
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?16548425225071";s:6:"source";s:77:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.js";s:3:"min";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.map.js";}"*/
(function(){BX.namespace("BX.UI.SidePanel");if(BX.UI.SidePanel.Wrapper){return}function t(t){}t.prototype.init=function(t){this.container=BX(t.containerId);this.isCloseAfterSave=t.isCloseAfterSave||false;this.isReloadGridAfterSave=t.isReloadGridAfterSave||false;this.isReloadPageAfterSave=t.isReloadPageAfterSave||false;this.skipNotification=t.skipNotification||false;this.useLinkTargetsReplacing=t.useLinkTargetsReplacing||false;this.notification=t.notification||{};var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));this.parentWindow=e?e.getWindow():top;this.initEditableTitle(t);if(this.isReloadGridAfterSave){if(this.getParam("reloadGridAfterSave")){this.reloadGridOnParentPage()}this.setParam("reloadGridAfterSave",true)}if(this.isCloseAfterSave){if(this.getParam("closeAfterSave")){var i;if(this.notification.content&&top.BX&&!this.getParam("skipNotification")){i=function(){top.BX.loadExt("ui.notification").then(function(){top.BX.UI.Notification.Center.notify(this.notification)}.bind(this))}.bind(this)}else if(this.isReloadPageAfterSave){i=function(){this.parentWindow.location.reload()}.bind(this)}BX.SidePanel.Instance.close(false,i)}if(this.skipNotification){this.setParam("skipNotification",true)}this.setParam("closeAfterSave",true)}if(this.useLinkTargetsReplacing){this.initLinkTargetsReplacing()}};t.prototype.initEditableTitle=function(t){if(!t.title||!t.title.selector||!t.title.defaultTitle){return}var i=this.container.querySelector(t.title.selector);if(!i){return}var n=i.querySelector('input[type="text"]');if(!n){return}i.style.display="none";e.init({dataContainer:i,dataNode:n,defaultTitle:t.title.defaultTitle})};t.prototype.initLinkTargetsReplacing=function(){this.replaceLinkTargets();if(!window.MutationObserver){return}var t=new MutationObserver(this.domMutationHandler.bind(this));t.observe(this.container,{childList:true,subtree:true})};t.prototype.domMutationHandler=function(t){t.forEach(function(t){for(var e=0;e<t.addedNodes.length;++e){var i=t.addedNodes.item(e);if(!i){continue}this.replaceLinkTargets(i)}},this)};t.prototype.replaceLinkTargets=function(t){if(!t){t=document.body}var e=[];if(t.tagName==="A"){e=[t]}else if(t.nodeName!=="#text"){e=BX.convert.nodeListToArray(t.querySelectorAll("a"))}if(e.length===0){return}BX.convert.nodeListToArray(e).filter(function(t){return!t.target}).forEach(function(t){t.target="_top"})};t.prototype.setParam=function(t,e){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.getData().set(t,e)}};t.prototype.getParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){return e.getData().get(t)}return undefined};t.prototype.removeParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){e.getData().delete(t)}};t.prototype.reloadGridOnParentPage=function(){var t=this.parentWindow;var e=BX.type.isString(this.isReloadGridAfterSave)?this.isReloadGridAfterSave:null;if(!t.BX.Main||!t.BX.Main.gridManager){return}if(e==="all"){t.BX.Main.gridManager.data.forEach(function(t){t.instance.reload()});return}if(!e&&t.BX.Main.gridManager.data){var i=t.BX.Main.gridManager.data;e=i.length>0?i[0].id:null}if(!e){return}var n=t.BX.Main.gridManager.getById(e);if(!n){return}n.instance.reload()};var e={isInit:false,init:function(t){this.dataNode=t.dataNode;this.titleNode=document.querySelector(".ui-side-panel-wrap-title-name");this.inputNode=document.querySelector(".ui-side-panel-wrap-title-input");this.buttonNode=document.querySelector(".ui-side-panel-wrap-title-edit-button");this.initialTitle=this.titleNode.textContent;this.defaultTitle=t.defaultTitle;BX.bind(this.dataNode,"bxchange",this.onDataNodeChange.bind(this));BX.bind(this.buttonNode,"click",this.startEdit.bind(this));BX.bind(this.inputNode,"keyup",this.onKeyUp.bind(this));BX.bind(this.inputNode,"blur",this.endEdit.bind(this));this.isInit=true;if(!t.disabled){this.enable()}if(!this.dataNode.value){this.dataNode.value=this.defaultTitle}},enable:function(t){t=t||false;if(!this.isInit){return}this.changeDisplay(this.buttonNode,!t);this.titleNode.textContent=!t?this.dataNode.value?this.dataNode.value:this.defaultTitle:this.initialTitle},disable:function(){this.enable(true)},onDataNodeChange:function(){this.titleNode.textContent=this.dataNode.value},onKeyUp:function(t){t=t||window.event;if(t.keyCode===10||t.keyCode===13){this.endEdit();t.preventDefault();return false}},getTitle:function(){var t=this.dataNode.value;if(!t){t=this.titleNode.textContent}return t},startEdit:function(){this.inputNode.value=this.getTitle();this.changeDisplay(this.titleNode,false);this.changeDisplay(this.buttonNode,false);this.changeDisplay(this.inputNode,true);this.inputNode.focus()},endEdit:function(){this.dataNode.value=this.inputNode.value;this.titleNode.textContent=this.inputNode.value;this.changeDisplay(this.inputNode,false);this.changeDisplay(this.buttonNode,true);this.changeDisplay(this.titleNode,true)},changeDisplay:function(t,e){return t.style.display=e?"":"none"}};BX.UI.SidePanel.Wrapper=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/rest.integration.edit/templates/.default/script.min.js?165484225022590";s:6:"source";s:76:"/bitrix/components/bitrix/rest.integration.edit/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/rest.integration.edit/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/rest.integration.edit/templates/.default/script.map.js";}"*/
(function(){var t=[];BX.namespace("BX.rest.integration");if(BX.rest.integration.edit){return}BX.rest.integration.edit={};function e(){this.items=null}e.prototype={init:function(){this.getItems()},getItems:function(){if(this.items){return this.items}var t=BX("rest-integration-form").querySelectorAll('[data-role="integration-hint"]');this.items=[];for(var e=0;e<t.length;e++){var i={};i.id=e;i.container=t[e];i.text=t[e].getAttribute("data-integration-hint-text");this.items.push(i)}this.loadData();return this.items},loadData:function(){for(var t=0;t<this.items.length;t++){this.addItem(this.items[t])}},addItem:function(t){var e=new i(t);e.hint=this;this.items[t.id]=e}};BX.rest.integration.edit.InitHint=e;function i(t){this.id=t.id;this.container=t.container;this.text=t.text;this.popup=null;this.init()}i.prototype={init:function(){this.addEvents()},addEvents:function(){BX.bind(this.container,"mouseenter",function(){this.getPopup().show()}.bind(this));BX.bind(this.container,"mouseleave",function(){this.getPopup().close()}.bind(this))},getPopup:function(){if(this.popup){return this.popup}this.popup=new BX.PopupWindow("integration-popup-hit-"+this.id,this.container,{className:"integration-popup-hit",darkMode:true,maxWidth:330,angle:true,content:this.text,offsetLeft:11,offsetTop:-12,bindOptions:{position:"top"},animationOptions:{show:{type:"opacity-transform"},close:{type:"opacity"}}});return this.popup}};BX.rest.integration.edit.InitHintItem=i;function n(t){this.target=t.target;this.items=t.items;this.section=t.section;this.code=t.code;this.container=null;this.init()}n.prototype={init:function(){this.loadData()},getItems:function(){return this.items},removeItem:function(t){this.items.splice(this.items.indexOf(t),1)},appendItem:function(t){var e=new r(t);e.paramControl=this;this.items[this.items.indexOf(this.getItemById(t.id))]=e},getItemById:function(t){for(var e=0;e<this.items.length;e++){if(this.items[e].id===t){return this.items[e]}}},loadData:function(){for(var t=0;t<this.items.length;t++){if(!this.items[t].id){this.items[t].id="unknown-integration-param-id-"+t}this.appendItem(this.items[t])}},addItem:function(t){this.items.push(t);this.appendItem(t);this.container.appendChild(this.getItemById(t.id).render(true))},getContainer:function(){if(this.container){return this.container}this.container=BX.create("div",{props:{className:"integration-table"}});return this.container},render:function(){for(var t=0;t<this.items.length;t++){this.getContainer().appendChild(this.items[t].render())}BX.cleanNode(this.target);this.target.appendChild(this.getContainer())}};BX.rest.integration.edit.ParamFieldsControl=n;function r(t){this.id=t.id;this.title=t.title;this.value=t.value;this.layout={container:null,title:null,titleValue:null,titleEdit:null,inputWrapper:null,input:null,remove:null};this.editMode=false;this.init()}r.prototype={init:function(){this.addEvents()},addEvents:function(){BX.bind(window,"click",function(t){if(t.target===this.layout.titleEdit){this.setEditMode();return}var e=t.target.closest(".integration-table-title");if(!e||t.target!==this.layout.title){if(this.editMode){if(e!==this.layout.title){this.resetEditMode();if(this.layout.titleInput.value.length===0){this.returnTitle()}else{this.updateTitle()}}}else{this.resetEditMode()}}}.bind(this))},getTitle:function(){if(this.layout.title){return this.layout.title}this.layout.title=BX.create("div",{props:{className:"integration-table-title"}});this.layout.titleValue=BX.create("div",{props:{className:"integration-table-title-value"},text:this.title});this.layout.titleEdit=BX.create("div",{props:{className:"integration-table-title-edit"},events:{click:function(){this.setEditMode();this.layout.titleInput.focus()}.bind(this)}});this.layout.titleInput=BX.create("input",{props:{type:"text",className:"integration-table-title-input",value:this.title,name:"QUERY["+this.paramControl.code+"][ITEMS][title][]"},events:{keydown:function(t){if(t.code==="Escape"){this.resetEditMode();this.returnTitle()}if(t.code==="Enter"){if(this.layout.titleInput.value.length===0){this.resetEditMode();this.returnTitle();return}this.resetEditMode();this.updateTitle()}}.bind(this)}});this.layout.title.appendChild(this.layout.titleValue);this.layout.title.appendChild(this.layout.titleEdit);this.layout.title.appendChild(this.layout.titleInput);return this.layout.title},getInput:function(){if(this.layout.inputWrapper){return this.layout.inputWrapper}this.layout.inputWrapper=BX.create("div",{props:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});if(typeof this.value==="undefined"){this.value=""}this.layout.input=BX.create("input",{props:{type:"text",className:"ui-ctl-element",value:this.value,name:"QUERY["+this.paramControl.code+"][ITEMS][value][]"},events:{blur:function(){BX.rest.integration.edit.makeCurlString()}.bind(this)}});this.layout.inputWrapper.appendChild(this.layout.input);return this.layout.inputWrapper},getRemove:function(){if(this.layout.remove){return this.layout.remove}this.layout.remove=BX.create("div",{props:{className:"integration-table-td-remove"},events:{click:function(){this.remove();this.paramControl.removeItem(this)}.bind(this)}});return this.layout.remove},remove:function(){var t;if(this.paramControl.getItems().indexOf(this)===0){t=true}this.layout.container.style.height=this.layout.container.offsetHeight+"px";BX.addClass(this.layout.container,"integration-table-row-hide");setTimeout(function(){this.layout.container.style.height="0px";this.layout.container.style.paddingTop="0px";if(t){this.layout.container.style.marginBottom="-30px"}}.bind(this),250);setTimeout(function(){this.layout.container.parentNode.removeChild(this.layout.container);BX.rest.integration.edit.makeCurlString()}.bind(this),500)},setEditMode:function(){this.editMode=true;BX.addClass(this.layout.title,"integration-table-title-edit-mode")},resetEditMode:function(){this.editMode=false;BX.removeClass(this.layout.title,"integration-table-title-edit-mode")},updateTitle:function(){this.title=this.layout.titleInput.value;this.layout.titleValue.innerText=this.layout.titleInput.value;BX.rest.integration.edit.makeCurlString()},returnTitle:function(){this.layout.titleInput.value=this.layout.titleValue.innerText},render:function(t){if(this.layout.container){return this.layout.container}this.layout.container=BX.create("div",{props:{className:t?"integration-table-row integration-table-row-show":"integration-table-row"},children:[BX.create("div",{props:{className:"integration-table-cell"},children:[this.getTitle()]}),BX.create("div",{props:{className:"integration-table-cell"},children:[this.getInput()]}),BX.create("div",{props:{className:"integration-table-cell"},children:[this.getRemove()]})]});if(t){setTimeout(function(){BX.removeClass(this.layout.container,"integration-table-row-show")}.bind(this),450)}return this.layout.container}};BX.rest.integration.edit.ParamFieldsControlItem=r;function o(){this.items=[]}o.prototype={init:function(){var t=BX("rest-integration-form").querySelectorAll('[data-role="integration-tab"]');for(var e=0;e<t.length;e++){var i={};i.id=e;i.container=t[e];i=new a(i);this.items.push(i);if(i.container.className.replace(/[\n\t]/g," ").indexOf("integration-tab-auto-open")>-1){i.openTab()}}}};BX.rest.integration.edit.InitTabs=o;function a(t){this.id=t.id;this.container=t.container;this.layout={title:null,container:null,wrapper:null,checkbox:null};this.open=false;this.init()}a.prototype={init:function(){this.initTitle();this.initWrapper();this.initContainer();this.initCheckbox()},setAutoHeight:function(){this.layout.wrapper.style.height=null;this.layout.wrapper.classList.add("integration-tab-wrapper-height-auto");BX.unbind(this.layout.wrapper,"transitionend",this.setAutoHeight.bind(this))},openTab:function(t){if(t){BX.bind(this.layout.wrapper,"transitionend",this.setAutoHeight.bind(this))}else{BX.bind(this.layout.wrapper,"transitionend",function(){this.layout.wrapper.style.height=null;this.layout.wrapper.classList.add("integration-tab-wrapper-height-auto");BX.unbindAll(this.layout.wrapper)}.bind(this))}this.open=true;BX.addClass(this.container,"integration-tab-open");if(this.layout.checkbox!==null){this.layout.checkbox.checked=true}var e=this.container.querySelectorAll(".integration-required");if(e.length>0){e.forEach(function(t){t.required=true})}this.layout.wrapper.style.height=this.layout.container.offsetHeight+"px"},closeTab:function(){this.layout.wrapper.style.height=this.layout.wrapper.offsetHeight+"px";this.layout.wrapper.classList.remove("integration-tab-wrapper-height-auto");var t=this.container.querySelectorAll("input[type=url]");t.forEach(function(t){t.value=""});this.open=false;BX.removeClass(this.container,"integration-tab-open");BX.addClass(this.container,"integration-tab-close");var e=this.container.querySelectorAll(".integration-required");if(e.length>0){e.forEach(function(t){t.required=false})}setTimeout(function(){this.layout.wrapper.style.height=0;BX.removeClass(this.container,"integration-tab-close");this.layout.checkbox.checked=false}.bind(this),200)},initWrapper:function(){this.layout.wrapper=this.container.querySelector(".integration-tab-wrapper")},initCheckbox:function(){this.layout.checkbox=this.container.querySelector(".integration-tab-checkbox")},initContainer:function(){this.layout.container=this.container.querySelector(".integration-tab-container")},initTitle:function(){this.layout.title=this.container.querySelector(".integration-tab-title");BX.bind(this.layout.title,"click",function(){if(this.open){this.closeTab()}else{this.openTab(true);BX.bind(this.layout.wrapper,"animationend",function(){this.scrollToItem(this.container);BX.unbindAll(this.layout.wrapper)}.bind(this))}}.bind(this))},scrollToItem:function(t){if(window.safari){var e=document.body,i=document.documentElement,n=window.pageYOffset,r;var o=setInterval(function(){r=Math.max(e.scrollHeight,e.offsetHeight,i.clientHeight,i.scrollHeight,i.offsetHeight);n+=10;window.scrollTo(0,n);if(n>=i.scrollTop+i.clientHeight){clearInterval(o)}},10);return}window.scrollTo({top:BX.pos(t).top,behavior:"smooth"})}};BX.rest.integration.edit.InitTabsItem=a;BX.rest.integration.edit.makeCurlString=function(){BX.rest.integration.edit.setMethodLink();var e=BX("rest-integration-form").querySelector("#webhookURL");if(typeof t==="object"&&e!==null){var i,n,r;for(var o in t){r="";if(t.hasOwnProperty(o)&&typeof t[o]["items"]==="object"&&t[o]["items"].length>0){for(var a=0;a<t[o]["items"].length;a++){if(r!==""){r+="&"}r+=t[o]["items"][a]["title"]+"=";if(typeof t[o]["items"][a]["layout"]["input"]["value"]==="string"){r+=t[o]["items"][a]["layout"]["input"]["value"]}}}i=BX("rest-integration-form").querySelector('.integration-webhook-method-api-select input[name="QUERY['+o+'][METHOD]"]');n=BX("rest-integration-form").querySelector('.integration-curl-uri[data-key="'+o+'"]');if(i!==null&&n!==null){if(r!==""){r="?"+r}n.value=e.value+i.value+".json"+r}}}};BX.rest.integration.edit.setMethodLink=function(){BX("rest-integration-form").querySelectorAll(".integration-method-url").forEach(function(t){var e=BX("rest-integration-form").querySelector('input[name="QUERY['+t.dataset.key+'][METHOD]"]');if(e!==null){BX.adjust(t,{props:{href:restIntegrationEditComponent.uriToMethodInfo+e.value}})}})};BX.rest.integration.edit.inputApiOnlyChange=function(){var t=BX("rest-integration-form").querySelector('#rest-integration-form input[name="APPLICATION_ONLY_API"]');if(t!==null){var e=BX("rest-integration-form").querySelectorAll("#applicationLang .integration-required-lang");if(!t.checked){BX.show(BX("applicationLang"));e.forEach(function(t){t.required=true})}else{BX.hide(BX("applicationLang"));e.forEach(function(t){t.required=false});var i=BX("rest-integration-form").querySelector('#rest-integration-form #applicationType input[value="SERVER"]');if(i!==null){if(!i.checked){i.checked=true;BX.fireEvent(i,"change")}}}}};BX.rest.integration.edit.initParams=function(){this.savedDo=false;var e=new BX.rest.integration.edit.InitTabs;var i=new BX.rest.integration.edit.InitHint({items:BX("rest-integration-form").querySelectorAll('[data-role="integration-hint"]')});BX.rest.integration.edit.inputApiOnlyChange();BX.bind(BX("rest-integration-form"),"submit",BX.delegate(BX.rest.integration.edit.actionSaveForm,this));var r=BX("rest-integration-form").querySelectorAll("#rest-integration-form .integration-post-open");if(r.length>0){for(var o=0;o<r.length;o++){BX.bind(r[o],"click",BX.delegate(BX.rest.integration.edit.openPostUri,this))}}r=BX("rest-integration-form").querySelectorAll("#rest-integration-form .integration-example-url");if(r.length>0){for(var a=0;a<r.length;a++){BX.bind(r[a],"click",BX.delegate(BX.rest.integration.edit.openUri,this))}}BX.bind(BX("rest-integration-form").querySelector('#rest-integration-form input[name="APPLICATION_ONLY_API"]'),"change",BX.delegate(BX.rest.integration.edit.inputApiOnlyChange,this));BX("rest-integration-form").querySelectorAll("#rest-integration-form .integration-curl-uri-button").forEach(function(t){BX.bind(t,"click",BX.rest.integration.edit.actionCurlQuery)});BX("rest-integration-form").querySelectorAll("#rest-integration-form .integration-action-dropdown").forEach(function(t){BX.bind(t,"click",BX.rest.integration.edit.actionDropdown)});BX("rest-integration-form").querySelectorAll("#rest-integration-form #applicationType input").forEach(function(t){BX.bind(t,"change",BX.rest.integration.edit.changeAppType)});BX.bind(BX("rest-integration-form").querySelector("#rest-integration-form #integrationSaveBot"),"click",BX.delegate(BX.rest.integration.edit.actionSaveBtnClick,this));BX.bind(BX("rest-integration-form").querySelector("#rest-integration-form #integrationGenerateWebhook"),"click",BX.delegate(BX.rest.integration.edit.actionSaveRegenBtnClick,this));BX.bind(BX("rest-integration-form").querySelector('#rest-integration-form input[name="APP_ZIP"]'),"change",BX.delegate(BX.rest.integration.edit.loadFileApplication,this));BX.addCustomEvent("SidePanel.Slider:onClose",this.onCloseSlider.bind(this));if(typeof restIntegrationEditComponent==="object"&&typeof restIntegrationEditComponent.queryProps==="object"){var s;for(var l in restIntegrationEditComponent.queryProps){if(restIntegrationEditComponent.queryProps.hasOwnProperty(l)){s=restIntegrationEditComponent.queryProps[l].CODE;t[s]=new n({target:document.getElementById("integration-webhook-param-"+s),items:restIntegrationEditComponent.queryProps[l].ITEMS,section:restIntegrationEditComponent.queryProps[l].TITLE,code:restIntegrationEditComponent.queryProps[l].CODE});t[s].render();BX.bind(BX("integration-webhook-add-param-"+s),"click",function(){var e=this.dataset.key;t[e].addItem({id:"newparam"+Math.random(),title:"NEW_PARAM"});BX.rest.integration.edit.makeCurlString()})}}BX.rest.integration.edit.makeCurlString()}i.init();e.init()};BX.rest.integration.edit.onCloseSlider=function(t){var e=t.getSlider();if(!!restIntegrationEditComponent.needConfirmCloseSliderWithDelete&&(typeof e.data.NEW_OPEN==="undefined"||e.data.NEW_OPEN!=="N")){this.popupWindow=BX.PopupWindowManager.create("rest-integration-edit-on-slider-close",null,{content:BX.message("REST_INTEGRATION_EDIT_CLOSE_SLIDER_CLOSE"),titleBar:BX.message("REST_INTEGRATION_EDIT_CLOSE_SLIDER_CLOSE_TITLE"),width:400,height:200,padding:10,closeByEsc:true,contentColor:"white",angle:false,buttons:[new BX.PopupWindowButton({text:BX.message("REST_INTEGRATION_EDIT_CLOSE_SLIDER_YES"),className:"popup-window-button-accept",events:{click:function(){BX.ajax.runComponentAction("bitrix:rest.integration.edit","delete",{mode:"class",signedParameters:restIntegrationEditComponent.signetParameters,data:{},analyticsLabel:{type:"integrationDownloadExample",integrationCode:restIntegrationEditComponent.integrationCode}}).then(function(t){e.data={close:true};e.close()})}}}),new BX.PopupWindowButton({text:BX.message("REST_INTEGRATION_EDIT_CLOSE_SLIDER_CANCEL"),className:"popup-window-button-cancel",events:{click:function(){this.popupWindow.close()}}})]}).show();if(typeof e.data.close==="undefined"||e.data.close===false){t.denyAction()}}};BX.rest.integration.edit.loadFileApplication=function(t){if(t.target.files.length>0&&t.target.files[0]["size"]>0){var e=BX("rest-integration-form").querySelector("#applicationZip .ui-ctl-label-text");BX.cleanNode(e);e.textContent=t.target.files[0]["name"]}else{BX.UI.Notification.Center.notify({content:BX.message("REST_INTEGRATION_EDIT_TAB_APPLICATION_ZIP_INPUT_LABEL")})}};BX.rest.integration.edit.changeAppType=function(t){var e,i,n;var r=t.target.value;var o=BX("rest-integration-form").querySelector("#applicationServer");var a=BX("rest-integration-form").querySelector("#applicationZip");var s=BX("rest-integration-form").querySelector('#rest-integration-form input[name="APPLICATION_ONLY_API"]');if(r==="ZIP"){BX.hide(o);BX.show(a);e=a.querySelectorAll(".integration-required");i=o.querySelectorAll(".integration-required");n=o.querySelectorAll("input");s.checked=false;BX.fireEvent(s,"change")}else{BX.hide(a);BX.show(o);e=o.querySelectorAll(".integration-required");i=a.querySelectorAll(".integration-required");n=a.querySelectorAll("input");var l=BX("rest-integration-form").querySelector("#applicationZip .ui-ctl-label-text");if(l){BX.cleanNode(l);l.textContent=BX.message("REST_INTEGRATION_EDIT_TAB_APPLICATION_ZIP_INPUT_LABEL")}}if(e.length>0){e.forEach(function(t){t.required=true})}if(i.length>0){i.forEach(function(t){t.required=false})}if(n.length>0){n.forEach(function(t){t.value="";if(t.type==="file"){t.type="text";t.type="file"}})}};BX.rest.integration.edit.actionDropdown=function(){var t;var e=this.dataset.id;var i=this.dataset.selector;var n=this.dataset.required;var r=BX.hasClass(this,"active")===true;if(r){BX.removeClass(this,"active")}else{BX.addClass(this,"active")}BX("rest-integration-form").querySelectorAll("#"+e+" ."+i).forEach(function(e){if(r){t=BX.findChild(e,{tag:"input"},true);if(t.value===""&&BX.hasClass(t,n)===false){BX.addClass(e,"hidden")}}else{BX.removeClass(e,"hidden")}})};BX.rest.integration.edit.actionCurlQuery=function(){if(restIntegrationEditComponent.hasOwnProperty("pathIframe")&&restIntegrationEditComponent.pathIframe!==""){var t=BX("rest-integration-form").querySelector('input[data-key="'+this.dataset.key+'"]');if(t!==null){var e="type=integrationRun";if(restIntegrationEditComponent.hasOwnProperty("integrationCode")&&restIntegrationEditComponent.integrationCode!==""){e+="&integrationCode="+restIntegrationEditComponent.integrationCode}BX.SidePanel.Instance.open(restIntegrationEditComponent.pathIframe+"?"+e,{requestMethod:"post",requestParams:{query:t.value,sessid:BX.bitrix_sessid()},allowChangeHistory:false,cacheable:false})}}};BX.rest.integration.edit.actionSaveBtnClick=function(){BX.rest.integration.edit.savedDo=false;BX("integration-save-mode").value="SAVE";BX.submit(BX("rest-integration-form"),"save","Y",function(){if(!BX.rest.integration.edit.savedDo){BX.removeClass(BX("ui-button-panel-save"),"ui-btn-wait")}})};BX.rest.integration.edit.actionSaveRegenBtnClick=function(){BX.addClass(BX("integrationGenerateWebhook"),"ui-btn-wait");BX.UI.Dialogs.MessageBox.show({message:BX.create("div",{children:[BX.create("p",{text:BX.message("REST_INTEGRATION_EDIT_CONFIRM_POPUP_DESCRIPTION")})]}),title:BX.message("REST_INTEGRATION_EDIT_CONFIRM_POPUP_TITLE"),popupOptions:{closeIcon:true},modal:true,bindElement:BX(this.id),buttons:[new BX.UI.Button({color:BX.UI.Button.Color.PRIMARY,state:BX.UI.Button.State.ACTIVE,text:BX.message("REST_INTEGRATION_EDIT_CONFIRM_POPUP_BTN_CONTINUE"),onclick:BX.delegate(function(t){BX("integration-save-mode").value="GEN_SAVE";BX.submit(BX("rest-integration-form"),"SAVE","Y",function(){BX.removeClass(BX("integrationGenerateWebhook"),"ui-btn-wait");BX.removeClass(BX("ui-button-panel-save"),"ui-btn-wait")});t.context.close()},this)}),new BX.UI.CancelButton({events:{click:function(){BX.removeClass(BX("integrationGenerateWebhook"),"ui-btn-wait");BX.removeClass(BX("ui-button-panel-save"),"ui-btn-wait");this.getContext().close()}}})]})};BX.rest.integration.edit.openPostUri=function(t){t.preventDefault();var e=document.getElementById("rest-integration-form");var i=e.querySelector('input[name="sessid"]');i.value="";e.setAttribute("action",t.target.href);e.setAttribute("target","_blank");e.submit();e.setAttribute("action","");e.setAttribute("target","");i.value=BX.bitrix_sessid()};BX.rest.integration.edit.openUri=function(t){if(restIntegrationEditComponent.hasOwnProperty("integrationCode")&&restIntegrationEditComponent.integrationCode!==""){BX.ajax.runComponentAction("bitrix:rest.integration.edit","analytic",{mode:"class",signedParameters:restIntegrationEditComponent.signetParameters,data:{},analyticsLabel:{type:"integrationDownloadExample",integrationCode:restIntegrationEditComponent.integrationCode}})}};BX.rest.integration.edit.actionSaveForm=function(t){t.preventDefault();var e=BX("rest-integration-form").querySelector('#rest-integration-form #applicationType input[value="ZIP"]');if(e!==null&&!!e.checked){var i=BX("rest-integration-form").querySelector('#applicationZip input[type="file"]');if(i!==null&&(!(i.files.length>0)||!(i.files[0]["size"]>0))){BX.UI.Notification.Center.notify({content:BX.message("REST_INTEGRATION_EDIT_TAB_APPLICATION_ZIP_NO_FILE")});return false}}BX.rest.integration.edit.savedDo=true;BX.addClass(BX("ui-button-panel-save"),"ui-btn-wait");var n=BX("rest-integration-form-error");n.style.display="none";BX.cleanNode(n);var r=BX("rest-integration-form").querySelectorAll('input[type="url"]');r.forEach(function(t){t.type="text"});var o={mode:"class",c:"bitrix:rest.integration.edit",action:"saveData"};var a="/bitrix/services/main/ajax.php?"+BX.ajax.prepareData(o);BX.ajax.submitAjax(BX("rest-integration-form"),{method:"POST",url:a,processData:true,data:{signedParameters:restIntegrationEditComponent.signetParameters},onsuccess:function(t){t=BX.parseJSON(t,{});if(typeof t.data=="object"&&t.data.status===true){var e=BX.SidePanel.Instance.getTopSlider();e.data={NEW_OPEN:"N"};e.reload()}else{if(!!t.data.helperCode&&t.data.helperCode!==""){top.BX.UI.InfoHelper.show(t.data.helperCode)}else{if(!!t.data.errors){t.data.errors.forEach(function(t){n.style.display="block";BX.ready(function(){BX.append(BX.create("div",{props:{className:"ui-alert ui-alert-danger"},children:[BX.create("span",{className:"ui-alert-message",text:t})]}),n)})})}}BX.scrollToNode(BX("pagetitle"))}BX.removeClass(BX("ui-button-panel-save"),"ui-btn-wait");r.forEach(function(t){t.type="url"})}})}})(window);BX.ready(function(){BX.rest.integration.edit.initParams()});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/rest.integration.selector/templates/.default/script.min.js?16548422513692";s:6:"source";s:80:"/bitrix/components/bitrix/rest.integration.selector/templates/.default/script.js";s:3:"min";s:84:"/bitrix/components/bitrix/rest.integration.selector/templates/.default/script.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/rest.integration.selector/templates/.default/script.map.js";}"*/
(function(){BX.namespace("BX.rest.integration");if(BX.rest.integration.selector){return}function Selector(t){this.init(t)}Selector.prototype.init=function(t){this.manager=t.manager;this.id=t.id;this.scopeSelectorName=t.scopeSelectorName;this.pathToAdd=t.pathToAdd;this.pathToEdit=t.pathToEdit;this.onChange=t.onChange;this.context=BX(t.containerId);this.signetParameters=t.signetParameters;this.action=t.action;this.mess=t.mess||{searchTitle:""};this.ajaxUses=false;this.initSelector();top.BX.addCustomEvent(top,"rest-integration-edit-change",this.onCampaignChange.bind(this))};Selector.prototype.initSelector=function(){this.selector=BX.UI.TileSelector.getById(this.id);if(!this.selector){throw new Error("Tile selector `"+this.id+"` not found.")}BX.addCustomEvent(this.selector,this.selector.events.buttonSelect,this.onButtonSelect.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonSelectFirst,this.onButtonSelectFirst.bind(this));BX.addCustomEvent(this.selector,this.selector.events.buttonAdd,this.onButtonAdd.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileClick,this.onTileClick.bind(this));BX.addCustomEvent(this.selector,this.selector.events.input,this.onInput.bind(this));BX.addCustomEvent(this.selector,this.selector.events.search,this.onSearch.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileRemove,this.onTileRemove.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileAdd,this.onTileAdd.bind(this))};Selector.prototype.onTileAdd=function(tile){if(this.scopeSelectorName!==""){var scopeTile=BX.UI.TileSelector.getById(this.scopeSelectorName);if(!!scopeTile){BX.ajax.runComponentAction("bitrix:rest.integration.selector","getNeededScope",{mode:"class",signedParameters:this.signetParameters,data:{code:tile.id,action:this.action}}).then(function(t){if(t.status==="success"&&typeof t.data=="object"&&t.data.length>0){var e=null;t.data.forEach(function(t){e=scopeTile.getTile(t.id);if(e===null){scopeTile.addTile(t.name,{},t.id)}})}})}}if(this.onChange!==""){eval(this.onChange)}};Selector.prototype.onTileRemove=function(tile){if(this.onChange!==""){eval(this.onChange)}};Selector.prototype.getSearcherData=function(){if(this.ajaxUses===false){var t=this.selector;BX.ajax.runComponentAction("bitrix:rest.integration.selector","get"+this.action,{mode:"class",signedParameters:this.signetParameters}).then(function(e){if(e.status==="success"&&typeof e.data=="object"&&typeof e.data.list=="object"){t.setSearcherData(e.data.list||[])}else{t.hideSearcher.bind(t)}});this.ajaxUses=true}};Selector.prototype.onButtonSelect=function(){this.selector.showSearcher(this.mess.searchTitle)};Selector.prototype.onButtonSelectFirst=function(){this.getSearcherData()};Selector.prototype.onButtonAdd=function(){};Selector.prototype.onTileClick=function(t){this.getSearcherData();this.selector.showSearcher(this.mess.searchTitle)};Selector.prototype.onInput=function(t){};Selector.prototype.onSearch=function(t){};Selector.prototype.fire=function(t,e){e=e||{};BX.onCustomEvent(this,t,e)};Selector.prototype.actualizeTiles=function(t,e){var i=this.selector.getTile(t.id);if(i){this.selector.updateTile(i,t.name,t.data,t.bgcolor,t.color)}else if(e){this.selector.addTile(t.name,t.data,t.id,t.bgcolor,t.color)}};Selector.prototype.actualize=function(t,e){this.selector.clearSearcher();this.actualizeTiles(t,e)};Selector.prototype.onCampaignChange=function(t){this.actualize(t,this.isAdding);this.isAdding=false};function Manager(){}Manager.prototype.create=function(t){return new Selector(t)};BX.rest.integration.selector=Selector;BX.rest.integration.selectorManager=new Manager})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js?165484252314283";s:6:"source";s:71:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.map.js";}"*/
(function(t){BX.namespace("BX.UI");if(BX.UI.TileSelector){return}var e=[];function i(t){this.id=t.id;this.name=t.name||null;this.node=t.node;this.data=t.data;this.removeNode=null;this.nameNode=o.getNode("tile-item-name",this.node);if(!this.name){this.name=this.nameNode.textContent}}i.prototype.changeRemoving=function(t){if(!this.removeNode){return}this.removeNode.style.display=t?"":"none"};function n(t){this.init(t)}n.prototype.events={containerClick:"container-click",tileClick:"tile-click",tileRemove:"tile-remove",tileEdit:"tile-edit",tileAdd:"tile-add",buttonAdd:"add",buttonSelect:"select",buttonSelectFirst:"select-first",search:"search",input:"input",searcherCategoryClick:"popup-category-click",searcherItemClick:"popup-item-click",searcherInit:"popup-search-init"};n.getById=function(t){var i=e.filter(function(e){return e.id===t&&document.body.contains(e.context)});return i.length>0?i[0]:null};n.getList=function(){return e};n.prototype.init=function(t){this.list=[];this.id=t.id;this.context=BX(t.containerId);this.duplicates=t.duplicates;this.multiple=t.multiple;this.readonly=t.readonly;this.manualInputEnd=t.manualInputEnd;this.caption=t.caption;this.captionMore=t.captionMore;this.tilesLimit=!!t.tilesLimit?parseInt(t.tilesLimit):10;this.attributeId="data-bx-id";this.attributeData="data-bx-data";this.tileContainer=o.getNode("tile-container",this.context);this.tileTemplate=o.getNode("tile-template",this.context);this.input=o.getNode("tile-input",this.context);this.buttonAdd=o.getNode("tile-add",this.context);this.buttonSelect=o.getNode("tile-select",this.context);this.buttonMore=o.getNode("tile-more",this.context);if(!this.context||!this.input){return}o.getNodes("tile-item",this.context).forEach(this.initNode.bind(this));if(!this.readonly){this.initEventHandlers()}this.searcher=null;e.push(this)};n.prototype.initEventHandlers=function(){if(this.buttonAdd){BX.bind(this.buttonAdd,"click",this.onButtonAdd.bind(this))}if(this.context){BX.bind(this.context,"click",this.onContainerClick.bind(this))}if(this.buttonSelect){BX.bind(this.buttonSelect,"click",this.onButtonSelect.bind(this));BX.bind(this.tileContainer,"click",this.onButtonSelect.bind(this))}BX.bind(this.input,"input",this.onInput.bind(this));if(this.buttonMore){BX.bind(this.buttonMore,"click",this.onButtonMore.bind(this))}if(!this.manualInputEnd){BX.bind(this.input,"blur",this.onInputEnd.bind(this));o.handleKeyEnter(this.input,this.onInputEnd.bind(this))}BX.bind(this.input,"keydown",function(t){if(t.key==="Enter"){t.preventDefault();t.stopPropagation();return false}})};n.prototype.getSearchInput=function(){return this.input};n.prototype.isSearcherInit=function(){return!!this.searcher};n.prototype.clearSearcher=function(){this.isButtonSelectFired=false;if(this.searcher){this.searcher.hide();this.searcher=null}};n.prototype.hideSearcher=function(){this.searcher.hide()};n.prototype.showSearcher=function(t){if(!this.searcher){this.searcher=new s({id:this.id,caller:this,context:this.context,title:t||""});this.fire(this.events.searcherInit,[this.searcher])}this.searcher.filterByName();this.searcher.show()};n.prototype.setSearcherData=function(t){if(!this.searcher){this.showSearcher()}this.searcher.setCategories(t)};n.prototype.initNode=function(t){if(!t){return null}var e=t.getAttribute(this.attributeId);var n=t.getAttribute(this.attributeData);try{n=JSON.parse(n)}catch(t){try{n=JSON.parse(BX.util.htmlspecialcharsback(n))}catch(t){n={}}}var s=new i({id:e,node:t,data:n});if(s.id&&!this.duplicates&&this.findDuplicates(s.id)){s=null;return null}s.removeNode=o.getNode("remove",t);if(s.removeNode){BX.bind(s.removeNode,"click",this.onRemove.bind(this,s))}BX.bind(t,"click",this.onClick.bind(this,s));this.list.push(s);return s};n.prototype.onRemove=function(t,e){e.preventDefault();e.stopPropagation();this.removeTile(t);if(BX.UI.SelectorManager){var i=BX.UI.SelectorManager.instances[this.id];if(i&&i.callback.unSelect){if(BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyString(t.data.entityType)){i.callback.unSelect({item:i.entities[t.data.entityType.toUpperCase()].items[t.id.match(/^\d+$/)?"U"+t.id:t.id],entityType:t.data.entityType,selectorId:i.id})}}}return false};n.prototype.onClick=function(t,e){e.preventDefault();e.stopPropagation();this.fire(this.events.tileClick,[t])};n.prototype.removeTiles=function(){var t=this.list;t.forEach(this.removeTile.bind(this))};n.prototype.removeTile=function(t){this.list=BX.util.deleteFromArray(this.list,this.list.indexOf(t));BX.remove(t.node);this.fire(this.events.tileRemove,[t]);this.recalcButtonSelectText();if(this.buttonMore.style.display!="none"){this.recalcMore()}};n.prototype.recalcMore=function(){if(this.checkTilesLimit({action:"remove"})){this.buttonMore.style.display="none"}o.getNodes("tile-item",this.context).forEach(function(t,e){t.style.display=e>=this.tilesLimit?"none":""}.bind(this))};n.prototype.getTile=function(t){var e=this.list.filter(function(e){return e.id===t});return e.length>0?e[0]:null};n.prototype.getTilesData=function(){return this.list.map(function(t){return t.data})};n.prototype.getTilesId=function(){return this.list.map(function(t){return t.id}).filter(function(t){return!!t})};n.prototype.getTiles=function(){return this.list};n.prototype.findDuplicates=function(t){var e=this.getTile(t);if(!e){return false}this.removeTile(e)};n.prototype.addTile=function(t,e,i,n,s){if(!t||this.readonly){return null}if(!this.multiple){this.removeTiles();if(this.isSearcherInit()){this.hideSearcher()}}e=e||{};i=i||"";s=s||"";n=n||"";var r=this.tileTemplate;if(!r){return null}r=r.innerHTML;var a="";if(s){a+="color: "+BX.util.htmlspecialchars(s)+"; "}if(n){a+="background-color: "+BX.util.htmlspecialchars(n)+"; "}if(BX.type.isNotEmptyString(e.state)&&e.state=="init"){a+=this.checkTilesLimit({action:"init"})?"":"display: none;"}var l=BX.type.isNotEmptyString(e.entityType)?e.entityType.toLowerCase():"none";if(!!e.extranet){l+="-extranet"}if(!!e.crmEmail){l+="-crm"}r=o.replace(r,{id:BX.util.htmlspecialchars(i+""),name:BX.util.htmlspecialchars(t),data:BX.util.htmlspecialchars(JSON.stringify(e)),style:a,type:l,readonly:!!e.readonly?"yes":"no"},true);var c=document.createElement("div");c.innerHTML=r;c=c.children[0];var h=this.initNode(c);if(!h){return null}this.buttonMore.parentNode.insertBefore(c,this.buttonMore);this.fire(this.events.tileAdd,[h]);this.recalcButtonSelectText();return h};n.prototype.updateTile=function(t,e,i,n,o){if(!t||this.readonly){return null}e=e||null;i=i||null;n=n||null;o=o||null;if(e){t.nameNode.textContent=e}if(i){t.data=i}if(n||n===null){t.node.style.backgroundColor=n}if(o){t.node.style.color=o}this.fire(this.events.tileEdit,[t]);return t};n.prototype.checkTilesLimit=function(t){var e=true,i=o.getNodes("tile-item",this.context).length,n=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.action)?t.action:null;if(i>=this.tilesLimit){e=false;this.buttonMore.style.display="";this.buttonMore.title=BX.message("UI_TILE_SELECTOR_MORE").replace("#NUM#",i-this.tilesLimit+(n=="init"?1:0))}return e};n.prototype.fire=function(t,e){BX.onCustomEvent(this,t,e)};n.prototype.onInput=function(){var t=this.input.value;if(this.searcher&&t.length>0){this.searcher.filterByName(t)}this.fire(this.events.input,[this.input.value])};n.prototype.onInputEnd=function(){var t=this.input.value;this.input.value="";o.changeDisplay(this.input,false);o.changeDisplay(this.buttonSelect,true);this.recalcButtonSelectText();this.fire(this.events.search,[t])};n.prototype.onButtonAdd=function(t){t.preventDefault();t.stopPropagation();this.fire(this.events.buttonAdd,[])};n.prototype.onContainerClick=function(){this.fire(this.events.containerClick,[])};n.prototype.onButtonSelect=function(t){t.preventDefault();t.stopPropagation();o.changeDisplay(this.buttonSelect,false);o.changeDisplay(this.input,true);this.input.focus();this.fire(this.events.buttonSelect,[]);if(!this.isButtonSelectFired){this.fire(this.events.buttonSelectFirst,[]);this.isButtonSelectFired=true}};n.prototype.onButtonMore=function(t){t.preventDefault();t.stopPropagation();o.getNodes("tile-item",this.context).forEach(function(t){t.style.display=""});t.currentTarget.style.display="none"};n.prototype.recalcButtonSelectText=function(){if(!this.buttonSelect){return}var t=this.getTiles();this.buttonSelect.innerHTML=t.length>0?this.captionMore:this.caption};var o={getObjectByKey:function(t,e,i){var n=t.filter(function(t){return t.hasOwnProperty(e)&&t[e]===i});return n.length>0?n[0]:null},getNode:function(t,e){var i=this.getNodes(t,e);return i.length>0?i[0]:null},getNodes:function(t,e){if(!e){return[]}return BX.convert.nodeListToArray(e.querySelectorAll('[data-role="'+t+'"]'))},changeClass:function(t,e,i){if(!t){return}if(i){BX.addClass(t,e)}else{BX.removeClass(t,e)}},changeDisplay:function(t,e){if(!t){return}t.style.display=e?"":"none"},replace:function(t,e,i){e=e||{};i=i||false;if(!t){return""}for(var n in e){if(!e.hasOwnProperty(n)){continue}var o=e[n];o=o||"";if(!i&&o){o=BX.util.htmlspecialchars(o)}t=t.replace(new RegExp("%"+n+"%","g"),o)}return t},handleKeyEnter:function(e,i){if(!i){return}var n=function(e){e=e||t.event;if(e.keyCode===10||e.keyCode===13){e.preventDefault();e.stopPropagation();i();return false}};BX.bind(e,"keyup",n)},getTemplatedNode:function(t,e,i){if(!t){return null}var n=o.replace(t.innerHTML,e,i);var s=document.createElement("div");s.innerHTML=n;return s.children[0]}};function s(t){this.init(t)}s.prototype.classNameCategoryActive="ui-tile-selector-searcher-sidebar-item-selected";s.prototype.classNameItemActive="ui-tile-selector-searcher-content-item-selected";s.prototype.init=function(t){this.id=t.id;this.context=t.context;this.caller=t.caller;this.categories=[];this.items=[];this.currentCategory=null;this.categoryTemplate=o.getNode("popup-category-template",this.context);this.itemTemplate=o.getNode("popup-item-template",this.context);this.content=o.getTemplatedNode(o.getNode("popup-template",this.context));this.loader=o.getNode("popup-loader",this.content);this.categoryContainer=o.getNode("popup-category-list",this.content);this.itemContainer=o.getNode("popup-item-list",this.content);this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";this.title=o.getNode("popup-title",this.content);if(this.title){this.title.textContent=t.title}if(t.dataList){this.setCategories(t.dataList)}BX.addCustomEvent(this.caller,this.caller.events.tileAdd,this.onTileAdd.bind(this));BX.addCustomEvent(this.caller,this.caller.events.tileRemove,this.onTileRemove.bind(this))};s.prototype.onTileAdd=function(t){var e=o.getObjectByKey(this.items,"id",t.id);if(!e){return}o.changeClass(e.node,this.classNameItemActive,true)};s.prototype.onTileRemove=function(t){var e=o.getObjectByKey(this.items,"id",t.id);if(!e){return}o.changeClass(e.node,this.classNameItemActive,false)};s.prototype.filterByName=function(t){t=t||"";if(t.length<3){o.changeDisplay(this.categoryContainer,true);this.setCurrentCategory();return}var e=new RegExp(BX.util.escapeRegExp(t),"i");this.items.forEach(function(t){o.changeDisplay(t.node,e.test(t.name))});o.changeDisplay(this.categoryContainer,false)};s.prototype.onCategoryClick=function(t){this.setCurrentCategory(t);this.caller.fire(this.caller.events.searcherCategoryClick,[t])};s.prototype.setCurrentCategory=function(t){t=t||this.categories[0];if(this.currentCategory){BX.removeClass(this.currentCategory.node,this.classNameCategoryActive)}this.currentCategory=t;if(!t){return}BX.addClass(this.currentCategory.node,this.classNameCategoryActive);this.items.forEach(function(e){o.changeDisplay(e.node,e.category===t)})};s.prototype.onItemClick=function(t){this.caller.addTile(t.name,t.data,t.id,t.bgcolor,t.color);this.caller.fire(this.caller.events.searcherItemClick,[t])};s.prototype.getCategory=function(t){return o.getObjectByKey(this.categories,"id",t)};s.prototype.getItem=function(t){return o.getObjectByKey(this.items,"id",t)};s.prototype.updateItem=function(t,e,i){if(e){t.node.textContent=e;t.node.title=e}if(i){t.data=i}};s.prototype.addItem=function(t,e,i,n){var s=o.getTemplatedNode(this.itemTemplate,{name:i});var r={category:t,node:s,id:e,name:i,data:n||{}};this.items.push(r);this.itemContainer.appendChild(s);BX.bind(s,"click",this.onItemClick.bind(this,r));return r};s.prototype.setItems=function(t,e){this.items=[];e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};s.prototype.addItems=function(t,e){e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};s.prototype.addCategory=function(t,e,i,n){var s=o.getTemplatedNode(this.categoryTemplate,{name:e});var r={node:s,id:t,name:e,data:i||{}};this.categories.push(r);this.categoryContainer.appendChild(s);BX.bind(s,"click",this.onCategoryClick.bind(this,r));this.addItems(r,n);return r};s.prototype.setCategories=function(t){this.items=[];this.categories=[];this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";t.forEach(function(t){this.addCategory(t.id,t.name,t.data,t.items)},this);if(this.categories.length>0){this.setCurrentCategory(this.categories[0])}var e=this.caller.getTilesId();this.items.filter(function(t){var i=t.id&&BX.util.in_array(t.id,e);o.changeClass(t.node,this.classNameItemActive,i)},this);o.changeDisplay(this.loader,false);o.changeDisplay(this.itemContainer,true);o.changeDisplay(this.categoryContainer,true)};s.prototype.showLoader=function(){o.changeDisplay(this.loader,true)};s.prototype.hide=function(){if(!this.popup){return}this.popup.close()};s.prototype.show=function(){if(this.popup){this.popup.show();return}this.popup=BX.Main.PopupManager.create(this.id,this.context,{width:620,height:290,autoHide:true,lightShadow:true,closeByEsc:true,closeIcon:false,offsetLeft:40,angle:true,buttons:[new BX.UI.CloseButton({onclick:function(){this.popup.close()}.bind(this)})]});this.popup.setContent(this.content);o.changeDisplay(this.content,true);this.popup.show()};BX.UI.TileSelector=n;BX.addCustomEvent("BX.Main.SelectorV2:onGetDataStart",function(t){var e=BX("ui-tile-selector-"+t+"-mask");if(!e){return}e.classList.add("ui-tile-selector-selector-mask-active")});BX.addCustomEvent("BX.Main.SelectorV2:onGetDataFinish",function(t){var e=BX("ui-tile-selector-"+t+"-mask");if(!e){return}e.classList.remove("ui-tile-selector-selector-mask-active")})})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?16548425221109";s:6:"source";s:70:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.UI");var t=function(){this.layout={container:null}};t.prototype={init:function(t){this.layout.container=BX(t.containerId);this.isFrame=t.isFrame||false;this.hasHints=t.hasHints||false;this.pinner=new BX.UI.Pinner(this.layout.container,{fixBottom:this.isFrame,fullWidth:this.isFrame});if(this.hasHints){BX.UI.Hint.init(this.layout.container)}t.buttons.forEach(this.initButton,this)},getContainer:function(){return this.layout.container},hide:function(){if(!this.layout.container){return}this.layout.container.classList.add("ui-button-panel-wrapper-hide")},show:function(){this.layout.container.classList.remove("ui-button-panel-wrapper-hide")},initButton:function(t){if(!t.ID){return}t.node=BX(t.ID);if(!t.node){return}BX.bind(t.node,"click",this.onButtonClick.bind(this,t))},onButtonClick:function(t,n){BX.onCustomEvent(this,"button-click",[t]);if(t.WAIT){BX.addClass(BX(t.ID),"ui-btn-wait")}if(this.isFrame&&(t.TYPE==="close"||t.TYPE==="cancel")){n.preventDefault();top.BX.SidePanel.Instance.close()}}};BX.UI.ButtonPanel=new t})();
/* End */
;; /* /bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?16548425225071*/
; /* /bitrix/components/bitrix/rest.integration.edit/templates/.default/script.min.js?165484225022590*/
; /* /bitrix/components/bitrix/rest.integration.selector/templates/.default/script.min.js?16548422513692*/
; /* /bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js?165484252314283*/
; /* /bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?16548425221109*/

//# sourceMappingURL=page_4ddb2d7744f410eb8f6e5c435d0e7510.map.js