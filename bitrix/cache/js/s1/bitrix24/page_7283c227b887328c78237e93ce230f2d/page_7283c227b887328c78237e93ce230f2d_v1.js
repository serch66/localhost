
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?165484154145567";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),getSubmenu:BX.delegate(this.getSubmenu,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame();var o=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));o.forEach(function(t){var e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;var i=e.closest(".main-buttons-item-child-button-cloned");if(i){this.clonedChildButton=i}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))},this)},calculateChildListWidth:function(){if(this.realChildButton){var t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");var e=10;return Array.from(t).reduce(function(t,e){var i=BX.Text.toNumber(BX.Dom.style(e,"width"));var s=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));var n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+i+s+n},e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}var e=this.realChildButton.querySelector(".main-buttons-item-child-list");var i=BX.Dom.attr(this.realChildButton,"data-child-items");var s=BX.Dom.attr(this.realChildButton,"data-is-opened");var n={};if(s){BX.Dom.attr(this.realChildButton,"data-is-opened",null);i.forEach(function(t){var e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}},this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);i.forEach(function(t){var e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}},this);setTimeout(function(){BX.Dom.style(e,"overflow","unset")}.bind(this),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout(function(){this._onResizeHandler()}.bind(this),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);var e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout(function(){BX.Dom.style(this.clonedChildButton,"transition",null)}.bind(this))},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,r;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var u,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{u=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(u,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();r=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&r>2){this.disableItem(n)}if(r===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var r=BX.pos(i);var u={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:r.width/2,zIndex:20,angle:{position:"top",offset:r.width/2}}};s=BX.PopupMenu.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){this.saveOptions("firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e&&t.parentNode===this.listContainer){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({html:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a={},o=[],r=n.hasOwnProperty("AJAX_OPTIONS");if(r){a=this._getEvents(n["AJAX_OPTIONS"]);o=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}var u,h={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],events:a,items:o};if(r){h.cacheable=true}else{u=this.getListItems(t,s);if(u.length){h.items=u}}i.push(h);delete t[s]}}return i},_setAjaxMode:function(t){for(var e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){var e=this;return{onSubMenuShow:function(){if(this.subMenuLoaded){return}var i=this.getSubMenu();i.removeMenuItem("loading");var s=i.getMenuItem("loading");e.getSubItems(t).then(function(t){e._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()}.bind(this)).catch(function(t){if(s){s.getLayout().text.innerText=t}})}}},getSubItems:function(t){return new Promise(function(e,i){if(this.progress){i(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then(function(t){this.progress=false;e(t.data)}.bind(this))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then(function(t){this.progress=false;e(t.data)}.bind(this))}})},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}var t={};this.optionsToSave.forEach(function(e){t[e.name]=e.value});this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1654841541575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16548423932527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?16548425225071";s:6:"source";s:77:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.js";s:3:"min";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.map.js";}"*/
(function(){BX.namespace("BX.UI.SidePanel");if(BX.UI.SidePanel.Wrapper){return}function t(t){}t.prototype.init=function(t){this.container=BX(t.containerId);this.isCloseAfterSave=t.isCloseAfterSave||false;this.isReloadGridAfterSave=t.isReloadGridAfterSave||false;this.isReloadPageAfterSave=t.isReloadPageAfterSave||false;this.skipNotification=t.skipNotification||false;this.useLinkTargetsReplacing=t.useLinkTargetsReplacing||false;this.notification=t.notification||{};var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));this.parentWindow=e?e.getWindow():top;this.initEditableTitle(t);if(this.isReloadGridAfterSave){if(this.getParam("reloadGridAfterSave")){this.reloadGridOnParentPage()}this.setParam("reloadGridAfterSave",true)}if(this.isCloseAfterSave){if(this.getParam("closeAfterSave")){var i;if(this.notification.content&&top.BX&&!this.getParam("skipNotification")){i=function(){top.BX.loadExt("ui.notification").then(function(){top.BX.UI.Notification.Center.notify(this.notification)}.bind(this))}.bind(this)}else if(this.isReloadPageAfterSave){i=function(){this.parentWindow.location.reload()}.bind(this)}BX.SidePanel.Instance.close(false,i)}if(this.skipNotification){this.setParam("skipNotification",true)}this.setParam("closeAfterSave",true)}if(this.useLinkTargetsReplacing){this.initLinkTargetsReplacing()}};t.prototype.initEditableTitle=function(t){if(!t.title||!t.title.selector||!t.title.defaultTitle){return}var i=this.container.querySelector(t.title.selector);if(!i){return}var n=i.querySelector('input[type="text"]');if(!n){return}i.style.display="none";e.init({dataContainer:i,dataNode:n,defaultTitle:t.title.defaultTitle})};t.prototype.initLinkTargetsReplacing=function(){this.replaceLinkTargets();if(!window.MutationObserver){return}var t=new MutationObserver(this.domMutationHandler.bind(this));t.observe(this.container,{childList:true,subtree:true})};t.prototype.domMutationHandler=function(t){t.forEach(function(t){for(var e=0;e<t.addedNodes.length;++e){var i=t.addedNodes.item(e);if(!i){continue}this.replaceLinkTargets(i)}},this)};t.prototype.replaceLinkTargets=function(t){if(!t){t=document.body}var e=[];if(t.tagName==="A"){e=[t]}else if(t.nodeName!=="#text"){e=BX.convert.nodeListToArray(t.querySelectorAll("a"))}if(e.length===0){return}BX.convert.nodeListToArray(e).filter(function(t){return!t.target}).forEach(function(t){t.target="_top"})};t.prototype.setParam=function(t,e){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.getData().set(t,e)}};t.prototype.getParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){return e.getData().get(t)}return undefined};t.prototype.removeParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){e.getData().delete(t)}};t.prototype.reloadGridOnParentPage=function(){var t=this.parentWindow;var e=BX.type.isString(this.isReloadGridAfterSave)?this.isReloadGridAfterSave:null;if(!t.BX.Main||!t.BX.Main.gridManager){return}if(e==="all"){t.BX.Main.gridManager.data.forEach(function(t){t.instance.reload()});return}if(!e&&t.BX.Main.gridManager.data){var i=t.BX.Main.gridManager.data;e=i.length>0?i[0].id:null}if(!e){return}var n=t.BX.Main.gridManager.getById(e);if(!n){return}n.instance.reload()};var e={isInit:false,init:function(t){this.dataNode=t.dataNode;this.titleNode=document.querySelector(".ui-side-panel-wrap-title-name");this.inputNode=document.querySelector(".ui-side-panel-wrap-title-input");this.buttonNode=document.querySelector(".ui-side-panel-wrap-title-edit-button");this.initialTitle=this.titleNode.textContent;this.defaultTitle=t.defaultTitle;BX.bind(this.dataNode,"bxchange",this.onDataNodeChange.bind(this));BX.bind(this.buttonNode,"click",this.startEdit.bind(this));BX.bind(this.inputNode,"keyup",this.onKeyUp.bind(this));BX.bind(this.inputNode,"blur",this.endEdit.bind(this));this.isInit=true;if(!t.disabled){this.enable()}if(!this.dataNode.value){this.dataNode.value=this.defaultTitle}},enable:function(t){t=t||false;if(!this.isInit){return}this.changeDisplay(this.buttonNode,!t);this.titleNode.textContent=!t?this.dataNode.value?this.dataNode.value:this.defaultTitle:this.initialTitle},disable:function(){this.enable(true)},onDataNodeChange:function(){this.titleNode.textContent=this.dataNode.value},onKeyUp:function(t){t=t||window.event;if(t.keyCode===10||t.keyCode===13){this.endEdit();t.preventDefault();return false}},getTitle:function(){var t=this.dataNode.value;if(!t){t=this.titleNode.textContent}return t},startEdit:function(){this.inputNode.value=this.getTitle();this.changeDisplay(this.titleNode,false);this.changeDisplay(this.buttonNode,false);this.changeDisplay(this.inputNode,true);this.inputNode.focus()},endEdit:function(){this.dataNode.value=this.inputNode.value;this.titleNode.textContent=this.inputNode.value;this.changeDisplay(this.inputNode,false);this.changeDisplay(this.buttonNode,true);this.changeDisplay(this.titleNode,true)},changeDisplay:function(t,e){return t.style.display=e?"":"none"}};BX.UI.SidePanel.Wrapper=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/script.min.js?165475981818040";s:6:"source";s:84:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/script.js";s:3:"min";s:88:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/script.min.js";s:3:"map";s:88:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/script.map.js";}"*/
(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.Manager){return}e.Manager=function(e){this.init(e)};e.Manager.prototype={init:function(t){this.signedParameters=t.signedParameters;this.componentName=t.componentName;this.canEditProfile=t.canEditProfile==="Y";this.userId=t.userId||"";this.userStatus=t.userStatus||"";this.isOwnProfile=t.isOwnProfile==="Y";this.isSessionAdmin=t.isSessionAdmin==="Y";this.urls=t.urls;this.isExtranetUser=t.isExtranetUser==="Y";this.adminRightsRestricted=t.adminRightsRestricted==="Y";this.delegateAdminRightsRestricted=t.delegateAdminRightsRestricted==="Y";this.isFireUserEnabled=t.isFireUserEnabled==="Y";this.showSonetAdmin=t.showSonetAdmin==="Y";this.languageId=t.languageId;this.initialFields=t.initialFields;this.siteId=t.siteId;this.isCloud=t.isCloud==="Y";this.isRusCloud=t.isRusCloud==="Y";this.isCurrentUserIntegrator=t.isCurrentUserIntegrator==="Y";this.personalMobile=this.initialFields["PERSONAL_MOBILE"];this.entityEditorInstance=new e.EntityEditor({managerInstance:this,params:t});BX.ready(function(){this.tagsManagerInstance=new e.Tags({managerInstance:this,inputNode:document.getElementById("intranet-user-profile-tags-input"),tagsNode:document.getElementById("intranet-user-profile-tags")});this.stressLevelManagerInstance=new e.StressLevel({managerInstance:this,options:t});this.gratsManagerInstance=new e.Grats({managerInstance:this,options:t});this.profilePostManagerInstance=new e.ProfilePost({managerInstance:this,options:t});this.initAvailableActions();this.initAvatarLoader();this.initAppsInstall();if(this.isCloud){this.initGdpr()}var i=BX("intranet-user-profile-subordinate-more");if(BX.type.isDomNode(i)){BX.bind(i,"click",function(){this.loadMoreUsers(i)}.bind(this))}var n=BX("intranet-user-profile-manages-more");if(BX.type.isDomNode(i)){BX.bind(n,"click",function(){this.loadMoreUsers(n)}.bind(this))}var o=document.querySelector(".intranet-user-profile-bottom-controls");var s=document.getElementById("intranet-user-profile_buttons");if(BX.type.isDomNode(o)&&BX.type.isDomNode(s)){var r=s.querySelector(".ui-entity-settings-link");r.setAttribute("class","ui-btn ui-btn-xs ui-btn-light-border ui-btn-themes");s.parentNode.removeChild(s);o.appendChild(r)}}.bind(this))},initAvailableActions:function(){if(!this.userStatus)return;var e=document.querySelector("[data-role='user-profile-actions-button']");if(BX.type.isDomNode(e)){BX.bind(e,"click",BX.proxy(function(){this.showActionPopup(BX.proxy_context)},this))}},initGdpr:function(){var e=document.querySelectorAll("[data-role='gdpr-input']");e.forEach(function(e,t,i){BX.bind(e,"change",function(){this.changeGdpr(e)}.bind(this))}.bind(this));var t=document.querySelector(".intranet-user-profile-column-block-title-dropdown");BX.bind(t,"click",function(){this.animateGdprBlock(t)}.bind(this))},initAvatarLoader:function(){var e=new BX.AvatarEditor({enableCamera:true});if(BX("intranet-user-profile-photo-camera")&&!e.isCameraEnabled()){BX.hide(BX("intranet-user-profile-photo-camera"))}BX.bind(BX("intranet-user-profile-photo-camera"),"click",function(){e.show("camera")});BX.bind(BX("intranet-user-profile-photo-file"),"click",function(){e.show("file")});BX.addCustomEvent(e,"onApply",BX.proxy(function(e,t){var i=new FormData;if(!e.name){e.name="tmp.png"}i.append("newPhoto",e,e.name);this.changePhoto(i)},this));BX.bind(BX("intranet-user-profile-photo-remove"),"click",BX.proxy(function(){if(BX("intranet-user-profile-photo").style.backgroundImage!=""){this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_PHOTO_DELETE_CONFIRM"),this.deletePhoto.bind(this))}},this))},initAppsInstall:function(){var e=document.querySelector("[data-role='profile-android-app']");if(BX.type.isDomNode(e)){BX.bind(e,"click",BX.proxy(function(){this.showSmsPopup(this.personalMobile)},this))}var t=document.querySelector("[data-role='profile-ios-app']");if(BX.type.isDomNode(t)){BX.bind(t,"click",BX.proxy(function(){this.showSmsPopup(this.personalMobile)},this))}},showActionPopup:function(e){var t=[];if(this.showSonetAdmin){t.push({text:BX.message(this.isSessionAdmin?"INTRANET_USER_PROFILE_QUIT_ADMIN_MODE":"INTRANET_USER_PROFILE_ADMIN_MODE"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();__SASSetAdmin()}})}if(this.userStatus==="admin"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REMOVE_ADMIN_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.removeAdminRights()},this)})}if(this.userStatus==="employee"&&this.canEditProfile&&!this.isOwnProfile&&!this.isCurrentUserIntegrator){var i=BX.message("INTRANET_USER_PROFILE_SET_ADMIN_RIGHTS");if(this.delegateAdminRightsRestricted){i+="<span class='intranet-user-profile-lock-icon'></span>"}t.push({html:i,onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(this.adminRightsRestricted){if(this.delegateAdminRightsRestricted){top.BX.UI.InfoHelper.show("limit_admin_admins")}else{this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_CONFIRM"),this.setAdminRights.bind(this))}}else{this.setAdminRights()}},this)})}if((this.userStatus==="admin"||this.userStatus==="employee"||this.userStatus==="integrator"||this.isExtranetUser)&&this.canEditProfile&&!this.isOwnProfile&&!BX.util.in_array(this.userStatus,["email","shop"])){i=BX.message("INTRANET_USER_PROFILE_FIRE");if(!this.isFireUserEnabled&&this.userStatus!=="integrator"){i+="<span class='intranet-user-profile-lock-icon'></span>"}t.push({text:i,className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(!this.isFireUserEnabled&&this.userStatus!=="integrator"){top.BX.UI.InfoHelper.show("limit_dismiss")}else{this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_FIRE_CONFIRM"),this.fireUser.bind(this))}},this)})}if(this.userStatus==="fired"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_HIRE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_HIRE_CONFIRM"),this.hireUser.bind(this))},this)})}if(this.userStatus==="invited"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REINVITE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.reinviteUser()},this)});t.push({text:BX.message("INTRANET_USER_PROFILE_DELETE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_DELETE_CONFIRM"),this.deleteUser.bind(this))},this)})}if(this.isExtranetUser&&this.canEditProfile&&!this.isOwnProfile&&this.isCloud){t.push({text:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.moveToIntranet()},this)})}if(this.isCloud&&this.canEditProfile&&!this.isOwnProfile&&this.userStatus!=="integrator"){t.push({text:BX.message("INTRANET_USER_PROFILE_SET_INEGRATOR_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_SET_INTEGRATOR_RIGHTS_CONFIRM"),this.setIntegratorRights.bind(this))},this)})}BX.PopupMenu.show("user-profile-action-popup",e,t,{offsetTop:0,offsetLeft:10,angle:true,events:{onPopupClose:function(){BX.PopupMenu.destroy()}}})},showConfirmPopup:function(e,t){BX.PopupWindowManager.create({id:"intranet-user-profile-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(e){e.setWaiting();this.context.close();t()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})],events:{onPopupClose:function(){this.destroy()}}}).show()},showFireInvitedUserPopup:function(e){BX.PopupWindowManager.create({id:"intranet-user-profile-fire-invited-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_FIRE_INVITED_USER")}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(t){t.setWaiting();this.context.close();e()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})]}).show()},showErrorPopup:function(e){if(!e){return}BX.PopupWindowManager.create({id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10}).show()},loadMoreUsers:function(e){if(!BX.type.isDomNode(e)){return}var t=e.parentNode;var i=t.querySelectorAll("[data-role='user-profile-item']");var n=i.length;for(var o=0;o<4&&o<n;o++){i[o].style.display="inline-block";i[o].setAttribute("data-role","")}if(n-4<=0){e.style.display="none"}else{BX.findChild(e).innerHTML=n-4}},changePhoto:function(e){var t=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:e}).then(function(e){if(e.data){BX("intranet-user-profile-photo").style="background-image: url('"+e.data+"'); background-size: cover;"}this.hideLoader({loader:t})}.bind(this),function(e){this.hideLoader({loader:t});this.showErrorPopup(e["errors"][0].message)}.bind(this))},deletePhoto:function(){var e=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){BX("intranet-user-profile-photo").style="";this.hideLoader({loader:e})}.bind(this),function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},setAdminRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},setIntegratorRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setIntegratorRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},removeAdminRights:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"removeAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},fireUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"fireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showErrorPopup(t["errors"][0].message)}.bind(this))},hireUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"hireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e})}.bind(this))},deleteUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deleteUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});BX.SidePanel.Instance.close()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}},function(t){this.hideLoader({loader:e});this.showFireInvitedUserPopup(this.fireUser.bind(this))}.bind(this))},reinviteUser:function(){var e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:this.userId,extranet:this.isExtranetUser=="Y"?"Y":"N"}}}).then(function(t){this.hideLoader({loader:e});if(t.data.result){BX.PopupWindowManager.create("intranet-user-profile-invited-popup",null,{content:"<p>"+BX.message("INTRANET_USER_PROFILE_REINVITE_SUCCESS")+"</p>",offsetLeft:27,offsetTop:7,autoHide:true}).show()}}.bind(this),function(t){this.hideLoader({loader:e})}.bind(this))},moveToIntranet:function(e){if(e!==true)e=false;BX.PopupWindowManager.create("BXExtranet2Intranet",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET_TITLE"),closeIcon:false,width:500,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_MOVE"),events:{click:BX.proxy(function(){var t=BX.proxy_context;BX.addClass(t.button,"ui-btn-wait");var i=BX("moveToIntranetForm");if(BX.type.isDomNode(i)){BX.ajax.runComponentAction(this.componentName,"moveToIntranet",{signedParameters:this.signedParameters,mode:"ajax",data:{departmentId:BX("toIntranetDepartment").value,isEmail:e?"Y":"N"}}).then(function(e){if(e.data){t.context.setContent(e.data);t.context.setButtons([new BX.UI.CloseButton({events:{click:function(){location.reload()}}})])}},function(e){BX.removeClass(t.button,"ui-btn-wait");var i=BX("moveToIntranetForm");if(BX.type.isDomNode(i)&&!BX("moveToIntranetError")){var n=BX.create("div",{attrs:{id:"moveToIntranetError",class:"ui-alert ui-alert-danger ui-alert-icon-danger"},children:[BX.create("span",{attrs:{class:"ui-alert-message"},html:e["errors"][0].message})]});i.insertBefore(n,BX.findChild(i))}}.bind(this))}},this)}}),new BX.UI.CancelButton({events:{click:function(){this.context.close()}}})],events:{onAfterPopupShow:BX.proxy(function(){var t=BX.proxy_context;t.setContent('<div style="width:450px;height:230px"></div>');var i=this.showLoader({node:t.contentContainer,loader:null,size:100});BX.ajax.post("/bitrix/tools/b24_extranet2intranet.php",{USER_ID:this.userId,IS_EMAIL:e?"Y":"N"},BX.proxy(function(e){this.hideLoader({loader:i});t.setContent(e)},this))},this)}}).show()},showLoader:function(e){var t=null;if(e.node){if(e.loader===null){t=new BX.Loader({target:e.node,size:e.hasOwnProperty("size")?e.size:40})}else{t=e.loader}t.show()}return t},hideLoader:function(e){if(e.loader!==null){e.loader.hide()}if(e.node){BX.cleanNode(e.node)}if(e.loader!==null){e.loader=null}},processSliderCloseEvent:function(e){BX.addCustomEvent("SidePanel.Slider:onMessage",function(t){if(t.getSlider()!=BX.SidePanel.Instance.getSliderByWindow(window)){return}if(t.getEventId()!="SidePanel.Wrapper:onClose"){return}var i=t.getData();if(!BX.type.isNotEmptyObject(i.sliderData)){return}var n=i.sliderData.get("entityType"),o=i.sliderData.get("entityId");if(BX.type.isNotEmptyString(n)&&n==e.entityType&&o==this.userId){e.callback()}}.bind(this))},showSmsPopup:function(e){BX.PopupWindowManager.create({id:"intranet-user-profile-sms-popup",className:"intranet-user-profile-popup",titleBar:BX.message("INTRANET_USER_PROFILE_APP_INSTALL"),maxWidth:450,contentColor:"white",content:BX.create("div",{children:[BX.create("div",{props:{className:"intranet-user-profile-popup-title"},html:BX.message("INTRANET_USER_PROFILE_APP_PHONE")}),BX.create("div",{props:{className:"ui-ctl ui-ctl-textbox ui-ctl-wa"},children:[BX.create("input",{props:{value:e,className:"ui-ctl-element",type:"text"},events:{input:function(){e=this.value}}})]}),BX.create("div",{props:{className:"intranet-user-profile-popup-text"},html:BX.message("INTRANET_USER_PROFILE_APP_INSTALL_TEXT")})]}),closeIcon:true,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_APP_SEND"),className:"ui-btn-primary",events:{click:BX.proxy(function(t){t.setWaiting();var i=t.context;BX.ajax.runAction("intranet.controller.sms.sendsmsforapp",{data:{phone:e}}).then(function(e){i.close()}.bind(this),function(e){i.close()}.bind(this))},this)}})],events:{onPopupClose:function(){this.destroy()}}}).show()},changeGdpr:function(e){var t={type:e.name,value:e.checked?"Y":"N"};BX.ajax.runComponentAction(this.componentName,"changeGdpr",{signedParameters:this.signedParameters,mode:"class",data:t}).then(function(e){},function(e){}.bind(this))},animateGdprBlock:function(e){var t=document.querySelector('[data-role="'+e.getAttribute("for")+'"]');if(e.classList.contains("intranet-user-profile-column-block-title-dropdown--open")){e.classList.remove("intranet-user-profile-column-block-title-dropdown--open");t.style.height=null}else{e.classList.add("intranet-user-profile-column-block-title-dropdown--open");t.style.height=t.firstElementChild.offsetHeight+"px"}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:104:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/utils.min.js?1654759818735";s:6:"source";s:86:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/utils.js";s:3:"min";s:90:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/utils.min.js";s:3:"map";s:90:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/utils.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.Utils){return}t.Utils={processAjaxBlock:function(t){if(!BX.type.isNotEmptyObject(t)){return}var e=t.data,a=t.containerNode,s=BX.type.isNotEmptyString(t.className)?t.className:"";if(!BX.type.isNotEmptyObject(e)||!BX(a)){return}var r=false;var i=false;l(o);n(c);function n(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function c(){a.appendChild(BX.create("DIV",{props:{className:s},html:e.CONTENT}));r=true;if(i){o()}}function l(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function o(){i=true;if(r){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML"})}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:111:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/stresslevel.min.js?16547598187950";s:6:"source";s:92:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/stresslevel.js";s:3:"min";s:96:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/stresslevel.min.js";s:3:"map";s:96:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/stresslevel.map.js";}"*/
(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.StressLevel){return}e.StressLevel=function(e){this.init(e)};e.StressLevel.prototype={init:function(e){this.managerInstance=e.managerInstance;this.options=e.options;this.loader=null;this.stressLevel={value:null,type:null,typeDescription:null,comment:null,hash:null};this.noResultNode=BX("intranet-user-profile-stresslevel-noresult");this.resultNode=BX("intranet-user-profile-stresslevel-result");if(!this.resultNode||!this.noResultNode){return}this.resultStatusInfoNode=BX("intranet-user-profile-stresslevel-status-info");this.permsOpenNode=BX("intranet-user-profile-stresslevel-result-perms-open");this.permsCloseNode=BX("intranet-user-profile-stresslevel-result-perms-close");this.checkNode=BX("intranet-user-profile-stresslevel-check");this.widgetNode=BX("intranet-user-profile-stresslevel-widget");this.widgetNoResultNode=BX("intranet-user-profile-stresslevel-noresult-widget");this.resultCommentNode=BX("intranet-user-profile-stresslevel-comment");this.resultCopyLinkNode=BX("intranet-user-profile-stresslevel-status-copy");this.widgetLayout={container:null,arrow:null,level:null,content:null,title:null,progress:null};this.url={};this.measurementId=null;this.classes={widget:"intranet-stress-level-widget",widgetArrow:"intranet-stress-level-widget-arrow",widgetContent:"intranet-stress-level-widget-content",widgetContentTitle:"intranet-stress-level-widget-content-title",widgetContentProgress:"intranet-stress-level-widget-content-progress",widgetContentProgressEmpty:"intranet-stress-level-widget-content-progress-empty"};BX.UI.Hint.init(this.noResultNode);BX.UI.Hint.init(this.resultNode);this.getData();if(this.managerInstance.canEditProfile){this.getOpenPerms()}BX.bind(this.permsOpenNode,"click",function(){this.setOpenPerms({value:true})}.bind(this));BX.bind(this.permsCloseNode,"click",function(){this.setOpenPerms({value:false})}.bind(this));BX.bind(this.checkNode,"click",function(){this.openSlider({page:""})}.bind(this));BX.bind(this.resultStatusInfoNode,"click",function(){this.openSlider({page:"result"})}.bind(this));if(this.resultCopyLinkNode){var t=navigator.userAgent.match(/chrome\/(\d+)/i);if(t&&parseInt(t[1])>=76){BX.bind(this.resultCopyLinkNode,"click",function(){if(this.measurementId){this.copyToBuffer()}}.bind(this))}else{this.resultCopyLinkNode.style.display="none"}}},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runAction("socialnetwork.api.user.stresslevel.get",{signedParameters:this.managerInstance.signedParameters,data:{c:"bitrix:intranet.user.profile",fields:{userId:this.managerInstance.userId}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});if(BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyObject(e.data.url)){this.url=e.data.url}if(BX.type.isNotEmptyObject(e.data)&&typeof e.data.id!="undefined"){this.measurementId=parseInt(e.data.id)}if(BX.type.isNotEmptyObject(e.data)&&typeof e.data.value!="undefined"){this.showData(e.data)}else if(BX.message("USER_ID")==this.managerInstance.userId){this.showEmpty()}}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader})}.bind(this))},showData:function(e){if(BX.type.isNotEmptyObject(e)&&typeof e.value!="undefined"){if(this.noResultNode){this.resultNode.style.display="none"}if(!this.resultNode){return}this.stressLevel.value=parseInt(e.value)>0?parseInt(e.value):0;this.stressLevel.comment=BX.type.isNotEmptyString(e.comment)?e.comment:"";this.stressLevel.type=BX.type.isNotEmptyString(e.type)?e.type:"";this.stressLevel.typeDescription=BX.type.isNotEmptyString(e.typeDescription)?e.typeDescription:"";this.stressLevel.hash=BX.type.isNotEmptyString(e.hash)?e.hash:"";this.resultNode.style.display="block";this.renderData()}},showEmpty:function(){if(this.noResultNode){this.noResultNode.style.display="block"}if(this.resultNode){this.resultNode.style.display="none"}this.renderEmptyData()},getOpenPerms:function(){BX.ajax.runAction("socialnetwork.api.user.stresslevel.getaccess",{data:{fields:{userId:this.managerInstance.userId}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.showOpenPerms(e.data.value)}}.bind(this),function(e){}.bind(this))},setOpenPerms:function(e){if(!BX.type.isNotEmptyObject(e)){e={}}if(!BX.type.isBoolean(e.value)){e.value=false}BX.ajax.runAction("socialnetwork.api.user.stresslevel.setaccess",{data:{fields:{userId:this.managerInstance.userId,value:e.value?"Y":"N"}}}).then(function(e){if(BX.type.isNotEmptyString(e.data.value)){this.showOpenPerms(e.data.value)}}.bind(this),function(e){}.bind(this))},showOpenPerms:function(e){if(e=="Y"){this.permsCloseNode.style.display="block";this.permsOpenNode.style.display="none"}else{this.permsCloseNode.style.display="none";this.permsOpenNode.style.display="block"}},openSlider:function(e){var t=BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyString(e.page)?e.page:"";var s="";if(t=="result"&&BX.type.isNotEmptyString(this.url.result)){s=this.url.result}else if(BX.type.isNotEmptyString(this.url.check)){s=this.url.check}if(BX.type.isNotEmptyString(s)){BX.SidePanel.Instance.open(s,{cacheable:false,data:{},width:500})}},renderData:function(){if(!this.widgetNode){return}this.widgetNode.appendChild(this.getRenderContainer());this.afterRender();if(this.resultCommentNode&&BX.type.isNotEmptyString(this.stressLevel.comment)){this.resultCommentNode.innerHTML=BX.util.htmlspecialchars(this.stressLevel.comment)}if(BX.type.isNotEmptyString(this.stressLevel.type)&&BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type)){BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).style.display="inline-block";BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).innerHTML=BX.util.htmlspecialchars(this.stressLevel.typeDescription)}},renderEmptyData:function(){if(!this.widgetNoResultNode){return}this.widgetNoResultNode.appendChild(this.getRenderContainer());this.afterRender()},getRenderContainer:function(){if(!this.widgetLayout.container){this.widgetLayout.container=BX.create("DIV",{props:{className:this.classes.widget},children:[this.getRenderArrowContainer(),this.getRenderContentContainer()]})}return this.widgetLayout.container},getRenderArrowContainer:function(){if(!this.widgetLayout.arrow){this.widgetLayout.arrow=BX.create("DIV",{props:{className:this.classes.widgetArrow}})}return this.widgetLayout.arrow},getRenderContentContainer:function(){if(!this.widgetLayout.content){this.widgetLayout.content=BX.create("DIV",{props:{className:this.classes.widgetContent},children:[this.widgetLayout.title=BX.create("DIV",{props:{className:this.classes.widgetContentTitle},text:BX.message("INTRANET_USER_PROFILE_STRESSLEVEL_NORESULT_INDICATOR_TEXT")}),this.widgetLayout.progress=BX.create("DIV",{props:{className:this.classes.widgetContentProgress},text:"?"})]})}return this.widgetLayout.content},afterRender:function(){if(!this.stressLevel.value){this.widgetLayout.progress.classList.add(this.classes.widgetContentProgressEmpty);this.getRenderArrowContainer().style.transform="rotate(90deg)";return}setTimeout(function(){this.animateRenderNumber();this.getRenderArrowContainer().style.transform="rotate("+this.getRenderProgressScale()+"deg)"}.bind(this),1e3)},animateRenderNumber:function(){var e=0;var t=600/this.stressLevel.value;var s=setInterval(function(){e++;this.widgetLayout.progress.innerHTML=e;e===this.stressLevel.value?clearInterval(s):null}.bind(this),t)},getRenderProgressScale:function(){return 1.8*this.stressLevel.value},copyToBuffer:function(){if(!this.measurementId){return}var e="/bitrix/components/bitrix/intranet.user.profile/stresslevel_img.php";fetch(e).then(function(e){return e.blob()}).then(function(e){navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},e.type,{value:e,enumerable:true}))])}).catch(function(e){})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/grats.min.js?16547598187573";s:6:"source";s:86:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/grats.js";s:3:"min";s:90:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/grats.min.js";s:3:"map";s:90:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/grats.map.js";}"*/
(function(){var e=BX.namespace("BX.Intranet.UserProfile");if(e.Grats){return}e.Grats=function(e){this.init(e)};e.Grats.prototype={init:function(e){this.managerInstance=e.managerInstance;this.options=e.options;this.initBadges(this.options.badgesData);this.postListPageSize=parseInt(this.options.gratPostListPageSize);this.postListPageNum=1;this.loader=null;this.badgesWrapperNode=BX("intranet-user-profile-thanks");this.postsWrapperNode=BX("intranet-user-profile-thanks-users-wrapper");this.moreLinkNode=BX("intranet-user-profile-load-users-link");this.loaderNode=BX("intranet-user-profile-thanks-users-loader");this.classes={item:"intranet-user-profile-thanks-item",itemActive:"intranet-user-profile-thanks-item-active",itemCounter:"intranet-user-profile-thanks-item-counter",badgesDisabled:"intranet-user-profile-thanks-disabled"};if(this.moreLinkNode){BX.bind(this.moreLinkNode,"click",function(){this.getData()}.bind(this))}this.getData();this.managerInstance.processSliderCloseEvent({entityType:"gratPost",callback:function(){BX.cleanNode(this.postsWrapperNode);this.postListPageNum=1;this.getData()}.bind(this)});if(this.badgesWrapperNode){BX.bind(this.badgesWrapperNode,"click",function(e){this.openGratSlider(e)}.bind(this))}},initBadges:function(e){this.badgesData={};for(var t in e){if(!e.hasOwnProperty(t)){continue}this.badgesData[e[t].ID]={CODE:e[t].CODE,NAME:e[t].NAME}}},showMoreLink:function(){if(this.moreLinkNode){this.moreLinkNode.style.display="block"}},hideMoreLink:function(){if(this.moreLinkNode){this.moreLinkNode.style.display="none"}},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});this.showBadgesLoader();BX.ajax.runComponentAction(this.managerInstance.componentName,"getGratitudePostList",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{pageSize:this.postListPageSize,pageNum:this.postListPageNum}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.hideBadgesLoader();if(BX.type.isNotEmptyObject(e.data)){if(typeof e.data.POSTS_COUNT!="undefined"&&this.postListPageSize*this.postListPageNum>=parseInt(e.data.POSTS_COUNT)){this.hideMoreLink()}else{this.showMoreLink()}this.showData(e.data);this.postListPageNum++}}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.hideBadgesLoader();this.showMoreLink()}.bind(this))},showData:function(e){if(BX.type.isNotEmptyObject(e)){if(BX.type.isNotEmptyObject(e.BADGES)){this.showBadges(e.BADGES)}if(BX.type.isNotEmptyObject(e.POSTS)){this.showPosts(e.POSTS,BX.type.isNotEmptyObject(e.AUTHORS)?e.AUTHORS:{})}}},showBadges:function(e){if(!this.badgesWrapperNode){return}var t=BX.findChildren(this.badgesWrapperNode,{className:this.classes.item});if(t){var s=null;for(var i=0;i<t.length;i++){s=t[i].getAttribute("data-bx-grat-enum");if(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyObject(e[s])&&typeof e[s].COUNT!="undefined"&&parseInt(e[s].COUNT)>0){t[i].appendChild(BX.create("DIV",{props:{className:this.classes.itemCounter},text:parseInt(e[s].COUNT)}));t[i].classList.add(this.classes.itemActive)}else{BX.cleanNode(t[i]);t[i].classList.remove(this.classes.itemActive)}}var a=BX.clone(t);a.sort(function(e,t){if(e.classList.contains(this.classes.itemActive)&&!t.classList.contains(this.classes.itemActive)){return-1}else if(!e.classList.contains(this.classes.itemActive)&&t.classList.contains(this.classes.itemActive)){return 1}else{return 0}}.bind(this));BX.cleanNode(this.badgesWrapperNode);for(i=0;i<a.length;i++){this.badgesWrapperNode.appendChild(a[i])}}},showBadgesLoader:function(){if(!this.badgesWrapperNode){return}this.badgesWrapperNode.classList.add(this.classes.badgesDisabled)},hideBadgesLoader:function(){if(!this.badgesWrapperNode){return}this.badgesWrapperNode.classList.remove(this.classes.badgesDisabled)},showPosts:function(e,t){if(!this.postsWrapperNode){return}var s=null,i=null,a=null;var r=[];for(var n in e){if(!e.hasOwnProperty(n)){continue}r.push(e[n])}r.sort(function(e,t){if(e.DATE_PUBLISH_TS==t.DATE_PUBLISH_TS){return 0}return e.DATE_PUBLISH_TS<t.DATE_PUBLISH_TS?+1:-1});for(var o=0;o<r.length;o++){s=r[o];i=BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-likes"},children:[]});if(BX.type.isNotEmptyObject(s.RATING_DATA)){a=BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-emodji"}});if(BX.type.isNotEmptyObject(s.RATING_DATA.REACTIONS_LIST)){for(var p in s.RATING_DATA.REACTIONS_LIST){if(!s.RATING_DATA.REACTIONS_LIST.hasOwnProperty(p)||parseInt(s.RATING_DATA.REACTIONS_LIST[p])<=0){continue}a.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-emoji intranet-user-profile-thanks-emoji-"+p}}))}}i.appendChild(a);if(typeof s.RATING_DATA.TOTAL_POSITIVE_VOTES!="undefined"&&parseInt(s.RATING_DATA.TOTAL_POSITIVE_VOTES)>0){i.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-counter"},text:parseInt(s.RATING_DATA.TOTAL_POSITIVE_VOTES)}))}}var d="",h="";if(typeof s.AUTHOR_ID!="undefined"&&parseInt(s.AUTHOR_ID)>0&&BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t[s.AUTHOR_ID])&&BX.type.isNotEmptyString(t[s.AUTHOR_ID].PHOTO)){d="background-size: cover; background-image: url('"+t[s.AUTHOR_ID].PHOTO+"')";h=t[s.AUTHOR_ID].NAME+" "+t[s.AUTHOR_ID].LAST_NAME}this.postsWrapperNode.appendChild(BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user"},children:[BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-avatar"},children:[BX.create("A",{attrs:{href:t[s.AUTHOR_ID].URL,"bx-tooltip-user-id":s.AUTHOR_ID},props:{className:"ui-icon ui-icon-common-user intranet-user-profile-thanks-user-userpic"},children:[BX.create("i",{props:{style:d},attrs:{title:h}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-picture"+(this.badgesData[s.BADGE_ID]?" intranet-user-profile-thanks-item-"+this.badgesData[s.BADGE_ID].CODE:"")}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content"},children:[BX.create("A",{attrs:{"bx-post-url":s.URL+(s.URL.indexOf("?")==-1?"?":"&")+"IFRAME=Y",href:"#"},props:{className:"intranet-user-profile-thanks-user-content-title"},html:s.TITLE,events:{click:function(e){BX.SidePanel.Instance.open(e.currentTarget.getAttribute("bx-post-url"),{width:1e3});e.stopPropagation();e.preventDefault()}}}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-info"},children:[BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-date"},text:BX.type.isNotEmptyString(s.DATE_FORMATTED)?s.DATE_FORMATTED:""}),typeof s.CONTENT_VIEW_CNT!="undefined"&&parseInt(s.CONTENT_VIEW_CNT)>0?BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-views"},text:s.CONTENT_VIEW_CNT}):null,i]})]})]}))}},openGratSlider:function(e){if(!this.badgesWrapperNode){return}var t=this.badgesWrapperNode.getAttribute("data-bx-grat-url");if(!BX.type.isNotEmptyString(t)){return}var s=null;if(e.target.classList.contains(this.classes.item)){s=e.target}if(!s){s=BX.findParent(e.target,{className:"intranet-user-profile-thanks-item"},this.badgesWrapperNode)}if(!s){return}var i=s.getAttribute("data-bx-grat-code");if(!BX.type.isNotEmptyString(i)){return}t+=(t.indexOf("?")==-1?"?":"&")+"gratUserId="+this.managerInstance.userId+"&gratCode="+i;BX.SidePanel.Instance.open(t,{cacheable:false,data:{entityType:"gratPost",entityId:this.managerInstance.userId},width:1e3})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:111:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/profilepost.min.js?16547598186181";s:6:"source";s:92:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/profilepost.js";s:3:"min";s:96:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/profilepost.min.js";s:3:"map";s:96:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/profilepost.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.ProfilePost){return}t.ProfilePost=function(t){this.init(t)};t.ProfilePost.prototype={init:function(t){this.managerInstance=t.managerInstance;this.options=t.options;this.loaderNode=BX("intranet-user-profile-about-loader");this.wrapperNode=BX("intranet-user-profile-about-wrapper");this.containerNode=BX("intranet-user-profile-post-container");this.editLinkNode=BX("intranet-user-profile-post-edit-link");this.stubButtonNode=BX("intranet-user-profile-post-edit-stub-button");this.loader=null;this.LHEEventNode=BX("div"+this.options.profilePostData.lheId);this.getData();this.managerInstance.processSliderCloseEvent({entityType:"profilePost",callback:function(){BX.cleanNode(this.wrapperNode);this.getData()}.bind(this)});if(this.editLinkNode){BX.bind(this.editLinkNode,"click",function(){this.getFormData()}.bind(this))}if(this.stubButtonNode){BX.bind(this.stubButtonNode,"click",function(){this.getFormData()}.bind(this))}if(this.LHEEventNode){BX.addCustomEvent(this.LHEEventNode,"OnProfilePostFormAfterShow",function(t,e){this.OnProfilePostFormAfterShow(t,e)}.bind(this));BX.addCustomEvent(this.LHEEventNode,"OnClickSubmit",function(t){this.OnClickSubmit(t)}.bind(this));BX.addCustomEvent(this.LHEEventNode,"OnClickCancel",function(t){this.setContainerEditMode(false);this.showPostContainer(true)}.bind(this))}},getData:function(){BX.addClass(this.loaderNode,"intranet-user-profile-loader-getdata");this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runComponentAction(this.managerInstance.componentName,"getProfileBlogPost",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{}}).then(function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});BX.removeClass(this.loaderNode,"intranet-user-profile-loader-getdata");this.setContainerEmpty(!BX.type.isNotEmptyObject(t.data));if(BX.type.isNotEmptyObject(t.data)){this.showData(t.data)}}.bind(this),function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});BX.removeClass(this.loaderNode,"intranet-user-profile-loader-getdata")}.bind(this))},setContainerEmpty:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-empty")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-empty")}}},setContainerEditMode:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-editmode")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-editmode")}}},showData:function(t){if(!this.wrapperNode){return}this.showPostContainer(true);if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.additionalParams)&&BX.type.isNotEmptyObject(t.additionalParams.POST)){var e=t.additionalParams.POST;if(BX.type.isNotEmptyString(e.TITLE)){this.wrapperNode.appendChild(BX.create("DIV",{props:{className:"intranet-user-profile-container-body-title"},html:e.TITLE}))}if(BX.type.isNotEmptyString(t.html)){var i=BX.create("DIV",{props:{className:"intranet-user-profile-about"}});this.wrapperNode.appendChild(i);BX.html(i,t.html)}if(BX.type.isNotEmptyObject(e.UF_RENDERED)){BX.Intranet.UserProfile.Utils.processAjaxBlock({data:e.UF_RENDERED,className:"intranet-user-profile-about-props",containerNode:this.wrapperNode})}}},getFormData:function(){this.showPostContainer(false);this.setContainerEditMode(true);this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader});BX.ajax.runComponentAction(this.managerInstance.componentName,"getProfileBlogPostForm",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{}}).then(function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.showFormData(t.data)}.bind(this),function(t){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader});this.showPostContainer(true)}.bind(this))},showPostContainer:function(t){if(!this.wrapperNode){return}this.wrapperNode.style.display=!!t?"block":"none"},showFormData:function(t){if(this.LHEEventNode){BX.onCustomEvent(this.LHEEventNode,"OnShowLHE",["show"]);BX.onCustomEvent(this.LHEEventNode,"OnProfilePostFormAfterShow",[t])}},OnProfilePostFormAfterShow:function(t){t=!!t?t:{};var e=BX.type.isNotEmptyString(t.DETAIL_TEXT)?t.DETAIL_TEXT:"",i={};if(BX.type.isNotEmptyObject(t.UF)&&BX.type.isNotEmptyObject(t.UF.UF_BLOG_POST_FILE)){i["UF_BLOG_POST_FILE"]={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_BLOG_POST_FILE[]",VALUE:BX.clone(t.UF.UF_BLOG_POST_FILE.VALUE)}}LHEPostForm.reinitData(this.options.profilePostData.lheId,e,i)},OnClickSubmit:function(t){var e=t.oEditor.GetContent(),i=t.formID,o=BX.type.isNotEmptyString(i)?BX(i):null,n=BX.type.isNotEmptyString(i)?BX("lhe_button_submit_"+i):null;if(o){var a=BX.ajax.prepareForm(o);this.sendFormData({text:e,submitButton:n,additionalData:a.data})}},sendFormData:function(t){this.showButtonWait(t.submitButton,true);if(BX.type.isNotEmptyString(t.text)){BX.ajax.runComponentAction(this.managerInstance.componentName,"sendProfileBlogPostForm",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{text:t.text,additionalData:t.additionalData}}}).then(function(e){this.showButtonWait(t.submitButton,false);BX.onCustomEvent(this.LHEEventNode,"OnShowLHE",["hide"]);BX.cleanNode(this.wrapperNode);this.getData();this.setContainerEditMode(false)}.bind(this),function(e){this.setContainerEditMode(false);this.showButtonWait(t.submitButton,false)}.bind(this))}else{BX.ajax.runComponentAction(this.managerInstance.componentName,"deleteProfileBlogPost",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{}}}).then(function(e){this.showButtonWait(t.submitButton,false);BX.onCustomEvent(this.LHEEventNode,"OnShowLHE",["hide"]);BX.cleanNode(this.wrapperNode);this.getData();this.setContainerEditMode(false)}.bind(this),function(e){this.setContainerEditMode(false);this.showButtonWait(t.submitButton,false)}.bind(this))}},showButtonWait:function(t,e){if(t){if(!!e){BX.addClass(t,"ui-btn-clock")}else{BX.removeClass(t,"ui-btn-clock")}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags.min.js?165475981814658";s:6:"source";s:85:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags.js";s:3:"min";s:89:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags.min.js";s:3:"map";s:89:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.Tags){return}t.Tags=function(t){this.init(t);return this};t.Tags.prototype={init:function(t){this.tagsLoader=null;this.tagsLoaderNode=BX("intranet-user-profile-tags-loader");this.managerInstance=t.managerInstance;this.inputNode=t.inputNode;this.tagsNode=t.tagsNode;this.popup=null;this.popupContent=null;this.defferedTags=[];this.container={input:null,inputWrapper:null};this.popupContainer=null;this.initialized=null;this.tagsUsersPopupInstanceList={};this.getTagsData();this.containerNode=BX("intranet-user-profile-tags-container");this.editLinkNode=BX("intranet-user-profile-add-tags");this.stubButtonNode=BX("intranet-user-profile-interests-stub-button");if(this.editLinkNode){BX.bind(this.editLinkNode,"click",this.show.bind(this))}if(this.stubButtonNode){BX.bind(this.stubButtonNode,"click",this.show.bind(this))}BX.bind(window,"click",function(t){if(!BX.findParent(t.target,{className:"intranet-user-profile-tags-input-wrapper"})&&!BX.findParent(t.target,{className:"intranet-user-profile-tags-popup"})&&t.target!==this.editLinkNode&&t.target!==this.stubButtonNode){if(this.defferedTags.length>0){for(var e=0;e<this.defferedTags.length;e++){this.addTag({tag:this.defferedTags[e]})}this.reindexUser();this.defferedTags=[]}this.cleanInput();BX.cleanNode(this.getInputWrapper());this.getInputWrapper().appendChild(this.getInput());this.hide();this.closePopup()}}.bind(this))},closePopup:function(){if(this.popup){this.popup.close()}},getTagsData:function(t){BX.addClass(this.tagsLoaderNode,"intranet-user-profile-loader-getdata");this.tagsLoader=this.managerInstance.showLoader({node:this.tagsLoaderNode,loader:this.tagsLoader});BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagsList",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{}}}).then(function(t){this.managerInstance.hideLoader({node:this.tagsLoaderNode,loader:this.tagsLoader});BX.removeClass(this.tagsLoaderNode,"intranet-user-profile-loader-getdata");if(BX.type.isNotEmptyObject(t.data)){this.showTagsList(t.data)}}.bind(this),function(t){this.managerInstance.hideLoader({node:this.tagsLoaderNode,loader:this.tagsLoader});BX.removeClass(this.tagsLoaderNode,"intranet-user-profile-loader-getdata")}.bind(this))},showTagsList:function(t,e){for(var s in t){if(!t.hasOwnProperty(s)){continue}var i=this.getTagNode({tag:s,tagData:t[s],openListSlider:true});if(e){this.tagsNode.insertBefore(i,e);BX.cleanNode(e,true)}else{this.tagsNode.appendChild(i)}}this.checkEmptyTagsList()},getTagNode:function(e){var s=BX.create("DIV",{attrs:{"bx-data-user-tag":e.tag},props:{className:"intranet-user-profile-tags-item intranet-user-profile-tags-item-new"},children:[BX.create("DIV",{props:{className:"intranet-user-profile-tags-item-title",title:e.tag},text:e.tag,events:e.openListSlider?{click:function(){BX.SidePanel.Instance.open(decodeURIComponent(this.managerInstance.urls.PathToTag).replace("#TAG#",e.tag),{cacheable:false,allowChangeHistory:true,width:1e3})}.bind(this)}:null}),this.managerInstance.isOwnProfile?BX.create("DIV",{props:{className:"intranet-user-profile-tags-item-remove"},events:{click:function(t){this.removeTag({tag:e.tag,node:s});this.reindexUser();t.stopPropagation();t.preventDefault()}.bind(this)}}):null,e.tagData?this.getTagUsersNode({tag:e.tag,checksum:e.tagData.CHECKSUM,usersObject:e.tagData.USERS}):null,e.tagData?this.getTagCounterNode(e.tagData.COUNT-e.tagData.USERS.length):null,e.tagData?BX.create("SPAN",{attrs:{id:"iup-tags-item-users-popup-container-"+e.tagData.CHECKSUM,style:"display: none;"},props:{className:"iup-tags-users-popup-cont"},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup-outer"},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup"},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-waiter"}})]}),BX.create("SPAN",{props:{className:"iup-tags-item-users-action"},children:[BX.create("SPAN",{props:{className:"ui-btn ui-btn-xs ui-btn-primary"},text:BX.message("INTRANET_USER_PROFILE_TAGS_POPUP_ADD")})]})]})]}):null]});if(e.tagData){this.tagsUsersPopupInstanceList[e.tagData.CHECKSUM]=new t.TagsUsersPopup({containerNodeId:"iup-tags-item-users-popup-container-"+e.tagData.CHECKSUM,tagsInstance:this,tag:e.tag,tagNode:s,checksum:e.tagData.CHECKSUM})}BX.bind(s,"animationend",function(){s.classList.remove("intranet-user-profile-tags-item-new")});return s},removeTag:function(t){var e=BX.type.isNotEmptyObject(t)?BX(t.node):null,s=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.tag)?t.tag:null;if(!e||!BX.type.isNotEmptyString(s)){return}this.removeTagNode(e);BX.ajax.runComponentAction(this.managerInstance.componentName,"removeTag",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:t.tag}}}).then(function(t){}.bind(this),function(t){}.bind(this))},removeTagNode:function(t){t.style.opacity="0";BX.bind(t,"transitionend",function(){t.parentNode.removeChild(t);this.checkEmptyTagsList()}.bind(this))},checkEmptyTagsList:function(){this.setContainerEmpty(!this.tagsNode.hasChildNodes())},getTagUsersNode:function(t){var e=BX.create("DIV",{props:{className:"intranet-user-profile-tags-users"},events:{mouseenter:function(e){if(this.tagsUsersPopupInstanceList[t.checksum]){this.tagsUsersPopupInstanceList[t.checksum].onMouseOver({event:e})}}.bind(this),mouseleave:function(e){if(this.tagsUsersPopupInstanceList[t.checksum]){this.tagsUsersPopupInstanceList[t.checksum].onMouseOut({event:e})}}.bind(this),click:function(e){if(this.tagsUsersPopupInstanceList[t.checksum]){this.tagsUsersPopupInstanceList[t.checksum].onClick({event:e})}}.bind(this)}});for(var s=0;s<t.usersObject.length;s++){var i=t.usersObject[s];e.appendChild(BX.create("DIV",{props:{className:"ui-icon ui-icon-common-user intranet-user-profile-tags-user"},children:[BX.create("i",{style:BX.type.isNotEmptyString(i.PERSONAL_PHOTO_SRC)?{backgroundImage:"url('"+i.PERSONAL_PHOTO_SRC+"')"}:null})]}))}return e},getTagCounterNode:function(t){return t>0?BX.create("DIV",{props:{className:"intranet-user-profile-tags-users-counter"},text:parseInt(t)}):null},addTag:function(t){BX.ajax.runComponentAction(this.managerInstance.componentName,"addTag",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:t.tag,userId:typeof t.userId!="undefined"?parseInt(t.userId):null}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.showTagsList(e.data,BX.type.isDomNode(t.tagNode)?t.tagNode:null)}}.bind(this),function(t){}.bind(this))},reindexUser:function(t){if(!BX.type.isNotEmptyObject(t)){t={}}setTimeout(function(){BX.ajax.runComponentAction(this.managerInstance.componentName,"reindexUser",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{userId:typeof t.userId!="undefined"?parseInt(t.userId):null}}}).then(function(t){}.bind(this),function(t){}.bind(this))}.bind(this),1e3)},getInputValue:function(){return this.getInput().value},cleanInput:function(){this.getInput().value=""},focusInput:function(){this.getInput().focus()},getInputWrapper:function(){if(!this.container.inputWrapper){this.container.inputWrapper=BX.create("DIV",{props:{className:"intranet-user-profile-tags-input-wrapper"}});this.container.inputWrapper.appendChild(this.getInput())}return this.container.inputWrapper},parseLongString:function(){var t=this.getInputValue();if(t===""){return false}var e=t.split(/[\s\t]+/);if(BX.type.isArray(e)&&e.length>1){for(var s=0;s<e.length;s++){if(!BX.type.isNotEmptyString(e[s])){continue}this.addDeferredTag(e[s],this.getTagNode({tag:e[s]}))}return true}return false},checkDeferredTag:function(t){return BX.util.in_array(t,this.defferedTags)},addDeferredTag:function(t,e){if(!this.checkDeferredTag(t)){this.defferedTags.push(t);this.addDeferredTagNode(e)}},addDeferredTagNode:function(t){this.cleanInput();this.getInputWrapper().insertBefore(BX.create("div",{props:{className:"intranet-user-profile-tags-input-deferred"},children:[t]}),this.getInputWrapper().children[this.getInputWrapper().children.length-1])},removeDeferredTag:function(t){if(this.defferedTags.indexOf(t)!==-1){this.defferedTags.splice(this.defferedTags.indexOf(t),1)}},removeDeferredTagNode:function(t){this.getInputWrapper().removeChild(t)},getInput:function(){if(!this.container.input){this.container.input=BX.create("INPUT",{props:{type:"text",className:"intranet-user-profile-tags-input"},events:{keydown:function(t){if(t.code&&(t.code.toLowerCase()==="enter"||t.code.toLowerCase()==="numpadenter")||t.keyCode&&t.keyCode===13){if(this.defferedTags.length===0&&this.getInputValue()===""){return}if(this.parseLongString()){return}if(this.defferedTags.length>0){for(var e=0;e<this.defferedTags.length;e++){this.addTag({tag:this.defferedTags[e]})}this.reindexUser();this.defferedTags=[]}if(this.getInputValue()!==""){this.addTag({tag:this.getInputValue()});this.reindexUser()}this.cleanInput();BX.cleanNode(this.getInputWrapper());this.getInputWrapper().appendChild(this.getInput());this.hide();this.closePopup()}else if(t.code&&t.code.toLowerCase()==="escape"||t.keyCode&&t.keyCode===27){this.hide();this.cleanInput();BX.cleanNode(this.getInputWrapper());this.getInputWrapper().appendChild(this.getInput());this.defferedTags=[];this.closePopup();t.preventDefault();t.stopPropagation()}else if(t.code&&(t.code.toLowerCase()==="arrowdown"||t.code.toLowerCase()==="arrowup")||t.keyCode&&(t.keyCode===38||t.keyCode===40)){}else if((t.code&&t.code.toLowerCase()==="space"||t.keyCode&&t.keyCode===32)&&this.getInputValue()!==""){if(!this.parseLongString()){this.addDeferredTag(this.getInputValue(),this.getTagNode({tag:this.getInputValue()}))}this.cleanInput();BX.PreventDefault(t)}else if((t.code&&t.code.toLowerCase()==="backspace"||t.keyCode&&t.keyCode===8)&&this.getInputValue()===""&&this.defferedTags.length>0){var s=this.getInputWrapper().children[this.getInputWrapper().children.length-2];this.removeDeferredTag(this.defferedTags[this.defferedTags.length-1]);this.removeDeferredTagNode(s)}}.bind(this),input:BX.debounce(function(){if(this.getInputValue()!==""){BX.ajax.runComponentAction(this.managerInstance.componentName,"searchTags",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{searchString:this.getInputValue()}}}).then(function(t){if(BX.type.isNotEmptyObject(t.data)){this.getPopup({tags:t.data,mode:"search"}).show()}else{this.closePopup()}}.bind(this),function(t){this.closePopup()}.bind(this));return}this.getPopup().destroy();this.popup=null},1e3,this)}})}return this.container.input},hide:function(){this.getInputWrapper().style.height=this.getInputWrapper().offsetHeight+"px";setTimeout(function(){this.getInputWrapper().classList.remove("intranet-user-profile-tags-input-show");this.getInputWrapper().classList.add("intranet-user-profile-tags-hide");this.getInputWrapper().style.height=null;this.setContainerEditMode(false)}.bind(this));this.initialized=false},show:function(){if(!this.initialized){this.inputNode.appendChild(this.getInputWrapper())}this.getInputWrapper().classList.remove("intranet-user-profile-tags-hide");setTimeout(function(){this.setContainerEditMode(true);this.getInputWrapper().classList.add("intranet-user-profile-tags-input-show");setTimeout(function(){this.getInputWrapper().style.height="auto"}.bind(this),400)}.bind(this));this.focusInput();this.getPopularTags();this.initialized=true},getPopup:function(t){var e=this.getInput();if(!BX.type.isNotEmptyObject(t)){t={}}if(!this.popup){this.popup=new BX.PopupWindow({className:"intranet-user-profile-tags-popup",bindElement:e,width:this.getInput().offsetWidth,content:this.getPopupContainer(t),animation:"fading-slide",offsetTop:5})}else{this.popup.setContent(this.getPopupContainer(t));this.popup.setBindElement(e)}this.popup.setBindElement(e);return this.popup},getPopupContainer:function(t){this.popupContent=BX.create("div",{props:{className:"intranet-user-profile-tags-popup"},children:[this.getPopupContentEmpty(t)]});return this.popupContent},getPopularTags:function(){BX.ajax.runComponentAction(this.managerInstance.componentName,"searchTags",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{}}}).then(function(t){if(BX.type.isNotEmptyObject(t.data)){setTimeout(function(){this.getPopup({tags:t.data,mode:"popular"}).show()}.bind(this),200)}}.bind(this),function(t){}.bind(this))},getPopupContentEmpty:function(t){var e=BX.type.isNotEmptyString(t.mode)?t.mode:"popular";this.popupContent=BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty-cont"}});this.popupContainer=BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty"},children:[BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty-title"},text:BX.message(e=="search"?"INTRANET_USER_PROFILE_TAGS_POPUP_SEARCH_TITLE":"INTRANET_USER_PROFILE_TAGS_POPUP_TITLE")}),this.popupContent,BX.create("div",{props:{className:"intranet-user-profile-tags-popup-empty-text"},text:BX.message("INTRANET_USER_PROFILE_TAGS_POPUP_HINT_3")})]});var s=BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.tags)?t.tags:[],i=null,a=null;for(var n=0;n<s.length;n++){i=this.getTagNode({tag:s[n].NAME,tagData:s[n]});BX.bind(i,"click",function(t){a=t.currentTarget.getAttribute("bx-data-user-tag");if(BX.type.isNotEmptyString(a)){this.addDeferredTag(a,this.getTagNode({tag:a}))}this.focusInput()}.bind(this));this.popupContent.appendChild(i)}return this.popupContainer},getTagList:function(){var t=this.tags;var e=BX.create("DIV",{props:{className:"intranet-user-profile-tags-popup-list"}});for(var s=0;s<t.length;s++){var i=BX.create("DIV",{attrs:{"bx-data-user-tag":t[s].text},props:{className:"intranet-user-profile-tags-popup-list-item"},text:t[s].text,events:{click:function(t){this.addTag({tag:t.currentTarget.getAttribute("bx-data-user-tag")});this.reindexUser();this.cleanInput();this.closePopup()}.bind(this)}});e.appendChild(i)}return e},setActivePopularTag:function(t){t.classList.add("intranet-user-profile-tags-item-active")},resetActivePopularTag:function(t){t.classList.remove("intranet-user-profile-tags-item-active")},setInputValue:function(t){this.getInput().value=t},setContainerEmpty:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-empty")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-empty")}}},setContainerEditMode:function(t){if(this.containerNode){if(t){BX.addClass(this.containerNode,"intranet-user-profile-container-editmode")}else{BX.removeClass(this.containerNode,"intranet-user-profile-container-editmode")}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:116:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags-users-popup.min.js?16547598185162";s:6:"source";s:97:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags-users-popup.js";s:3:"min";s:101:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags-users-popup.min.js";s:3:"map";s:101:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags-users-popup.map.js";}"*/
(function(){var t=BX.namespace("BX.Intranet.UserProfile");if(t.TagsUsersPopup){return}t.TagsUsersPopup=function(t){setTimeout(function(){this.init(t)}.bind(this),0);return this};t.TagsUsersPopup.prototype={init:function(t){this.tagsInstance=t.tagsInstance;this.managerInstance=this.tagsInstance.managerInstance;this.tagNode=BX.type.isDomNode(t.tagNode)?t.tagNode:null;this.tag=t.tag;this.checksum=t.checksum;this.page=1;this.contentNode=BX(t.containerNodeId)?BX.findChild(BX(t.containerNodeId),{tagName:"span",className:"iup-tags-item-users-popup"},true,false):null;this.actionNode=BX(t.containerNodeId)?BX.findChild(BX(t.containerNodeId),{tagName:"span",className:"iup-tags-item-users-action"},true,false):null;this.popup=null;this.initialized=false;this.showPopupTimeoutId=null;this.hidePopupTimeoutId=null;this.leavePopupTimeoutId=null;this.popupUsersShownIdList=[];BX.bind(this.actionNode,"click",function(){this.tagsInstance.addTag({userId:BX.message("USER_ID"),tag:this.tag,tagNode:this.tagNode});this.tagsInstance.reindexUser({userId:BX.message("USER_ID")});this.popup.close()}.bind(this))},onMouseOver:function(t){if(this.tagsInstance.popupContent&&BX.findParent(t.event.target,{className:"intranet-user-profile-tags-popup-empty-cont"},this.tagsInstance.popupContent)){return}if(this.popup!==null&&this.popup.isShown()){clearTimeout(this.hidePopupTimeoutId);return}clearTimeout(this.showPopupTimeoutId);this.showPopupTimeoutId=setTimeout(function(){this.show({bindNode:t.event.target})}.bind(this),400)},onMouseOut:function(t){clearTimeout(this.showPopupTimeoutId);if(!this.popup){return}this.hidePopupTimeoutId=setTimeout(function(){this.popup.close()}.bind(this),1e3)},onClick:function(t){clearTimeout(this.showPopupTimeoutId);this.show({bindNode:t.event.currentTarget})},show:function(t){this.open({bindNode:t.bindNode});if(!this.initialized){this.page=1;BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagData",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:this.tag,page:this.page}}}).then(function(t){this.buildContent(t.data);this.initialized=true}.bind(this),function(t){}.bind(this))}},open:function(t){if(this.popup==null){this.popup=new BX.PopupWindow("tags-users-popup-"+this.checksum,t.bindNode,{lightShadow:true,offsetLeft:-22,autoHide:true,closeByEsc:true,zIndex:2005,bindOptions:{position:"top"},animationOptions:{show:{type:"opacity-transform"},close:{type:"opacity"}},events:{onPopupClose:function(){},onPopupDestroy:function(){}},content:BX("iup-tags-item-users-popup-container-"+this.checksum),className:"iup-tags-users-popup"});BX.bind(BX("tags-users-popup-"+this.checksum),"mouseleave",function(){clearTimeout(this.hidePopupTimeoutId);this.hidePopupTimeoutId=setTimeout(function(){this.popup.close()}.bind(this),1e3)}.bind(this));BX.bind(BX("tags-users-popup-"+this.checksum),"mouseenter",function(){clearTimeout(this.hidePopupTimeoutId)}.bind(this))}this.popup.show();this.adjustPopup()},adjustPopup:function(){if(this.popup!=null){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}},buildContent:function(t){if(BX.type.isArray(t.USERS)){if(this.page==1&&this.contentNode){this.contentNode.innerHTML=""}this.page+=1;var i=null;for(var e=0;e<t.USERS.length;e++){if(BX.util.in_array(t.USERS[e]["ID"],this.popupUsersShownIdList)){continue}this.popupUsersShownIdList.push(t.USERS[e]["ID"]);if(t.USERS[e].PERSONAL_PHOTO.SRC.length>0){i=BX.create("IMG",{attrs:{src:t.USERS[e].PERSONAL_PHOTO.SRC},props:{className:"iup-tags-item-users-popup-avatar-img"}})}else{i=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"iup-tags-item-users-popup-avatar-img bx-contentview-popup-avatar-img-default"}})}this.contentNode.appendChild(BX.create("A",{attrs:{href:t.USERS[e]["URL"],target:"_blank",title:t.USERS[e]["NAME_FORMATTED"]},props:{className:"iup-tags-item-users-popup-img"+(!!t.USERS[e]["TYPE"]?" iup-tags-item-users-popup-img-"+t.USERS[e]["TYPE"]:"")},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup-avatar-new"},children:[i,BX.create("SPAN",{props:{className:"bx-contentview-popup-avatar-status-icon"}})]}),BX.create("SPAN",{attrs:{"bx-tooltip-user-id":t.USERS[e]["ID"]},props:{className:"iup-tags-item-users-popup-name-new"},html:t.USERS[e]["NAME_FORMATTED"]})]}))}this.adjustPopup();this.bindScroll()}if(BX.type.isNotEmptyString(t.CAN_ADD)&&t.CAN_ADD=="Y"){this.actionNode.classList.add("iup-tags-item-users-action-visible")}else{this.actionNode.classList.remove("iup-tags-item-users-action-visible")}},bindScroll:function(){BX.bind(this.contentNode,"scroll",function(t){var i=t.currentTarget;if(i.scrollTop>(i.scrollHeight-i.offsetHeight)/1.5){BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagData",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:this.tag,page:this.page}}}).then(function(t){if(BX.type.isArray(t.data.USERS)&&t.data.USERS.length>0){this.buildContent(t.data)}}.bind(this),function(t){}.bind(this));BX.unbindAll(i)}}.bind(this))}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:112:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/form-entity.min.js?165475981816030";s:6:"source";s:92:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/form-entity.js";s:3:"min";s:96:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/form-entity.min.js";s:3:"map";s:96:"/local/templates/.default/components/bitrix/intranet.user.profile/.default/js/form-entity.map.js";}"*/
(function(){"use strict";var t=BX.namespace("BX.Intranet.UserProfile");if(t.EntityEditor){return}t.EntityEditor=function(t){this.init(t)};t.EntityEditor.prototype={init:function(t){var e=t.params;this.managerInstance=t.managerInstance;this.signedParameters=e.signedParameters;this.componentName=e.componentName;this.initialFields=e.initialFields||{};this.isCloud=e.isCloud==="Y";this.isCurrentUserAdmin=e.isCurrentUserAdmin==="Y";this.gridId=e.gridId||null;this.voximplantEnablePhones=e.voximplantEnablePhones;BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",BX.proxy(function(t,e){e.methods["timezone"]=this.userProfileEntity.bind(this);e.methods["phone"]=this.userProfileEntity.bind(this)},this));BX.addCustomEvent("BX.UI.EntityEditorAjax:onSubmit",BX.proxy(function(t){this.onAfterSubmit(t)},this));if(!this.isCloud&&this.isCurrentUserAdmin){BX.addCustomEvent(window,"BX.UI.EntityEditor:onPrepareConfigMenuItems",function(t,e){e.push({id:"intranet-fields-link",text:BX.message("INTRANET_USER_FIILDS_SETTINGS"),onclick:function(){this.showFieldsSettings()}.bind(this),className:"menu-popup-item-none"})}.bind(this));BX.addCustomEvent(window,"BX.UI.EntityEditor:onUserFieldAdd",function(t,e){if(typeof e!=="object"||!e){return}BX.ajax.runComponentAction(this.componentName,"onUserFieldAdd",{signedParameters:this.signedParameters,mode:"ajax",data:{fieldName:e["FIELD"]}}).then(function(t){},function(t){})}.bind(this))}},userProfileEntity:function(t,e,i){if(t==="timezone"){return BX.Intranet.UserProfile.EntityEditorTimezone.create(e,i)}if(t==="phone"){i.model._settings["SHOW_PHONE_ICON"]=this.voximplantEnablePhones[e]=="Y"?"Y":"N";return BX.Intranet.UserProfile.EntityEditorPhone.create(e,i)}return null},onAfterSubmit:function(t){if(this.isCloud){var e=BX.prop.getString(t,"PERSONAL_MOBILE","");if(e&&this.initialFields["PERSONAL_MOBILE"]!=e){this.managerInstance.showSmsPopup(e);this.managerInstance.personalMobile=e}}var i=BX.prop.getString(t,"NAME","");var n=BX.prop.getString(t,"LAST_NAME","");if(i&&this.initialFields["NAME"]!=i||n&&this.initialFields["LAST_NAME"]!=n){this.changePageTitle(BX.prop.getString(t,"FULL_NAME",""))}this.reloadGrid()},reloadGrid:function(){if(!BX.type.isNotEmptyString(this.gridId)||!window.parent.BX.Main.gridManager){return}var t=window.parent.BX.Main.gridManager.getById(this.gridId);if(!t){return}t.instance.reload()},changePageTitle:function(t){if(!t){return}BX.html(BX("pagetitle"),t);document.title=t;if(BX.getClass("BX.SidePanel.Instance.updateBrowserTitle")){BX.SidePanel.Instance.updateBrowserTitle()}},showFieldsSettings:function(){BX.SidePanel.Instance.open("intranet:user-pfofile-fields-settings",{contentCallback:function(t){return new Promise(function(t,e){top.BX.ajax.runComponentAction(this.componentName,"fieldsSettings",{signedParameters:this.signedParameters,mode:"class",data:{}}).then(function(e){t({html:e.data.html})})}.bind(this))}.bind(this),width:600})}};BX.load(["/bitrix/js/ui/entity-editor/js/editor.js"],function(){if(typeof BX.Intranet.UserProfile.EntityEditorTimezone==="undefined"){BX.Intranet.UserProfile.EntityEditorTimezone=function(){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.constructor.apply(this);this._items=null;this._inputAutoTimeZone=null;this._inputTimeZone=null;this._selectAutoTimeZone=null;this._selectTimeZone=null;this._selectContainer=null;this._selectedValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._innerWrapper=null;this._isOpened=false};BX.Intranet.UserProfile.EntityEditorTimezone.create=function(t,e){var i=new BX.Intranet.UserProfile.EntityEditorTimezone;i.initialize(t,e);return i};BX.extend(BX.Intranet.UserProfile.EntityEditorTimezone,BX.UI.EntityEditorField);BX.Intranet.UserProfile.EntityEditorTimezone.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-select"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.getTimeZoneItemByValue(n.timeZone);var o=this.getAutoTimeZoneItemByValue(n.autoTimeZone);var s=this.getDataBooleanParam("isHtml",false);var a={};var l={};this._selectedValueAutoTimeZone=n.autoTimeZone;this._selectedValueTimeZone=n.timeZone;this._selectAutoTimeZone=null;this._selectTimeZone=null;this._innerWrapper=null;if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._inputAutoTimeZone=BX.create("input",{attrs:{name:"AUTO_TIME_ZONE",type:"hidden",value:n.autoTimeZone}});this._inputTimeZone=BX.create("input",{attrs:{name:"TIME_ZONE",type:"hidden",value:n.timeZone}});this._wrapper.appendChild(this._inputAutoTimeZone);this._wrapper.appendChild(this._inputTimeZone);a={props:{className:"ui-ctl-element"}};if(s){a.html=o?o["NAME"]:n}else{a.text=o?o["NAME"]:n}this._selectAutoTimeZone=BX.create("div",a);BX.bind(this._selectAutoTimeZone,"click",BX.proxy(function(){this._selectorClickHandler("autoTimeZone")},this));l={props:{className:"ui-ctl-element"}};if(s){l.html=r?r["NAME"]:n}else{l.text=r?r["NAME"]:n}this._selectTimeZone=BX.create("div",l);BX.bind(this._selectTimeZone,"click",BX.proxy(function(){this._selectorClickHandler("timeZone")},this));var u=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-angle"}});this._selectContainerAutoTimeZone=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100"},children:[this._selectAutoTimeZone,u]});this._selectContainerTimeZone=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100",style:"margin-top: 10px;"+(n.autoTimeZone!=="N"?"display: none;":"")},children:[this._selectTimeZone,BX.clone(u)]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-card-content-block-inner"},children:[this._selectContainerAutoTimeZone,this._selectContainerTimeZone]});this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}this.registerLayout(t);this._hasLayout=true}else{}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getContentWrapper=function(){return this._innerWrapper};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.checkIfNotEmpty=function(t){return t!==""&&t!=="0"};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.doRegisterLayout=function(){};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.doClearLayout=function(t){this.closeMenu();this._input=null;this._select=null;this._innerWrapper=null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.refreshLayout.apply(this,arguments);return}var t=this.getValue();var e=this.getItemByValue(t);var i=e?BX.prop.getString(e,"NAME",t):t;if(this._mode===BX.Intranet.UserProfile.EntityEditorMode.edit){this._selectedValue=t;if(this._input){this._input.value=t}if(this._select){this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}}else if(this._mode===BX.Intranet.UserProfile.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i)}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.validate=function(t){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.Intranet.UserProfile.EntityEditorTimezone. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Intranet.UserProfile.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.showError=function(t,e){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"ui-entity-card-content-error")}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.clearError=function(){BX.Intranet.UserProfile.EntityEditorTimezone.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-entity-card-content-error")}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onSelectorClick=function(t){if(!this._isOpened){this.openMenu(t)}else{this.closeMenu(t)}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.openMenu=function(t){if(this._isOpened){return}var e=[];if(t=="timeZone"){var i=this.getTimeZoneItems()}else{i=this.getAutoTimeZoneItems()}for(var n=0,r=i.length;n<r;n++){var o=i[n];if(!BX.prop.getBoolean(o,"IS_EDITABLE",true)){continue}var s=BX.prop.getString(o,"VALUE",n);var a=BX.prop.getString(o,"NAME",s);e.push({text:this.getDataBooleanParam("isHtml",false)?a:BX.util.htmlspecialchars(a),value:s,onclick:BX.delegate(t=="autoTimeZone"?this.onAutoTimeZoneItemSelect:this.onTimeZoneItemSelect,this)})}var l=t==="timeZone"?this._selectTimeZone:this._selectAutoTimeZone;BX.PopupMenu.show(this._id,l,e,{angle:false,width:l.offsetWidth+"px",maxHeight:300,events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(l)["width"])};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.closeMenu=function(){var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onMenuShow=function(){BX.addClass(this._selectContainer,"ui-ctl-active");this._isOpened=true};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"ui-ctl-active");this._isOpened=false};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onAutoTimeZoneItemSelect=function(t,e){this.closeMenu();this._selectedValueAutoTimeZone=this._inputAutoTimeZone.value=e.value;var i=BX.prop.getString(this.getAutoTimeZoneItemByValue(this._selectedValueAutoTimeZone),"NAME",this._selectedValueAutoTimeZone);this._selectAutoTimeZone.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i);this.markAsChanged();BX.PopupMenu.destroy(this._id);this._selectContainerTimeZone.style.display=this._selectedValueAutoTimeZone==="N"?"block":"none"};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.onTimeZoneItemSelect=function(t,e){this.closeMenu();this._selectedValueTimeZone=this._inputTimeZone.value=e.value;var i=BX.prop.getString(this.getTimeZoneItemByValue(this._selectedValueTimeZone),"NAME",this._selectedValueTimeZone);this._selectTimeZone.innerHTML=this.getDataBooleanParam("isHtml",false)?i:BX.util.htmlspecialchars(i);this.markAsChanged();BX.PopupMenu.destroy(this._id)};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getTimeZoneItems=function(){if(!this._itemsAutoTimeZone){this._itemsAutoTimeZone=BX.prop.getArray(this._schemeElement.getData(),"timezone_items",[])}return this._itemsAutoTimeZone};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getAutoTimeZoneItems=function(){if(!this._itemsTimeZone){this._itemsTimeZone=BX.prop.getArray(this._schemeElement.getData(),"auto_timezone_items",[])}return this._itemsTimeZone};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getTimeZoneItemByValue=function(t){var e=this.getTimeZoneItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getString(r,"VALUE","")){return r}}return null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getAutoTimeZoneItemByValue=function(t){var e=this.getAutoTimeZoneItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getString(r,"VALUE","")){return r}}return null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getFirstItem=function(){var t=this.getItems();return t.length>0?t[0]:null};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.save=function(){if(!this.isEditable()){return}var t={timeZone:this._selectedValueTimeZone,autoTimeZone:this._selectedValueAutoTimeZone};this._model.setField(this.getName(),t)};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.Intranet.UserProfile.EntityEditorTimezone.prototype.getRuntimeValue=function(){return this._mode===BX.Intranet.UserProfile.EntityEditorMode.edit&&this._input?this._selectedValue:""}}if(typeof BX.Intranet.UserProfile.EntityEditorPhone==="undefined"){BX.Intranet.UserProfile.EntityEditorPhone=function(){BX.Intranet.UserProfile.EntityEditorPhone.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.Intranet.UserProfile.EntityEditorPhone.create=function(t,e){var i=new BX.Intranet.UserProfile.EntityEditorPhone;i.initialize(t,e);return i};BX.extend(BX.Intranet.UserProfile.EntityEditorPhone,BX.UI.EntityEditorField);BX.Intranet.UserProfile.EntityEditorPhone.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.Intranet.UserProfile.EntityEditorPhone.prototype.getContentWrapper=function(){return this._innerWrapper};BX.Intranet.UserProfile.EntityEditorPhone.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.Intranet.UserProfile.EntityEditorPhone.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.checkPhoneIcon();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});this._input=BX.create("input",{attrs:{name:e,className:"ui-ctl-element",type:"text",value:n,id:this._id.toLowerCase()+"_text"}});this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var o=this.getCreationPlaceholder();if(o!==""){this._input.setAttribute("placeholder",o)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(i));if(this.hasContentToDisplay()){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},children:[BX.create("span",{text:n}),r?BX.create("div",{props:{className:"intranet-user-profile-phone-icon"},events:{mouseup:function(t){t.preventDefault();t.stopPropagation();top.BXIM.phoneTo(n)}}}):""]})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.Intranet.UserProfile.EntityEditorPhone.prototype.checkPhoneIcon=function(t){return this._model._settings["SHOW_PHONE_ICON"]=="Y"}}})})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?16548420241622";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Intranet.Binding.Menu");BX.Intranet.Binding.Menu=function(i,t,n){n=n||{};this.id=i||"intranet_binding_menu";this.idTop=this.id+"_top";this.items=t;this.menu=null;this.menuShowed=false;this.sections=n.sections||{};this.frequencyItem=n.frequencyItem||{};this.ajaxPath=n.ajaxPath||"";this.bindingId=n.bindingId||""};BX.Intranet.Binding.Menu.prototype={binding:function(){if(BX(this.id)){BX.bind(BX(this.id),"click",BX.delegate(this.clickMenuButton,this));if(BX(this.idTop)&&BX(this.idTop).getAttribute("href")==="#"){BX.bind(BX(this.idTop),"click",BX.delegate(this.clickMenuButton,this))}}},onItemClick:function(id,onclick){this.menu.close();if(BX.type.isString(onclick)){eval(onclick)}BX.ajax({url:this.ajaxPath,method:"POST",data:{action:"openingLog",payload:{bindingId:this.bindingId,menuItemId:id},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){}.bind(this)})},buildMenu:function(i){var t=[];for(var n=0,e=i.length;n<e;n++){i[n]["text"]=i[n]["text"];if(typeof i[n]["items"]!=="undefined"){i[n]["items"]=this.buildMenu(i[n]["items"])}else if(!i[n]["system"]){i[n]["onclick"]=this.onItemClick.bind(this,i[n]["id"],i[n]["onclick"])}t.push(i[n])}return t},clickMenuButton:function(i){if(!this.menu){this.menu=new BX.PopupMenuWindow(this.id,i.target===BX(this.idTop)?BX(this.idTop):BX(this.id),this.buildMenu(this.items),{autoHide:true,events:{onClose:function(){this.menuShowed=false}.bind(this)}})}if(this.menu){if(this.menuShowed){this.menu.close()}else{this.menuShowed=true;this.menu.show()}}BX.PreventDefault()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?165484154462061";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"])return;var e={controller:{},handler:{},form:{},selector:{}};BX.addCustomEvent(window,"BFileDLoadFormControllerWasBound",function(t){e.controller[t.id]=true});BX.addCustomEvent(window,"WDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"WDLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"DiskDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"DiskLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"OnEditorInitedBefore",function(t){if(e.handler[t.id]){t.__lhe_flags=["OnEditorInitedBefore"];if(e.handler[t.id]["params"]&&e.handler[t.id]["params"]["LHEJsObjName"])window[e.handler[t.id].params["LHEJsObjName"]]=t;e.handler[t.id].OnEditorInitedBefore(t)}});var t=function(t){if(e.handler[t.id]&&e.handler[t.id].editorIsLoaded!==true){e.handler[t.id].editorIsLoaded=true;e.handler[t.id].exec();BX.onCustomEvent(e.handler[t.id],"OnEditorIsLoaded",[e.handler[t.id],t])}};BX.addCustomEvent(window,"OnCreateIframeAfter",t);BX.addCustomEvent(window,"OnEditorInitedAfter",function(i,n){if(e.handler[i.id]){i.__lhe_flags.push("OnEditorInitedAfter");e.handler[i.id].OnEditorInitedAfter(i);if(e.handler[i.id].editorIsLoaded!==true&&n&&i.sandbox&&i.sandbox.inited)t.apply(i,[i])}});BX.util.object_search=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){if(t[i]==e)return true;else if(typeof t[i]=="object"&&t[i]!==null){var n=BX.util.object_search_key(e,t[i]);if(n!==false)return n}}}return false};var i=function(e,t,i){i=i&&i.length>0?i:[];if(typeof t=="object"&&t.length>0){var n;while((n=t.pop())&&n&&t.length>0){i.push(n)}t=n}i.push(t);this.exist=true;this.bxTag=e;this.tag=t;this.tags=i;this.regexp=new RegExp("\\[("+i.join("|")+")=((?:\\s|\\S)*?)(?:\\s*?WIDTH=(\\d+)\\s*?HEIGHT=(\\d+))?\\]","ig");this.code="["+t+"=#ID##ADDITIONAL#]";this.wysiwyg='<span style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;" id="#ID#"#ADDITIONAL#>#NAME#</span>'},n=function(t,i,n){this.CID=this.id=i;this.parser=t.parser["disk_file"]||null;this.params=n;this.node=BX("diskuf-selectdialog-"+i);this.handler=e.controller[i];this.manager=t;this.eventNode=this.manager.eventNode;this.parserName="disk_file";this.prefixNode="disk-edit-attach";this.prefixHTMLNode="disk-attach-";this.props={valueEditClassName:"wd-inline-file",securityCID:"disk-upload-cid"};this.storage="disk";this.fileToAttach={};this.xmlToAttach={};this.events={onInit:"DiskDLoadFormControllerInit",onShow:"DiskLoadFormController",onBound:"DiskLoadFormControllerWasBound"}};n.prototype={parser:false,eventNode:null,values:{},initialized:false,functionsToExec:[],exec:function(e,t){if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.handler&&this.handler!==true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},init:function(){if(this.initialized!==true){this.values={};this.functionsToExec=[];this.initialized=true;this.bindMainEvents(this.manager);if(this.parser!==null){this.bindEvents(this.manager);return this.initValues()}}return false},initValues:function(){var e=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(e&&e.length>0){this.exec(this.runCheckText);return true}return false},bindMainEvents:function(t){var i=null;BX.addCustomEvent(t.eventNode,"onReinitializeBefore",BX.proxy(this.clean,this));BX.addCustomEvent(t.eventNode,"onShowControllers",BX.proxy(function(e){i=e;BX.onCustomEvent(t.eventNode,this.events.onShow,[e])},this));if(!e.controller[this.id]){var o=BX.delegate(function(e){if(e["UID"]==this.id||e["id"]==this.id){if(i==="show"||i==="hide"){BX.onCustomEvent(t.eventNode,this.events.onShow,[i]);i=null}BX.removeCustomEvent(window,this.events.onBound,o)}},this);BX.addCustomEvent(window,this.events.onBound,o)}if(BX["DD"]&&this.storage=="disk"){var r=BX.delegate(function(e){if((e["UID"]==this.id||e["id"]==this.id)&&this.manager["dropZoneExists"]!==true){BX.removeCustomEvent(window,this.events.onBound,r);this.manager["dropZoneExists"]=true;var i=this.eventNode,o=this.id;n.dndCatcher=n.dndCatcher||{};n.dndCatcher[o]={catch:true,files:[],dropZone:null,dropZoneMicro:null,initdrag:BX.delegate(function(){n.dndCatcher[o].dropZone=new BX.DD.dropFiles(t.eventNode);BX.addCustomEvent(t.eventNode,"OnImageDataUriHandle",function(e,t){if(BX["UploaderUtils"]){var i=BX.UploaderUtils.dataURLToBlob(t.src);if(i&&i.size>0&&i.type.indexOf("image/")==0){i.name=i.name||t.title||"image."+i.type.substr(6);i.referrerToEditor=t;if(n.dndCatcher[o]["catch"]===true)n.dndCatcher[o]["drop"]([i]);else if(this.handler&&this.handler["addFile"])this.handler.addFile(i);BX.onCustomEvent(e,"OnImageDataUriCaught",[t])}}}.bind(this));BX.addCustomEvent(n.dndCatcher[o].dropZone,"dropFiles",n.dndCatcher[o]["drop"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragEnter",n.dndCatcher[o]["dragover"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragLeave",n.dndCatcher[o]["dragleave"]);if(BX("micro"+t.__divId)){n.dndCatcher[o].dropZoneMicro=new BX.DD.dropFiles(BX("micro"+t.__divId));BX.addCustomEvent(n.dndCatcher[o].dropZoneMicro,"dragEnter",function(){BX.onCustomEvent(t.eventNode,"OnShowLHE",["justShow"])})}BX.unbind(document,"dragover",n.dndCatcher[o]["initdrag"]);BX.onCustomEvent(t.eventNode,"onDropZoneExists",[])},this),dragover:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragover",[])},this),dragleave:BX.delegate(function(){BX.removeClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragleave",[])},this),dragenterwindow:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.addClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragenterwindow",[])},this),dragleavewindow:BX.delegate(function(e){BX.removeClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.removeClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragleavewindow",[])},this),drop:BX.delegate(function(e){BX.onCustomEvent(t.eventNode,"drop",[]);BX.onCustomEvent(window,"dragWindowLeave");BX.onCustomEvent(window,"__dragWindowLeave");var i=0;if(e&&e.length>0){if(n.dndCatcher[o]["catch"]===true){n.dndCatcher[o].files=e;i=1}else{i=2}BX.onCustomEvent(t.eventNode,this.events.onShow,["show"]);BX.removeClass(t.eventNode,"feed-add-post-dnd-ready feed-add-post-dnd-over")}return i},this)};BX.ready(function(){n.dndCatcher[o]["initdrag"]()});BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){BX.PreventDefault(e);if(e["dataTransfer"]&&e["dataTransfer"]["files"]){if(n.dndCatcher[o].drop(e["dataTransfer"]["files"])===2){this.handler.agent.onChange(e["dataTransfer"]["files"])}}},this));BX.addCustomEvent(i,"OnIframeDragOver",n.dndCatcher[o].dragover);BX.addCustomEvent(i,"OnIframeDragLeave",n.dndCatcher[o].dragleave);if(!window["bxMpfDndCatcher"]){window["bxMpfDndCatcher"]=true;var s=false,a=function(){if(s===false){s=true;BX.bind(document,"dragleave",l);BX.bind(document,"dragover",l);BX.bind(document,"mouseout",d);BX.onCustomEvent(window,"dragWindowEnter")}},d=function(e){BX.unbind(document,"dragleave",l);BX.unbind(document,"dragover",l);BX.unbind(document,"mouseout",d);s=false;BX.onCustomEvent(window,"dragWindowLeave")},l=function(e){if(h>0){clearTimeout(h);h=0}BX.fixEventPageXY(e);var t=true;if(e.pageX>0&&e.pageY>0){var i=BX.GetWindowSize();if(e.pageY<i.scrollHeight&&e.pageX<i.scrollWidth){var n=e.pageY-i.scrollTop,o=e.pageX-i.scrollLeft;if(0<n&&n<i.innerHeight-20&&0<o&&o<i.innerWidth-20){t=false}}}if(t){d(e)}else{h=setTimeout(function(){l({type:"intervalLimit"})},100)}},h=0;BX.bind(document,"dragenter",function(e){if(window["bxMpfDndCatcher"]>0){clearTimeout(window["bxMpfDndCatcher"])}var t=true;if(e&&e["dataTransfer"]&&e["dataTransfer"]["types"]){for(var i=0;i<e["dataTransfer"]["types"].length;i++){if(e["dataTransfer"]["types"][i]=="Files"){t=true;break}}}if(t){a()}});BX.addCustomEvent(window,"__dragWindowLeave",d);BX.bind(document,"dragover",function(e){return BX.PreventDefault(e)});BX.bind(document,"drop",function(e){d(e);return BX.PreventDefault(e)})}BX.addCustomEvent(window,"dragWindowEnter",n.dndCatcher[o].dragenterwindow);BX.addCustomEvent(window,"dragWindowLeave",n.dndCatcher[o].dragleavewindow);this.__initCatcher=BX.delegate(function(e,i){if(e==this.id){BX.removeCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher);i.agent.initDropZone(t.eventNode);if(n.dndCatcher[e].files.length>0){i.agent.onChange(n.dndCatcher[e].files);n.dndCatcher[e].files=[]}n.dndCatcher[e]["catch"]=false;this.__initCatcher=null}},this);BX.addCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher)}},this);BX.addCustomEvent(window,this.events.onBound,r);if(e.controller[this.id])r(e.controller[this.id])}},bindEvents:function(e){this._catchHandler=BX.delegate(function(t){BX.removeCustomEvent(this.eventNode,this.events.onInit,this._catchHandler);this.handler=t;var i=BX.findChild(BX(e.formID),{attr:{id:this.props.securityCID}},true,false);if(i)i.value=this.handler.CID;this.exec();var n=BX.delegate(function(){BX.onCustomEvent(e.eventNode,"onUploadsHasBeenChanged",arguments)},this);BX.addCustomEvent(this.handler.agent,"onFileIsInited",n);BX.addCustomEvent(this.handler.agent,"ChangeFileInput",n);BX.onCustomEvent(e.eventNode,"onControllerInitialized",[this.id,t])},this);if(typeof this.handler!="object"||!this.handler)BX.addCustomEvent(e.eventNode,this.events.onInit,this._catchHandler);else this._catchHandler(this.handler);BX.addCustomEvent(e.eventNode,"OnFileUploadSuccess",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){i=i||{};i.usePostfix=true;this.addFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadFailed",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){this.failFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadRemove",BX.delegate(function(e,t){if(this.id==t.CID||this.id==t.id){this.deleteFile(e,{usePostfix:true},t)}},this));BX.addCustomEvent(this,"onFileIsInText",BX.proxy(function(e,t){this.adjustFile(this.checkFile(e),t)},this))},addFile:function(e,t,i){var n=this.checkFile(e.element_id,e,t);if(n){setTimeout(BX.proxy(function(){this.bindFile(n);this.adjustFile(n,false)},this),100);BX.onCustomEvent(this.eventNode,"onFileIsAdded",[n,this,i,t])}else{this.failFile(this,t,i)}return true},failFile:function(e,t,i){BX.onCustomEvent(this.eventNode,"onFileIsFailed",[this,i,t])},checkFile:function(e,t){e=""+(typeof e=="object"?e.id:e);if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(t.place)){var i={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(t.place,true),xmlID:BX(t.place,true).getAttribute("bx-attach-xml-id"),fileID:BX(t.place,true).getAttribute("bx-attach-file-id"),fileType:BX(t.place,true).getAttribute("bx-attach-file-type")},n;if(/(\.png|\.jpg|\.jpeg|\.gif|\.bmp|\.webp)$/i.test(t.element_name)&&(n=BX.findChild(i.place,{className:"files-preview",tagName:"IMG"},true,false))&&n){i.type="image/xyz";i.lowsrc=n.src;i.element_url=i.src=n.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight=(\d+)/,"");i.isImage=true;i.width=parseInt(n.getAttribute("data-bx-full-width")||n.getAttribute("data-bx-width"));i.height=parseInt(n.getAttribute("data-bx-full-height")||n.getAttribute("data-bx-height"))}if(i.xmlID)this.xmlToAttach[i.xmlID+""]=e;if(i.fileID)this.fileToAttach[i.fileID+""]=e;this.values[e]=i}return this.values[e]||false},bindFile:function(e){var t=e.place;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){var i=BX.findChild(t,{className:"f-wrap"},true,false),n=BX.findChild(t,{className:"files-preview"},true,false);if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e.id)},this));i.style.cursor="pointer";i.title=BX.message("MPF_FILE")}if(n){BX.bind(n,"click",BX.delegate(function(){this.insertFile(e.id)},this))}}},adjustFile:function(e,t){var i=e.place;if(t===true||t===false){if(!e.info)e.info=BX.findChild(e.place,{className:"files-info"},true,false);i=e.info;if(BX.type.isDomNode(i)){var n="check-in-text-"+e.id,o=BX(n),r=t===false?{attrs:{"bx-file-is-in-text":"N"},props:{className:"insert-btn"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_INSERT_IN_TEXT")+"</span>"}:{attrs:{"bx-file-is-in-text":"Y"},props:{className:"insert-text"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_IN_TEXT")+"</span>"};if(!o){r.attrs.id=n;r.events={click:BX.proxy(function(){this.insertFile(e.id)},this)};i.appendChild(BX.create("SPAN",r))}else{BX.adjust(o,r)}}}},insertFile:function(e){BX.onCustomEvent(this.eventNode,"onFileIsInserted",[this.checkFile(e),this])},deleteFile:function(e,t){e=this.checkFile(e,t);if(e){BX.onCustomEvent(this.eventNode,"onFileIsDeleted",[e,this]);this.values[e.id].place=null;delete this.values[e.id].place;this.values[e.id]=null;delete this.values[e.id];e=null;return true}return false},reinitValues:function(e,t){var i,n,o={};while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("data-bx-title")||n.getAttribute("data-title"),size:n.getAttribute("data-bx-size")||"",sizeInt:n.getAttribute("data-bx-size")||"",width:n.getAttribute("data-bx-width"),height:n.getAttribute("data-bx-height"),storage:"disk",previewUrl:n.tagName=="A"?"":n.getAttribute("data-bx-src")||n.getAttribute("data-src"),fileId:n.getAttribute("bx-attach-file-id")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");if(n.hasAttribute("bx-attach-file-type"))o["E"+i]["fileType"]=n.getAttribute("bx-attach-file-type")}}this.handler.selectFile({},{},o);this.runCheckText()},runCheckText:function(){if(!this._checkText)this._checkText=BX.delegate(this.checkText,this);this.manager.exec(this._checkText)},checkText:function(){var e,t=this.manager.getContent(),i=[],n,o;if(t!=""){e=t;for(o in this.xmlToAttach){if(this.xmlToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]").replace(new RegExp("\\[DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]")}}for(o in this.fileToAttach){if(this.fileToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;"+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]").replace(new RegExp("\\["+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]")}}n=new RegExp("(?:\\&\\#91\\;)("+this.parser["tags"].join("|")+")=([a-z=0-9 ]+)(?:\\&\\#93\\;)","gim");if(n.test(t)){for(o in this.values){if(this.values.hasOwnProperty(o)){i.push(o)}}if(i.length>0){n=new RegExp("(?:\\&\\#91\\;|\\[)("+this.parser["tags"].join("|")+")=("+i.join("|")+")([WIDTHHEIGHT=0-9 ]*)(?:\\&\\#93\\;|\\])","gim");if(n.test(t))t=t.replace(n,BX.delegate(function(e,t,i,n){return"["+t+"="+i+n+"]"},this))}}if(e!=t)BX.onCustomEvent(this.eventNode,"onFileIsDetected",[t,this])}return t},clean:function(){if(this.handler&&this.handler.values){var e;while((e=this.handler.values.pop())&&e){BX.remove(e)}if(this.handler.params&&this.handler.params.controlName){var t=BX(this.manager.formID)||this.handler.controller;if(t){t.querySelectorAll('input[name="'+this.handler.params.controlName+'"]').forEach(function(e){e.parentNode.removeChild(e)})}}}this.values={}},reinit:function(e,t){var i=[],n,o;for(n in t){if(t.hasOwnProperty(n)){if(t[n]["USER_TYPE_ID"]==this.parserName&&t[n]["VALUE"]){for(o in t[n]["VALUE"]){if(t[n]["VALUE"].hasOwnProperty(o)){i.push(t[n]["VALUE"][o])}}}}}if(i.length>0){this.exec(this.reinitValues,[e,i]);return true}return false}};var o=function(e,t,i){o.superclass.constructor.apply(this,arguments);this.parser=e.parser["webdav_element"]||null;this.node=BX("wduf-selectdialog-"+t);this.manager=e;this.parserName="webdav_element";this.prefixNode="wd-doc";this.prefixHTMLNode="wdif-doc-";this.storage="webdav";this.events={onInit:"WDLoadFormControllerInit",onShow:"WDLoadFormController",onBound:"WDLoadFormControllerWasBound"}};BX.extend(o,n);o.prototype.reinitValues=function(e,t){var i,n,o={};this.waitAnswerFromServer=[];while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("alt"),storage:"webdav",size:n.getAttribute("data-bx-size"),sizeInt:1,ext:"",link:n.getAttribute("data-bx-document")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");this.waitAnswerFromServer.push(i)}}if(this.waitAnswerFromServer.length>0){if(!this._defferCheckText)this._defferCheckText=BX.delegate(this.defferCheckText,this);BX.addCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText);this.handler.WDFD_SelectFile({},{},o)}};o.prototype.defferCheckText=function(e){var t=BX.util.array_search(e.element_id,this.waitAnswerFromServer);if(t>=0){this.runCheckText();this.waitAnswerFromServer=BX.util.deleteFromArray(this.waitAnswerFromServer,t)}if(this.waitAnswerFromServer.length<=0)BX.removeCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText)};var r=function(e,t,i){r.superclass.constructor.apply(this,arguments);this.parser=e.parser["file"]?e.parser["file"]:e.parser["postimage"]["exist"]?e.parser["postimage"]:null;this.postfix=i["postfix"]||"";this.node=BX("file-selectdialog-"+t);this.parserName="file";this.prefixNode="wd-doc";this.prefixHTMLNode="file-doc-";this.props={valueEditClassName:"file-inline-file",securityCID:"upload-cid"};this.storage="bfile";this.events={onInit:"BFileDLoadFormControllerInit",onShow:"BFileDLoadFormController",onBound:"BFileDLoadFormControllerWasBound"}};BX.extend(r,n);r.prototype.initValues=function(e){var t;if(e!==true){t=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(t&&t.length>1){this.exec(this.initValues,[true]);return true}return false}t=this.handler.agent.values||[];var i,n,o,r,s={},a="/bitrix/components/bitrix/main.file.input/file.php?mfi_mode=down&cid="+this.handler.CID+"&sessid="+BX.bitrix_sessid();for(var d=0;d<t.length;d++){r=parseInt(t[d].getAttribute("id").replace(this.prefixNode,""));if(s["id"+r])continue;s["id"+r]="Y";if(r>0){n=BX.findChild(t[d],{className:"f-wrap"},true,false);if(!n)continue;o={element_id:r,element_name:n.innerHTML,parser:this.parser.bxTag,storage:"bfile",element_url:a+"&fileID="+r};i=this.addFile(o,{usePostfix:true,hasPreview:false})}}this.runCheckText();return true};r.prototype.checkFile=function(e,t,i){e=""+(typeof e=="object"?e.id:e);e=e+(i&&i["usePostfix"]===true?this.postfix:"");if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(this.prefixNode+t.element_id,true)){var n={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(this.prefixNode+t.element_id,true)},o;if((t["element_type"]&&t["element_type"].indexOf("image/")===0||/(\.png|\.jpg|\.jpeg|\.gif|\.bmp|\.webp)$/i.test(t.element_name))&&((o=BX.findChild(n.place,{tagName:"IMG"},true,false))&&o||i&&i["hasPreview"]===false)){n.type="image/xyz";n.src=t["element_thumbnail"]||t["element_url"];n.isImage=true;n.hasPreview=false;n.lowsrc="";n.width="";n.height="";if(BX(o)){n.hasPreview=true;n.lowsrc=t["element_thumbnail"]||o["src"];n.width=parseInt(o.getAttribute("data-bx-full-width"));n.height=parseInt(o.getAttribute("data-bx-full-height"))}}else if(this.parser.bxTag=="postimage"){return false}if(BX(n.place,true).getAttribute("bx-attach-file-type")){n.fileType=BX(n.place,true).getAttribute("bx-attach-file-type")}this.values[e]=n}return this.values[e]||false};r.prototype.bindFile=function(e){var t=e&&e["place"]?e["place"]:null;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){if(e.isImage&&e.hasPreview){var i=BX.findChild(t,{className:"feed-add-img-title"},true,false),n=BX.findChild(t,{className:"feed-add-img-wrap"},true,false);if(n){BX.bind(n,"click",BX.proxy(function(){this.insertFile(e)},this));n.style.cursor="pointer";n.title=BX.message("MPF_IMAGE")}if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e)},this));i.style.cursor="pointer";i.title=BX.message("MPF_IMAGE")}}else r.superclass.bindFile.apply(this,arguments)}};r.prototype.clean=function(){r.superclass.clean.apply(this,arguments);if(this["handler"]&&this.handler["agent"]&&this.handler.agent["inputName"]){var e,t,i=BX(this.manager.formID);e=BX.findChildren(i,{tagName:"INPUT",attribute:{name:this.handler.agent.inputName+"[]"}},true);if(e){for(t=0;t<e.length;t++){BX.remove(e[t])}}}};var s=function(t,i){this.params=i;this.formID=t;this.showPinButton=!!BX("lhe_button_editor_"+this.formID);if(this.showPinButton){this.params.showPanelEditor=!!this.params.pinEditorPanel}this.oEditorId=i["LHEJsObjId"];this.__divId=i["LHEJsObjName"]||i["LHEJsObjId"];e.handler[this.oEditorId]=this;e.form[this.formID]=this;this.oEditor=s.getEditor(this.oEditorId);this.urlPreview=this.initUrlPreview(i);this.eventNode=BX("div"+this.__divId);BX.addCustomEvent(this.eventNode,"OnShowLHE",BX.delegate(this.OnShowLHE,this));BX.addCustomEvent(this.eventNode,"OnButtonClick",BX.delegate(this.OnButtonClick,this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){if(t.oEditor&&t.oEditor["AllowBeforeUnloadHandler"])t.oEditor.AllowBeforeUnloadHandler();if(t.monitoringWakeUp===true)t.monitoringStart()});BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",function(e,t){t.monitoringWakeUp=t.monitoringStop();if(t.oEditor&&t.oEditor["DenyBeforeUnloadHandler"])t.oEditor.DenyBeforeUnloadHandler()});this.initParsers(i);this.initFiles(t,i);BX.ready(BX.delegate(function(){if(BX("lhe_button_submit_"+t,true)){BX.bind(BX("lhe_button_submit_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["submit"]);return BX.PreventDefault(e)},this))}if(BX("lhe_button_cancel_"+t,true)){BX.bind(BX("lhe_button_cancel_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["cancel"]);return BX.PreventDefault(e)},this))}},this));this.inited=true;if(BX(this.formID)){BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){e.FORM.setAttribute("bx-lhe-autosave-prepared","Y")})}BX.onCustomEvent(this,"onInitialized",[this,t,i,this.parsers]);BX.onCustomEvent(this.eventNode,"onInitialized",[this,t,i,this.parsers]);if(this.oEditor&&this.oEditor.inited&&!this.oEditor["__lhe_flags"]){BX.onCustomEvent(this.oEditor,"OnEditorInitedBefore",[this.oEditor]);BX.onCustomEvent(this.oEditor,"OnEditorInitedAfter",[this.oEditor,true])}};s.prototype={editorIsLoaded:false,arFiles:{},parser:{},controllers:{},exec:function(e,t){this.functionsToExec=this.functionsToExec||[];if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.editorIsLoaded===true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},initParsers:function(e){this.parser={postimage:{exist:false,bxTag:"postimage",tag:"IMG ID",tags:["IMG ID"],regexp:/\[(IMG ID)=((?:\s|\S)*?)(?:\s*?WIDTH=(\d+)\s*?HEIGHT=(\d+))?\]/gi,code:"[IMG ID=#ID##ADDITIONAL#]",wysiwyg:'<img id="#ID#" src="'+'#SRC#" lowsrc="'+'#LOWSRC#" title=""#ADDITIONAL# />'},player:{exist:false,bxTag:"player",tag:"FILE ID",tags:["FILE ID"],regexp:/\[(FILE ID)=((?:\s|\S)*?)?\]/gi,code:"[FILE ID=#ID##ADDITIONAL#]",wysiwyg:'<img class="bxhtmled-player-surrogate" id="#ID#" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" contenteditable="false" title=""#ADDITIONAL# />'}};var t=e["parsers"]?e["parsers"]:{};for(var n in t){if(t.hasOwnProperty(n)&&/[a-z]/gi.test(n+"")){this.parser[n]=new i(n,t[n])}}if(BX.util.object_search("UploadImage",t)){this.parser["postimage"]["exist"]=true}if(typeof e["arSize"]=="object"){var o="";if(e["arSize"]["width"])o+="max-width:"+e["arSize"]["width"]+"px;";if(e["arSize"]["height"])o+="max-height:"+e["arSize"]["height"]+"px;";if(o!=="")this.parser["postimage"]["wysiwyg"]=this.parser["postimage"]["wysiwyg"].replace("#ADDITIONAL#",' style="'+o+'" #ADDITIONAL#')}},initFiles:function(e,t){this.arFiles={};this.controllers={common:{postfix:"",storage:"bfile",parser:"postimage",node:window,obj:null,init:false}};this.monitoring={interval:null,text:"",savedText:"",files:[],savedFiles:[]};if(!t["CID"]||typeof t["CID"]!=="object")return;BX.addCustomEvent(this.eventNode,"onFileIsAdded",BX.delegate(this.OnFileUploadSuccess,this));BX.addCustomEvent(this.eventNode,"onFileIsFailed",BX.delegate(this.OnFileUploadFailed,this));BX.addCustomEvent(this.eventNode,"onFileIsDeleted",BX.delegate(this.OnFileUploadRemove,this));BX.addCustomEvent(this.eventNode,"onFileIsDetected",BX.delegate(this.setContent,this));BX.addCustomEvent(this.eventNode,"onFileIsInserted",BX.delegate(this.insertFile,this));var i,s,a;for(s in t["CID"]){if(t["CID"].hasOwnProperty(s)){i=t["CID"][s]["parser"];if(i=="disk_file")this.controllers[s]=new n(this,s,t["CID"][s]);else if(i=="webdav_element")this.controllers[s]=new o(this,s,t["CID"][s]);else if(i=="file")this.controllers[s]=new r(this,s,t["CID"][s]);if(this.controllers[s]&&this.controllers[s].init()&&!a)a=true}}BX.ready(BX.delegate(function(){BX.bind(BX("bx-b-uploadfile-"+e),"click",BX.proxy(this.controllerInit,this));if(a)this.controllerInit("show")},this))},controllerInit:function(e){this.controllerInitStatus=e=="show"||e=="hide"?e:this.controllerInitStatus=="show"?"hide":"show";BX.onCustomEvent(this.eventNode,"onShowControllers",[this.controllerInitStatus])},initUrlPreview:function(){if(this.params["urlPreviewId"]&&window["BXUrlPreview"]&&BX(this.params["urlPreviewId"])){return new BXUrlPreview(BX(this.params["urlPreviewId"]))}return null},getContent:function(){return this.oEditor?this.oEditor.GetContent():""},setContent:function(e){if(this.oEditor)this.oEditor.SetContent(e)},OnFileUploadSuccess:function(e,t,i,n){if(this.controllers[t.id]){var o=t.parser.bxTag+e.id;this.arFiles[o]=this.arFiles[o]||[];this.arFiles[o].push(t.id);if(n&&n["referrerToEditor"]){var r=this.getFileToInsert(e,t);BX.onCustomEvent(n["referrerToEditor"],"OnImageDataUriCaughtUploaded",[r]);BX.onCustomEvent(this.oEditor,"OnImageDataUriCaughtUploaded",[n["referrerToEditor"],e,r])}else if(i===true&&e.isImage&&this.insertImageAfterUpload){if(!this._insertFile)this._insertFile=BX.delegate(this.insertFile,this);this.exec(this._insertFile,arguments)}}},OnFileUploadFailed:function(e,t,i){if(i&&i["referrerToEditor"]){BX.onCustomEvent(i["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(this.editor,"OnImageDataUriCaughtFailed",[i["referrerToEditor"]])}},OnFileUploadRemove:function(e,t){if(this.controllers[t.id]){var i=t.parser.bxTag+e.id;if(this.arFiles[i]){var n=BX.util.array_search(t.id,this.arFiles[i]);this.arFiles[i]=BX.util.deleteFromArray(this.arFiles[i],n);if(!this.arFiles[i]||this.arFiles[i].length<=0){this.arFiles[i]=null;delete this.arFiles[i];if(!this._deleteFile)this._deleteFile=BX.delegate(this.deleteFile,this);this.exec(this._deleteFile,arguments)}}}},showPanelEditor:function(e,t){if(e==undefined)e=!this.oEditor.toolbar.IsShown();this.params.showPanelEditor=e;var i=BX("lhe_button_editor_"+this.formID),n=BX("panel-close"+this.__divId);if(n){this.oEditor.dom.cont.appendChild(n)}if(e){this.oEditor.dom.toolbarCont.style.opacity="inherit";this.oEditor.toolbar.Show();if(i)BX.addClass(i,"feed-add-post-form-btn-active");if(n)n.style.display=""}else{this.oEditor.toolbar.Hide();if(i)BX.removeClass(i,"feed-add-post-form-btn-active");if(n)n.style.display="none"}if(t!==false)BX.userOptions.save("main.post.form","postEdit","showBBCode",e?"Y":"N")},monitoring:{},monitoringStart:function(){if(this.monitoring.interval===null){if(!this._monitoringStart){this._monitoringStart=BX.delegate(this.checkFilesInText,this);BX.addCustomEvent(this.oEditor,"OnContentChanged",BX.proxy(function(e){this.monitoring.text=e},this))}this.monitoring.interval=setInterval(this._monitoringStart,1e3)}},monitoringStop:function(){var e=this.monitoring.interval!==null;if(this.monitoring.interval!==null)clearInterval(this.monitoring.interval);this.monitoring.interval=null;return e},monitoringSetStatus:function(e,t,i){if(this.arFiles[e+t]){var n;for(var o=0;o<this.arFiles[e+t].length;o++){n=this.arFiles[e+t][o];BX.onCustomEvent(this.controllers[n],"onFileIsInText",[t,i])}}},checkFilesInText:function(){if(this.monitoring.text!==this.monitoring.savedText){this.monitoring.savedText=this.monitoring.text;this.monitoring.files=[];var e=this.monitoring.savedText,t,i=function(e,t){return function(i,n,o){e.monitoring.files.push([t,o].join("/"))}};for(t in this.parser){if(this.parser.hasOwnProperty(t)){if(!this.parser[t]["checkFilesInText"]){this.parser[t]["checkFilesInText"]=i(this,t)}e.replace(this.parser[t]["regexp"],this.parser[t]["checkFilesInText"])}}if(this.monitoring.savedFiles.join(",")!==this.monitoring.files.join(",")){var n={},o;while(o=this.monitoring.savedFiles.pop()){n[o]=null}for(t=0;t<this.monitoring.files.length;t++){o=this.monitoring.files[t];n[o]=n[o]>=0?n[o]+1:1}for(t in n){if(n.hasOwnProperty(t)){o=t.split("/");this.monitoringSetStatus(o[0],o[1],n[t]>0)}}}this.monitoring.savedFiles=this.monitoring.files;if(this.monitoring.savedFiles.length<=0)this.monitoringStop()}},checkFile:function(e,t){var i=false;if(typeof e=="string"){var n=typeof t=="string"?t:t.parser;if(!!this.arFiles[n+e]){var o=this.arFiles[n+e][0];t=this.controllers[o];i={file:t.values[e],controller:t}}}else if(this.controllers[t.id]){i={file:e,controller:t}}return i},insertFile:function(e,t){var i=this.oEditor;if(i&&e){var n=i.GetViewMode(),o=this.getFileToInsert(e,t);if(n=="wysiwyg"){i.InsertHtml(o.replacement);setTimeout(BX.delegate(i.AutoResizeSceleton,i),500);setTimeout(BX.delegate(i.AutoResizeSceleton,i),1e3)}else if(n=="code"){i.textareaView.Focus();if(!i.bbCode){var r=i.GetIframeDoc();var s=r.createElement("DIV");s.style.display="none";s.innerHTML=o.replacement;r.body.appendChild(s);o.replacement=i.Parse(o.replacement,true,false);s.parentNode.removeChild(s)}i.textareaView.WrapWith("","",o.replacement)}else{return}o["callback"]()}},getFileToInsert:function(e,t){var i=this.oEditor;if(i&&e){var n=e["id"],o="",r=t.parser,s=i.bbCode?i.GetViewMode():"wysiwyg",a=this.parser[r.bxTag][s];if(e["fileType"]&&this.parser[e["fileType"]]&&s=="wysiwyg"){a=this.parser[e["fileType"]][s]}if(e["isImage"]){a=s=="wysiwyg"?this.parser["postimage"][s]:a;if(e.width>0&&e.height>0&&i.sEditorMode=="html"){o=' style="width:'+e.width+"px;height:"+e.height+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}if(s=="wysiwyg"){a=a.replace("#ID#",i.SetBxTag(false,{tag:r.bxTag,params:{value:n}})).replace("#SRC#",e.src).replace("#URL#",e.url).replace("#LOWSRC#",e.lowsrc||"").replace("#NAME#",e.name).replace("#ADDITIONAL#",o)+"<span>&nbsp;</span>"}else if(s=="code"&&i.bbCode){a=a.replace("#ID#",n).replace("#ADDITIONAL#","")}return{replacement:a,callback:BX.proxy(function(){this.monitoringSetStatus(t.parser.bxTag,e.id,true);this.monitoringStart()},this)}}return{replacement:"",callback:BX.DoNothing}},deleteFile:function(e,t){var i=this.oEditor,n=t.parser,o=e.id,r=i.GetContent();if(n&&r.indexOf("="+o)>=0){if(i.GetViewMode()=="wysiwyg"){var s=i.GetIframeDoc(),a,d;for(a in i["bxTags"]){if(i["bxTags"].hasOwnProperty(a)){if(typeof i.bxTags[a]=="object"&&i.bxTags[a]["params"]&&i.bxTags[a]["params"]["value"]==e.id){d=s.getElementById(a);if(d)d.parentNode.removeChild(d)}}}i.SaveContent()}else{r=r.replace(n.regexp,function(t,i,n){return n==e.id?"":t});i.SetContent(r);i.Focus()}this.monitoringSetStatus(n.bxTag,e.id,false)}},reinit:function(e,t){BX.onCustomEvent(this.eventNode,"onReinitializeBefore",[this,e,t]);this.arFiles={};delete this.monitoringWakeUp;this.monitoringStop();this.oEditor.CheckAndReInit(e||"");BX.onCustomEvent(this.eventNode,"onReinitialize",[this,e,t]);var i,n=false;for(i in this.controllers){if(this.controllers.hasOwnProperty(i)){if(this.controllers[i]["init"]&&this.controllers[i].reinit(e,t))n=true}}this.controllerInit(n?"show":"hide");if(this.params["~height"]){this.oEditor.SetConfigHeight(this.params["~height"]);this.oEditor.ResizeSceleton()}if(this.urlPreview){this.urlPreview.detachUrlPreview();var o;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){o=t[r]["VALUE"]}}if(o)this.urlPreview.attachUrlPreview({id:o})}},Parse:function(e,t,i){var n=this.parser[e],o=this;if(n){t=t.replace(n.regexp,function(t,r,s,a,d){var l=o.checkFile(s,e);if(l&&(l=l.file)&&l){var h="",f=l.isImage?o.parser.postimage.wysiwyg:n.wysiwyg;o.monitoringStart();if(l.fileType&&o.parser[l.fileType]&&o.parser[l.fileType].wysiwyg){f=o.parser[l.fileType].wysiwyg}if(l.isImage){a=parseInt(a);d=parseInt(d);h=a&&d?' width="'+a+'" height="'+d+'"':"";if(h===""&&l["width"]>0&&l["height"]>0){h=' style="width:'+l["width"]+"px;height:"+l["height"]+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}return f.replace("#ID#",i.SetBxTag(false,{tag:e,params:{value:s}})).replace("#NAME#",l.name).replace("#SRC#",l.src).replace("#LOWSRC#",l.lowsrc).replace("#ADDITIONAL#",h).replace("#WIDTH#",parseInt(a)).replace("#HEIGHT#",parseInt(d))}return t})}return t},Unparse:function(e,t){var i="",n=e.tag;if(this.parser[n]){var o=parseInt(t.node.hasAttribute("width")?t.node.getAttribute("width"):0),r=parseInt(t.node.hasAttribute("height")?t.node.getAttribute("height"):0),s="";if(o>0&&r>0){s=" WIDTH="+o+" HEIGHT="+r}i=this.parser[n]["code"].replace("#ID#",e.params.value).replace("#ADDITIONAL#",s).replace("#WIDTH#",o).replace("#HEIGHT#",r)}return i},OnShowLHE:function(e,t,i){var n=this.__divId;e=e===false?false:e==="hide"?"hide":e==="justShow"?"justShow":true;this.oEditor=this.oEditor||s.getEditor(this.oEditorId);if(!this.oEditor)return;this.oEditor.Init();var o=BX("micro"+n),r=this.eventNode;if(o){o.style.display=e===true||e==="justShow"?"none":"block"}if(e=="hide"){BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);if(this.eventNode.style.display=="none"){BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.eventNode.scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.proxy(function(){this.eventNode.style.cssText="";this.eventNode.style.display="none";BX.onCustomEvent(r,"OnAfterHideLHE",[e,this])},this)}).animate()}}else if(e){BX.onCustomEvent(this.eventNode,"OnBeforeShowLHE",[e,this]);if(e=="justShow"){this.eventNode.style.display="block";BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else if(this.eventNode.style.display=="block"){BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else{BX.adjust(this.eventNode,{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:r.scrollHeight},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.proxy(function(){BX.onCustomEvent(r,"OnAfterShowLHE",[e,this]);this.oEditor.Focus();this.eventNode.style.cssText=""},this)}).animate()}}else{BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);this.eventNode.style.display="none";BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}},OnButtonClick:function(e){if(e!=="cancel"){var t={result:true};BX.onCustomEvent(this.eventNode,"OnClickBeforeSubmit",[this,t]);if(t["result"]!==false)BX.onCustomEvent(this.eventNode,"OnClickSubmit",[this])}else{d.node=null;BX.onCustomEvent(this.eventNode,"OnClickCancel",[this]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["hide"])}},OnEditorInitedBefore:function(e){var t=this;this.oEditor=e;e.formID=this.formID;if(this.params)this.params["~height"]=e.config["height"];BX.addCustomEvent(e,"OnCtrlEnter",function(){e.SaveContent();if(BX.type.isNotEmptyString(t.params["ctrlEnterHandler"])&&typeof window[t.params["ctrlEnterHandler"]]=="function")window[t.params["ctrlEnterHandler"]]();else if(BX.type.isFunction(t.params["ctrlEnterHandler"]))t.params["ctrlEnterHandler"]();else BX.submit(BX(t.formID))});var i=this.params.parsers?this.params.parsers:[];if(BX.util.object_search("Spoiler",i)){e.AddButton({id:"spoiler",name:BX.message("spoilerText"),iconClassName:"spoiler",disabledForTextarea:false,src:BX.message("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.png",toolbarSort:205,handler:function(){var e=this,t=false;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){t=e.editor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=e.editor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}});e.AddParser({name:"spoiler",obj:{Parse:function(e,t,i){if(/\[(cut|spoiler)(([^\]])*)\]/gi.test(t)){t=t.replace(/[\001-\006]/gi,"").replace(/\[cut(((?:=)[^\]]*)|)\]/gi,"\x01$1\x01").replace(/\[\/cut]/gi,"\x02").replace(/\[spoiler([^\]]*)\]/gi,"\x03$1\x03").replace(/\[\/spoiler]/gi,"\x04");var n=/(?:\001([^\001]*)\001)([^\001-\004]+)\002/gi,o=/(?:\003([^\003]*)\003)([^\001-\004]+)\004/gi,r=function(e,t){e=e.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'+i.SetBxTag(false,{tag:"spoiler"})+'" title="'+e+'">'+t+"</blockquote>"},s=function(e,t,i){return r(t,i)};while(t.match(n)||t.match(o)){t=t.replace(n,s).replace(o,s)}}t=t.replace(/\001([^\001]*)\001/gi,"[cut$1]").replace(/\003([^\003]*)\003/gi,"[spoiler$1]").replace(/\002/gi,"[/cut]").replace(/\004/gi,"[/spoiler]");return t},UnParse:function(t,i){if(t.tag=="spoiler"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}})}if(BX.util.object_search("MentionUser",i)){e.AddParser({name:"postuser",obj:{Parse:function(t,i){i=i.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(t,i,n){n=BX.util.trim(n);if(n=="")return"";return'<span id="'+e.SetBxTag(false,{tag:"postuser",params:{value:parseInt(i)}})+'" class="bxhtmled-metion">'+n+"</span>"});return i},UnParse:function(t,i){if(t.tag=="postuser"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[USER="+t.params.value+"]"+n+"[/USER]"}return""}}})}var n=function(i,n){return t.Parse(i,n,e)},o=function(e,i){return t.Unparse(e,i)};for(var r in this.parser){if(this.parser.hasOwnProperty(r)){e.AddParser({name:r,obj:{Parse:n,UnParse:o}})}}if(this.showPinButton){this.pinEditorPanel=this.params&&this.params.pinEditorPanel===true;var s="toolbar_pin";var a=function(e,i){a.superclass.constructor.apply(this,arguments);this.id=s;this.title=BX.message("MPF_PIN_EDITOR_PANNEL");this.className+=" "+(t.pinEditorPanel?"bxhtmled-button-toolbar-pined":"bxhtmled-button-toolbar-pin");this.Create();if(i)i.appendChild(this.GetCont())};BX.extend(a,window.BXHtmlEditor.Button);a.prototype.OnClick=function(){BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pined");BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pin");if(t.pinEditorPanel){t.pinEditorPanel=false;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pin")}else{t.pinEditorPanel=true;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pined")}BX.userOptions.save("main.post.form","postEdit","pinEditorPanel",t.pinEditorPanel?"Y":"N")};window.BXHtmlEditor.Controls[s]=a;BX.addCustomEvent(e,"GetControlsMap",function(e){e.push({id:s,compact:true,hidden:false,sort:500,checkWidth:true,offsetWidth:32,wrap:"right"})})}},OnEditorInitedAfter:function(t){BX.addCustomEvent(t,"OnIframeDrop",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDrop",arguments)},this));BX.addCustomEvent(t,"OnIframeDragOver",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragOver",arguments)},this));BX.addCustomEvent(t,"OnIframeDragLeave",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragLeave",arguments)},this));BX.addCustomEvent(t,"OnImageDataUriHandle",function(){BX.onCustomEvent(this.eventNode,"OnImageDataUriHandle",Array.prototype.slice.call(arguments))}.bind(this));BX.addCustomEvent(t,"OnAfterUrlConvert",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnAfterLinkInserted",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnBeforeCommandExec",this.OnBeforeCommandExec.bind(this));t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:BX.message("BXEdDelFromText"),bbMode:true,ACTION:function(){var e=t.contextMenu.GetTargetItem("postimage");if(!e)e=t.contextMenu.GetTargetItem("postdocument");if(!e)e=t.contextMenu.GetTargetItem("postfile");if(e&&e.element){t.selection.RemoveNode(e.element)}t.contextMenu.Hide()}}];if(!this.params["lazyLoad"]){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow",t,false])}if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}if(BX(this.formID)){BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){var i=e;setTimeout(function(){BX.addCustomEvent(t,"OnContentChanged",BX.proxy(function(e){this["mpfTextContent"]=e;this.Init()},i))},1500)});BX.addCustomEvent(BX(this.formID),"onAutoSave",BX.proxy(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"+this.formID]=e["mpfTextContent"]},this));BX.addCustomEvent(BX(this.formID),"onAutoSaveRestore",BX.proxy(function(i,n){if(e.handler[t.id]){for(var o in e.handler[t.id].controllers){if(e.handler[t.id].controllers.hasOwnProperty(o)&&e.handler[t.id].controllers[o].handler&&e.handler[t.id].controllers[o].handler.params&&e.handler[t.id].controllers[o].handler.params.controlName&&e.handler[t.id].controllers[o].handler.params.controlName){delete n[e.handler[t.id].controllers[o].handler.params.controlName]}}}if(n["text"+this.formID]&&/[^\s]+/gi.test(n["text"+this.formID])){t.CheckAndReInit(n["text"+this.formID])}},this));if(BX(this.formID).hasAttribute("bx-lhe-autosave-prepared")&&BX(this.formID).BXAUTOSAVE){BX(this.formID).removeAttribute("bx-lhe-autosave-prepared");setTimeout(BX.proxy(function(){BX(this.formID).BXAUTOSAVE.Prepare()},this),100)}}var i=this.formID,n=this.params;this.showPanelEditor(n.showPanelEditor,false);if(!t.mainPostFormCustomized){t.mainPostFormCustomized=true;BX.addCustomEvent(t,"OnIframeKeydown",function(e){if(window.onKeyDownHandler){window.onKeyDownHandler(e,t,i)}});BX.addCustomEvent(t,"OnIframeKeyup",function(e){if(window.onKeyUpHandler){window.onKeyUpHandler(e,t,i)}});if(window["BXfpdStopMent"+i]){BX.addCustomEvent(t,"OnIframeClick",function(){window["BXfpdStopMent"+i]()})}if(t&&t.textareaView.GetCursorPosition){BX.addCustomEvent(t,"OnTextareaKeyup",function(e){if(window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(e,t,i)}});BX.addCustomEvent(t,"OnTextareaKeydown",function(e){if(window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(e,t,i)}})}}},OnAfterUrlConvert:function(e){if(this.urlPreview){this.urlPreview.attachUrlPreview({url:e})}},OnBeforeCommandExec:function(e,t,i,n){if(this.urlPreview&&t=="createLink"&&BX.type.isPlainObject(n)&&n.hasOwnProperty("href")){this.urlPreview.attachUrlPreview({url:n.href})}}};s.getEditor=function(e){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(typeof e=="object"?e.id:e):null};s.getHandler=function(t){return e.handler[typeof t=="object"?t.id:t]};s.getHandlerByFormId=function(t){return e.form[t]};s.unsetHandler=function(t){var i=typeof t=="object"?t.id:t;if(!e.handler[i])return;if(e.handler[i].oEditor)e.handler[i].oEditor.Destroy();e.handler[i]=null};s.reinitData=function(e,t,i){var n=s.getHandler(e);if(n)n.exec(n.reinit,[t,i]);return false};s.reinitDataBefore=function(e){var t=s.getHandler(e);if(t&&t["eventNode"])BX.onCustomEvent(t.eventNode,"onReinitializeBefore",[t])};window.LHEPostForm=s;window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var o=BX.util.trim(t[n]);if(o.length>0){var r=this.hiddenField.value.split(",");if(!BX.util.in_array(o,r)){var s;var a=BX.create("span",{children:[s=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});a.insertBefore(document.createTextNode(o),s);this.tagsContainer.insertBefore(a,this.addNewLink);BX.bind(s,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:a,tagValue:o}));this.hiddenField.value+=o+",";i.push(o)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy(function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)},this));BX.bind(this.activeBlock,"click",BX.proxy(function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)},this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var a=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");a=e;BX.defer(function(){e.disabled=true})()}};window.MPFbuttonCloseWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||a||this;if(e){e.disabled=false;BX.removeClass(e,"ui-btn-clock");a=null}};window.__mpf_wd_getinfofromnode=function(e,t){var i=BX.findChild(BX((e["prefixNode"]||"wd-doc")+e.element_id),{className:"files-preview",tagName:"IMG"},true,false);if(i){e.lowsrc=i.src;e.element_url=i.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight\=(\d+)/,"");e.width=parseInt(i.getAttribute("data-bx-full-width"));e.height=parseInt(i.getAttribute("data-bx-full-height"))}else if(t.urlGet){e.element_url=t.urlGet.replace("#element_id#",e.element_id).replace("#ELEMENT_ID#",e.element_id).replace("#element_name#",e.element_name).replace("#ELEMENT_NAME#",e.element_name)}};var d={listen:false,plus:false,text:"",bSearch:false,node:null,mode:null};window.onKeyDownHandler=function(e,t,i){var n=e.keyCode;if(!window["BXfpdStopMent"+i]){return true}var o=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(n===t.KEY_CODES["backspace"]&&d.node){var r=BX.util.trim(t.util.GetTextContent(d.node));if(r==="+"||r==="@"||d.mode=="button"&&r.length==1){window["BXfpdStopMent"+i]()}else if(d.mode=="button"&&r.length==1){window["BXfpdStopMent"+i]()}}if(BX.util.in_array(n,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(n,[50,43,61])||e.altKey&&BX.util.in_array(n,[76])||e.altKey&&e.ctrlKey&&BX.util.in_array(n,[81])&&e.key==="@"||e.altKey&&BX.util.in_array(n,[71,81])&&e.key==="@"||e.altKey&&BX.util.in_array(n,[50])&&e.key==="@"||typeof e.getModifierState==="function"&&!!e.getModifierState("AltGraph")&&BX.util.in_array(n,[81,50])&&typeof e.key!=="undefined"&&e.key==="@"){setTimeout(function(){var e=t.selection.GetRange(),i=t.GetIframeDoc(),n=e?e.endContainer.textContent:"",r=n?n.slice(e.endOffset-1,e.endOffset):"",s=n?n.slice(e.endOffset-2,e.endOffset-1):"";if((r=="@"||r=="+")&&(!s||BX.util.in_array(s,["+","@",",","("])||s.length==1&&BX.util.trim(s)==="")){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=true;d.mode="plus";e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);d.node=BX.create("SPAN",{props:{id:"bx-mention-node"}},i);t.selection.Surround(d.node,e);e.setStart(d.node,1);e.setEnd(d.node,1);t.selection.SetSelection(e);if(BX.type.isNotEmptyString(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:o,bindPosition:l(d.node,t)}])}}},10)}if(d.listen){var s=null;if(BX.type.isNotEmptyString(o)){s=BX.UI.SelectorManager.instances[o]}var a=false;if(s){a=s.getNavigationInstance().checkKeyboardNavigation({keyCode:n,tab:d.bSearch?"search":s?s.tabs.selected:false})}if(a){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}if(!d.listen&&d.listenFlag&&n===t.KEY_CODES["enter"]){var h=t.selection.GetRange();if(h.collapsed){var f=h.endContainer,u=t.GetIframeDoc();if(f){if(f.className!=="bxhtmled-metion"){f=BX.findParent(f,function(e){return e.className=="bxhtmled-metion"},u.body)}if(f&&f.className=="bxhtmled-metion"){t.selection.SetAfter(f)}}}}};window.onKeyUpHandler=function(e,t,i){var n=e.keyCode,o,r;if(!window["BXfpdStopMent"+i])return true;if(d.listen===true){if(n==t.KEY_CODES["escape"]){window["BXfpdStopMent"+i]()}else if(n!==t.KEY_CODES["enter"]&&n!==t.KEY_CODES["left"]&&n!==t.KEY_CODES["right"]&&n!==t.KEY_CODES["up"]&&n!==t.KEY_CODES["down"]){if(BX(d.node)){r=BX.util.trim(t.util.GetTextContent(d.node));var s=r;r=r.replace(/^[\+@]*/,"");d.bSearch=r.length>0;var a=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.type.isNotEmptyString(a)){var h=BX.UI.SelectorManager.instances[a];if(BX.type.isNotEmptyObject(h)){h.getSearchInstance().runSearch({text:r})}}if(d.leaveContent&&d._lastText&&s===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&s!==""&&r===""){d.bSearch=false;window["BXfpdStopMent"+i]();if(BX.type.isNotEmptyString(a)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:a,bindPosition:l(d.node,t)}])}}d.lastText=r;d._lastText=s}else{window["BXfpdStopMent"+i]()}}}else{if(!e.shiftKey&&(n===t.KEY_CODES["space"]||n===t.KEY_CODES["escape"]||n===188||n===190)){o=t.selection.GetRange();if(o.collapsed){var f=o.endContainer,u=t.GetIframeDoc();if(f){if(f.className!=="bxhtmled-metion"){f=BX.findParent(f,function(e){return e.className=="bxhtmled-metion"},u.body)}if(f&&f.className=="bxhtmled-metion"){r=t.util.GetTextContent(f);var c=r.match(/[\s\.\,]$/);if(c||n===t.KEY_CODES["escape"]){f.innerHTML=r.replace(/[\s\.\,]$/,"");var p=BX.create("SPAN",{html:c||t.INVISIBLE_SPACE},u);t.util.InsertAfter(p,f);t.selection.SetAfter(p)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,i){var n=e.keyCode;if(d.listen&&n==t.KEY_CODES["enter"]){var o=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.type.isNotEmptyString(o)){var r=BX.UI.SelectorManager.instances[o];if(BX.type.isNotEmptyObject(r)){r.getNavigationInstance().selectFirstItem({tab:d.bSearch?"search":r.tabs.selected})}}t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,i){var n,o,r=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(d.listen===true){if(r==27){window["BXfpdStopMent"+i]()}else if(r!==13){o=t.textareaView.GetValue(false);n=t.textareaView.GetCursorPosition();if(o.indexOf("+")!==-1||o.indexOf("@")!==-1){var a=o.substr(0,n),l=Math.max(a.lastIndexOf("+"),a.lastIndexOf("@"));if(l>=0){var h=a.substr(l),f=h;h=h.replace(/^[\+@]*/,"");d.bSearch=h.length>0;var u=null;if(BX.type.isNotEmptyString(s)){u=BX.UI.SelectorManager.instances[s]}if(BX.type.isNotEmptyObject(u)){u.getSearchInstance().runSearch({text:h})}if(d.leaveContent&&d._lastText&&(f===""||h==="")){window["BXfpdStopMent"+i]()}d.lastText=h;d._lastText=f}}}}else{if(r==16){var c=this;this.shiftPressed=true;if(this.shiftTimeout)this.shiftTimeout=clearTimeout(this.shiftTimeout);this.shiftTimeout=setTimeout(function(){c.shiftPressed=false},100)}if(r==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(r,[187,50,107,43,61])){n=t.textareaView.element.selectionStart;if(n>0){o=t.textareaView.element.value;var p=o.substr(n-1,1);if(p&&(p==="+"||p==="@")){d.listen=true;d.listenFlag=true;d.text="";d.textarea=true;d.bSearch=false;d.mode="plus";if(BX.type.isNotEmptyString(s)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:s}])}}}}}};var l=function(e,t){var i=BX.pos(e),n=BX.pos(t.dom.areaCont),o=BX.GetWindowScrollPos(t.GetIframeDoc()),r=n.top+i.bottom-o.scrollTop+2,s=n.left+i.right-o.scrollLeft;return{top:r,left:s}};window.BxInsertMention=function(e){var t=e.item,i=e.type,n=e.formID,o=e.editorId,r=e.bNeedComa,a=s.getEditor(o),l;if(i=="users"&&t&&t.entityId>0&&a){if(a.GetViewMode()=="wysiwyg"){var h=a.GetIframeDoc(),f=a.selection.GetRange(),u=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},h);l=BX.create("SPAN",{html:r?",&nbsp;":"&nbsp;"},h);a.SetBxTag(u,{tag:"postuser",params:{value:t.entityId}});if(BX(d.node)&&d.node.parentNode){a.util.ReplaceNode(d.node,u)}else{a.selection.InsertNode(u,f)}if(u&&u.parentNode){var c=BX.findParent(u,{className:"bxhtmled-metion"},h.body);if(c){a.util.InsertAfter(u,c)}}if(u&&u.parentNode){a.util.InsertAfter(l,u);a.selection.SetAfter(l)}}else if(a.GetViewMode()=="code"&&a.bbCode){a.textareaView.Focus();var p=a.textareaView.GetValue(false),m=a.textareaView.GetCursorPosition(),B=p.substr(0,m),v=Math.max(B.lastIndexOf("+"),B.lastIndexOf("@"));if(v>=0&&m>v){a.textareaView.SetValue(p.substr(0,v)+p.substr(m));a.textareaView.element.setSelectionRange(v,v)}a.textareaView.WrapWith(false,false,"[USER="+t.entityId+"]"+t.name+"[/USER]"+(r?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t])}var g=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(BX.type.isNotEmptyString(g)){var X=BX.UI.SelectorManager.instances[g];if(BX.type.isNotEmptyObject(X)){if(typeof X.itemsSelected[t.id]!="undefined"){delete X.itemsSelected[t.id]}}}if(window["BXfpdStopMent"+n]){window["BXfpdStopMent"+n]()}d["text"]="";if(a.GetViewMode()=="wysiwyg"){a.Focus();a.selection.SetAfter(l)}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFMentionInit=function(t,i){if(i.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",function(e){if(BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyString(e.data.DEST_DATA)&&BX.type.isNotEmptyString(e.formId)&&e.formId==t&&BX.UI.EntitySelector){var i=JSON.parse(e.data.DEST_DATA);if(!Array.isArray(i)){return}var n=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(n)){return}n.preselectedItems=i;n.setPreselectedItems(i)}});BX.addCustomEvent(window,"onMentionAdd",function(e){var t=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(t)){return}var i="employee";if(e.isExtranet==="Y"){i="extranet"}else if(e.isEmail==="Y"){i="email"}t.addItem({avatar:e.avatar,customData:{email:e.email},entityId:"user",entityType:i,id:e.entityId,title:e.name}).select()})}window["BXfpdSelectCallbackMent"+t]=function(e){window.BxInsertMention({item:e.item,type:e.entityType.toLowerCase(),formID:t,editorId:i.editorId,fireAddEvent:i.initDestination})};window["BXfpdStopMent"+t]=function(){var e=window.MPFgetSelectorId("bx-mention-"+t+"-id");if(BX.type.isNotEmptyString(e)){var i=BX.UI.SelectorManager.instances[e];if(BX.type.isNotEmptyObject(i)){i.closeAllPopups();i.getSearchInstance().abortSearchRequest()}}};if(BX(t)){BX.addCustomEvent(BX(t),"OnUCFormAfterShow",function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isArray(e.id)||!BX.type.isNotEmptyString(e.id[0])){return}var i=new RegExp("EVENT_(\\d+)","i");if(!i.test(e.id[0])){return}var n=window.MPFgetSelectorId("bx-mention-"+t+"-id");if(!BX.type.isNotEmptyString(n)){return}var o=BX.UI.SelectorManager.instances[n];if(!BX.type.isNotEmptyObject(o)){return}o.bindOptions.zIndex=2200})}if(e.form[t]&&BX("div"+e.form[t].__divId)){BX.addCustomEvent(e.handler[e.form[t].oEditorId],"OnEditorIsLoaded",function(){var e=window.MPFgetSelectorId("bx-mention-"+t+"-id");if(e){BX.onCustomEvent(window,"BX.MPF.MentionSelector:init",[{id:e,openDialogWhenInit:false}])}})}BX.ready(function(){var e=BX("bx-b-mention-"+t);var n=window.MPFgetSelectorId("bx-mention-"+t+"-id");BX.bind(e,"click",function(t){if(d.listen!==true){var o=s.getEditor(i.editorId),r=o.GetIframeDoc();if(o.GetViewMode()=="wysiwyg"&&r){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;d.mode="button";var a=o.selection.GetRange();if(BX(d.node)){BX.remove(BX(d.node))}o.InsertHtml('<span id="bx-mention-node">'+o.INVISIBLE_SPACE+"</span>",a);setTimeout(function(){if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:n,bindNode:e}])}d.node=r.getElementById("bx-mention-node");if(d.node){a.setStart(d.node,0);if(d.node.firstChild&&d.node.firstChild.nodeType==3&&d.node.firstChild.nodeValue.length>0){a.setEnd(d.node,1)}else{a.setEnd(d.node,0)}o.selection.SetSelection(a)}o.Focus()},100)}else if(o.GetViewMode()=="code"){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;d.mode="button";setTimeout(function(){if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:n,bindNode:e}])}},100)}BX.onCustomEvent(e,"mentionClick")}})})};window.BXfpdOnDialogOpen=function(){d.listen=true;d.listenFlag=true};window.BXfpdOnDialogClose=function(e){d.listen=false;setTimeout(function(){d.listenFlag=false;if(!d.listen){var t=s.getEditor(e.editorId);if(t){var i=t.GetIframeDoc();if(BX(d.node)){t.selection.SetAfter(d.node);if(d.leaveContent){t.util.ReplaceWithOwnChildren(d.node)}else{BX.remove(BX(d.node))}}t.Focus()}}},100)};MPFEntitySelector=function(t){this.selector=null;this.inputNode=null;this.messages={};if(!BX.type.isNotEmptyString(t.id)){return null}if(e.selector[t.id]){return e.selector[t.id]}e.selector[t.id]=this.init(t)};MPFEntitySelector.prototype.init=function(e){if(!BX.type.isPlainObject(e)){e={}}if(!BX.type.isNotEmptyString(e.id)||!BX.type.isNotEmptyString(e.tagNodeId)||!BX(e.tagNodeId)){return null}if(BX.type.isNotEmptyString(e.inputNodeId)&&BX(e.inputNodeId)){this.inputNode=BX(e.inputNodeId)}if(BX.type.isNotEmptyObject(e.messages)){this.messages=e.messages}this.selector=new BX.UI.EntitySelector.TagSelector({id:e.id,dialogOptions:{id:e.id,context:BX.type.isNotEmptyString(e.context)?e.context:null,preselectedItems:BX.type.isArray(e.preselectedItems)?e.preselectedItems:[],events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{title:this.messages.allUsersTitle,allowView:BX.type.isBoolean(e.allowToAll)&&e.allowToAll}}},{id:"user",options:{emailUsers:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,inviteGuestLink:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,myEmailUsers:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]}}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_LINK_2")});this.selector.renderTo(document.getElementById(e.tagNodeId));return this.selector};MPFEntitySelector.prototype.recalcValue=function(e){if(!BX.type.isArray(e)||!this.inputNode){return}var t=[];e.forEach(function(e){t.push([e.entityId,e.id])});this.inputNode.value=JSON.stringify(t)};window.MPFEntitySelector=MPFEntitySelector})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1654841551814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?165484184530971";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.map.js";}"*/
(function(e){var t=false,i=false,s=0,o=null,n=null,a={},l={};BX.namespace("BX.Disk");if(BX.Disk.UF)return;BX.Disk.UF=function(){var t=function(t){this.dialogName="DiskFileDialog";this.params=t;this.CID=t["UID"];this.controller=t.controller;this.values=t.values||[];this.prefix="diskuf-doc";this.onUploaderIsAlmostInited=BX.delegate(this.onUploaderIsAlmostInited,this);this._checkFileName=this.checkFileName.bind(this);this._selectFolder=this.selectFolder.bind(this);this._openSection=this.openSection.bind(this);this._selectItem=this.selectItem.bind(this);this._unSelectItem=this.unSelectItem.bind(this);BX.addCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);this.agent=BX.Uploader.getInstance({id:t["UID"],streams:3,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:t["urlUpload"],showImage:false,sortItems:false,input:t["input"],dropZone:t["dropZone"],placeHolder:t["placeHolder"],queueFields:{thumb:{tagName:"TR",className:"wd-inline-file"}},fields:{thumb:{tagName:"",template:BX.message("DISK_TMPLT_THUMB")}}});this.urlSelect=!!t["urlSelect"]?t["urlSelect"]:null;this.urlRenameFile=!!t["urlRenameFile"]?t["urlRenameFile"]:null;this.urlDeleteFile=!!t["urlDeleteFile"]?t["urlDeleteFile"]:null;this.urlSelect=this._addUrlParam(this.urlSelect,"dialog2=Y&ACTION=SELECT&MULTI=Y");this.urlUpload=!!t["urlUpload"]?t["urlUpload"]:null;this.urlShow=!!t["urlShow"]?t["urlShow"]:null;this.params.controlName=this.params.controlName||"FILES[]";this.init();return this};t.prototype={_addUrlParam:function(e,t){if(!e)return null;if(e.indexOf(t)==-1)e+=(e.indexOf("?")==-1?"?":"&")+t;return e},_camelToSNAKE:function(e){var t={},i,s;for(i in e){s=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[s]=e[i];t[i]=e[i]}return t},onUploaderIsAlmostInited:function(t,i){if(this.CID!=i["id"])return;BX.removeCustomEvent(e,"onUploaderIsAlmostInited",this.onUploaderIsAlmostInited);var s=BX.findChild(this.controller,{className:"diskuf-simple"},true),o=BX.findChild(this.controller,{className:"diskuf-extended"},true);if(t=="BX.UploaderSimple"){BX.remove(o);BX.show(s)}else{BX.remove(s);BX.show(o)}i.input=BX.findChild(this.controller,{className:"diskuf-fileUploader"},true);i.dropZone=BX.findChild(this.controller,{className:"diskuf-extended"},false);this.params.placeHolder=i["placeHolder"]=BX.findChild(this.controller,{className:"diskuf-placeholder-tbody"},true)},init:function(){this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);this._onFileIsAttached=BX.delegate(this.onFileIsAttached,this);this._onFileIsBound=BX.delegate(this.onFileIsBound,this);this._onFileIsInited=BX.delegate(this.onFileIsInited,this);this._onError=BX.delegate(this.onError,this);BX.addCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.agent,"onFileIsInited",this._onFileIsInited);BX.addCustomEvent(this.agent,"onError",this._onError);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);BX.onCustomEvent(BX(this.controller.parentNode),"DiskDLoadFormControllerInit",[this]);var e=[],t=[],i;for(var s=0;s<this.values.length;s++){i=BX.findChild(this.values[s],{className:"f-wrap"},true);if(!!i){e.push({name:i.innerHTML});t.push(this.values[s])}}this.values=[];this.agent.onAttach(e,t);var o=BX.findChild(this.controller,{className:"diskuf-selector-link"},true);if(!!o){BX.bind(o,"click",BX.proxy(this.showSelectDialog,this))}var n=BX.findChildren(this.controller,{className:"diskuf-selector-link-cloud"},true);if(!!n){for(var a in n){if(!n.hasOwnProperty(a))continue;BX.bind(n[a],"click",BX.proxy(this.showSelectDialogCloudImport,this))}}return false},addFile:function(e){return this.agent&&this.agent.onChange([e])},onItemIsAdded:function(){BX.removeCustomEvent(this.agent,"onItemIsAdded",this._onItemIsAdded);BX.show(BX.findParent(this.params.placeHolder,{className:"diskuf-files-block"}))},onFileIsInited:function(e,t){BX.addCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.addCustomEvent(t,"onFileIsAfterCreated",function(e,t,i,s){if(t&&!t.sizeInt){e.size=" "}});BX.addCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.addCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(t,"onUploadDone",this._onUploadDone);BX.addCustomEvent(t,"onUploadError",this._onUploadError)},onFileIs:function(e,t,i){this.bindEventsHandlers(e,t,i);var s={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,place:e,storage:"disk"};this.values.push(e);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadSuccess",[s,this,t.file,t]);t.__disk_element_id=i.element_id;BX.onCustomEvent(t,"OnFileUploadSuccess",[s,this])},onFileIsAppended:function(e,t){var i=this.agent.getItem(e),s=i.node;this.bindEventsHandlers(s,t,{});BX.onCustomEvent(this.params.controller.parentNode,"onFileIsAppended",[e,t])},onFileIsBound:function(e,t){var i=this.agent.getItem(e),s=i.node,o=s.getAttribute("id").replace("disk-edit-attach","");this.onFileIs(s,t,{element_id:o})},onFileIsAttached:function(e,t,i,s){if(!!s["sizeFormatted"])s["size"]=s["sizeFormatted"];if(!s.hasOwnProperty("service")){this.onUploadDone(t,{file:s});return}BX.Disk.ExternalLoader.startLoad({file:{id:s.id,name:s.name,service:s.service},onFinish:BX.delegate(function(e){var i=this.agent.getItem(t.id).node;BX.hide(i);var s={id:e.ufId,name:e.name,storage:e.storage,ext:t.ext,size:e.sizeFormatted,previewUrl:e.previewUrl,preview_url:e.previewUrl,element_url:e.previewUrl,size_int:parseInt(e.size,10)};var o;var n=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName);for(var a in s){o=s[a];if(s.hasOwnProperty(a)){if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0||isNaN(s["size_int"])){o=""}}if(s.hasOwnProperty("SIZE_INT")||isNaN(s["SIZE_INT"])){if(parseInt(s["SIZE_INT"],10)==0){o=""}}}n=n.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),o).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),o)}}var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":t.id},r;r=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:n});var d=BX.findChild(r,{className:"files-name-edit-btn"},true);if(d){BX.remove(d)}i.parentNode.insertBefore(r,i);s.element_id=s.id;this.agent.onAttach([s],[r]);t.deleteFile()},this),onProgress:BX.delegate(function(e){this.onUploadProgress(t,e)},this)})},onUploadProgress:function(e,t){t=Math.min(t,98);var i=e.id;if(!e.__progressBarWidth)e.__progressBarWidth=5;if(t>e.__progressBarWidth){e.__progressBarWidth=Math.ceil(t);e.__progressBarWidth=e.__progressBarWidth>100?100:e.__progressBarWidth;if(BX("wdu"+i+"Progressbar"))BX.adjust(BX("wdu"+i+"Progressbar"),{style:{width:e.__progressBarWidth+"%"}});if(BX("wdu"+i+"ProgressbarText"))BX.adjust(BX("wdu"+i+"ProgressbarText"),{text:e.__progressBarWidth+"%"})}},onUploadDone:function(e,t){if(t["file"]&&t["file"]["attachId"]&&t["file"]["attachId"]!=t["file"]["id"]){t["file"]["id"]=t["file"]["attachId"];delete t["file"]["attachId"]}var i=this.agent.getItem(e.id).node,s=this._camelToSNAKE(t["file"]);if(BX(i)){var o=BX.message("DISK_TMPLT_THUMB2").replace("#control_name#",this.params.controlName).replace("#CONTROL_NAME#",this.params.controlName),n;for(var a in s){if(s.hasOwnProperty(a)){n=s[a];if(a.toLowerCase()=="size"){if(s.hasOwnProperty("size_int")){if(parseInt(s["size_int"],10)==0){n=""}}if(s.hasOwnProperty("SIZE_INT")){if(parseInt(s["SIZE_INT"],10)==0){n=""}}}if(a==="STORAGE"&&n==="disk"){r(s.id).then(function(e){if(e.crumbs){var t=e.crumbs.join(" / ");var i=BX("disk-edit-attach"+s.id);if(i){var o=BX.findChild(i,{className:"files-placement"},true);if(o){BX.adjust(o,{text:t})}}}})}o=o.replace(new RegExp("#"+a.toLowerCase()+"#","gi"),n).replace(new RegExp("#"+a.toUpperCase()+"#","gi"),n)}}o=o.replace(new RegExp("#(width|height)#","gi"),"0").replace(new RegExp("#preview_url#","gi"),"data:image/png;base64,");var l={id:"disk-edit-attach"+s.id,"bx-agentFileId":e.id},d;if(s["XML_ID"])l["bx-attach-xml-id"]=s["XML_ID"];if(s["FILE_ID"])l["bx-attach-file-id"]="n"+s["FILE_ID"];if(s["FILE_TYPE"])l["bx-attach-file-type"]=s["FILE_TYPE"];d=BX.create("TR",{attrs:l,props:{className:"wd-inline-file"},html:o});if(!t.file.canChangeName){var c=BX.findChild(d,{className:"files-name-edit-btn"},true);if(c){BX.remove(c)}}i.parentNode.replaceChild(d,i);s.element_id=s.id;this.onFileIs(d,e,s)}else{this.onUploadError(e,t,this.agent)}},onUploadError:function(e,t,i){var s=this.agent.getItem(e.id);if(!!s&&(s=s.node)&&BX(s)&&(i==true||!BX(s).hasAttribute("bx-disk-error"))){BX(s).setAttribute("bx-disk-error","Y");BX.adjust(s,{props:{className:"error-load"}});var o=t&&t["error"]?t["error"]:"Uploading error";s.cells[1].innerHTML="";s.cells[2].innerHTML='<span class="info-icon"></span><span class="error-text">'+o+"</span>";BX.onCustomEvent(e,"OnFileUploadFailed",[s,this]);BX.onCustomEvent(this.params.controller.parentNode,"OnFileUploadFailed",[s,this,e.file,e])}},onError:function(e,t,i){var s="Uploading error.",o=s,n,a;if(i){if(i["error"]&&typeof i["error"]=="string")o=i["error"];else if(i["message"]&&typeof i["message"]=="string")o=i["message"];else if(BX.type.isArray(i["errors"])&&i["errors"].length>0){o=[];for(var l=0;l<i["errors"].length;l++){if(typeof i["errors"][l]=="object"&&i["errors"][l]["message"])o.push(i["errors"][l]["message"])}if(o.length<=0)o.push("Uploading error.");o=o.join(" ")}}e.files=e.files||{};for(a in e.files){if(e.files.hasOwnProperty(a)){n=this.agent.queue.items.getItem(a);this.onUploadError(n,{error:o},o!=s)}}},onBlurRenameInput:function(e){var t=e.target||e.srcElement;var i=BX.findChild(t.parentNode,{className:"files-name-edit-btn"},true);if(!!i)BX.fireEvent(i,"click")},bindEventsHandlers:function(t,i,s){var o=s.element_id,n="file-action-control",a=BX.findChild(t,{className:"files-path"},true),l=BX.findChild(t,{className:"files-name-edit-btn"},true),r=BX.findChild(t,{className:"f-wrap"},true);if(!!l&&!!a&&!!r&&!a.getAttribute(n)){a.setAttribute(n,"enabled");BX.show(a,"inline");BX.hide(BX.findChild(t,{className:"files-placement"},true));BX.bind(a,"click",BX.delegate(function(){this.move(o,r.innerHTML,t)},this))}if(!!l){BX.bind(l,"click",BX.delegate(function(){BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t)},this));var d=BX.findChild(t,{className:"files-name-edit-inp"},true);if(d){BX.bind(d,"keydown",BX.delegate(function(i){var s=(i||e.event).keyCode||(i||e.event).charCode;if(s==13){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.rename(o,t);return BX.PreventDefault(i)}if(s==27){BX.unbind(d,"blur",BX.proxy(this.onBlurRenameInput,this));BX.toggleClass(l.parentNode,"files-name-editable");this.revertRename(o,t);return BX.PreventDefault(i)}},this))}}var c=BX.findChild(t,{className:"feed-add-post-loading"},true),u=BX.delegate(function(){this.deleteFile(t,i)},this),h=BX.create("SPAN",{props:{className:"del-but"},events:{click:u}});if(!!c){var m=BX.findChild(c,{className:"del-but"},true);if(!!m)BX.bind(m,"click",u);else c.appendChild(h.cloneNode(true))}if(!BX.findChild(t,{className:"files-info"},true)){t.appendChild(BX.create("TD",{props:{className:"files-info"}}))}if(!BX.findChild(t,{className:"files-del-btn"},true)){t.appendChild(BX.create("TD",{props:{className:"files-del-btn"},children:[h]}))}if(!h.hasAttribute("bx-bound")){h.setAttribute("bx-bound","Y");BX.bind(h,"click",u);BX.onCustomEvent(t,"OnMkClose",[t])}var p=BX.findChild(t,{className:"transformer-upgrade-popup"},true);if(p){BX.show(p.parentNode);BX.bind(p,"click",BX.proxy(BX.Disk.UF.showTransformationUpgradePopup,this))}},deleteFile:function(e,t){if(!!t.__disk_element_id){BX.Disk.ajax({url:this.urlDeleteFile,method:"POST",dataType:"json",data:{attachedId:t.__disk_element_id},onsuccess:function(e){}});BX.onCustomEvent(this.controller.parentNode,"OnFileUploadRemove",[t.__disk_element_id,this])}BX.removeCustomEvent(t,"onFileIsAttached",this._onFileIsAttached);BX.removeCustomEvent(t,"onFileIsAppended",this._onFileIsAppended);BX.removeCustomEvent(t,"onFileIsBound",this._onFileIsBound);BX.removeCustomEvent(t,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(t,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(t,"onUploadError",this._onUploadError);delete t.hash;t.deleteFile("deleteFile");BX.remove(e);this.setHiddenUfValue()},setHiddenUfValue:function(){var e=BX.findChild(this.controller,{className:"diskuf-extended"},true);BX.append(BX.create("input",{props:{name:this.params.controlName,type:"hidden",value:""}}),e)},move:function(e,t,i){var s=this._addUrlParam(this.urlSelect.replace("ACTION=SELECT","").replace("MULTI=Y",""),"ID=E"+e+"&NAME="+t+"&wish=fakemove");while(s.indexOf("&&")>=0)s=s.replace("&&","&");var o=i||BX("disk-edit-attach"+e),n=BX.findChild(o,{className:"f-wrap"},true);BX.DiskFileDialog.arParams={};BX.DiskFileDialog.arParams[this.dialogName]={element_id:e,element_name:n.innerHTML};BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.addCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.addCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem);return BX.ajax.get(s,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFolder};BX.DiskFileDialog.openDialog(this.dialogName)},this),100)},this))},rename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".").pop();var l=s.value+"."+a;if(!!i){BX.focus(s);BX.bind(s,"blur",BX.proxy(this.onBlurRenameInput,this))}else if(s.value&&l!==n){BX.adjust(o,{text:l});var r=t.getAttribute("bx-agentFileId");var d=r?this.agent.getItem(r):null;if(!!d){d.item.file.name=l;d.item.name=l}var c=this.manager?this.manager.checkFile("disk_file"+e):null;if(!!c){c.name=l}BX.Disk.ajax({url:this.urlRenameFile,method:"POST",dataType:"json",data:{newName:l,attachedId:e},onsuccess:function(e){}})}},revertRename:function(e,t){if(!this.urlRenameFile){return}var i=BX.findChild(t,{className:"files-name-editable"},true);var s=BX.findChild(t,{className:"files-name-edit-inp"},true);var o=BX.findChild(t,{className:"f-wrap"},true);var n=o.textContent||o.innerText;var a=n.split(".");var l=a.pop();s.value=a.join(".")},showMovedFile:function(e,t,i){if(!e)return false;var s,o=e,n=BX("disk-edit-attach"+o),a=BX.findChild(n,{className:"files-path"},true);BX.cleanNode(a);i=i.split("/").join(" / ");a.innerHTML=i;var l=parseInt(a.offsetWidth);var r=parseInt(a.parentNode.offsetWidth)-150,d;s=r/(l/i.length);if(l>r){d=Math.floor(s/2)+1;i=i.substr(0,d)+" ... "+i.substr(i.length-d);a.innerHTML=i}var c=BX("diskuf-doc"+o);if(!!c){var u=this._fileUnserialize(c.value);u.section=t["sectionID"];u.iblock=t["iblockID"];c.value=this._fileSerialize(u)}return true},_fileUnserialize:function(e){if(!BX.type.isString(e))return false;var t=e.split("|");return{id:t[0]||0,section:t[1]||0,iblock:t[2]||0}},_fileSerialize:function(e){var t=[e.id,e.section,e.iblock];return t.join("|")},selectFolder:function(e,t,i,s){var o=false,n=false,a,l,r;if(BX.DiskFileDialog.arParams&&BX.DiskFileDialog.arParams[this.dialogName]&&BX.DiskFileDialog.arParams[this.dialogName]["element_id"])o=BX.DiskFileDialog.arParams[this.dialogName]["element_id"];var d=BX.delegate(function(e,t,i,s){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:e,targetFolderId:t},onsuccess:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.showMovedFile(e,i,s)},this)})},this);for(a in i){if(i.hasOwnProperty(a)&&i[a].type==="folder"){l=e.name+i[a].path;r={sectionID:a,iblockID:e.iblock_id};d(o,i[a].id,r,l);n=true}}if(!n){l=e.name;r={sectionID:e.section_id,iblockID:e.iblock_id};if(!!s&&!!s.path&&s.path!="/"){l+=s.path;r.sectionID=s.id;if(!!s){d(o,s.id,r,l)}}}BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.removeCustomEvent(BX.DiskFileDialog,"loadItemsDone",this._checkFileName);BX.removeCustomEvent(BX.DiskFileDialog,"selectItem",this._selectItem);BX.removeCustomEvent(BX.DiskFileDialog,"unSelectItem",this._unSelectItem)},checkFileName:function(e){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}if(!!e&&e!=this.dialogName)return;var t=BX.DiskFileDialog.arParams[this.dialogName]["element_name"];var i=false,s;for(s in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(s)){if(BX.DiskFileDialog.obItems[this.dialogName][s]["name"]==t)i=true;if(i)break}}if(i)BX.DiskFileDialog.showNotice(BX.message("DISK_FILE_EXISTS"),this.dialogName);else BX.DiskFileDialog.closeNotice(this.dialogName)},selectItem:function(e,t,i){if(i!=this.dialogName)return;var s=t.substr(1);var o=BX.DiskFileDialog.obCurrentTab[i].link;o=o.replace("/index.php","")+"/element/upload/"+s+"/?use_light_view=Y&AJAX_CALL=Y&SIMPLE_UPLOAD=Y&IFRAME=Y&sessid="+BX.bitrix_sessid()+"&SECTION_ID="+s+"&CHECK_NAME="+BX.DiskFileDialog.arParams[this.dialogName]["element_name"];o=o.replace("/files/lib/","/files/");BX.ajax.loadJSON(o,BX.delegate(function(e){var t=e.permission===true&&e["okmsg"]!="";if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){if(t){BX.DiskFileDialog.showNotice(this.msg.file_exists,this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}},this),200)},this))},unSelectItem:function(){if(this.noticeTimeout){clearTimeout(this.noticeTimeout);this.noticeTimeout=null}this.noticeTimeout=setTimeout(BX.delegate(function(){this.checkFileName()},this),200)},openSection:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y")}},openSectionCloud:function(e,t){if(t==this.dialogName){BX.DiskFileDialog.target[t]=this._addUrlParam(e,"dialog2=Y");BX.DiskFileDialog.target[t]=this._addUrlParam(BX.DiskFileDialog.target[t],"cloudImport=1")}},selectFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},selectCloudFile:function(e,t,i){var s=[],o;for(o in i){if(i.hasOwnProperty(o)){if(i[o].type=="file"&&!BX(this.prefix+o)){if(i[o].hasOwnProperty("provider")){i[o].service=i[o].provider}else{i[o].service=n}i[o].sizeFormatted=i[o]["size"];i[o].size=i[o]["sizeInt"];if(!i[o]["ext"])i[o]["ext"]=i[o]["name"].split(".").pop();if(!i[o]["storage"])i[o]["storage"]="";s.push(i[o])}}}this.agent.onAttach(s,s);BX.removeCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection)},showSelectDialog:function(){this._openSection=BX.proxy(this.openSection,this);this._selectFile=BX.proxy(this.selectFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))},showSelectDialogCloudImport:function(e){var t=e.target||e.srcElement;if(!BX.hasClass(t,"diskuf-selector-link-cloud")){t=BX.findParent(t,{className:"diskuf-selector-link-cloud"})}if(!t||!t.getAttribute("data-bx-doc-handler"))return;n=t.getAttribute("data-bx-doc-handler");this._openSection=BX.proxy(this.openSectionCloud,this);this._selectFile=BX.proxy(this.selectFile,this);this._selectCloudFile=BX.proxy(this.selectCloudFile,this);BX.addCustomEvent(BX.DiskFileDialog,"loadItems",this._openSection);BX.ajax.get(this.urlSelect,"&cloudImport=1&service="+n+"&dialogName="+this.dialogName,BX.delegate(function(){setTimeout(BX.delegate(function(){BX.DiskFileDialog.obCallback[this.dialogName]={saveButton:this._selectCloudFile};BX.DiskFileDialog.openDialog(this.dialogName)},this),10)},this))}};return t}();BX.Disk.UF.dndCatcher={};BX.Disk.UF.add=function(e){e["controller"]=BX("diskuf-selectdialog-"+e["UID"]);if(e["controller"]&&BX.isNodeInDom(e["controller"])){e["values"]=BX.findChildren(e["controller"],{className:"wd-inline-file"},true);var t=BX(e["controller"]).parentNode;BX.onCustomEvent(e["controller"],"DiskLoadFormControllerWasBound",[e,"DiskLoadFormControllerWasBound"]);if(!BX(e["controller"]).hasAttribute("bx-disk-load-is-bound")){BX(e["controller"]).setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(t,"DiskLoadFormController",function(t){BX.Disk.UF.initialize(t,e)})}if(!!e["values"]&&e["values"].length>0&&!e["hideSelectDialog"])BX.onCustomEvent(e["controller"].parentNode,"DiskLoadFormController",["show"])}};BX.Disk.UF.initialize=function(e,t){e=e==="show"||e==="hide"?e:t["controller"].style.display!="none"?"hide":"show";if(!t["controller"].loaded){t["controller"].loaded=true;a[t["UID"]]=new BX.Disk.UF(t)}if(e=="show"){if(t["controller"].style.display!="block"){BX.fx.show(t["controller"],"fade",{time:.2});if(t["switcher"]&&t["switcher"].style.display!="none")BX.fx.hide(t["switcher"],"fade",{time:.1});BX.onCustomEvent(t["controller"],"onControllerIsShown",[t["controller"],a[t["UID"]]]);o=a[t["UID"]]}}else if(t["controller"].style.display!="none"){o=null;BX.fx.hide(t["controller"],"fade",{time:.2});BX.onCustomEvent(t["controller"],"onControllerIsHidden",[t["controller"],a[t["UID"]]])}return a[t["UID"]]};var r=function(e){return BX.Disk.ajaxPromise({url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var d=function(e){if(!BX(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;BX.unbindAll(e);BX.unbindAll(this.node);BX.show(this.node);BX.remove(this.node.nextSibling);this.id="wufdp_"+Math.random()};d.prototype={turnOn:function(){this.timeout=setTimeout(BX.delegate(function(){this.show()},this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(BX["UploaderUtils"]){var t=BX.UploaderUtils.scaleImage(e,{width:parseInt(BX.message("DISK_THUMB_WIDTH")),height:parseInt(BX.message("DISK_THUMB_HEIGHT"))});e=t.destin}this.popup=new BX.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("DIV",{props:e,children:[BX.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};BX.addCustomEvent("onDiskPreviewIsReady",function(e){new d(e)});BX.Disk.UF.runImport=function(e){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});BX.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:BX.delegate(function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{BX.Disk.showActionModal({text:BX.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}},this),onProgress:BX.delegate(function(e){},this)}).start()};BX.Disk.UF.setDocumentHandlers=function(e){this.documentHandlers=e};BX.Disk.UF.getDocumentHandler=function(e){if(!this.documentHandlers){return""}var t=this.documentHandlers.find(function(t){return t.code===e});return t||{}};BX.Disk.UF.getDocumentHandlers=function(e){return this.documentHandlers};BX.Disk.UF.disableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.enableAutoCommentToAttachedObject=function(e){var t=e.attachedId;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:t},onsuccess:BX.delegate(function(e){},this)})};BX.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),BX.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};BX.Disk.UFShowController=function(e){if(!BX.type.isPlainObject(e)){e={}}this.entityType=BX.type.isNotEmptyString(e.entityType)?e.entityType:"";this.entityId=parseInt(e.entityId)>0?e.entityId:"";this.signedParameters=BX.type.isNotEmptyString(e.signedParameters)?e.signedParameters:"";this.loader=null;this.container=BX.type.isNotEmptyString(e.nodeId)?document.getElementById(e.nodeId):null;if(this.container){var t=this.container.querySelector(".disk-uf-file-switch-control");if(t){BX.Event.bind(t,"click",BX.Disk.UFShowController.onToggleView)}}if(BX.type.isNotEmptyString(e.nodeId)){l[e.nodeId]=this}};BX.Disk.UFShowController.getInstance=function(e){return BX.type.isNotEmptyString(e)&&l[e]?l[e]:null};BX.Disk.UFShowController.onToggleView=function(e){var t=e.currentTarget.closest(".diskuf-files-toggle-container"),i=e.currentTarget.getAttribute("data-bx-view-type");if(!BX.type.isDomNode(t)||!BX.type.isNotEmptyString(t.id)){return}var s=BX.Disk.UFShowController.getInstance(t.id);if(s){s.toggleViewType({viewType:i})}e.preventDefault()};BX.Disk.UFShowController.prototype.toggleViewType=function(e){this.showToggleViewLoader();BX.ajax.runComponentAction("bitrix:disk.uf.file","toggleViewType",{mode:"class",signedParameters:this.signedParameters,data:{params:{viewType:e.viewType}}}).then(function(e){this.hideToggleViewLoader();BX.clean(this.container);BX.html(this.container,e.data.html)}.bind(this),function(e){this.hideToggleViewLoader()})};BX.Disk.UFShowController.prototype.showToggleViewLoader=function(e){this.container.classList.add("diskuf-files-toggle-container-active");this.loader=new BX.Loader({target:this.container});this.loader.show()};BX.Disk.UFShowController.prototype.hideToggleViewLoader=function(e){this.container.classList.remove("diskuf-files-toggle-container-active");if(this.loader){this.loader.destroy()}};e.DiskCreateDocument=function(e,t){t.preventDefault();if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}if(!o){return}if(!e){return}var i=function(e){var t=e.object.name.split(".");t.pop();var i={};i["E"+e.object.id]={type:"file",id:"n"+e.object.id,name:e.object.name,label:t.join("."),storage:e.folderName,size:e.object.size,sizeInt:e.object.sizeInt,ext:e.object.extension,canChangeName:true,link:e.link};setTimeout(function(){o.selectFile({},{},i)},200)};if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:e}).then(function(e){console.log("local createFile",e);i(e)}.bind(this));return}var s=new BX.Disk.Document.CreateProcess({typeFile:e,serviceCode:BX.Disk.getDocumentService(),onAfterSave:function(e,t){if(e.status!=="success"){return}if(!t){BX.ajax.runAction("disk.api.file.getMetaDataForCreatedFileInUf",{data:{id:e.object.id}}).then(function(e){i(e.data)})}else{i(t)}}});s.start()};e.DiskOpenMenuCreateService=function(e){var t=[BX.Disk.UF.getDocumentHandler("onlyoffice")?{text:BX.Disk.UF.getDocumentHandler("onlyoffice").name,className:"bx-viewer-popup-item item-b24-docs",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("onlyoffice");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("onlyoffice").name})}}:null,BX.Disk.Document.Local.Instance.isEnabled()?{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("l");BX.adjust(e,{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:BX.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("gdrive");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("gdrive").name})}},{text:BX.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("office365");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("office365").name})}},{text:BX.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(t,i){i.getMenuWindow().close();BX.Disk.saveDocumentService("onedrive");BX.adjust(e,{text:BX.Disk.UF.getDocumentHandler("onedrive").name})}}];BX.PopupMenu.show("disk_open_menu_with_services",BX(e),t,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,t){var i=[];for(var s in t){if(!t.hasOwnProperty(s))continue;i.push({text:t[s].name,code:t[s].id,href:"#",onclick:function(e,t){var i=t.layout.item;BX.addClass(i,"diskuf-selector-link-cloud");i.setAttribute("data-bx-doc-handler",t.code);BX.onCustomEvent("onManualChooseCloudImport",[{target:i}]);BX.removeClass(i,"diskuf-selector-link-cloud");i.removeAttribute("data-bx-doc-handler");BX.PopupMenu.destroy("disk_open_menu_with_import_services");return BX.PreventDefault(e)}})}var o=new BX.CViewer({});o.openMenu("disk_open_menu_with_import_services",BX(e),i,{offsetTop:0,offsetLeft:25});return BX.PreventDefault()};e.DiskActionFileMenu=function(e,t,i){s++;BX.PopupMenu.show("bx-viewer-wd-popup"+s+"_"+e,BX(t),i,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,t){var i=BX(t);if(i){BX.fireEvent(i,"click")}return false}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:76:"/local/js/im/lib/localstorage/dist/localstorage.bundle.min.js?16547598172914";s:6:"source";s:57:"/local/js/im/lib/localstorage/dist/localstorage.bundle.js";s:3:"min";s:61:"/local/js/im/lib/localstorage/dist/localstorage.bundle.min.js";s:3:"map";s:61:"/local/js/im/lib/localstorage/dist/localstorage.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var t=function(){function e(){babelHelpers.classCallCheck(this,e);this.enabled=null;this.expireList=null;this.expireInterval=null}babelHelpers.createClass(e,[{key:"isEnabled",value:function e(){if(this.enabled!==null){return this.enabled}this.enabled=false;if(typeof window.localStorage!=="undefined"){try{window.localStorage.setItem("__bx_test_ls_feature__","ok");if(window.localStorage.getItem("__bx_test_ls_feature__")==="ok"){window.localStorage.removeItem("__bx_test_ls_feature__");this.enabled=true}}catch(e){}}if(this.enabled&&!this.expireInterval){try{var t=window.localStorage.getItem("bx-messenger-localstorage-expire");if(t){this.expireList=JSON.parse(t)}}catch(e){}clearInterval(this.expireInterval);this.expireInterval=setInterval(this._checkExpireInterval.bind(this),6e4)}return this.enabled}},{key:"set",value:function e(t,i,r,s){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;if(!this.isEnabled()){return false}var l=null;if(n){l=new Date((new Date).getTime()+n*1e3)}var a=JSON.stringify({value:s,expire:l});if(window.localStorage.getItem(this._getKey(t,i,r))!==a){window.localStorage.setItem(this._getKey(t,i,r),a)}if(n){if(!this.expireList){this.expireList={}}this.expireList[this._getKey(t,i,r)]=l;window.localStorage.setItem("bx-messenger-localstorage-expire",JSON.stringify(this.expireList))}return true}},{key:"get",value:function e(t,i,r,s){if(!this.isEnabled()){return typeof s!=="undefined"?s:null}var n=window.localStorage.getItem(this._getKey(t,i,r));if(n===null){return typeof s!=="undefined"?s:null}try{n=JSON.parse(n);if(n&&typeof n.value!=="undefined"){if(!n.expire||new Date(n.expire)>new Date){n=n.value}else{window.localStorage.removeItem(this._getKey(t,i,r));if(this.expireList){delete this.expireList[this._getKey(t,i,r)]}return typeof s!=="undefined"?s:null}}else{return typeof s!=="undefined"?s:null}}catch(e){return typeof s!=="undefined"?s:null}return n}},{key:"remove",value:function e(t,i,r){if(!this.isEnabled()){return false}if(this.expireList){delete this.expireList[this._getKey(t,i,r)]}return window.localStorage.removeItem(this._getKey(t,i,r))}},{key:"_getKey",value:function e(t,i,r){return"bx-messenger-"+t+"-"+i+"-"+r}},{key:"_checkExpireInterval",value:function e(){if(!this.expireList)return true;var t=new Date;var i=0;for(var r in this.expireList){if(!this.expireList.hasOwnProperty(r)){continue}if(new Date(this.expireList[r])<=t){window.localStorage.removeItem(r);delete this.expireList[r]}else{i++}}if(i){window.localStorage.setItem("bx-messenger-localstorage-expire",JSON.stringify(this.expireList))}else{this.expireList=null;window.localStorage.removeItem("bx-messenger-localstorage-expire")}return true}}]);return e}();var i=new t;e.LocalStorage=i})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:64:"/local/js/im/lib/logger/dist/logger.bundle.min.js?16547598174491";s:6:"source";s:45:"/local/js/im/lib/logger/dist/logger.bundle.js";s:3:"min";s:49:"/local/js/im/lib/logger/dist/logger.bundle.min.js";s:3:"map";s:49:"/local/js/im/lib/logger/dist/logger.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var t=new WeakMap;var a=new WeakMap;var l=new WeakMap;var r=function(){function e(){babelHelpers.classCallCheck(this,e);t.set(this,{writable:true,value:{}});a.set(this,{writable:true,value:{}});l.set(this,{writable:true,value:{}});babelHelpers.classPrivateFieldSet(this,t,{desktop:true,log:false,info:false,warn:false,error:true,trace:true});babelHelpers.classPrivateFieldSet(this,a,babelHelpers.classPrivateFieldGet(this,t));this.__load()}babelHelpers.createClass(e,[{key:"setConfig",value:function e(l){for(var r in l){if(l.hasOwnProperty(r)&&typeof babelHelpers.classPrivateFieldGet(this,t)[r]!=="undefined"){babelHelpers.classPrivateFieldGet(this,t)[r]=!!l[r];babelHelpers.classPrivateFieldGet(this,a)[r]=!!l[r]}}this.__load()}},{key:"enable",value:function e(a){if(typeof babelHelpers.classPrivateFieldGet(this,t)[a]==="undefined"){return false}babelHelpers.classPrivateFieldGet(this,t)[a]=true;babelHelpers.classPrivateFieldGet(this,l)[a]=true;this.__save();return true}},{key:"disable",value:function e(a){if(typeof babelHelpers.classPrivateFieldGet(this,t)[a]==="undefined"){return false}babelHelpers.classPrivateFieldGet(this,t)[a]=false;babelHelpers.classPrivateFieldGet(this,l)[a]=false;this.__save();return true}},{key:"isEnabled",value:function e(a){return babelHelpers.classPrivateFieldGet(this,t)[a]===true}},{key:"desktop",value:function e(){if(this.isEnabled("desktop")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).log.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("desktop")),l))}}},{key:"log",value:function e(){if(this.isEnabled("log")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).log.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("log")),l))}}},{key:"info",value:function e(){if(this.isEnabled("info")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).info.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("info")),l))}}},{key:"warn",value:function e(){if(this.isEnabled("warn")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).warn.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("warn")),l))}}},{key:"error",value:function e(){if(this.isEnabled("error")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).error.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("error")),l))}}},{key:"trace",value:function e(){if(this.isEnabled("trace")){var t;(t=console).trace.apply(t,arguments)}}},{key:"__save",value:function e(){if(typeof window.localStorage!=="undefined"){try{var t={};for(var r in babelHelpers.classPrivateFieldGet(this,l)){if(babelHelpers.classPrivateFieldGet(this,l).hasOwnProperty(r)&&babelHelpers.classPrivateFieldGet(this,a)[r]!==babelHelpers.classPrivateFieldGet(this,l)[r]){t[r]=!!babelHelpers.classPrivateFieldGet(this,l)[r]}}console.warn(JSON.stringify(t));window.localStorage.setItem("bx-messenger-logger",JSON.stringify(t))}catch(e){}}}},{key:"__load",value:function e(){if(typeof window.localStorage!=="undefined"){try{var a=window.localStorage.getItem("bx-messenger-logger");if(typeof a==="string"){babelHelpers.classPrivateFieldSet(this,l,JSON.parse(a));babelHelpers.classPrivateFieldSet(this,t,babelHelpers.objectSpread({},babelHelpers.classPrivateFieldGet(this,t),babelHelpers.classPrivateFieldGet(this,l)))}}catch(e){}}}},{key:"__getStyles",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"all";var a={desktop:["%cDESKTOP","color: white; font-style: italic; background-color: #29619b; padding: 0 6px"],log:["%cLOG","color: #2a323b; font-style: italic; background-color: #ccc; padding: 0 6px"],info:["%cINFO","color: #fff; font-style: italic; background-color: #6b7f96; padding: 0 6px"],warn:["%cWARNING","color: white; font-style: italic; padding: 0 6px; border: 1px solid #f0a74f"],error:["%cERROR","color: white; font-style: italic; padding: 0 6px; border: 1px solid #8a3232"]};if(t==="all"){return a}if(a[t]){return a[t]}return[]}},{key:"__getRemoveString",value:function e(){var t=this.__getStyles();var a=[];for(var l in t){if(t.hasOwnProperty(l)){a.push(t[l][1])}}return a}}]);return e}();var s=new r;e.Logger=s})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:61:"/local/js/im/const/dist/registry.bundle.min.js?16547598176519";s:6:"source";s:42:"/local/js/im/const/dist/registry.bundle.js";s:3:"min";s:46:"/local/js/im/const/dist/registry.bundle.min.js";s:3:"map";s:46:"/local/js/im/const/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var i=Object.freeze({groupTitle:"groupTitle",message:"message",recentTitle:"recentTitle",recentLinesTitle:"recentLinesTitle",readedTitle:"readedTitle",default:"default",vacationTitle:"vacationTitle"});var t=Object.freeze({mobile:"mobile",desktop:"desktop"});var a=Object.freeze({horizontal:"horizontal",portrait:"portrait"});var s=Object.freeze({none:"none",add:"delete",update:"update",delete:"delete",set:"set",setAfter:"after",setBefore:"before"});var r=Object.freeze({dialogues:50,messages:100});var o=Object.freeze({imMessageAdd:"im.message.add",imMessageUpdate:"im.message.update",imMessageDelete:"im.message.delete",imMessageLike:"im.message.like",imMessageCommand:"im.message.command",imMessageShare:"im.message.share",imChatGet:"im.chat.get",imChatLeave:"im.chat.leave",imChatMute:"im.chat.mute",imChatParentJoin:"im.chat.parent.join",imDialogGet:"im.dialog.get",imDialogMessagesGet:"im.dialog.messages.get",imDialogRead:"im.dialog.read",imDialogUnread:"im.dialog.unread",imDialogWriting:"im.dialog.writing",imUserGet:"im.user.get",imUserListGet:"im.user.list.get",imDiskFolderGet:"im.disk.folder.get",imDiskFileUpload:"disk.folder.uploadfile",imDiskFileCommit:"im.disk.file.commit",mobileBrowserConstGet:"mobile.browser.const.get",imRecentGet:"im.recent.get",imRecentList:"im.recent.list",imCallGetCallLimits:"im.call.getCallLimits",imNotifyGet:"im.notify.get",imNotifySchemaGet:"im.notify.schema.get"});var l=Object.freeze({imChatGet:"im.chat.get",imMessageAdd:"im.message.add",imDialogRead:"im.dialog.read",imDialogMessagesGet:"im.dialog.messages.get",imDialogMessagesGetInit:"im.dialog.messages.get.init",imDialogMessagesGetUnread:"im.dialog.messages.get.unread",imDiskFolderGet:"im.disk.folder.get",imDiskFileUpload:"disk.folder.uploadfile",imDiskFileCommit:"im.disk.file.commit",imUserGet:"im.user.get",imUserListGet:"im.user.list.get",mobileBrowserConstGet:"mobile.browser.const.get",imRecentGet:"im.recent.get",imRecentList:"im.recent.list",imCallGetCallLimits:"im.call.getCallLimits",imNotifyGet:"im.notify.get",imNotifySchemaGet:"im.notify.schema.get"});var n=Object.freeze({dialog:{newMessage:"EventType.dialog.newMessage",scrollOnStart:"IM.Dialog:scrollOnStart",scrollToBottom:"IM.Dialog:scrollToBottom",readVisibleMessages:"IM.Dialog.readVisibleMessages",requestUnread:"IM.Dialog.requestUnread",readMessage:"IM.Dialog:readMessage",quoteMessage:"IM.Dialog:quoteMessage",clickOnCommand:"IM.Dialog:clickOnCommand",clickOnMention:"IM.Dialog:clickOnMention",clickOnUserName:"IM.Dialog:clickOnUserName",clickOnMessageMenu:"IM.Dialog:clickOnMessageMenu",clickOnMessageRetry:"IM.Dialog:clickOnMessageRetry",clickOnUploadCancel:"IM.Dialog:clickOnUploadCancel",clickOnReadList:"IM.Dialog:clickOnReadList",setMessageReaction:"IM.Dialog:setMessageReaction",openMessageReactionList:"IM.Dialog:openMessageReactionList",clickOnKeyboardButton:"IM.Dialog:clickOnKeyboardButton",clickOnChatTeaser:"IM.Dialog:clickOnChatTeaser",clickOnDialog:"IM.Dialog:clickOnDialog",quotePanelClose:"IM.Dialog:quotePanelClose",beforeMobileKeyboard:"IM.Dialog:beforeMobileKeyboard",messagesSet:"IM.Dialog:messagesSet"},textarea:{focus:"IM.Textarea:focus",setFocus:"IM.Textarea:setFocus",blur:"IM.Textarea:blur",setBlur:"IM.Textarea:setBlur",keyUp:"IM.Textarea:keyUp",edit:"IM.Textarea:edit",insertText:"IM.Textarea:insertText",sendMessage:"IM.Textarea:sendMessage",fileSelected:"IM.Textarea:fileSelected",startWriting:"IM.Textarea:startWriting",appButtonClick:"IM.Textarea:appButtonClick"},conference:{setPasswordFocus:"IM.Conference:setPasswordFocus",hideSmiles:"IM.Conference:hideSmiles",requestPermissions:"IM.Conference:requestPermissions",waitForStart:"IM.Conference:waitForStart",userRenameFocus:"IM.Conference:userRenameFocus",userRenameBlur:"IM.Conference:userRenameBlur"},notification:{updateState:"IM.Notifications:restoreConnection"}});var c=Object.freeze({private:"private",chat:"chat",open:"open",call:"call",crm:"crm"});var m=Object.freeze({lead:"lead",company:"company",contact:"contact",deal:"deal",none:"none"});var d=Object.freeze({listBody:"bx-im-dialog-list",listItem:"bx-im-dialog-list-item-reference",listItemName:"bx-im-dialog-list-item-name-reference",listItemBody:"bx-im-dialog-list-item-content-reference",listUnreadLoader:"bx-im-dialog-list-unread-loader-reference"});var g=Object.freeze({message:"message",delimiter:"delimiter",group:"group",historyLoader:"historyLoader",unreadLoader:"unreadLoader",button:"button",placeholder:"placeholder"});var M=Object.freeze({loading:"loading",empty:"empty",show:"show"});var f=Object.freeze({upload:"upload",wait:"wait",done:"done",error:"error"});var u=Object.freeze({image:"image",video:"video",audio:"audio",file:"file"});var p=Object.freeze({self:"self",opponent:"opponent",system:"system"});var C=Object.freeze({view:"view",edit:"edit",create:"create"});var h=Object.freeze({preparation:"preparation",call:"call"});var b=Object.freeze({userLimitReached:"userLimitReached",detectIntranetUser:"detectIntranetUser",bitrix24only:"bitrix24only",kickedFromCall:"kickedFromCall",unsupportedBrowser:"unsupportedBrowser",missingMicrophone:"missingMicrophone",unsafeConnection:"unsafeConnection",wrongAlias:"wrongAlias",notStarted:"notStarted",finished:"finished",userLeftCall:"userLeftCall",noSignalFromCamera:"noSignalFromCamera"});var D=Object.freeze({hidden:"hidden",chat:"chat",users:"users",split:"split"});var I=Object.freeze({Idle:"Idle",Busy:"Busy",Calling:"Calling",Unavailable:"Unavailable",Declined:"Declined",Ready:"Ready",Connecting:"Connecting",Connected:"Connected",Failed:"Failed"});var v={chat:"chat",open:"open",user:"user",notification:"notification"};var y={item:"item",placeholder:"placeholder"};var O={general:"general",pinned:"pinned"};var k={received:"received",delivered:"delivered",error:"error"};var T=Object.freeze({confirm:1,simple:3,placeholder:5});e.DateFormat=i;e.DeviceType=t;e.DeviceOrientation=a;e.MutationType=s;e.StorageLimit=r;e.RestMethod=o;e.RestMethodHandler=l;e.EventType=n;e.DialogType=c;e.DialogCrmType=m;e.DialogReferenceClassName=d;e.DialogTemplateType=g;e.DialogState=M;e.FileStatus=f;e.FileType=u;e.MessageType=p;e.ConferenceFieldState=C;e.ConferenceStateType=h;e.ConferenceErrorCode=b;e.ConferenceRightPanelMode=D;e.ConferenceUserState=I;e.ChatTypes=v;e.TemplateTypes=y;e.RecentSection=O;e.MessageStatus=k;e.NotificationTypesCodes=T})(this.BX.Messenger.Const=this.BX.Messenger.Const||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:63:"/local/js/im/lib/utils/dist/utils.bundle.min.js?165475981718118";s:6:"source";s:43:"/local/js/im/lib/utils/dist/utils.bundle.js";s:3:"min";s:47:"/local/js/im/lib/utils/dist/utils.bundle.min.js";s:3:"map";s:47:"/local/js/im/lib/utils/dist/utils.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t){"use strict";var i={browser:{isSafari:function e(){if(this.isChrome()){return false}if(!navigator.userAgent.toLowerCase().includes("safari")){return false}return!this.isSafariBased()},isSafariBased:function e(){if(!navigator.userAgent.toLowerCase().includes("applewebkit")){return false}return navigator.userAgent.toLowerCase().includes("yabrowser")||navigator.userAgent.toLowerCase().includes("yaapp_ios_browser")||navigator.userAgent.toLowerCase().includes("crios")},isChrome:function e(){return navigator.userAgent.toLowerCase().includes("chrome")},isFirefox:function e(){return navigator.userAgent.toLowerCase().includes("firefox")},isIe:function e(){return navigator.userAgent.match(/(Trident\/|MSIE\/)/)!==null},findParent:function e(t,i){var n=i instanceof HTMLElement;if(!i||typeof i!=="string"&&!n){return null}for(;t&&t!==document;t=t.parentNode){if(typeof i==="string"){if(t.classList.contains(i)){return t}}else if(n){if(t===i){return t}}}return null}},platform:{isMac:function e(){return navigator.userAgent.toLowerCase().includes("macintosh")},isLinux:function e(){return navigator.userAgent.toLowerCase().includes("linux")},isWindows:function e(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isBitrixMobile:function e(){return navigator.userAgent.toLowerCase().includes("bitrixmobile")},isBitrixDesktop:function e(){return navigator.userAgent.toLowerCase().includes("bitrixdesktop")},getDesktopVersion:function e(){if(typeof this.getDesktopVersionStatic!=="undefined"){return this.getDesktopVersionStatic}if(typeof BXDesktopSystem==="undefined"){return 0}var t=BXDesktopSystem.GetProperty("versionParts");this.getDesktopVersionStatic=t[3];return this.getDesktopVersionStatic},isMobile:function e(){return this.isAndroid()||this.isIos()||this.isBitrixMobile()},isIos:function e(){return navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")},getIosVersion:function e(){if(!this.isIos()){return null}var t=navigator.userAgent.toLowerCase().match(/(iphone|ipad)(.+)(OS\s([0-9]+)([_.]([0-9]+))?)/i);if(!t||!t[4]){return null}return parseFloat(t[4]+"."+(t[6]?t[6]:0))},isAndroid:function e(){return navigator.userAgent.toLowerCase().includes("android")},openNewPage:function e(t){if(!t){return false}if(this.isBitrixMobile()){if(typeof BX.MobileTools!=="undefined"){var i=BX.MobileTools.resolveOpenFunction(t);if(i){i();return true}}app.openNewPage(t)}else{window.open(t,"_blank")}return true}},device:{isDesktop:function e(){return!this.isMobile()},isMobile:function e(){if(typeof this.isMobileStatic!=="undefined"){return this.isMobileStatic}this.isMobileStatic=navigator.userAgent.toLowerCase().includes("android")||navigator.userAgent.toLowerCase().includes("webos")||navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")||navigator.userAgent.toLowerCase().includes("ipod")||navigator.userAgent.toLowerCase().includes("blackberry")||navigator.userAgent.toLowerCase().includes("windows phone");return this.isMobileStatic},orientationHorizontal:"horizontal",orientationPortrait:"portrait",getOrientation:function e(){if(!this.isMobile()){return this.orientationHorizontal}return Math.abs(window.orientation)===0?this.orientationPortrait:this.orientationHorizontal}},types:{isString:function e(t){return t===""?true:t?typeof t=="string"||t instanceof String:false},isArray:function e(t){return t&&Object.prototype.toString.call(t)=="[object Array]"},isFunction:function e(t){return t===null?false:typeof t=="function"||t instanceof Function},isDomNode:function e(t){return t&&babelHelpers.typeof(t)=="object"&&"nodeType"in t},isDate:function e(t){return t&&Object.prototype.toString.call(t)=="[object Date]"},isPlainObject:function e(t){if(!t||babelHelpers.typeof(t)!=="object"||t.nodeType){return false}var i=Object.prototype.hasOwnProperty;try{if(t.constructor&&!i.call(t,"constructor")&&!i.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var n;return typeof n==="undefined"||i.call(t,n)}},dialog:{getChatIdByDialogId:function e(t){if(!this.isChatId(t)){return 0}return parseInt(t.toString().substr(4))},isChatId:function e(t){return t.toString().startsWith("chat")},isEmptyDialogId:function e(t){if(!t){return true}if(typeof t==="string"){if(t==="chat0"||t==="0"){return true}}return false}},text:{quote:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,function(e,t,i){return i});t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})](.*?)[\/CHAT]/gi,function(e,t,i,n){return n});t=t.replace(/\[CALL(?:=(.+?))?](.+?)?\[\/CALL]/gi,function(e,t,i){return i?i:t});t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "});t=t.replace(/\[RATING=([1-5]{1})]/gi,function(e,t){return"["+r.IM_F_RATING+"] "});t=t.replace(/&nbsp;/gi," ");t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"]");t=t.replace(/^(>>(.*)\n)/gi,"["+r["IM_UTILS_TEXT_QUOTE"]+"]\n");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var a=[];i.FILE_ID.forEach(function(e){if(n[e].type==="image"){a.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){a.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){a.push(r["IM_UTILS_TEXT_VIDEO"])}else{a.push(n[e].name)}});if(a.length<=0){a.push(r["IM_UTILS_TEXT_FILE"])}t=a.join("\n")+t}else if(i&&i.ATTACH&&i.ATTACH.length>0){t="["+r["IM_UTILS_TEXT_ATTACH"]+"]\n"+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.trim()},purify:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.trim();if(t.startsWith("/me")){t=t.substr(4)}else if(t.startsWith("/loud")){t=t.substr(6)}t=t.replace(/<br><br \/>/gi,"<br />");t=t.replace(/<br \/><br>/gi,"<br />");var a=[];t=t.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,function(e,t){var i=a.length;a.push(t);return"####REPLACEMENT_CODE_"+i+"####"});t=t.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,function(e,t,i){return i?i:t})});t=t.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,function(e,t,i){return i?i:t})});t=t.replace(/\[[buis]](.*?)\[\/[buis]]/gi,"$1");t=t.replace(/\[url](.*?)\[\/url]/gi,"$1");t=t.replace(/\[RATING=([1-5]{1})]/gi,function(){return"["+r["IM_UTILS_TEXT_RATING"]+"] "});t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,function(){return"["+r["IM_UTILS_TEXT_ATTACH"]+"] "});t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,"$2");t=t.replace(/\[CHAT=([0-9]{1,})](.*?)\[\/CHAT]/gi,"$2");t=t.replace(/\[SEND(?:=(?:.+?))?\](.+?)?\[\/SEND]/gi,"$1");t=t.replace(/\[PUT(?:=(?:.+?))?\](.+?)?\[\/PUT]/gi,"$1");t=t.replace(/\[CALL=([0-9]{1,})](.*?)\[\/CALL]/gi,"$2");t=t.replace(/\[PCH=([0-9]{1,})](.*?)\[\/PCH]/gi,"$2");t=t.replace(/<img.*?data-code="([^"]*)".*?>/gi,"$1");t=t.replace(/<span.*?title="([^"]*)".*?>.*?<\/span>/gi,"($1)");t=t.replace(/<img.*?title="([^"]*)".*?>/gi,"($1)");t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "});t=t.replace(/<s>([^"]*)<\/s>/gi," ");t=t.replace(/\[s]([^"]*)\[\/s]/gi," ");t=t.replace(/\[icon=([^\]]*)]/gi,function(e){var t=e.match(/title=(.*[^\s\]])/i);if(t&&t[1]){t=t[1];if(t.indexOf("width=")>-1){t=t.substr(0,t.indexOf("width="))}if(t.indexOf("height=")>-1){t=t.substr(0,t.indexOf("height="))}if(t.indexOf("size=")>-1){t=t.substr(0,t.indexOf("size="))}if(t){t="("+t.trim()+")"}}else{t="("+r["IM_UTILS_TEXT_ICON"]+")"}return t});a.forEach(function(e,i){t=t.replace("####REPLACEMENT_CODE_"+i+"####",e)});t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/^(>>(.*)(\n)?)/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/<\/?[^>]+>/gi,"");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var s=[];if(babelHelpers.typeof(n)==="object"){i.FILE_ID.forEach(function(e){if(typeof n[e]==="undefined");else if(n[e].type==="image"){s.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){s.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){s.push(r["IM_UTILS_TEXT_VIDEO"])}else{s.push(n[e].name)}})}if(s.length<=0){s.push(r["IM_UTILS_TEXT_FILE"])}t=s.join(" ")+t}else if(i&&(i.WITH_ATTACH||i.ATTACH&&i.ATTACH.length>0)){t="["+r["IM_UTILS_TEXT_ATTACH"]+"] "+t}else if(i&&i.WITH_FILE){t="["+r["IM_UTILS_TEXT_FILE"]+"] "+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.replace("\n"," ").trim()},htmlspecialchars:function e(t){if(typeof t!=="string"){return t}return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlspecialcharsback:function e(t){if(typeof t!=="string"){return t}return t.replace(/\&quot;/g,'"').replace(/&#039;/g,"'").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&").replace(/\&nbsp;/g," ")},getLocalizeForNumber:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"en";var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!r){r=BX.message}var a=1;i=parseInt(i);if(i<0){i=i*-1}if(n){switch(n){case"de":case"en":a=i!==1?1:0;break;case"ru":case"ua":a=i%10===1&&i%100!==11?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;break}}return r[t+"_PLURAL_"+a]}},date:{getFormatType:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:t.DateFormat.default;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){n=BX.message}var r=[];if(i===t.DateFormat.groupTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE"]]]}else if(i===t.DateFormat.message){r=[["",n["IM_UTILS_FORMAT_TIME"]]]}else if(i===t.DateFormat.recentTitle){r=[["tommorow","today"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(i===t.DateFormat.recentLinesTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(i===t.DateFormat.readedTitle){r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_READED"]]]}else if(i===t.DateFormat.vacationTitle){r=[["",n["IM_UTILS_FORMAT_DATE_SHORT"]]]}else{r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_DATE_TIME"]]]}return r},getDateFunction:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(BX.Main.Date);if(t){this.dateFormatFunction._getMessage=function(e){return t[e]}}return this.dateFormatFunction},format:function e(i){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!e){e=this.getFormatType(t.DateFormat.default,n)}return this.getDateFunction(n).format(e,i)},cast:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Date;var n=i;if(t instanceof Date){n=t}else if(typeof t==="string"){n=new Date(t)}else if(typeof t==="number"){n=new Date(t*1e3)}if(n instanceof Date&&Number.isNaN(n.getTime())){n=i}return n}},object:{countKeys:function e(t){var i=0;for(var n in t){if(t.hasOwnProperty(n)){i++}}return i}},user:{getLastDateText:function e(n){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){return""}var a=i.date.getDateFunction(r);if(!r){r=BX.message||{}}var s="";var o={};if(n.bot||n.network){s=""}else if(n.absent&&!this.isMobileActive(n,r)){o=this.getOnlineStatus(n,r);s=r["IM_STATUS_VACATION_TITLE"].replace("#DATE#",a.format(i.date.getFormatType(t.DateFormat.vacationTitle,r),n.absent.getTime()/1e3));if(o.isOnline&&n.idle){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(n,r))+". "+s}else if(o.isOnline&&!o.lastSeenText){s=o.statusText+". "+s}else if(o.lastSeenText){if(!i.platform.isMobile()){s=s+". "+r["IM_LAST_SEEN_"+(n.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}else if(n.lastActivityDate){o=this.getOnlineStatus(n,r);if(o.isOnline&&n.idle&&!this.isMobileActive(n,r)){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(n,r))}else if(o.isOnline&&!o.lastSeenText){if(i.platform.isMobile()&&this.isMobileActive(n,r)){s=r["IM_STATUS_MOBILE"]}else{s=o.statusText}}else if(o.lastSeenText){if(i.platform.isMobile()){s=r["IM_LAST_SEEN_SHORT_"+(n.gender==="F"?"F":"M")].replace("#LAST_SEEN#",o.lastSeenText)}else{s=r["IM_LAST_SEEN_"+(n.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}return s},getIdleText:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return""}if(!t.idle){return""}return i.date.getDateFunction(n).format([["s60","sdiff"],["i60","idiff"],["H24","Hdiff"],["","ddiff"]],t.idle)},getOnlineStatus:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r={isOnline:false,status:"offline",statusText:n?n.IM_STATUS_OFFLINE:"offline",lastSeen:t.lastActivityDate,lastSeenText:""};if(!t.lastActivityDate||t.lastActivityDate.getTime()===0){return r}var a=new Date;r.isOnline=a.getTime()-t.lastActivityDate.getTime()<=this.getOnlineLimit(n)*1e3;r.status=r.isOnline?t.status:"offline";r.statusText=n&&n["IM_STATUS_"+r.status.toUpperCase()]?n["IM_STATUS_"+r.status.toUpperCase()]:r.status;if(n&&t.lastActivityDate.getTime()>0&&a.getTime()-t.lastActivityDate.getTime()>300*1e3){r.lastSeenText=i.date.getDateFunction(n).formatLastActivityDate(t.lastActivityDate)}return r},isMobileActive:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return false}if(!i){i=BX.message||{}}return t.mobileLastDate&&new Date-t.mobileLastDate<this.getOnlineLimit(i)*1e3&&t.lastActivityDate-t.mobileLastDate<300*1e3},getOnlineLimit:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!t){t=BX.message||{}}return t.LIMIT_ONLINE?parseInt(t.LIMIT_ONLINE):15*60}},isDarkColor:function e(t){if(!t||!t.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){return false}if(t.length===4){t=t.replace(/#([A-Fa-f0-9])/gi,"$1$1")}else{t=t.replace(/#([A-Fa-f0-9])/gi,"$1")}t=t.toLowerCase();var i=["#17a3ea","#00aeef","#00c4fb","#47d1e2","#75d900","#ffab00","#ff5752","#468ee5","#1eae43"];if(i.includes("#"+t)){return true}var n=parseInt(t,16);var r=n>>16&255;var a=n>>8&255;var s=n&255;var o=(r*299+a*587+s*114)/1e3;return o<128},hashCode:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=0;if(babelHelpers.typeof(t)==="object"&&t){t=JSON.stringify(t)}else if(typeof t!=="string"){t=t.toString()}if(typeof t!=="string"){return i}for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);i=(i<<5)-i+r;i=i&i}return i},versionCompare:function e(t,i){var n=/^([\d+\.]+)$/;if(!n.test(t)||!n.test(i)){return NaN}t=t.toString().split(".");i=i.toString().split(".");if(t.length<i.length){while(t.length<i.length){t.push(0)}}else if(i.length<t.length){while(i.length<t.length){i.push(0)}}for(var r=0;r<t.length;r++){if(t[r]>i[r]){return 1}else if(t[r]<i[r]){return-1}}return 0},throttle:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a);r=null};return function(){if(!r){a=arguments;r=setTimeout(s,i)}}},debounce:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a)};return function(){a=arguments;clearTimeout(r);r=setTimeout(s,i)}},getLogTrackingParams:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=[];var n=t.name,r=n===void 0?"tracking":n,a=t.data,s=a===void 0?[]:a,o=t.dialog,l=o===void 0?null:o,u=t.message,f=u===void 0?null:u,D=t.files,c=D===void 0?null:D;r=encodeURIComponent(r);if(s&&!(s instanceof Array)&&babelHelpers.typeof(s)==="object"){var x=[];for(var T in s){if(s.hasOwnProperty(T)){x.push(encodeURIComponent(T)+"="+encodeURIComponent(s[T]))}}s=x}else if(!s instanceof Array){s=[]}if(l){i.push("timType="+l.type);if(l.type==="lines"){i.push("timLinesType="+l.entityId.split("|")[0])}}if(c){var g="file";if(c instanceof Array&&c[0]){g=c[0].type}else{g=c.type}i.push("timMessageType="+g)}else if(f){i.push("timMessageType=text")}if(this.platform.isBitrixMobile()){i.push("timDevice=bitrixMobile")}else if(this.platform.isBitrixDesktop()){i.push("timDevice=bitrixDesktop")}else if(this.platform.isIos()||this.platform.isAndroid()){i.push("timDevice=mobile")}else{i.push("timDevice=web")}return r+(s.length?"&"+s.join("&"):"")+(i.length?"&"+i.join("&"):"")}};e.Utils=i})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{},BX.Messenger.Const);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:62:"/local/js/im/model/dist/registry.bundle.min.js?165475981797207";s:6:"source";s:42:"/local/js/im/model/dist/registry.bundle.js";s:3:"min";s:46:"/local/js/im/model/dist/registry.bundle.min.js";s:3:"map";s:46:"/local/js/im/model/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t,i,n,a,r,o,s){"use strict";var l=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"application"}},{key:"getState",value:function e(){return{common:{host:this.getVariable("common.host",location.protocol+"//"+location.host),siteId:this.getVariable("common.siteId","default"),userId:this.getVariable("common.userId",0),languageId:this.getVariable("common.languageId","en")},dialog:{dialogId:this.getVariable("dialog.dialogId","0"),chatId:this.getVariable("dialog.chatId",0),diskFolderId:this.getVariable("dialog.diskFolderId",0),messageLimit:this.getVariable("dialog.messageLimit",20),enableReadMessages:this.getVariable("dialog.enableReadMessages",true),messageExtraCount:0},disk:{enabled:false,maxFileSize:5242880},call:{serverEnabled:false,maxParticipants:24},mobile:{keyboardShow:false},device:{type:this.getVariable("device.type",s.DeviceType.desktop),orientation:this.getVariable("device.orientation",s.DeviceOrientation.portrait)},options:{quoteEnable:this.getVariable("options.quoteEnable",true),quoteFromRight:this.getVariable("options.quoteFromRight",true),autoplayVideo:this.getVariable("options.autoplayVideo",true),darkBackground:this.getVariable("options.darkBackground",false),showSmiles:false},error:{active:false,code:"",description:""}}}},{key:"getStateSaveException",value:function e(){return Object.assign({common:this.getVariable("saveException.common",null),dialog:this.getVariable("saveException.dialog",null),mobile:this.getVariable("saveException.mobile",null),device:this.getVariable("saveException.device",null),error:this.getVariable("saveException.error",null)})}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){i.commit("set",t.validate(n))},showSmiles:function e(t,i){t.commit("showSmiles")},hideSmiles:function e(t,i){t.commit("hideSmiles")}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){var a=false;for(var r in n){if(!n.hasOwnProperty(r)){continue}for(var o in n[r]){if(!n[r].hasOwnProperty(o)){continue}i[r][o]=n[r][o];a=true}}if(a&&t.isSaveNeeded(n)){t.saveState(i)}},increaseDialogExtraCount:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.count,a=n===void 0?1:n;t.dialog.messageExtraCount+=a},decreaseDialogExtraCount:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.count,a=n===void 0?1:n;var r=t.dialog.messageExtraCount-a;if(r<=0){r=0}t.dialog.messageExtraCount=r},clearDialogExtraCount:function e(t){t.dialog.messageExtraCount=0},showSmiles:function e(t){t.options.showSmiles=true},hideSmiles:function e(t){t.options.showSmiles=false}}}},{key:"validate",value:function e(t){var i={};if(babelHelpers.typeof(t.common)==="object"&&t.common){i.common={};if(typeof t.common.userId==="number"){i.common.userId=t.common.userId}if(typeof t.common.languageId==="string"){i.common.languageId=t.common.languageId}}if(babelHelpers.typeof(t.dialog)==="object"&&t.dialog){i.dialog={};if(typeof t.dialog.dialogId==="number"){i.dialog.dialogId=t.dialog.dialogId.toString();i.dialog.chatId=0}else if(typeof t.dialog.dialogId==="string"){i.dialog.dialogId=t.dialog.dialogId;if(typeof t.dialog.chatId!=="number"){var n=t.dialog.dialogId;if(n.startsWith("chat")){n=t.dialog.dialogId.substr(4)}n=parseInt(n);i.dialog.chatId=!isNaN(n)?n:0;t.dialog.chatId=i.dialog.chatId}}if(typeof t.dialog.chatId==="number"){i.dialog.chatId=t.dialog.chatId}if(typeof t.dialog.diskFolderId==="number"){i.dialog.diskFolderId=t.dialog.diskFolderId}if(typeof t.dialog.messageLimit==="number"){i.dialog.messageLimit=t.dialog.messageLimit}if(typeof t.dialog.messageExtraCount==="number"){i.dialog.messageExtraCount=t.dialog.messageExtraCount}if(typeof t.dialog.enableReadMessages==="boolean"){i.dialog.enableReadMessages=t.dialog.enableReadMessages}}if(babelHelpers.typeof(t.disk)==="object"&&t.disk){i.disk={};if(typeof t.disk.enabled==="boolean"){i.disk.enabled=t.disk.enabled}if(typeof t.disk.maxFileSize==="number"){i.disk.maxFileSize=t.disk.maxFileSize}}if(babelHelpers.typeof(t.call)==="object"&&t.call){i.call={};if(typeof t.call.serverEnabled==="boolean"){i.call.serverEnabled=t.call.serverEnabled}if(typeof t.call.maxParticipants==="number"){i.call.maxParticipants=t.call.maxParticipants}}if(babelHelpers.typeof(t.mobile)==="object"&&t.mobile){i.mobile={};if(typeof t.mobile.keyboardShow==="boolean"){i.mobile.keyboardShow=t.mobile.keyboardShow}}if(babelHelpers.typeof(t.device)==="object"&&t.device){i.device={};if(typeof t.device.type==="string"&&typeof s.DeviceType[t.device.type]!=="undefined"){i.device.type=t.device.type}if(typeof t.device.orientation==="string"&&typeof s.DeviceOrientation[t.device.orientation]!=="undefined"){i.device.orientation=t.device.orientation}}if(babelHelpers.typeof(t.error)==="object"&&t.error){if(typeof t.error.active==="boolean"){i.error={active:t.error.active,code:t.error.code.toString()||"",description:t.error.description.toString()||""}}}return i}}]);return t}(r.VuexBuilderModel);var c=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"conference"}},{key:"getState",value:function e(){return{common:{inited:false,passChecked:true,showChat:false,userCount:0,messageCount:0,userInCallCount:0,state:s.ConferenceStateType.preparation,callEnded:false,showSmiles:false,error:"",conferenceTitle:"",alias:"",permissionsRequested:false,conferenceStarted:null,conferenceStartDate:null,joinWithVideo:null,userReadyToJoin:false,isBroadcast:false,users:[],usersInCall:[],presenters:[],rightPanelMode:s.ConferenceRightPanelMode.hidden},user:{id:-1,hash:""}}}},{key:"getActions",value:function e(){return{showChat:function e(t,i){if(typeof i.newState!=="boolean"){return false}t.commit("showChat",i)},changeRightPanelMode:function e(t,i){if(!s.ConferenceRightPanelMode[i.mode]){return false}t.commit("changeRightPanelMode",i)},setPermissionsRequested:function e(t,i){if(typeof i.status!=="boolean"){return false}t.commit("setPermissionsRequested",i)},setPresenters:function e(t,i){if(!Array.isArray(i.presenters)){i.presenters=[i.presenters]}t.commit("setPresenters",i)},setUsers:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("setUsers",i)},removeUsers:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("removeUsers",i)},setUsersInCall:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("setUsersInCall",i)},removeUsersInCall:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("removeUsersInCall",i)},setConferenceTitle:function e(t,i){if(typeof i.conferenceTitle!=="string"){return false}t.commit("setConferenceTitle",i)},setBroadcastMode:function e(t,i){if(typeof i.broadcastMode!=="boolean"){return false}t.commit("setBroadcastMode",i)}}}},{key:"getMutations",value:function e(){var t=this;return{common:function e(t,i){if(typeof i.inited==="boolean"){t.common.inited=i.inited}if(typeof i.passChecked==="boolean"){t.common.passChecked=i.passChecked}if(typeof i.userCount==="number"||typeof i.userCount==="string"){t.common.userCount=parseInt(i.userCount)}if(typeof i.messageCount==="number"||typeof i.messageCount==="string"){t.common.messageCount=parseInt(i.messageCount)}if(typeof i.userInCallCount==="number"||typeof i.userInCallCount==="string"){t.common.userInCallCount=parseInt(i.userInCallCount)}if(typeof i.componentError==="string"){t.common.componentError=i.componentError}if(typeof i.isBroadcast==="boolean"){t.common.isBroadcast=i.isBroadcast}if(Array.isArray(i.presenters)){t.common.presenters=i.presenters}},user:function e(i,n){if(typeof n.id==="number"){i.user.id=n.id}if(typeof n.hash==="string"&&n.hash!==i.user.hash){i.user.hash=n.hash}if(t.isSaveNeeded({user:n})){t.saveState(i)}},showChat:function e(t,i){var n=i.newState;t.common.showChat=n},changeRightPanelMode:function e(t,i){var n=i.mode;t.common.rightPanelMode=n},setPermissionsRequested:function e(t,i){t.common.permissionsRequested=i.status},startCall:function e(t,i){t.common.state=s.ConferenceStateType.call;t.common.callEnded=false},endCall:function e(t,i){t.common.state=s.ConferenceStateType.preparation;t.common.callEnded=true},returnToPreparation:function e(t,i){t.common.state=s.ConferenceStateType.preparation},toggleSmiles:function e(t,i){t.common.showSmiles=!t.common.showSmiles},setError:function e(t,i){if(typeof i.errorCode==="string"){t.common.error=i.errorCode}},setConferenceTitle:function e(t,i){t.common.conferenceTitle=i.conferenceTitle},setBroadcastMode:function e(t,i){t.common.isBroadcast=i.broadcastMode},setAlias:function e(t,i){if(typeof i.alias==="string"){t.common.alias=i.alias}},setJoinType:function e(t,i){if(typeof i.joinWithVideo==="boolean"){t.common.joinWithVideo=i.joinWithVideo}},setConferenceStatus:function e(t,i){if(typeof i.conferenceStarted==="boolean"){t.common.conferenceStarted=i.conferenceStarted}},setConferenceStartDate:function e(t,i){if(i.conferenceStartDate instanceof Date){t.common.conferenceStartDate=i.conferenceStartDate}},setUserReadyToJoin:function e(t,i){t.common.userReadyToJoin=true},setPresenters:function e(t,i){if(i.replace){t.common.presenters=i.presenters}else{i.presenters.forEach(function(e){e=parseInt(e);if(!t.common.presenters.includes(e)){t.common.presenters.push(e)}})}},setUsers:function e(t,i){i.users.forEach(function(e){e=parseInt(e);if(!t.common.users.includes(e)){t.common.users.push(e)}})},removeUsers:function e(t,i){t.common.users=t.common.users.filter(function(e){return!i.users.includes(parseInt(e))})},setUsersInCall:function e(t,i){i.users.forEach(function(e){e=parseInt(e);if(!t.common.usersInCall.includes(e)){t.common.usersInCall.push(e)}})},removeUsersInCall:function e(t,i){t.common.usersInCall=t.common.usersInCall.filter(function(e){return!i.users.includes(parseInt(e))})}}}},{key:"getStateSaveException",value:function e(){return{common:{inited:null,state:null,showSmiles:null,userCount:null,messageCount:null,userInCallCount:null,error:null,conferenceTitle:null,alias:null,conferenceStarted:null,conferenceStartDate:null,joinWithVideo:null,userReadyToJoin:null,rightPanelMode:null,presenters:null,users:null}}}}]);return t}(r.VuexBuilderModel);function u(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=d(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function d(e,t){if(!e)return;if(typeof e==="string")return f(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return f(e,t)}function f(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var p={empty:"empty",equal:"equal",none:"none",found:"found",foundReverse:"foundReverse"};var h=function(e){babelHelpers.inherits(r,e);function r(){babelHelpers.classCallCheck(this,r);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).apply(this,arguments))}babelHelpers.createClass(r,[{key:"getName",value:function e(){return"messages"}},{key:"getState",value:function e(){return{created:0,collection:{},mutationType:{},saveMessageList:{},saveFileList:{},saveUserList:{},host:this.getVariable("host",location.protocol+"//"+location.host)}}},{key:"getElementState",value:function e(){return{templateId:0,templateType:"message",placeholderType:0,id:0,chatId:0,authorId:0,date:new Date,text:"",textConverted:"",params:{TYPE:"default",COMPONENT_ID:"bx-im-view-message"},push:false,unread:false,sending:false,error:false,retry:false,blink:false}}},{key:"getGetters",value:function e(){var t=this;return{getMutationType:function e(t){return function(e){if(!t.mutationType[e]){return{initialType:s.MutationType.none,appliedType:s.MutationType.none}}return t.mutationType[e]}},getLastId:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return null}var i=0;for(var n=0;n<t.collection[e].length;n++){var a=t.collection[e][n];if(a.push||a.sending||a.id.toString().startsWith("temporary")){continue}if(i<a.id){i=a.id}}return i?i:null}},getMessage:function e(t){return function(e,i){if(!t.collection[e]||t.collection[e].length<=0){return null}for(var n=t.collection[e].length-1;n>=0;n--){if(t.collection[e][n].id===i){return t.collection[e][n]}}return null}},get:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return[]}return t.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState()}},getSaveFileList:function e(t){return function(e){return t.saveFileList}},getSaveUserList:function e(t){return function(e){return t.saveUserList}}}}},{key:"getActions",value:function e(){var t=this;return{add:function e(i,n){var a=t.validate(Object.assign({},n));a.params=Object.assign({},t.getElementState().params,a.params);a.id="temporary"+(new Date).getTime()+i.state.created;a.templateId=a.id;a.unread=false;i.commit("add",Object.assign({},t.getElementState(),a));if(n.sending!==false){i.dispatch("actionStart",{id:a.id,chatId:a.chatId})}return a.id},actionStart:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}i.chatId=parseInt(i.chatId);a.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:true}})})},actionError:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}i.chatId=parseInt(i.chatId);a.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:false,error:true,retry:i.retry!==false}})})},actionFinish:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}i.chatId=parseInt(i.chatId);a.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:false,error:false,retry:false}})})},set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return t.prepareMessage(e,{host:i.state.host})})}else{var a=t.prepareMessage(n,{host:i.state.host});(n=[]).push(a)}i.commit("set",{insertType:s.MutationType.set,data:n});return"set is done"},addPlaceholders:function e(i,n){if(n.placeholders instanceof Array){n.placeholders=n.placeholders.map(function(e){return t.prepareMessage(e,{host:i.state.host})})}else{return false}var a=n.requestMode==="history"?s.MutationType.setBefore:s.MutationType.setAfter;if(a===s.MutationType.setBefore){n.placeholders=n.placeholders.reverse()}i.commit("set",{insertType:a,data:n.placeholders});return n.placeholders[0].id},clearPlaceholders:function e(t,i){t.commit("clearPlaceholders",i)},updatePlaceholders:function e(i,n){if(n.data instanceof Array){n.data=n.data.map(function(e){return t.prepareMessage(e,{host:i.state.host})})}else{return false}i.commit("updatePlaceholders",n);return true},setAfter:function e(i,n){if(n instanceof Array){n=n.map(function(e){return t.prepareMessage(e)})}else{var a=t.prepareMessage(n);(n=[]).push(a)}i.commit("set",{insertType:s.MutationType.setAfter,data:n})},setBefore:function e(i,n){if(n instanceof Array){n=n.map(function(e){return t.prepareMessage(e)})}else{var a=t.prepareMessage(n);(n=[]).push(a)}i.commit("set",{insertType:s.MutationType.setBefore,data:n})},update:function e(i,n){if(/^\d+$/.test(n.id)){n.id=parseInt(n.id)}if(/^\d+$/.test(n.chatId)){n.chatId=parseInt(n.chatId)}i.commit("initCollection",{chatId:n.chatId});if(!i.state.collection[n.chatId]){return false}var a=i.state.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(a<0){return false}var r=t.validate(Object.assign({},n.fields));if(r.params){r.params=Object.assign({},t.getElementState().params,i.state.collection[n.chatId][a].params,r.params)}i.commit("update",{id:n.id,chatId:n.chatId,index:a,fields:r});if(n.fields.blink){setTimeout(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){if(!(i.id instanceof Array)){i.id=[i.id]}i.id=i.id.map(function(e){if(/^\d+$/.test(e)){e=parseInt(e)}return e});t.commit("delete",{chatId:i.chatId,elements:i.id});return true},clear:function e(t,i){i.chatId=parseInt(i.chatId);if(i.keepPlaceholders){t.commit("clearMessages",{chatId:i.chatId})}else{t.commit("clear",{chatId:i.chatId})}return true},applyMutationType:function e(t,i){i.chatId=parseInt(i.chatId);t.commit("applyMutationType",{chatId:i.chatId});return true},readMessages:function e(t,i){i.readId=parseInt(i.readId)||0;i.chatId=parseInt(i.chatId);if(typeof t.state.collection[i.chatId]==="undefined"){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var r=t.state.collection[i.chatId][a];if(!r.unread)continue;if(i.readId===0||r.id<=i.readId){n++}}t.commit("readMessages",{chatId:i.chatId,readId:i.readId});return{count:n}},unreadMessages:function e(t,i){i.unreadId=parseInt(i.unreadId)||0;i.chatId=parseInt(i.chatId);if(typeof t.state.collection[i.chatId]==="undefined"||!i.unreadId){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var r=t.state.collection[i.chatId][a];if(r.unread)continue;if(r.id>=i.unreadId){n++}}t.commit("unreadMessages",{chatId:i.chatId,unreadId:i.unreadId});return{count:n}}}}},{key:"getMutations",value:function e(){var n=this;return{initCollection:function e(t,i){return n.initCollection(t,i)},add:function e(i,a){n.initCollection(i,{chatId:a.chatId});i.collection[a.chatId].push(a);i.saveMessageList[a.chatId].push(a.id);i.created+=1;i.collection[a.chatId].sort(function(e,t){return e.id-t.id});n.saveState(i,a.chatId);t.Logger.warn("Messages model: saving state after add")},clearPlaceholders:function e(t,i){if(!t.collection[i.chatId]){return false}t.collection[i.chatId]=t.collection[i.chatId].filter(function(e){return!e.id.toString().startsWith("placeholder")})},updatePlaceholders:function e(i,a){var r="placeholder".concat(a.firstMessage);var o=i.collection[a.chatId].findIndex(function(e){return e.id===r});if(o>=0){var s;i.collection[a.chatId].splice(o,a.amount);(s=i.collection[a.chatId]).splice.apply(s,[o,0].concat(babelHelpers.toConsumableArray(a.data)))}i.collection[a.chatId].sort(function(e,t){return e.id-t.id});t.Logger.warn("Messages model: saving state after updating placeholders");n.saveState(i,a.chatId)},set:function e(a,r){t.Logger.warn("Messages model: set mutation",r);var o=[];var l=[];var c=false;var d=r.insertType;if(r.insertType===s.MutationType.set){(function(){r.insertType=s.MutationType.setAfter;var e={};r.data.forEach(function(t){if(!e[t.chatId]){e[t.chatId]=[]}e[t.chatId].push(t.id)});var i=function i(o){if(!e.hasOwnProperty(o))return"continue";n.initCollection(a,{chatId:o});t.Logger.warn("Messages model: messages before adding from request - ",a.collection[o].length);if(a.saveMessageList[o].length>e[o].length||e[o].length<s.StorageLimit.messages){a.collection[o]=a.collection[o].filter(function(t){return e[o].includes(t.id)});a.saveMessageList[o]=a.saveMessageList[o].filter(function(t){return e[o].includes(t)})}t.Logger.warn("Messages model: cache length",a.saveMessageList[o].length);var l=n.manageCacheBeforeSet(babelHelpers.toConsumableArray(a.saveMessageList[o].reverse()),e[o]);t.Logger.warn("Messages model: set intersection with cache",l);if(l.type===p.none){if(l.foundElements.length>0){a.collection[o]=a.collection[o].filter(function(e){return!l.foundElements.includes(e.id)});a.saveMessageList[o]=a.saveMessageList[o].filter(function(e){return!l.foundElements.includes(e)})}t.Logger.warn("Messages model: no intersection - removing cache");n.removeIntersectionCacheElements=a.collection[o].map(function(e){return e.id});a.collection[o]=a.collection[o].filter(function(e){return!n.removeIntersectionCacheElements.includes(e.id)});a.saveMessageList[o]=a.saveMessageList[o].filter(function(e){return!n.removeIntersectionCacheElements.includes(e)});n.removeIntersectionCacheElements=[]}else if(l.type===p.foundReverse){t.Logger.warn("Messages model: found reverse intersection");r.insertType=s.MutationType.setBefore;r.data=r.data.reverse()}};for(var o in e){var l=i(o);if(l==="continue")continue}})()}t.Logger.warn("Messages model: adding messages to model",r.data);var f=u(r.data),h;try{var m=function e(){var t=h.value;n.initCollection(a,{chatId:t.chatId});var i=a.collection[t.chatId].findIndex(function(e){return e.id===t.id});if(i>-1){delete t.templateId;a.collection[t.chatId][i]=Object.assign(a.collection[t.chatId][i],t)}else if(r.insertType===s.MutationType.setBefore){a.collection[t.chatId].unshift(t)}else if(r.insertType===s.MutationType.setAfter){a.collection[t.chatId].push(t)}o.push(t.chatId);if(n.store.getters["dialogues/canSaveChat"]&&n.store.getters["dialogues/canSaveChat"](t.chatId)){l.push(t.chatId)}};for(f.s();!(h=f.n()).done;){m()}}catch(e){f.e(e)}finally{f.f()}o=babelHelpers.toConsumableArray(new Set(o));l=babelHelpers.toConsumableArray(new Set(l));c=r.data.every(function(e){return e.push===true});t.Logger.warn("Is it fake push message?",c);o.forEach(function(e){a.collection[e].sort(function(e,t){return e.id-t.id});if(!c){t.Logger.warn("setting messagesSet = true for chatId = ",e);setTimeout(function(){i.EventEmitter.emit(s.EventType.dialog.messagesSet,{chatId:e});i.EventEmitter.emit(s.EventType.dialog.readVisibleMessages,{chatId:e})},100)}});if(d!==s.MutationType.setBefore){l.forEach(function(e){t.Logger.warn("Messages model: saving state after set");n.saveState(a,e)})}},update:function e(i,a){n.initCollection(i,{chatId:a.chatId});var r=-1;if(typeof a.index!=="undefined"&&i.collection[a.chatId][a.index]){r=a.index}else{r=i.collection[a.chatId].findIndex(function(e){return e.id===a.id})}if(r>=0){var o=i.saveMessageList[a.chatId].includes(i.collection[a.chatId][r].id)||a.fields.id&&!a.fields.id.toString().startsWith("temporary")&&i.collection[a.chatId][r].id.toString().startsWith("temporary");delete a.fields.templateId;i.collection[a.chatId][r]=Object.assign(i.collection[a.chatId][r],a.fields);if(o){t.Logger.warn("Messages model: saving state after update");n.saveState(i,a.chatId)}}},delete:function e(i,a){n.initCollection(i,{chatId:a.chatId});i.collection[a.chatId]=i.collection[a.chatId].filter(function(e){return!a.elements.includes(e.id)});if(i.saveMessageList[a.chatId].length>0){var r=u(a.elements),o;try{for(r.s();!(o=r.n()).done;){var s=o.value;if(i.saveMessageList[a.chatId].includes(s)){t.Logger.warn("Messages model: saving state after delete");n.saveState(i,a.chatId);break}}}catch(e){r.e(e)}finally{r.f()}}},clear:function e(t,i){n.initCollection(t,{chatId:i.chatId});t.collection[i.chatId]=[];t.saveMessageList[i.chatId]=[]},clearMessages:function e(t,i){n.initCollection(t,{chatId:i.chatId});t.collection[i.chatId]=t.collection[i.chatId].filter(function(e){return e.id.toString().startsWith("placeholder")});t.saveMessageList[i.chatId]=[]},applyMutationType:function e(t,i){if(typeof t.mutationType[i.chatId]==="undefined"){a.Vue.set(t.mutationType,i.chatId,{applied:false,initialType:s.MutationType.none,appliedType:s.MutationType.none,scrollStickToTop:0,scrollMessageId:0})}t.mutationType[i.chatId].applied=true},readMessages:function e(i,a){n.initCollection(i,{chatId:a.chatId});var r=false;for(var o=i.collection[a.chatId].length-1;o>=0;o--){var s=i.collection[a.chatId][o];if(!s.unread)continue;if(a.readId===0||s.id<=a.readId){i.collection[a.chatId][o]=Object.assign(i.collection[a.chatId][o],{unread:false});r=true}}if(r){t.Logger.warn("Messages model: saving state after reading");n.saveState(i,a.chatId)}},unreadMessages:function e(i,a){n.initCollection(i,{chatId:a.chatId});var r=false;for(var o=i.collection[a.chatId].length-1;o>=0;o--){var s=i.collection[a.chatId][o];if(s.unread)continue;if(s.id>=a.unreadId){i.collection[a.chatId][o]=Object.assign(i.collection[a.chatId][o],{unread:true});r=true}}if(r){t.Logger.warn("Messages model: saving state after unreading");n.saveState(i,a.chatId);n.updateSubordinateStates()}}}}},{key:"initCollection",value:function e(t,i){if(typeof i.chatId==="undefined"){return false}if(typeof i.chatId==="undefined"||typeof t.collection[i.chatId]!=="undefined"){return true}a.Vue.set(t.collection,i.chatId,i.messages?[].concat(i.messages):[]);a.Vue.set(t.saveMessageList,i.chatId,[]);a.Vue.set(t.saveFileList,i.chatId,[]);a.Vue.set(t.saveUserList,i.chatId,[]);return true}},{key:"prepareMessage",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t),i);n.params=Object.assign({},this.getElementState().params,n.params);n.templateId=n.id;return Object.assign({},this.getElementState(),n)}},{key:"manageCacheBeforeSet",value:function e(i,n){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;t.Logger.warn("manageCacheBeforeSet",i,n);var r={type:p.empty,foundElements:[],noneElements:[]};if(!i||i.length<=0){return r}var o=u(n),s;try{for(o.s();!(s=o.n()).done;){var l=s.value;if(i.includes(l)){if(r.type===p.empty){r.type=p.found}r.foundElements.push(l)}else{if(r.type===p.empty){r.type=p.none}r.noneElements.push(l)}}}catch(e){o.e(e)}finally{o.f()}if(r.type===p.found&&i.length===n.length&&r.foundElements.length===n.length){r.type=p.equal}else if(r.type===p.none&&!a&&r.foundElements.length>0){var c=this.manageCacheBeforeSet(i.reverse(),n.reverse(),true);if(c.type===p.found){c.type=p.foundReverse;return c}}return r}},{key:"updateSaveLists",value:function e(t,i){if(!this.isSaveAvailable()){return true}if(!i||!this.store.getters["dialogues/canSaveChat"]||!this.store.getters["dialogues/canSaveChat"](i)){return false}this.initCollection(t,{chatId:i});var n=0;var a=[];var r=[];var o=[];var l=this.store.getters["dialogues/getByChatId"](i);if(l&&l.type==="private"){o.push(parseInt(l.dialogId))}var c=0;for(var u=t.collection[i].length-1;u>=0;u--){if(t.collection[i][u].id.toString().startsWith("temporary")){continue}if(!t.collection[i][u].unread){c++}if(n>=s.StorageLimit.messages&&c>=50){break}a.unshift(t.collection[i][u].id);n++}a=a.slice(0,s.StorageLimit.messages);t.collection[i].filter(function(e){return a.includes(e.id)}).forEach(function(e){if(e.authorId>0){o.push(e.authorId)}if(e.params.FILE_ID instanceof Array){r=e.params.FILE_ID.concat(r)}});t.saveMessageList[i]=a;t.saveFileList[i]=babelHelpers.toConsumableArray(new Set(r));t.saveUserList[i]=babelHelpers.toConsumableArray(new Set(o));return true}},{key:"getSaveTimeout",value:function e(){return 150}},{key:"saveState",value:function e(i,n){if(!this.updateSaveLists(i,n)){return false}babelHelpers.get(babelHelpers.getPrototypeOf(r.prototype),"saveState",this).call(this,function(){var e={collection:{},saveMessageList:{},saveUserList:{},saveFileList:{}};var n=function n(a){if(!i.saveMessageList.hasOwnProperty(a)){return"continue"}if(!i.collection[a]){return"continue"}if(!e.collection[a]){e.collection[a]=[]}i.collection[a].filter(function(e){return i.saveMessageList[a].includes(e.id)}).forEach(function(t){if(t.templateType!=="placeholder"){e.collection[a].push(t)}});t.Logger.warn("Cache after updating",e.collection[a]);e.saveMessageList[a]=i.saveMessageList[a];e.saveFileList[a]=i.saveFileList[a];e.saveUserList[a]=i.saveUserList[a]};for(var a in i.saveMessageList){var r=n(a);if(r==="continue")continue}return e})}},{key:"updateSubordinateStates",value:function e(){this.store.dispatch("users/saveState");this.store.dispatch("files/saveState")}},{key:"validate",value:function e(t,i){var a={};if(typeof t.id==="number"){a.id=t.id}else if(typeof t.id==="string"){if(t.id.startsWith("temporary")||t.id.startsWith("placeholder")){a.id=t.id}else{a.id=parseInt(t.id)}}if(typeof t.templateId==="number"){a.templateId=t.templateId}else if(typeof t.templateId==="string"){if(t.templateId.startsWith("temporary")){a.templateId=t.templateId}else{a.templateId=parseInt(t.templateId)}}if(typeof t.templateType==="string"){a.templateType=t.templateType}if(typeof t.placeholderType==="number"){a.placeholderType=t.placeholderType}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){a.chatId=parseInt(t.chatId)}if(typeof t.date!=="undefined"){a.date=n.Utils.date.cast(t.date)}if(typeof t.textOriginal==="string"||typeof t.textOriginal==="number"){a.text=t.textOriginal.toString();if(typeof t.text==="string"||typeof t.text==="number"){a.textConverted=this.convertToHtml({text:t.text.toString(),isConverted:true})}}else{if(typeof t.text_converted!=="undefined"){t.textConverted=t.text_converted}if(typeof t.textConverted==="string"||typeof t.textConverted==="number"){a.textConverted=t.textConverted.toString()}if(typeof t.text==="string"||typeof t.text==="number"){a.text=t.text.toString();var r=typeof a.textConverted!=="undefined";a.textConverted=this.convertToHtml({text:r?a.textConverted:a.text,isConverted:r})}}if(typeof t.senderId!=="undefined"){t.authorId=t.senderId}else if(typeof t.author_id!=="undefined"){t.authorId=t.author_id}if(typeof t.authorId==="number"||typeof t.authorId==="string"){if(t.system===true||t.system==="Y"){a.authorId=0}else{a.authorId=parseInt(t.authorId)}}if(babelHelpers.typeof(t.params)==="object"&&t.params!==null){var o=this.validateParams(t.params,i);if(o){a.params=o}}if(typeof t.push==="boolean"){a.push=t.push}if(typeof t.sending==="boolean"){a.sending=t.sending}if(typeof t.unread==="boolean"){a.unread=t.unread}if(typeof t.blink==="boolean"){a.blink=t.blink}if(typeof t.error==="boolean"||typeof t.error==="string"){a.error=t.error}if(typeof t.retry==="boolean"){a.retry=t.retry}return a}},{key:"validateParams",value:function e(t,i){var a={};try{for(var r in t){if(!t.hasOwnProperty(r)){continue}if(r==="COMPONENT_ID"){if(typeof t[r]==="string"&&BX.Vue.isComponent(t[r])){a[r]=t[r]}}else if(r==="LIKE"){if(t[r]instanceof Array){a["REACTION"]={like:t[r].map(function(e){return parseInt(e)})}}}else if(r==="CHAT_LAST_DATE"){a[r]=n.Utils.date.cast(t[r])}else if(r==="AVATAR"){if(t[r]){a[r]=t[r].startsWith("http")?t[r]:i.host+t[r]}}else if(r==="NAME"){if(t[r]){a[r]=t[r]}}else if(r==="ATTACH"){a[r]=this.decodeAttach(t[r])}else{a[r]=t[r]}}}catch(e){}var o=false;for(var s in a){if(!a.hasOwnProperty(s)){continue}o=true;break}return o?a:null}},{key:"convertToHtml",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.quote,n=i===void 0?true:i,a=t.image,r=a===void 0?true:a,o=t.text,s=o===void 0?"":o,l=t.isConverted,c=l===void 0?false:l,u=t.enableBigSmile,d=u===void 0?true:u;s=s.trim();if(!c){s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}if(s.startsWith("/me")){s="<i>".concat(s.substr(4),"</i>")}else if(s.startsWith("/loud")){s="<b>".concat(s.substr(6),"</b>")}var f="&gt;&gt;";if(n&&s.indexOf(f)>=0){var p=s.split(c?"<br />":"\n");for(var h=0;h<p.length;h++){if(p[h].startsWith(f)){p[h]=p[h].replace(f,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++h<p.length&&p[h].startsWith(f)){p[h]=p[h].replace(f,"")}p[h-1]+="</div></div><br>"}}s=p.join("<br />")}s=s.replace(/\n/gi,"<br />");s=s.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");s=this.decodeBbCode(s,false,d);if(n){s=s.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\]<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a,r){return(r>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name"><span class="bx-im-message-content-quote-name-text">'+t+'</span><span class="bx-im-message-content-quote-name-time">'+i+"</span></div>"+n+"</div></div><br />"});s=s.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a){return(a>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"})}if(r){var m=false;s=s.replace(/<a(.*?)>(http[s]{0,1}:\/\/.*?)<\/a>/gi,function(e,t,i,n){if(!i.match(/(\.(jpg|jpeg|png|gif|webp)\?|\.(jpg|jpeg|png|gif|webp)$)/i)||i.indexOf("/docs/pub/")>0||i.indexOf("logout=yes")>0){return e}else{m=true;return(n>0?"<br />":"")+"<a"+t+' target="_blank" class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="BX.Messenger.Model.MessagesModel.hideErrorImage(this)"></a></span>'}});if(m){s=s.replace(/<\/span>(\n?)<br(\s\/?)>/gi,"</span>").replace(/<br(\s\/?)>(\n?)<br(\s\/?)>(\n?)<span/gi,"<br /><span")}}if(d){s=s.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,function e(t,i,n,a,r,o){return i+parseInt(n,10)*1.7+a+parseInt(r,10)*1.7+o})}if(s.substr(-6)=="<br />"){s=s.substr(0,s.length-6)}s=s.replace(/<br><br \/>/gi,"<br />");s=s.replace(/<br \/><br>/gi,"<br />");return s}},{key:"decodeBbCode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return r.decodeBbCode({text:t,textOnly:i,enableBigSmile:n})}},{key:"decodeAttach",value:function e(t){var i=this;if(Array.isArray(t)){t.forEach(function(e){e=i.decodeAttach(e)})}else if(babelHelpers.typeof(t)==="object"&&t!==null){for(var a in t){if(t.hasOwnProperty(a)){t[a]=this.decodeAttach(t[a])}}}else{if(typeof t==="string"){t=n.Utils.text.htmlspecialcharsback(t)}}return t}}],[{key:"decodeBbCode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.text,a=t.textOnly,r=a===void 0?false:a,o=t.enableBigSmile,s=o===void 0?true:o;var l=[];i=i.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,function(e){var t=l.length;l.push(e);return"####REPLACEMENT_PUT_"+t+"####"});var c=[];i=i.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,function(e){var t=c.length;c.push(e);return"####REPLACEMENT_SEND_"+t+"####"});var u=[];i=i.replace(/\[CODE\]\n?([\s\S]*?)\[\/CODE\]/gi,function(e,t){var i=u.length;u.push(t);return"####REPLACEMENT_CODE_"+i+"####"});i=i.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,function(e,t,i){var a=document.createElement("a");a.href=n.Utils.text.htmlspecialcharsback(t);a.target="_blank";a.text=n.Utils.text.htmlspecialcharsback(i);var r=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(r.indexOf(a.protocol)<=-1){return e}return a.outerHTML});i=i.replace(/\[url\]([^\]]+)\[\/url\]/gi,function(e,t){t=n.Utils.text.htmlspecialcharsback(t);var i=document.createElement("a");i.href=t;i.target="_blank";i.text=t;var a=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(a.indexOf(i.protocol)<=-1){return e}return i.outerHTML});i=i.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');i=i.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');i=i.replace(/\[BR\]/gi,"<br/>");i=i.replace(/\[([buis])\](.*?)\[(\/[buis])\]/gi,function(e,t,i,n){return"<"+t+">"+i+"<"+n+">"});i=i.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,n){return t?n:'<span class="bx-im-mention" data-type="CHAT" data-value="chat'+i+'">'+n+"</span>"});i=i.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,function(e,t,i){return'<span class="bx-im-mention" data-type="CALL" data-value="'+n.Utils.text.htmlspecialchars(t)+'">'+i+"</span>"});i=i.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});var d=0;if(s){d=i.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}i=i.replace(/\[icon\=([^\]]*)\]/gi,function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var i={src:t,border:0};var a=e.match(/size\=(\d+)/i);if(a&&a[1]){i["width"]=a[1];i["height"]=a[1]}else{var r=e.match(/width\=(\d+)/i);if(r&&r[1]){i["width"]=r[1]}var o=e.match(/height\=(\d+)/i);if(o&&o[1]){i["height"]=o[1]}if(i["width"]&&!i["height"]){i["height"]=i["width"]}else if(i["height"]&&!i["width"]){i["width"]=i["height"]}else if(i["height"]&&i["width"]);else{i["width"]=20;i["height"]=20}}i["width"]=i["width"]>100?100:i["width"];i["height"]=i["height"]>100?100:i["height"];if(s&&d===0&&i["width"]===i["height"]&&i["width"]===20){i["width"]=40;i["height"]=40}var l=e.match(/title\=(.*[^\s\]])/i);if(l&&l[1]){l=l[1];if(l.indexOf("width=")>-1){l=l.substr(0,l.indexOf("width="))}if(l.indexOf("height=")>-1){l=l.substr(0,l.indexOf("height="))}if(l.indexOf("size=")>-1){l=l.substr(0,l.indexOf("size="))}if(l){i["title"]=n.Utils.text.htmlspecialchars(l).trim();i["alt"]=i["title"]}}var c="";for(var u in i){if(i.hasOwnProperty(u)){c+=u+'="'+i[u]+'" '}}return'<img class="bx-smile bx-icon" '+c+">"});c.forEach(function(e,t){i=i.replace("####REPLACEMENT_SEND_"+t+"####",e)});i=i.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(!r&&i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);t=t.split("####REPLACEMENT_PUT_").join("####REPLACEMENT_SP_");n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="send">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n})});l.forEach(function(e,t){i=i.replace("####REPLACEMENT_PUT_"+t+"####",e)});i=i.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(!r&&i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="put">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n})});u.forEach(function(e,t){i=i.replace("####REPLACEMENT_CODE_"+t+"####",!r?'<div class="bx-im-message-content-code">'+e+"</div>":e)});if(c.length>0){do{c.forEach(function(e,t){i=i.replace("####REPLACEMENT_SEND_"+t+"####",e)})}while(i.includes("####REPLACEMENT_SEND_"))}i=i.split("####REPLACEMENT_SP_").join("####REPLACEMENT_PUT_");if(l.length>0){do{l.forEach(function(e,t){i=i.replace("####REPLACEMENT_PUT_"+t+"####",e)})}while(i.includes("####REPLACEMENT_PUT_"))}return i}},{key:"hideErrorImage",value:function e(t){if(t.parentNode&&t.parentNode){t.parentNode.innerHTML='<a href="'+t.src+'" target="_blank">'+t.src+"</a>"}return true}}]);return r}(r.VuexBuilderModel);function m(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=g(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function g(e,t){if(!e)return;if(typeof e==="string")return y(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return y(e,t)}function y(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var v=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"dialogues"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},saveDialogList:[],saveChatList:[]}}},{key:"getStateSaveException",value:function e(){return{host:null}}},{key:"getElementStateSaveException",value:function e(){return{writingList:null,quoteId:null}}},{key:"getElementState",value:function e(){return{dialogId:"0",chatId:0,counter:0,userCounter:0,messageCount:0,unreadId:0,lastMessageId:0,managerList:[],readedList:[],writingList:[],muteList:[],textareaMessage:"",quoteId:0,editId:0,init:false,name:"",owner:0,extranet:false,avatar:"",color:"#17A3EA",type:"chat",entityType:"",entityId:"",entityData1:"",entityData2:"",entityData3:"",dateCreate:new Date,restrictions:{avatar:true,extend:true,leave:true,leaveOwner:true,rename:true},public:{code:"",link:""}}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e){if(!t.collection[e]){return null}return t.collection[e]}},getByChatId:function e(t){return function(e){e=parseInt(e);for(var i in t.collection){if(!t.collection.hasOwnProperty(i)){continue}if(t.collection[i].chatId===e){return t.collection[i]}}return null}},getBlank:function e(i){return function(e){return t.getElementState()}},getQuoteId:function e(t){return function(e){if(!t.collection[e]){return 0}return t.collection[e].quoteId}},getEditId:function e(t){return function(e){if(!t.collection[e]){return 0}return t.collection[e].editId}},canSaveChat:function e(t){return function(e){if(/^\d+$/.test(e)){e=parseInt(e)}return t.saveChatList.includes(parseInt(e))}},canSaveDialog:function e(t){return function(e){return t.saveDialogList.includes(e.toString())}},isPrivateDialog:function e(t){return function(e){e=e.toString();return t.collection[e.toString()]&&t.collection[e].type==="private"}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}i.commit("update",{dialogId:n.dialogId,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.dialogId);return true},updateWriting:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}var a=i.state.collection[n.dialogId].writingList.findIndex(function(e){return e.userId===n.userId});if(n.action){if(a>=0){return true}else{var r=[].concat(i.state.collection[n.dialogId].writingList);r.unshift({userId:n.userId,userName:n.userName});i.commit("update",{actionName:"updateWriting/1",dialogId:n.dialogId,fields:t.validate({writingList:r},{host:i.state.host})})}}else{if(a>=0){var o=i.state.collection[n.dialogId].writingList.filter(function(e){return e.userId!==n.userId});i.commit("update",{actionName:"updateWriting/2",dialogId:n.dialogId,fields:t.validate({writingList:o},{host:i.state.host})});return true}else{return true}}return false},updateReaded:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}var a=i.state.collection[n.dialogId].readedList.filter(function(e){return e.userId!==n.userId});if(n.action){a.push({userId:n.userId,userName:n.userName||"",messageId:n.messageId,date:n.date||new Date})}i.commit("update",{actionName:"updateReaded",dialogId:n.dialogId,fields:t.validate({readedList:a},{host:i.state.host})});return false},increaseCounter:function e(t,i){var n;if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var a=t.state.collection[i.dialogId].counter;if(a===100){return true}var r=a+i.count;if(r>100){r=100}var o=(n=t.rootState.application)===null||n===void 0?void 0:n.common.userId;var s=o&&t.state.collection[i.dialogId].muteList.includes(o);t.commit("update",{actionName:"increaseCounter",dialogId:i.dialogId,dialogMuted:s,fields:{counter:r,previousCounter:a}});return false},decreaseCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].counter;if(n===100){return true}var a=n-i.count;if(a<0){a=0}var r=i.unreadId>t.state.collection[i.dialogId].unreadId?i.unreadId:t.state.collection[i.dialogId].unreadId;if(t.state.collection[i.dialogId].unreadId!==r||t.state.collection[i.dialogId].counter!==a){var o;var s=t.state.collection[i.dialogId].counter;if(a===0){r=0}var l=(o=t.rootState.application)===null||o===void 0?void 0:o.common.userId;var c=l&&t.state.collection[i.dialogId].muteList.includes(l);t.commit("update",{actionName:"decreaseCounter",dialogId:i.dialogId,dialogMuted:c,fields:{counter:a,previousCounter:s,unreadId:r}})}return false},increaseMessageCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].messageCount;t.commit("update",{actionName:"increaseMessageCount",dialogId:i.dialogId,fields:{messageCount:n+i.count}})},saveDialog:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}t.commit("saveDialog",{dialogId:i.dialogId,chatId:i.chatId});return false}}}},{key:"getMutations",value:function e(){var t=this;return{initCollection:function e(i,n){t.initCollection(i,n)},saveDialog:function e(i,n){if(!(n.chatId>0&&n.dialogId.length>0)){return false}var a=i.saveDialogList.filter(function(e){return e!==n.dialogId});a.unshift(n.dialogId);a=a.slice(0,s.StorageLimit.dialogues);if(i.saveDialogList.join(",")===a.join(",")){return true}i.saveDialogList=a;var r=i.saveChatList.filter(function(e){return e!==n.chatId});r.unshift(n.chatId);i.saveChatList=r.slice(0,s.StorageLimit.dialogues);t.saveState(i)},set:function e(i,n){var a=m(n),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;t.initCollection(i,{dialogId:o.dialogId});i.collection[o.dialogId]=Object.assign(t.getElementState(),i.collection[o.dialogId],o)}}catch(e){a.e(e)}finally{a.f()}t.saveState(i)},update:function e(i,n){t.initCollection(i,n);i.collection[n.dialogId]=Object.assign(i.collection[n.dialogId],n.fields);t.saveState(i)},delete:function e(i,n){delete i.collection[n.dialogId];t.saveState(i)}}}},{key:"initCollection",value:function e(t,i){if(typeof t.collection[i.dialogId]!=="undefined"){return true}a.Vue.set(t.collection,i.dialogId,this.getElementState());if(i.fields){t.collection[i.dialogId]=Object.assign(t.collection[i.dialogId],this.validate(Object.assign({},i.fields),{host:t.host}))}return true}},{key:"getSaveTimeout",value:function e(){return 100}},{key:"saveState",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.isSaveAvailable()){return true}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"saveState",this).call(this,function(){var e={collection:{},saveDialogList:[].concat(n.saveDialogList),saveChatList:[].concat(n.saveChatList)};n.saveDialogList.forEach(function(t){if(!n.collection[t])return false;e.collection[t]=Object.assign(i.getElementState(),i.cloneState(n.collection[t],i.getElementStateSaveException()))});return e})}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};i.host=i.host||this.getState().host;if(typeof t.dialog_id!=="undefined"){t.dialogId=t.dialog_id}if(typeof t.dialogId==="number"||typeof t.dialogId==="string"){a.dialogId=t.dialogId.toString()}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}else if(typeof t.id!=="undefined"){t.chatId=t.id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){a.chatId=parseInt(t.chatId)}if(typeof t.quoteId==="number"){a.quoteId=parseInt(t.quoteId)}if(typeof t.editId==="number"){a.editId=parseInt(t.editId)}if(typeof t.counter==="number"||typeof t.counter==="string"){a.counter=parseInt(t.counter)}if(typeof t.user_counter==="number"||typeof t.user_counter==="string"){a.userCounter=parseInt(t.user_counter)}if(typeof t.userCounter==="number"||typeof t.userCounter==="string"){a.userCounter=parseInt(t.userCounter)}if(typeof t.message_count==="number"||typeof t.message_count==="string"){a.messageCount=parseInt(t.message_count)}if(typeof t.messageCount==="number"||typeof t.messageCount==="string"){a.messageCount=parseInt(t.messageCount)}if(typeof t.unread_id!=="undefined"){t.unreadId=t.unread_id}if(typeof t.unreadId==="number"||typeof t.unreadId==="string"){a.unreadId=parseInt(t.unreadId)}if(typeof t.last_message_id!=="undefined"){t.lastMessageId=t.last_message_id}if(typeof t.lastMessageId==="number"||typeof t.lastMessageId==="string"){a.lastMessageId=parseInt(t.lastMessageId)}if(typeof t.readed_list!=="undefined"){t.readedList=t.readed_list}if(typeof t.readedList!=="undefined"){a.readedList=[];if(t.readedList instanceof Array){t.readedList.forEach(function(e){var t={};if(typeof e.user_id!=="undefined"){e.userId=e.user_id}if(typeof e.user_name!=="undefined"){e.userName=e.user_name}if(typeof e.message_id!=="undefined"){e.messageId=e.message_id}if(!e.userId||!e.userName||!e.messageId){return false}t.userId=parseInt(e.userId);t.userName=e.userName.toString();t.messageId=parseInt(e.messageId);t.date=n.Utils.date.cast(e.date);a.readedList.push(t)})}}if(typeof t.writing_list!=="undefined"){t.writingList=t.writing_list}if(typeof t.writingList!=="undefined"){a.writingList=[];if(t.writingList instanceof Array){t.writingList.forEach(function(e){var t={};if(!e.userId){return false}t.userId=parseInt(e.userId);t.userName=n.Utils.text.htmlspecialcharsback(e.userName);a.writingList.push(t)})}}if(typeof t.manager_list!=="undefined"){t.managerList=t.manager_list}if(typeof t.managerList!=="undefined"){a.managerList=[];if(t.managerList instanceof Array){t.managerList.forEach(function(e){e=parseInt(e);if(e>0){a.managerList.push(e)}})}}if(typeof t.mute_list!=="undefined"){t.muteList=t.mute_list}if(typeof t.muteList!=="undefined"){a.muteList=[];if(t.muteList instanceof Array){t.muteList.forEach(function(e){e=parseInt(e);if(e>0){a.muteList.push(e)}})}else if(babelHelpers.typeof(t.muteList)==="object"){Object.entries(t.muteList).forEach(function(e){if(e[1]===true){var t=parseInt(e[0]);if(t>0){a.muteList.push(t)}}})}}if(typeof t.textareaMessage!=="undefined"){a.textareaMessage=t.textareaMessage.toString()}if(typeof t.title!=="undefined"){t.name=t.title}if(typeof t.name==="string"||typeof t.name==="number"){a.name=n.Utils.text.htmlspecialcharsback(t.name.toString())}if(typeof t.owner!=="undefined"){t.ownerId=t.owner}if(typeof t.ownerId==="number"||typeof t.ownerId==="string"){a.ownerId=parseInt(t.ownerId)}if(typeof t.extranet==="boolean"){a.extranet=t.extranet}if(typeof t.avatar==="string"){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(typeof t.color==="string"){a.color=t.color.toString()}if(typeof t.type==="string"){a.type=t.type.toString()}if(typeof t.entity_type!=="undefined"){t.entityType=t.entity_type}if(typeof t.entityType==="string"){a.entityType=t.entityType.toString()}if(typeof t.entity_id!=="undefined"){t.entityId=t.entity_id}if(typeof t.entityId==="string"||typeof t.entityId==="number"){a.entityId=t.entityId.toString()}if(typeof t.entity_data_1!=="undefined"){t.entityData1=t.entity_data_1}if(typeof t.entityData1==="string"){a.entityData1=t.entityData1.toString()}if(typeof t.entity_data_2!=="undefined"){t.entityData2=t.entity_data_2}if(typeof t.entityData2==="string"){a.entityData2=t.entityData2.toString()}if(typeof t.entity_data_3!=="undefined"){t.entityData3=t.entity_data_3}if(typeof t.entityData3==="string"){a.entityData3=t.entityData3.toString()}if(typeof t.date_create!=="undefined"){t.dateCreate=t.date_create}if(typeof t.dateCreate!=="undefined"){a.dateCreate=n.Utils.date.cast(t.dateCreate)}if(typeof t.dateLastOpen!=="undefined"){a.dateLastOpen=n.Utils.date.cast(t.dateLastOpen)}if(babelHelpers.typeof(t.restrictions)==="object"&&t.restrictions){a.restrictions={};if(typeof t.restrictions.AVATAR==="boolean"){a.restrictions.avatar=t.restrictions.AVATAR}if(typeof t.restrictions.EXTEND==="boolean"){a.restrictions.extend=t.restrictions.EXTEND}if(typeof t.restrictions.LEAVE==="boolean"){a.restrictions.leave=t.restrictions.LEAVE}if(typeof t.restrictions.LEAVE_OWNER==="boolean"){a.restrictions.leaveOwner=t.restrictions.LEAVE_OWNER}if(typeof t.restrictions.RENAME==="boolean"){a.restrictions.rename=t.restrictions.RENAME}}if(babelHelpers.typeof(t.public)==="object"&&t.public){a.public={};if(typeof t.public.code==="string"){a.public.code=t.public.code}if(typeof t.public.link==="string"){a.public.link=t.public.link}}return a}}]);return t}(r.VuexBuilderModel);function b(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=I(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function I(e,t){if(!e)return;if(typeof e==="string")return S(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(e,t)}function S(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var C=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"users"}},{key:"getState",value:function e(){this.startOnlineCheckInterval();return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},onlineList:[],mobileOnlineList:[],absentList:[]}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.id,n=i===void 0?0:i,a=t.name,r=a===void 0?this.getVariable("default.name",""):a,o=t.firstName,s=o===void 0?this.getVariable("default.name",""):o,l=t.lastName,c=l===void 0?"":l;return{id:n,name:r,firstName:s,lastName:c,workPosition:"",color:"#048bd0",avatar:"",gender:"M",birthday:false,isBirthday:false,extranet:false,network:false,bot:false,connector:false,externalAuthId:"default",status:"online",idle:false,lastActivityDate:false,mobileLastDate:false,isOnline:false,isMobileOnline:false,absent:false,isAbsent:false,departments:[],phones:{workPhone:"",personalMobile:"",personalPhone:"",innerPhone:""},init:false}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(i){return function(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;e=parseInt(e);if(e<=0){if(n){e=0}else{return null}}if(!n&&(!i.collection[e]||!i.collection[e].init)){return null}if(!i.collection[e]){return t.getElementState({id:e})}return i.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState(e)}},getList:function e(i){return function(e){var n=[];if(!Array.isArray(e)){return null}e.forEach(function(e){if(i.collection[e]){n.push(i.collection[e])}else{n.push(t.getElementState({id:e}))}});return n}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.getElementState(),t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.getElementState(),t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){n.id=parseInt(n.id);if(typeof i.state.collection[n.id]==="undefined"||i.state.collection[n.id].init===false){return true}i.commit("update",{id:n.id,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.id);return true},saveState:function e(t,i){t.commit("saveState",{});return true}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,a){var r=b(a),o;try{var s=function e(){var a=o.value;t.initCollection(i,{id:a.id});i.collection[a.id]=Object.assign(i.collection[a.id],a);var r=n.Utils.user.getOnlineStatus(a);if(r.isOnline){i.collection[a.id].isOnline=true;t.addToOnlineList(i,a.id)}var s=n.Utils.user.isMobileActive(a);if(s){i.collection[a.id].isMobileOnline=true;t.addToMobileOnlineList(i,a.id)}if(a.birthday){var l=n.Utils.date.format(new Date,"d-m");if(a.birthday===l){i.collection[a.id].isBirthday=true;var c=t.getTimeToNextMidnight();setTimeout(function(){i.collection[a.id].isBirthday=false},c)}}if(a.absent){a.isAbsent=true;if(!i.absentList.includes(a.id)){t.addToAbsentList(i,a.id);var u=t.getTimeToNextMidnight();var d=1e3*60*60*24;setTimeout(function(){setInterval(function(){return t.startAbsentCheckInterval(i)},d)},u)}}t.saveState(i)};for(r.s();!(o=r.n()).done;){s()}}catch(e){r.e(e)}finally{r.f()}},update:function e(i,a){t.initCollection(i,a);if(typeof a.fields.lastActivityDate!=="undefined"&&i.collection[a.id].lastActivityDate){var r=i.collection[a.id].lastActivityDate.getTime();var o=a.fields.lastActivityDate.getTime();if(o>r){var s=n.Utils.user.getOnlineStatus(a.fields);if(s.isOnline){i.collection[a.id].isOnline=true;t.addToOnlineList(i,a.fields.id)}}}if(typeof a.fields.mobileLastDate!=="undefined"&&i.collection[a.id].mobileLastDate!==a.fields.mobileLastDate){var l=n.Utils.user.isMobileActive(a.fields);if(l){i.collection[a.id].isMobileOnline=true;t.addToMobileOnlineList(i,a.fields.id)}}i.collection[a.id]=Object.assign(i.collection[a.id],a.fields);t.saveState(i)},delete:function e(i,n){delete i.collection[n.id];t.saveState(i)},saveState:function e(i,n){t.saveState(i)}}}},{key:"initCollection",value:function e(t,i){if(typeof t.collection[i.id]!=="undefined"){return true}a.Vue.set(t.collection,i.id,this.getElementState());return true}},{key:"getSaveUserList",value:function e(){if(!this.db){return[]}if(!this.store.getters["messages/getSaveUserList"]){return[]}var t=this.store.getters["messages/getSaveUserList"]();if(!t){return[]}return t}},{key:"getSaveTimeout",value:function e(){return 250}},{key:"saveState",value:function e(i){var n=this;if(!this.isSaveAvailable()){return false}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"saveState",this).call(this,function(){var e=n.getSaveUserList();if(!e){return false}var t={collection:{}};var a={absent:true,idle:true,mobileLastDate:true,lastActivityDate:true};for(var r in e){if(!e.hasOwnProperty(r)){continue}e[r].forEach(function(e){if(!i.collection[e]){return false}t.collection[e]=n.cloneState(i.collection[e],a)})}return t})}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};i.host=i.host||this.getState().host;if(typeof t.id==="number"||typeof t.id==="string"){a.id=parseInt(t.id)}if(typeof t.first_name!=="undefined"){t.firstName=n.Utils.text.htmlspecialcharsback(t.first_name)}if(typeof t.last_name!=="undefined"){t.lastName=n.Utils.text.htmlspecialcharsback(t.last_name)}if(typeof t.name==="string"||typeof t.name==="number"){t.name=n.Utils.text.htmlspecialcharsback(t.name.toString());a.name=t.name}if(typeof t.firstName==="string"||typeof t.firstName==="number"){a.firstName=n.Utils.text.htmlspecialcharsback(t.firstName.toString())}if(typeof t.lastName==="string"||typeof t.lastName==="number"){a.lastName=n.Utils.text.htmlspecialcharsback(t.lastName.toString())}if(typeof t.work_position!=="undefined"){t.workPosition=t.work_position}if(typeof t.workPosition==="string"||typeof t.workPosition==="number"){a.workPosition=t.workPosition.toString()}if(typeof t.color==="string"){a.color=t.color}if(typeof t.avatar==="string"){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(typeof t.gender!=="undefined"){a.gender=t.gender==="F"?"F":"M"}if(typeof t.birthday==="string"){a.birthday=t.birthday}if(typeof t.extranet==="boolean"){a.extranet=t.extranet}if(typeof t.network==="boolean"){a.network=t.network}if(typeof t.bot==="boolean"){a.bot=t.bot}if(typeof t.connector==="boolean"){a.connector=t.connector}if(typeof t.external_auth_id!=="undefined"){t.externalAuthId=t.external_auth_id}if(typeof t.externalAuthId==="string"&&t.externalAuthId){a.externalAuthId=t.externalAuthId}if(typeof t.status==="string"){a.status=t.status}if(typeof t.idle!=="undefined"){a.idle=n.Utils.date.cast(t.idle,false)}if(typeof t.last_activity_date!=="undefined"){t.lastActivityDate=t.last_activity_date}if(typeof t.lastActivityDate!=="undefined"){a.lastActivityDate=n.Utils.date.cast(t.lastActivityDate,false)}if(typeof t.mobile_last_date!=="undefined"){t.mobileLastDate=t.mobile_last_date}if(typeof t.mobileLastDate!=="undefined"){a.mobileLastDate=n.Utils.date.cast(t.mobileLastDate,false)}if(typeof t.absent!=="undefined"){a.absent=n.Utils.date.cast(t.absent,false)}if(typeof t.departments!=="undefined"){a.departments=[];if(t.departments instanceof Array){t.departments.forEach(function(e){e=parseInt(e);if(e>0){a.departments.push(e)}})}}if(babelHelpers.typeof(t.phones)==="object"&&t.phones){a.phones={};if(typeof t.phones.work_phone!=="undefined"){t.phones.workPhone=t.phones.work_phone}if(typeof t.phones.workPhone==="string"||typeof t.phones.workPhone==="number"){a.phones.workPhone=t.phones.workPhone.toString()}if(typeof t.phones.personal_mobile!=="undefined"){t.phones.personalMobile=t.phones.personal_mobile}if(typeof t.phones.personalMobile==="string"||typeof t.phones.personalMobile==="number"){a.phones.personalMobile=t.phones.personalMobile.toString()}if(typeof t.phones.personal_phone!=="undefined"){t.phones.personalPhone=t.phones.personal_phone}if(typeof t.phones.personalPhone==="string"||typeof t.phones.personalPhone==="number"){a.phones.personalPhone=t.phones.personalPhone.toString()}if(typeof t.phones.inner_phone!=="undefined"){t.phones.innerPhone=t.phones.inner_phone}if(typeof t.phones.innerPhone==="string"||typeof t.phones.innerPhone==="number"){a.phones.innerPhone=t.phones.innerPhone.toString()}}return a}},{key:"addToOnlineList",value:function e(t,i){if(!t.onlineList.includes(i)){t.onlineList.push(i)}}},{key:"addToMobileOnlineList",value:function e(t,i){if(!t.mobileOnlineList.includes(i)){t.mobileOnlineList.push(i)}}},{key:"addToAbsentList",value:function e(t,i){if(!t.absentList.includes(i)){t.absentList.push(i)}}},{key:"getTimeToNextMidnight",value:function e(){var t=new Date((new Date).setHours(24,0,0)).getTime();return t-new Date}},{key:"startAbsentCheckInterval",value:function e(t){var i=b(t.absentList),n;try{var a=function e(){var i=n.value;var a=t.collection[i];if(!a){return"continue"}var r=(new Date).getTime();var o=new Date(t.collection[i].absent).getTime();if(o<=r){t.absentList=t.absentList.filter(function(e){return e!==i});a.isAbsent=false}};for(i.s();!(n=i.n()).done;){var r=a();if(r==="continue")continue}}catch(e){i.e(e)}finally{i.f()}}},{key:"startOnlineCheckInterval",value:function e(){var t=this;var i=6e4;setInterval(function(){var e=b(t.store.state.users.onlineList),i;try{var a=function e(){var a=i.value;var r=t.store.state.users.collection[a];if(!r){return"continue"}var o=n.Utils.user.getOnlineStatus(r);if(o.isOnline){r.isOnline=true}else{r.isOnline=false;t.store.state.users.onlineList=t.store.state.users.onlineList.filter(function(e){return e!==a})}};for(e.s();!(i=e.n()).done;){var r=a();if(r==="continue")continue}}catch(t){e.e(t)}finally{e.f()}var o=b(t.store.state.users.mobileOnlineList),s;try{var l=function e(){var i=s.value;var a=t.store.state.users.collection[i];if(!a){return"continue"}var r=n.Utils.user.isMobileActive(a);if(r){a.isMobileOnline=true}else{a.isMobileOnline=false;t.store.state.users.mobileOnlineList=t.store.state.users.mobileOnlineList.filter(function(e){return e!==i})}};for(o.s();!(s=o.n()).done;){var c=l();if(c==="continue")continue}}catch(e){o.e(e)}finally{o.f()}},i)}}]);return t}(r.VuexBuilderModel);function x(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=T(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function T(e,t){if(!e)return;if(typeof e==="string")return k(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(e,t)}function k(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var E=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"files"}},{key:"getState",value:function e(){return{created:0,host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},index:{}}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.id,n=i===void 0?0:i,a=t.chatId,r=a===void 0?0:a,o=t.name,l=o===void 0?this.getVariable("default.name",""):o;return{id:n,chatId:r,name:l,templateId:n,date:new Date,type:"file",extension:"",icon:"empty",size:0,image:false,status:s.FileStatus.done,progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:"",init:false,viewerAttrs:{}}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!e||!i){return null}if(!t.index[e]||!t.index[e][i]){return null}if(!n&&!t.index[e][i].init){return null}return t.index[e][i]}},getList:function e(t){return function(e){if(!t.index[e]){return null}return t.index[e]}},getBlank:function e(i){return function(e){return t.getElementState(e)}}}}},{key:"getActions",value:function e(){var t=this;return{add:function e(i,n){var a=t.validate(Object.assign({},n),{host:i.state.host});a.id="temporary"+(new Date).getTime()+i.state.created;a.templateId=a.id;a.init=true;i.commit("add",Object.assign({},t.getElementState(),a));return a.id},set:function e(i,n){if(n instanceof Array){n=n.map(function(e){var n=t.validate(Object.assign({},e),{host:i.state.host});n.templateId=n.id;return Object.assign({},t.getElementState(),n,{init:true})})}else{var a=t.validate(Object.assign({},n),{host:i.state.host});a.templateId=a.id;n=[];n.push(Object.assign({},t.getElementState(),a,{init:true}))}i.commit("set",{insertType:s.MutationType.setAfter,data:n})},setBefore:function e(i,n){if(n instanceof Array){n=n.map(function(e){var n=t.validate(Object.assign({},e),{host:i.state.host});n.templateId=n.id;return Object.assign({},t.getElementState(),n,{init:true})})}else{var a=t.validate(Object.assign({},n),{host:i.state.host});a.templateId=a.id;n=[];n.push(Object.assign({},t.getElementState(),a,{init:true}))}i.commit("set",{actionName:"setBefore",insertType:s.MutationType.setBefore,data:n})},update:function e(i,n){var a=t.validate(Object.assign({},n.fields),{host:i.state.host});i.commit("initCollection",{chatId:n.chatId});var r=i.state.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(r<0){return false}i.commit("update",{id:n.id,chatId:n.chatId,index:r,fields:a});if(n.fields.blink){setTimeout(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){t.commit("delete",{id:i.id,chatId:i.chatId});return true},saveState:function e(t,i){t.commit("saveState",{});return true}}}},{key:"getMutations",value:function e(){var t=this;return{initCollection:function e(i,n){t.initCollection(i,n)},add:function e(i,n){t.initCollection(i,n);i.collection[n.chatId].push(n);i.index[n.chatId][n.id]=n;i.created+=1;t.saveState(i)},set:function e(i,n){var a=x(n.data),r;try{var o=function e(){var a=r.value;t.initCollection(i,{chatId:a.chatId});var o=i.collection[a.chatId].findIndex(function(e){return e.id===a.id});if(o>-1){delete a.templateId;i.collection[a.chatId][o]=Object.assign(i.collection[a.chatId][o],a)}else if(n.insertType===s.MutationType.setBefore){i.collection[a.chatId].unshift(a)}else{i.collection[a.chatId].push(a)}i.index[a.chatId][a.id]=a;t.saveState(i)};for(a.s();!(r=a.n()).done;){o()}}catch(e){a.e(e)}finally{a.f()}},update:function e(i,n){t.initCollection(i,n);var a=-1;if(typeof n.index!=="undefined"&&i.collection[n.chatId][n.index]){a=n.index}else{a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id})}if(a>=0){delete n.fields.templateId;var r=Object.assign(i.collection[n.chatId][a],n.fields);i.collection[n.chatId][a]=r;i.index[n.chatId][r.id]=r;t.saveState(i)}},delete:function e(i,n){t.initCollection(i,n);i.collection[n.chatId]=i.collection[n.chatId].filter(function(e){return e.id!==n.id});delete i.index[n.chatId][n.id];t.saveState(i)},saveState:function e(i,n){t.saveState(i)}}}},{key:"initCollection",value:function e(t,i){if(typeof t.collection[i.chatId]!=="undefined"){return true}a.Vue.set(t.collection,i.chatId,[]);a.Vue.set(t.index,i.chatId,{});return true}},{key:"getLoadedState",value:function e(t){if(!t||babelHelpers.typeof(t)!=="object"){return t}if(babelHelpers.typeof(t.collection)!=="object"){return t}t.index={};var i=function e(i){if(!t.collection.hasOwnProperty(i)){return"continue"}t.index[i]={};t.collection[i].filter(function(e){return e!=null}).forEach(function(e){t.index[i][e.id]=e})};for(var n in t.collection){var a=i(n);if(a==="continue")continue}return t}},{key:"getSaveFileList",value:function e(){if(!this.db){return[]}if(!this.store.getters["messages/getSaveFileList"]){return[]}var t=this.store.getters["messages/getSaveFileList"]();if(!t){return[]}return t}},{key:"getSaveTimeout",value:function e(){return 250}},{key:"saveState",value:function e(i){var n=this;if(!this.isSaveAvailable()){return false}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"saveState",this).call(this,function(){var e=n.getSaveFileList();if(!e){return false}var t={collection:{}};var a=function n(a){if(!e.hasOwnProperty(a)){return"continue"}e[a].forEach(function(e){if(!i.index[a]){return false}if(!i.index[a][e]){return false}if(!t.collection[a]){t.collection[a]=[]}t.collection[a].push(i.index[a][e])})};for(var r in e){var o=a(r);if(o==="continue")continue}return t})}},{key:"validate",value:function e(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r={};a.host=a.host||this.getState().host;if(typeof i.id==="number"){r.id=i.id}else if(typeof i.id==="string"){if(i.id.startsWith("temporary")){r.id=i.id}else{r.id=parseInt(i.id)}}if(typeof i.templateId==="number"){r.templateId=i.templateId}else if(typeof i.templateId==="string"){if(i.templateId.startsWith("temporary")){r.templateId=i.templateId}else{r.templateId=parseInt(i.templateId)}}if(typeof i.chatId==="number"||typeof i.chatId==="string"){r.chatId=parseInt(i.chatId)}if(typeof i.date!=="undefined"){r.date=n.Utils.date.cast(i.date)}if(typeof i.type==="string"){r.type=i.type}if(typeof i.extension==="string"){r.extension=i.extension.toString();if(r.type==="image"){r.icon="img"}else if(r.type==="video"){r.icon="mov"}else{r.icon=t.getIconType(r.extension)}}if(typeof i.name==="string"||typeof i.name==="number"){r.name=i.name.toString()}if(typeof i.size==="number"||typeof i.size==="string"){r.size=parseInt(i.size)}if(typeof i.image==="boolean"){r.image=false}else if(babelHelpers.typeof(i.image)==="object"&&i.image){r.image={width:0,height:0};if(typeof i.image.width==="string"||typeof i.image.width==="number"){r.image.width=parseInt(i.image.width)}if(typeof i.image.height==="string"||typeof i.image.height==="number"){r.image.height=parseInt(i.image.height)}if(r.image.width<=0||r.image.height<=0){r.image=false}}if(typeof i.status==="string"&&typeof s.FileStatus[i.status]!=="undefined"){r.status=i.status}if(typeof i.progress==="number"||typeof i.progress==="string"){r.progress=parseInt(i.progress)}if(typeof i.authorId==="number"||typeof i.authorId==="string"){r.authorId=parseInt(i.authorId)}if(typeof i.authorName==="string"||typeof i.authorName==="number"){r.authorName=i.authorName.toString()}if(typeof i.urlPreview==="string"){if(!i.urlPreview||i.urlPreview.startsWith("http")||i.urlPreview.startsWith("bx")||i.urlPreview.startsWith("file")||i.urlPreview.startsWith("blob")){r.urlPreview=i.urlPreview}else{r.urlPreview=a.host+i.urlPreview}}if(typeof i.urlDownload==="string"){if(!i.urlDownload||i.urlDownload.startsWith("http")||i.urlDownload.startsWith("bx")||i.urlPreview.startsWith("file")){r.urlDownload=i.urlDownload}else{r.urlDownload=a.host+i.urlDownload}}if(typeof i.urlShow==="string"){if(!i.urlShow||i.urlShow.startsWith("http")||i.urlShow.startsWith("bx")||i.urlShow.startsWith("file")){r.urlShow=i.urlShow}else{r.urlShow=a.host+i.urlShow}}if(babelHelpers.typeof(i.viewerAttrs)==="object"){if(r.type==="image"&&!n.Utils.platform.isBitrixMobile()){r.viewerAttrs=i.viewerAttrs}if(r.type==="video"&&!n.Utils.platform.isBitrixMobile()&&r.size>t.maxDiskFileSize){r.viewerAttrs=i.viewerAttrs}}return r}}],[{key:"getType",value:function e(t){t=t.toString().toLowerCase().split(".").splice(-1)[0];switch(t){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":return s.FileType.image;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":return s.FileType.video;case"mp3":return s.FileType.audio}return s.FileType.file}},{key:"getIconType",value:function e(t){var i="empty";switch(t.toString()){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":i="img";break;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":i="mov";break;case"txt":i="txt";break;case"doc":case"docx":i="doc";break;case"xls":case"xlsx":i="xls";break;case"php":i="php";break;case"pdf":i="pdf";break;case"ppt":case"pptx":i="ppt";break;case"rar":i="rar";break;case"zip":case"7z":case"tar":case"gz":case"gzip":i="zip";break;case"set":i="set";break;case"conf":case"ini":case"plist":i="set";break}return i}}]);return t}(r.VuexBuilderModel);babelHelpers.defineProperty(E,"maxDiskFileSize",5242880);var M=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"recent"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:[]}}},{key:"getElementState",value:function e(){return{id:0,templateId:"",template:s.TemplateTypes.item,chatType:s.ChatTypes.chat,sectionCode:s.RecentSection.general,avatar:"",color:"#048bd0",title:"",lines:{id:0,status:0},message:{id:0,text:"",date:new Date,senderId:0,status:s.MessageStatus.received},counter:0,pinned:false,chatId:0,userId:0}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(i){return function(e){if(o.Type.isNumber(e)){e=e.toString()}var i=t.findItem(e);if(i){return i}return false}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){var a=[];if(n instanceof Array){a=n.map(function(e){return t.prepareItem(e,{host:i.state.host})})}if(a.length===0){return false}a.forEach(function(e){var n=t.findItem(e.id);if(n){i.commit("update",{index:n.index,fields:e})}else{i.commit("add",{fields:e})}});i.state.collection.sort(t.sortListByMessageDate)},addPlaceholders:function e(t,i){i.forEach(function(e){t.commit("addPlaceholder",{fields:e})})},updatePlaceholders:function e(i,n){n.items=n.items.map(function(e){return t.prepareItem(e)});n.items.forEach(function(e,a){var r="placeholder"+(n.firstMessage+a);var o=t.findItem(r,"templateId");var s=t.findItem(e.id);if(s){i.commit("update",{index:s.index,fields:e});i.commit("delete",{index:o.index})}else{i.commit("update",{index:o.index,fields:e})}})},update:function e(i,n){if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(n.id);if(!a){return false}n.fields=t.validate(Object.assign({},n.fields));i.commit("update",{index:a.index,fields:n.fields});i.state.collection.sort(t.sortListByMessageDate)},pin:function e(i,n){if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(n.id);if(!a){return false}i.commit("update",{index:a.index,fields:Object.assign({},a.element,{pinned:n.action})});i.state.collection.sort(t.sortListByMessageDate)},clearPlaceholders:function e(t){t.commit("clearPlaceholders")},delete:function e(i,n){if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(n.id);if(!a){return false}i.commit("delete",{index:a.index});i.state.collection.sort(t.sortListByMessageDate)}}}},{key:"getMutations",value:function e(){var t=this;return{add:function e(i,n){i.collection.push(Object.assign({},t.getElementState(),n.fields))},update:function e(t,i){t.collection.splice(i.index,1,Object.assign({},t.collection[i.index],i.fields))},delete:function e(t,i){t.collection.splice(i.index,1)},addPlaceholder:function e(i,n){i.collection.push(Object.assign({},t.getElementState(),n.fields))},clearPlaceholders:function e(t){t.collection=t.collection.filter(function(e){return!e.id.toString().startsWith("placeholder")})}}}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};if(o.Type.isNumber(t.id)){a.id=t.id.toString()}if(o.Type.isStringFilled(t.id)){a.id=t.id}if(o.Type.isString(t.templateId)){a.templateId=t.templateId}if(o.Type.isString(t.template)){a.template=t.template}if(o.Type.isString(t.type)){if(t.type===s.ChatTypes.chat){if(t.chat.type===s.ChatTypes.open){a.chatType=s.ChatTypes.open}else if(t.chat.type===s.ChatTypes.chat){a.chatType=s.ChatTypes.chat}}else if(t.type===s.ChatTypes.user){a.chatType=s.ChatTypes.user}else if(t.type===s.ChatTypes.notification){a.chatType=s.ChatTypes.notification;t.title="Notifications"}else{a.chatType=s.ChatTypes.chat}}if(o.Type.isString(t.avatar)){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(o.Type.isString(t.color)){a.color=t.color}if(o.Type.isString(t.title)){a.title=t.title}if(o.Type.isPlainObject(t.message)){var l={};if(o.Type.isNumber(t.message.id)){l.id=t.message.id}if(o.Type.isString(t.message.text)){var c={};if(t.message.withAttach){c.WITH_ATTACH=true}else if(t.message.withFile){c.WITH_FILE=true}l.text=n.Utils.text.purify(t.message.text,c)}if(o.Type.isDate(t.message.date)||o.Type.isString(t.message.date)){l.date=t.message.date}if(o.Type.isNumber(t.message.author_id)){l.senderId=t.message.author_id}if(o.Type.isNumber(t.message.senderId)){l.senderId=t.message.senderId}if(o.Type.isStringFilled(t.message.status)){l.status=t.message.status}a.message=l}if(o.Type.isNumber(t.counter)){a.counter=t.counter}if(o.Type.isBoolean(t.pinned)){a.pinned=t.pinned}if(o.Type.isNumber(t.chatId)){a.chatId=t.chatId}if(o.Type.isNumber(t.userId)){a.userId=t.userId}return a}},{key:"sortListByMessageDate",value:function e(t,i){if(t.message&&i.message){var n=new Date(t.message.date).getTime();var a=new Date(i.message.date).getTime();return a-n}}},{key:"prepareItem",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t));return Object.assign({},this.getElementState(),n,i)}},{key:"findItem",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"id";var n={};if(i==="id"&&o.Type.isNumber(t)){t=t.toString()}var a=this.store.state.recent.collection.findIndex(function(e,n){return e[i]===t});if(a!==-1){n.index=a;n.element=this.store.state.recent.collection[a];return n}return false}}]);return t}(r.VuexBuilderModel);function w(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=L(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function L(e,t){if(!e)return;if(typeof e==="string")return A(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return A(e,t)}function A(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var O=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"notifications"}},{key:"getState",value:function e(){return{collection:[],searchCollection:[],chat_id:0,total:0,host:this.getVariable("host",location.protocol+"//"+location.host),unreadCounter:0,schema:{}}}},{key:"getElementState",value:function e(){return{id:0,authorId:0,date:new Date,text:"",sectionCode:s.NotificationTypesCodes.simple,textConverted:"",unread:false,display:true,settingName:"im|default"}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(){return t.collection}},getById:function e(i){return function(e){if(o.Type.isString(e)){e=parseInt(e)}var n=t.findItemInArr(i.collection,e);if(!n.element){return false}return n.element}},getSearchItemById:function e(i){return function(e){if(o.Type.isString(e)){e=parseInt(e)}var n=t.findItemInArr(i.searchCollection,e);if(!n.element){return false}return n.element}},getBlank:function e(i){return function(e){return t.getElementState()}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){var a={notification:[]};if(n.notification instanceof Array){a.notification=n.notification.map(function(e){return t.prepareNotification(e,{host:i.state.host})})}if(o.Type.isNumber(n.total)||o.Type.isString(n.total)){a.total=parseInt(n.total)}i.commit("set",a)},setSearchResults:function e(i,n){var a={notification:[]};if(!(n.notification instanceof Array)){return false}if(n.type==="local"){a.notification=n.notification}else{a.notification=n.notification.map(function(e){return t.prepareNotification(e,{host:i.state.host})})}i.commit("setSearchResults",{data:a})},deleteSearchResults:function e(t,i){t.commit("deleteSearchResults")},setCounter:function e(t,i){if(o.Type.isNumber(i.unreadTotal)||o.Type.isString(i.unreadTotal)){var n=parseInt(i.unreadTotal);t.commit("setCounter",n)}},setTotal:function e(t,i){if(o.Type.isNumber(i.total)||o.Type.isString(i.total)){t.commit("setTotal",i.total)}},add:function e(i,n){var a=t.prepareNotification(n.data,{host:i.state.host});a.unread=true;var r=t.findItemInArr(i.state.collection,a.id);if(!r.element){i.commit("add",{data:a});i.commit("setTotal",i.state.total+1)}else{i.commit("update",{index:r.index,fields:Object.assign({},n.fields)})}},updatePlaceholders:function e(i,n){if(n.items instanceof Array){n.items=n.items.map(function(e){return t.prepareNotification(e)})}else{return false}i.commit("updatePlaceholders",n);return true},clearPlaceholders:function e(t,i){t.commit("clearPlaceholders",i)},update:function e(i,n){var a=t.findItemInArr(i.state.collection,n.id);if(a.element){i.commit("update",{index:a.index,fields:Object.assign({},n.fields)})}if(n.searchMode){var r=t.findItemInArr(i.state.searchCollection,n.id);if(r.element){i.commit("update",{searchCollection:true,index:r.index,fields:Object.assign({},n.fields)})}}},read:function e(i,n){var a=w(n.ids),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;var s=t.findItemInArr(i.state.collection,o);if(!s.element){return false}i.commit("read",{index:s.index,action:!n.action})}}catch(e){a.e(e)}finally{a.f()}},readAll:function e(t,i){t.commit("readAll")},delete:function e(i,n){var a=t.findItemInArr(i.state.collection,n.id);if(a.element){i.commit("delete",{searchCollection:false,index:a.index});i.commit("setTotal",i.state.total-1)}if(n.searchMode){var r=t.findItemInArr(i.state.searchCollection,n.id);if(r.element){i.commit("delete",{searchCollection:true,index:r.index})}}},deleteAll:function e(t,i){t.commit("deleteAll")},setSchema:function e(t,i){t.commit("setSchema",{data:i.data})}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){i.total=n.hasOwnProperty("total")?n.total:i.total;if(!n.hasOwnProperty("notification")||!o.Type.isArray(n.notification)){return}var a=w(n.notification),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;var l=t.findItemInArr(i.collection,s.id);if(!l.element){i.collection.push(s)}else{if(s.unread!==i.collection[l.index].unread){s.unread=i.collection[l.index].unread;i.unreadCounter=s.unread===true?i.unreadCounter+1:i.unreadCounter-1}i.collection[l.index]=Object.assign(i.collection[l.index],s)}}}catch(e){a.e(e)}finally{a.f()}i.collection.sort(t.sortByType)},setSearchResults:function e(i,n){var a=w(n.data.notification),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;var s=t.findItemInArr(i.searchCollection,o.id);if(!s.element){i.searchCollection.push(o)}else{i.searchCollection[s.index]=Object.assign(i.searchCollection[s.index],o)}}}catch(e){a.e(e)}finally{a.f()}},deleteAll:function e(t,i){t.collection=[]},deleteSearchResults:function e(t,i){t.searchCollection=[]},add:function e(i,n){var a=null;if(n.data.sectionCode===s.NotificationTypesCodes.confirm){i.collection.unshift(n.data)}else{for(var r=0;i.collection.length>r;r++){if(i.collection[r].sectionCode===s.NotificationTypesCodes.simple){a=r;break}}if(a===null){i.collection.push(n.data)}else{i.collection.splice(a,0,n.data)}}i.collection.sort(t.sortByType)},update:function e(t,i){var n=i.searchCollection?"searchCollection":"collection";a.Vue.set(t[n],i.index,Object.assign({},t[n][i.index],i.fields))},delete:function e(t,i){var n=i.searchCollection?"searchCollection":"collection";t[n].splice(i.index,1)},read:function e(t,i){t.collection[i.index].unread=i.action},readAll:function e(t,i){for(var n=0;t.collection.length>n;n++){if(t.collection[n].sectionCode===s.NotificationTypesCodes.simple){t.collection[n].unread=false}}},updatePlaceholders:function e(i,n){var a=n.searchCollection?"searchCollection":"collection";n.items.forEach(function(e,t){var r="placeholder".concat(n.firstItem+t);var o=i[a].findIndex(function(e){return e.id===r});var s=i[a].findIndex(function(t){return t.id===e.id});if(s>=0){i[a][s]=Object.assign(i[a][s],e);i[a].splice(o,1)}else{i[a].splice(o,1,Object.assign({},e))}});i[a].sort(t.sortByType)},clearPlaceholders:function e(t,i){t.collection=t.collection.filter(function(e){return!e.id.toString().startsWith("placeholder")});t.searchCollection=t.searchCollection.filter(function(e){return!e.id.toString().startsWith("placeholder")})},setCounter:function e(t,i){t.unreadCounter=i},setTotal:function e(t,i){t.total=i},setSchema:function e(t,i){t.schema=i.data}}}},{key:"validate",value:function e(t,i){var a={};if(o.Type.isString(t.id)||o.Type.isNumber(t.id)){a.id=t.id}if(!o.Type.isNil(t.date)){a.date=n.Utils.date.cast(t.date)}if(o.Type.isString(t.textOriginal)||o.Type.isNumber(t.textOriginal)){a.text=t.textOriginal.toString();if(o.Type.isString(t.text)||o.Type.isNumber(t.text)){a.textConverted=this.convertToHtml({text:t.text.toString()})}}else{if(!o.Type.isNil(t.text_converted)){t.textConverted=t.text_converted}if(o.Type.isString(t.textConverted)||o.Type.isNumber(t.textConverted)){a.textConverted=t.textConverted.toString()}if(o.Type.isString(t.text)||o.Type.isNumber(t.text)){a.text=t.text.toString();var r=!o.Type.isNil(a.textConverted);a.textConverted=this.convertToHtml({text:r?a.textConverted:a.text})}}if(o.Type.isNumber(t.author_id)){if(t.system===true||t.system==="Y"){a.authorId=0}else{a.authorId=t.author_id}}if(o.Type.isNumber(t.userId)){a.authorId=t.userId}if(o.Type.isObjectLike(t.params)){var l=this.validateParams(t.params);if(l){a.params=l}}if(!o.Type.isNil(t.notify_buttons)){a.notifyButtons=JSON.parse(t.notify_buttons)}if(!o.Type.isNil(t.buttons)){a.notifyButtons=t.buttons.map(function(e){return{COMMAND:"notifyConfirm",COMMAND_PARAMS:"".concat(a.id,"|").concat(e.VALUE),TEXT:"".concat(e.TITLE),TYPE:"BUTTON",DISPLAY:"LINE",BG_COLOR:e.VALUE==="Y"?"#8bc84b":"#ef4b57",TEXT_COLOR:"#fff"}})}if(t.notify_type===s.NotificationTypesCodes.confirm||t.type===s.NotificationTypesCodes.confirm){a.sectionCode=s.NotificationTypesCodes.confirm}else if(t.type===s.NotificationTypesCodes.placeholder){a.sectionCode=s.NotificationTypesCodes.placeholder}if(!o.Type.isNil(t.notify_read)){a.unread=t.notify_read==="N"}if(!o.Type.isNil(t.read)){a.unread=t.read==="N"}if(o.Type.isString(t.setting_name)){a.settingName=t.setting_name}return a}},{key:"validateParams",value:function e(t){var i={};try{for(var a in t){if(!t.hasOwnProperty(a)){continue}if(a==="COMPONENT_ID"){if(o.Type.isString(t[a])&&BX.Vue.isComponent(t[a])){i[a]=t[a]}}else if(a==="LIKE"){if(t[a]instanceof Array){i["REACTION"]={like:t[a].map(function(e){return parseInt(e)})}}}else if(a==="CHAT_LAST_DATE"){i[a]=n.Utils.date.cast(t[a])}else if(a==="AVATAR"){if(t[a]){i[a]=t[a].startsWith("http")?t[a]:options.host+t[a]}}else if(a==="NAME"){if(t[a]){i[a]=t[a]}}else{i[a]=t[a]}}}catch(e){}var r=false;for(var s in i){if(!i.hasOwnProperty(s)){continue}r=true;break}return r?i:null}},{key:"prepareNotification",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t));return Object.assign({},this.getElementState(),n,i)}},{key:"findItemInArr",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"id";var a={};var r=t.findIndex(function(e,t){return e[n]===i});if(r!==-1){a.index=r;a.element=t[r]}return a}},{key:"sortByType",value:function e(t,i){if(t.sectionCode===s.NotificationTypesCodes.confirm&&i.sectionCode!==s.NotificationTypesCodes.confirm){return-1}else if(t.sectionCode!==s.NotificationTypesCodes.confirm&&i.sectionCode===s.NotificationTypesCodes.confirm){return 1}else{return i.id-t.id}}},{key:"convertToHtml",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var a=i.text,r=a===void 0?"":a;r=r.trim();r=r.replace(/\n/gi,"<br />");r=r.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");r=t.decodeBbCode({text:r});if(n.Utils.platform.isBitrixDesktop()){r=r.replace(/<a(.*?)>(.*?)<\/a>/gi,function(e,t,i){return"<a"+t.replace('target="_self"','target="_blank"')+' class="bx-im-notifications-item-link">'+i+"</a>"})}return r}}],[{key:"decodeBbCode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.text;i=i.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,function(e,t,i){var a=document.createElement("a");a.href=n.Utils.text.htmlspecialcharsback(t);a.target="_blank";a.text=n.Utils.text.htmlspecialcharsback(i);var r=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(r.indexOf(a.protocol)<=-1){return e}return a.outerHTML});i=i.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');i=i.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');i=i.replace(/\[RATING\=([1-5]{1})\]/gi,function(e,t){return BX.MessengerCommon.linesVoteHeadNodes(0,t,false).outerHTML});i=i.replace(/\[BR\]/gi,"<br/>");i=i.replace(/\[([buis])\](.*?)\[(\/[buis])\]/gi,function(e,t,i,n){return"<"+t+">"+i+"<"+n+">"});i=i.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,n){i=parseInt(i);if(i<=0){return n}if(t){return'<span class="bx-im-mention" data-type="OPENLINES" data-value="'+i+'">'+n+"</span>"}else{return'<span class="bx-im-mention" data-type="CHAT" data-value="'+i+'">'+n+"</span>"}});i=i.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(e,t,i){var n="";t=parseInt(t);if(t>0&&typeof BXIM!="undefined"){n='<span class="bx-im-mention '.concat(t===+BXIM.userId?"bx-messenger-ajax-self":"",'" data-type="USER" data-value="').concat(t,'">').concat(i,"</span>")}else{n=i}return n});i=i.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});return i}}]);return t}(r.VuexBuilderModel);var N=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"call"}},{key:"getState",value:function e(){return{users:{}}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{id:t.id?t.id:0,state:s.ConferenceUserState.Idle,talking:false,pinned:false,cameraState:false,microphoneState:false,screenState:false,floorRequestState:false}}},{key:"getGetters",value:function e(){var t=this;return{getUser:function e(i){return function(e){e=parseInt(e,10);if(!i.users[e]){return t.getElementState({id:e})}return i.users[e]}},getBlankUser:function e(i){return function(e){e=parseInt(e,10);return t.getElementState({id:e})}}}}},{key:"getActions",value:function e(){var t=this;return{updateUser:function e(i,n){n.id=parseInt(n.id,10);n.fields=Object.assign({},t.validate(n.fields));i.commit("updateUser",n)},unpinUser:function e(t,i){t.commit("unpinUser")}}}},{key:"getMutations",value:function e(){var t=this;return{updateUser:function e(i,n){if(!i.users[n.id]){a.Vue.set(i.users,n.id,Object.assign(t.getElementState(),n.fields,{id:n.id}))}else{i.users[n.id]=Object.assign(i.users[n.id],n.fields)}},unpinUser:function e(t,i){var n=Object.values(t.users).find(function(e){return e.pinned===true});if(n){t.users[n.id].pinned=false}}}}},{key:"validate",value:function e(t){var i={};if(o.Type.isNumber(t.id)||o.Type.isString(t.id)){i.id=parseInt(t.id,10)}if(s.ConferenceUserState[t.state]){i.state=t.state}if(o.Type.isBoolean(t.talking)){i.talking=t.talking}if(o.Type.isBoolean(t.pinned)){i.pinned=t.pinned}if(o.Type.isBoolean(t.cameraState)){i.cameraState=t.cameraState}if(o.Type.isBoolean(t.microphoneState)){i.microphoneState=t.microphoneState}if(o.Type.isBoolean(t.screenState)){i.screenState=t.screenState}if(o.Type.isBoolean(t.floorRequestState)){i.floorRequestState=t.floorRequestState}return i}},{key:"getStateSaveException",value:function e(){return{users:false}}}]);return t}(r.VuexBuilderModel);e.ApplicationModel=l;e.ConferenceModel=c;e.MessagesModel=h;e.DialoguesModel=v;e.UsersModel=C;e.FilesModel=E;e.RecentModel=M;e.NotificationsModel=O;e.CallModel=N})(this.BX.Messenger.Model=this.BX.Messenger.Model||{},BX.Messenger.Lib,BX.Event,BX.Messenger.Lib,BX,BX,BX,BX.Messenger.Const);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/local/js/im/provider/pull/dist/registry.bundle.min.js?165475981718727";s:6:"source";s:50:"/local/js/im/provider/pull/dist/registry.bundle.js";s:3:"min";s:54:"/local/js/im/provider/pull/dist/registry.bundle.min.js";s:3:"map";s:54:"/local/js/im/provider/pull/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.Provider=this.BX.Messenger.Provider||{};(function(e,t,s,a,i,n){"use strict";var r=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.controller)==="object"&&t.controller){this.controller=t.controller}if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}this.option=babelHelpers.typeof(t.store)==="object"&&t.store?t.store:{};if(!(babelHelpers.typeof(this.option.handlingDialog)==="object"&&this.option.handlingDialog&&this.option.handlingDialog.chatId&&this.option.handlingDialog.dialogId)){this.option.handlingDialog=false}}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}},{key:"getSubscriptionType",value:function e(){return n.PullClient.SubscriptionType.Server}},{key:"skipExecute",value:function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!s.optionImportant){if(this.option.skip){a.Logger.info("Pull: command skipped while loading messages",t);return true}if(!this.option.handlingDialog){return false}}if(typeof t.chatId!=="undefined"||typeof t.dialogId!=="undefined"){if(typeof t.chatId!=="undefined"&&parseInt(t.chatId)===parseInt(this.option.handlingDialog.chatId)){return false}if(typeof t.dialogId!=="undefined"&&t.dialogId.toString()===this.option.handlingDialog.dialogId.toString()){return false}return true}return false}},{key:"handleMessage",value:function e(t,s){this.handleMessageAdd(t,s)}},{key:"handleMessageChat",value:function e(t,s){this.handleMessageAdd(t,s)}},{key:"handleMessageAdd",value:function e(n,r){var o=this;a.Logger.warn("handleMessageAdd",n);if(this.skipExecute(n,r)){return false}var d=this.store.state.messages.collection[n.chatId];if(!d){d=[]}var l=d.find(function(e){if(n.message.templateId&&e.id===n.message.templateId){return true}return e.id===n.message.id});if(l&&n.message.push){return false}if(n.chat&&n.chat[n.chatId]){var c=this.store.getters["dialogues/getByChatId"](n.chatId);if(!c){var u=Object.assign({},n.chat[n.chatId],{dialogId:n.dialogId});this.store.dispatch("dialogues/set",u)}else{this.store.dispatch("dialogues/update",{dialogId:n.dialogId,fields:n.chat[n.chatId]})}}var h=this.store.getters["recent/get"](n.dialogId);if(!h){var f=this.prepareRecentItem(n);this.store.dispatch("recent/set",[f])}else{this.store.dispatch("recent/update",{id:n.dialogId,fields:{lines:n.lines||{id:0},message:{id:n.message.id,text:n.message.textOriginal,date:n.message.date,senderId:n.message.senderId,withFile:typeof n.message.params["FILE_ID"]!=="undefined",withAttach:typeof n.message.params["ATTACH"]!=="undefined"},counter:n.counter}})}if(n.users){this.store.dispatch("users/set",t.VuexBuilderModel.convertToArray(n.users))}if(n.files){var p=this.controller.application.prepareFilesBeforeSave(t.VuexBuilderModel.convertToArray(n.files));p.forEach(function(e){if(p.length===1&&n.message.templateFileId&&o.store.state.files.index[n.chatId]&&o.store.state.files.index[n.chatId][n.message.templateFileId]){o.store.dispatch("files/update",{id:n.message.templateFileId,chatId:n.chatId,fields:e}).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:n.chatId,cancelIfScrollChange:true})})}else{o.store.dispatch("files/set",e)}})}if(l){a.Logger.warn("New message pull handler: we already have this message",n.message);this.store.dispatch("messages/update",{id:l.id,chatId:l.chatId,fields:babelHelpers.objectSpread({},n.message,{sending:false,error:false})}).then(function(){if(!n.message.push){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:l.chatId,cancelIfScrollChange:n.message.senderId!==o.controller.application.getUserId()})}})}else if(this.controller.application.isUnreadMessagesLoaded()){a.Logger.warn("New message pull handler: we dont have this message",n.message);this.store.dispatch("messages/setAfter",babelHelpers.objectSpread({},n.message,{unread:true})).then(function(){if(!n.message.push){i.EventEmitter.emit(s.EventType.dialog.newMessage,{chatId:n.message.chatId,messageId:n.message.id})}})}this.controller.application.stopOpponentWriting({dialogId:n.dialogId,userId:n.message.senderId});if(n.message.senderId===this.controller.application.getUserId()&&this.controller.application.isUnreadMessagesLoaded()){if(this.store.state.dialogues.collection[n.dialogId]&&this.store.state.dialogues.collection[n.dialogId].counter!==0){this.controller.restClient.callMethod("im.dialog.read",{dialog_id:n.dialogId}).then(function(){o.store.dispatch("messages/readMessages",{chatId:n.chatId}).then(function(e){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:n.chatId,cancelIfScrollChange:false});o.store.dispatch("dialogues/update",{dialogId:n.dialogId,fields:{counter:0}})})})}}else if(n.message.senderId!==this.controller.application.getUserId()){this.store.dispatch("dialogues/increaseCounter",{dialogId:n.dialogId,count:1})}this.store.dispatch("dialogues/update",{dialogId:n.dialogId,fields:{lastMessageId:n.message.id}});this.store.dispatch("dialogues/increaseMessageCounter",{dialogId:n.dialogId,count:1})}},{key:"handleMessageUpdate",value:function e(t,s,a){this.execMessageUpdateOrDelete(t,s,a)}},{key:"handleMessageDelete",value:function e(t,s,a){this.execMessageUpdateOrDelete(t,s,a)}},{key:"execMessageUpdateOrDelete",value:function e(t,a,n){if(this.skipExecute(t,a)){return false}this.controller.application.stopOpponentWriting({dialogId:t.dialogId,userId:t.senderId});this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{text:n==="messageUpdate"?t.text:"",textOriginal:n==="messageUpdate"?t.textOriginal:"",params:t.params,blink:true}}).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:t.chatId,cancelIfScrollChange:true})});var r=this.store.getters["recent/get"](t.dialogId);if(n==="messageUpdate"&&r.element&&r.element.message.id===t.id){this.store.dispatch("recent/update",{id:t.dialogId,fields:{message:{id:t.id,text:t.text,date:r.element.message.date}}})}if(n==="messageDelete"&&r.element&&r.element.message.id===t.id){this.store.dispatch("recent/update",{id:t.dialogId,fields:{message:{id:t.id,text:"Message deleted",date:r.element.message.date}}})}}},{key:"handleMessageDeleteComplete",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("messages/delete",{id:t.id,chatId:t.chatId});this.controller.application.stopOpponentWriting({dialogId:t.dialogId,userId:t.senderId,action:false})}},{key:"handleMessageLike",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{params:{LIKE:t.users}}})}},{key:"handleChatOwner",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{ownerId:t.userId}})}},{key:"handleChatManagers",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{managerList:t.list}})}},{key:"handleChatUpdateParams",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:t.params})}},{key:"handleChatUserAdd",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{userCounter:t.userCount}})}},{key:"handleChatUserLeave",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{userCounter:t.userCount}})}},{key:"handleMessageParamsUpdate",value:function e(t,a){if(this.skipExecute(t,a)){return false}this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{params:t.params}}).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:t.chatId,cancelIfScrollChange:true})})}},{key:"handleStartWriting",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.controller.application.startOpponentWriting(t)}},{key:"handleReadMessage",value:function e(t,s){var a=this;if(this.skipExecute(t,s)){return false}this.store.dispatch("messages/readMessages",{chatId:t.chatId,readId:t.lastId}).then(function(e){a.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{counter:t.counter}})});this.store.dispatch("recent/update",{id:t.dialogId,fields:{counter:t.counter}})}},{key:"handleReadMessageChat",value:function e(t,s){this.handleReadMessage(t,s)}},{key:"handleReadMessageOpponent",value:function e(t,s){this.execReadMessageOpponent(t,s)}},{key:"handleReadMessageChatOpponent",value:function e(t,s){this.execReadMessageOpponent(t,s)}},{key:"execReadMessageOpponent",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/updateReaded",{dialogId:t.dialogId,userId:t.userId,userName:t.userName,messageId:t.lastId,date:t.date,action:true});var a=this.store.getters["recent/get"](t.dialogId);if(a){var i=a.element.message;this.store.dispatch("recent/update",{id:t.dialogId,fields:{counter:t.counter,message:babelHelpers.objectSpread({},i,{status:"delivered"})}})}}},{key:"handleUnreadMessageOpponent",value:function e(t,s){this.execUnreadMessageOpponent(t,s)}},{key:"handleUnreadMessageChatOpponent",value:function e(t,s){this.execUnreadMessageOpponent(t,s)}},{key:"execUnreadMessageOpponent",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/updateReaded",{dialogId:t.dialogId,userId:t.userId,action:false})}},{key:"handleFileUpload",value:function e(a,n){if(this.skipExecute(a,n)){return false}this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(t.VuexBuilderModel.convertToArray({file:a.fileParams}))).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{cancelIfScrollChange:true})})}},{key:"handleChatPin",value:function e(t,s){this.store.dispatch("recent/pin",{id:t.dialogId,action:t.active})}},{key:"handleChatHide",value:function e(t,s){this.store.dispatch("recent/delete",{id:t.dialogId})}},{key:"handleChatMuteNotify",value:function e(t,s){var a=this.store.getters["dialogues/get"](t.dialogId);if(!a){return false}var i=a.muteList;var n=[];var r=this.store.state.application.common.userId;if(t.mute){n=[].concat(babelHelpers.toConsumableArray(i),[r])}else{n=i.filter(function(e){return e!==r})}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{muteList:n}})}},{key:"handleReadNotifyList",value:function e(t,s){this.store.dispatch("recent/update",{id:"notify",fields:{counter:t.counter}})}},{key:"handleUserInvite",value:function e(t,s){if(!t.invited){this.store.dispatch("users/update",{id:t.userId,fields:t.user})}}},{key:"prepareRecentItem",value:function e(t){var s="user";if(t.dialogId.toString().startsWith("chat")){s="chat"}t.dialogId.toString().startsWith("chat");var a=s==="chat"?t.chat[t.chatId].name:t.users[t.dialogId].name;var i=t.chat[t.chatId]?t.chat[t.chatId]:{};if(!t.users){t.users={}}var n=t.users[t.dialogId]?t.users[t.dialogId]:{};var r=s==="user"?t.dialogId:0;return{id:t.dialogId,type:s,title:a,counter:t.counter,chatId:t.chatId,chat:i,user:n,userId:r,message:{id:t.message.id,text:t.message.textOriginal,date:t.message.date,senderId:t.message.senderId,withFile:typeof t.message.params["FILE_ID"]!=="undefined",withAttach:typeof t.message.params["ATTACH"]!=="undefined"}}}}]);return e}();var o=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.application)==="object"&&t.application){this.application=t.application}if(babelHelpers.typeof(t.controller)==="object"&&t.controller){this.controller=t.controller}if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}this.option=babelHelpers.typeof(t.store)==="object"&&t.store?t.store:{}}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}},{key:"getSubscriptionType",value:function e(){return n.PullClient.SubscriptionType.Server}},{key:"handleChatUserAdd",value:function e(t){var s=Object.values(t.users).map(function(e){return babelHelpers.objectSpread({},e,{lastActivityDate:new Date})});this.store.commit("conference/common",{userCount:t.userCount});this.store.dispatch("users/set",s);this.store.dispatch("conference/setUsers",{users:s.map(function(e){return e.id})})}},{key:"handleChatUserLeave",value:function e(t){if(t.userId===this.controller.getUserId()&&t.dialogId===this.store.state.application.dialog.dialogId){this.application.kickFromCall()}this.store.commit("conference/common",{userCount:t.userCount});this.store.dispatch("conference/removeUsers",{users:[t.userId]})}},{key:"handleCallUserNameUpdate",value:function e(t){var s=this.store.getters["users/get"](t.userId);if(!s){this.store.dispatch("users/set",{id:t.userId,lastActivityDate:new Date})}this.store.dispatch("users/update",{id:t.userId,fields:{name:t.name,lastActivityDate:new Date}})}},{key:"handleVideoconfShareUpdate",value:function e(t){if(t.dialogId===this.store.state.application.dialog.dialogId){this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{public:{code:t.newCode,link:t.newLink}}});this.application.changeVideoconfUrl(t.newLink)}}},{key:"handleMessageChat",value:function e(t){this.application.sendNewMessageNotify(t)}},{key:"handleChatRename",value:function e(t){if(t.chatId!==this.application.getChatId()){return false}this.store.dispatch("conference/setConferenceTitle",{conferenceTitle:t.name})}},{key:"handleConferenceUpdate",value:function e(t){if(t.chatId!==this.application.getChatId()){return false}if(t.isBroadcast!==""){this.store.dispatch("conference/setBroadcastMode",{broadcastMode:t.isBroadcast})}if(t.presenters.length>0){this.store.dispatch("conference/setPresenters",{presenters:t.presenters,replace:true})}}}]);return e}();function d(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=l(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,r=false,o;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();n=t.done;return t},e:function e(t){r=true;o=t},f:function e(){try{if(!n&&s.return!=null)s.return()}finally{if(r)throw o}}}}function l(e,t){if(!e)return;if(typeof e==="string")return c(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return c(e,t)}function c(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}var u=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.application)==="object"&&t.application){this.application=t.application}if(babelHelpers.typeof(t.controller)==="object"&&t.controller){this.controller=t.controller}if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}this.option=babelHelpers.typeof(t.store)==="object"&&t.store?t.store:{}}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}},{key:"getSubscriptionType",value:function e(){return n.PullClient.SubscriptionType.Server}},{key:"handleNotifyAdd",value:function e(t,s){if(s.server_time_ago>30||t.onlyFlash===true){return false}var a=this.store.getters["users/get"](t.userId);if(!a){var i=[];i.push({id:t.userId,avatar:t.userAvatar,color:t.userColor,name:t.userName});this.store.dispatch("users/set",i)}this.store.dispatch("notifications/add",{data:t});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.store.dispatch("recent/update",{id:"notify",fields:{message:{id:t.id,text:t.text,date:t.date},counter:t.counter}})}},{key:"handleNotifyConfirm",value:function e(t,s){if(s.server_time_ago>30){return false}this.store.dispatch("notifications/delete",{id:t.id});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.updateRecentListOnDelete(t.counter)}},{key:"handleNotifyRead",value:function e(t,s){var a=this;if(s.server_time_ago>30){return false}t.list.forEach(function(e){a.store.dispatch("notifications/read",{ids:[e],action:true})});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.store.dispatch("recent/update",{id:"notify",fields:{counter:t.counter}})}},{key:"handleNotifyUnread",value:function e(t,s){var a=this;if(s.server_time_ago>30){return false}t.list.forEach(function(e){a.store.dispatch("notifications/read",{ids:[e],action:false})});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.store.dispatch("recent/update",{id:"notify",fields:{counter:t.counter}})}},{key:"handleNotifyDelete",value:function e(t,s){var a=this;if(s.server_time_ago>30){return false}var i=Object.keys(t.id).map(function(e){return parseInt(e,10)});i.forEach(function(e){a.store.dispatch("notifications/delete",{id:e})});this.updateRecentListOnDelete(t.counter);this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter})}},{key:"updateRecentListOnDelete",value:function e(t){var s;var a=this.getLatest();if(a!==null){s={id:a.id,text:a.text,date:a.date}}else{var i=this.store.getters["recent/get"]("notify");if(i===false){return}s=i.element.message;s.text=this.controller.localize["IM_NOTIFICATIONS_DELETED_ITEM_STUB"]}this.store.dispatch("recent/update",{id:"notify",fields:{message:s,counter:t}})}},{key:"getLatest",value:function e(){var t={id:0};var s=d(this.store.state.notifications.collection),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i.id>t.id){t=i}}}catch(e){s.e(e)}finally{s.f()}if(t.id===0){return null}return t}}]);return e}();e.ImBasePullHandler=r;e.ImCallPullHandler=o;e.ImNotificationsPullHandler=u})(this.BX.Messenger.Provider.Pull=this.BX.Messenger.Provider.Pull||{},BX,BX.Messenger.Const,BX.Messenger.Lib,BX.Event,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:69:"/local/js/im/provider/rest/dist/registry.bundle.min.js?16547598175400";s:6:"source";s:50:"/local/js/im/provider/rest/dist/registry.bundle.js";s:3:"min";s:54:"/local/js/im/provider/rest/dist/registry.bundle.min.js";s:3:"map";s:54:"/local/js/im/provider/rest/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.Provider=this.BX.Messenger.Provider||{};(function(e,s,t,i,a){"use strict";var r=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(s)}}]);function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(s.controller)==="object"&&s.controller){this.controller=s.controller}if(babelHelpers.typeof(s.store)==="object"&&s.store){this.store=s.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(s,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};s="handle"+s.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(t.error()){if(typeof this[s+"Error"]==="function"){return this[s+"Error"](t.error(),i)}}else{if(typeof this[s+"Success"]==="function"){return this[s+"Success"](t.data(),i)}}return typeof this[s]==="function"?this[s](t,i):null}}]);return e}();var l=function(e){babelHelpers.inherits(r,e);function r(){babelHelpers.classCallCheck(this,r);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).apply(this,arguments))}babelHelpers.createClass(r,[{key:"handleImUserListGetSuccess",value:function e(t){this.store.dispatch("users/set",s.VuexBuilderModel.convertToArray(t))}},{key:"handleImUserGetSuccess",value:function e(s){this.store.dispatch("users/set",[s])}},{key:"handleImChatGetSuccess",value:function e(s){this.store.dispatch("dialogues/set",s)}},{key:"handleImDialogMessagesGetSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/setBefore",this.controller.application.prepareFilesBeforeSave(s.files))}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files));if(s.messages.length===0&&s.chat_id){i.Logger.warn("setting messagesSet for empty chat",s.chat_id);setTimeout(function(){a.EventEmitter.emit(t.EventType.dialog.messagesSet,{chatId:s.chat_id})},100)}else{this.store.dispatch("messages/set",s.messages.reverse())}}},{key:"handleImDialogMessagesGetUnreadSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files))}},{key:"handleImDiskFolderGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{diskFolderId:s.ID}})}},{key:"handleImMessageAddSuccess",value:function e(s,t){var i=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s,sending:false,error:false}}).then(function(){i.store.dispatch("messages/actionFinish",{id:s,chatId:t.chatId})})}},{key:"handleImMessageAddError",value:function e(s,t){this.store.dispatch("messages/actionError",{id:t.id,chatId:t.chatId})}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){var i=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s["MESSAGE_ID"],sending:false,error:false}}).then(function(){i.store.dispatch("messages/actionFinish",{id:s["MESSAGE_ID"],chatId:t.chatId})})}},{key:"handleImDiskFileCommitError",value:function e(s,i){this.store.dispatch("files/update",{chatId:i.chatId,id:i.file.id,fields:{status:t.FileStatus.error,progress:0}});this.store.dispatch("messages/actionError",{id:i.id,chatId:i.chatId,retry:false})}},{key:"handleImRecentListSuccess",value:function e(s,t){i.Logger.warn("Provider.Rest.handleImRecentGetSuccess",s);var a=[];var r=[];var l=[];s.items.forEach(function(e){var s=0;var t=0;if(e.user&&e.user.id>0){s=e.user.id;a.push(e.user)}if(e.chat){t=e.chat.id;r.push(Object.assign(e.chat,{dialogId:e.id}))}else{r.push(Object.assign({},{dialogId:e.id}))}l.push(babelHelpers.objectSpread({},e,{avatar:e.avatar.url,color:e.avatar.color,userId:s,chatId:t}))});this.store.dispatch("users/set",a);this.store.dispatch("dialogues/set",r);this.store.dispatch("recent/set",l)}}]);return r}(r);var n=function(e){babelHelpers.inherits(s,e);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,e));t.application=e.application;return t}babelHelpers.createClass(s,[{key:"handleImChatGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{chatId:s.id,dialogId:s.dialog_id,diskFolderId:s.disk_folder_id}})}},{key:"handleImCallGetCallLimitsSuccess",value:function e(s){this.store.commit("application/set",{call:{serverEnabled:s.callServerEnabled,maxParticipants:s.maxParticipants}})}},{key:"handleImChatGetError",value:function e(s){if(s.ex.error==="ACCESS_ERROR"){i.Logger.error("MobileRestAnswerHandler.handleImChatGetError: ACCESS_ERROR")}}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){}},{key:"handleImMessageAddSuccess",value:function e(s,t){console.warn("im.message.add success in dialog handler")}},{key:"handleImMessageAddError",value:function e(s,t){}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){}}]);return s}(r);e.BaseRestHandler=r;e.CoreRestHandler=l;e.DialogRestHandler=n})(this.BX.Messenger.Provider.Rest=this.BX.Messenger.Provider.Rest||{},BX,BX.Messenger.Const,BX.Messenger.Lib,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:62:"/local/js/im/lib/timer/dist/timer.bundle.min.js?16547598172172";s:6:"source";s:43:"/local/js/im/lib/timer/dist/timer.bundle.js";s:3:"min";s:47:"/local/js/im/lib/timer/dist/timer.bundle.min.js";s:3:"map";s:47:"/local/js/im/lib/timer/dist/timer.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t){"use strict";var e=function(){function t(){babelHelpers.classCallCheck(this,t);this.list={};this.updateInterval=1e3;clearInterval(this.updateIntervalId);this.updateIntervalId=setInterval(this.worker.bind(this),this.updateInterval)}babelHelpers.createClass(t,[{key:"start",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var l=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};i=i==null?"default":i;n=parseFloat(n);if(isNaN(n)||n<=0){return false}n=n*1e3;if(typeof this.list[e]==="undefined"){this.list[e]={}}this.list[e][i]={dateStop:(new Date).getTime()+n,callback:typeof s==="function"?s:function(){},callbackParams:l};return true}},{key:"has",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";i=i==null?"default":i;if(i.toString().length<=0||typeof this.list[e]==="undefined"){return false}return!!this.list[e][i]}},{key:"stop",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";var n=arguments.length>2?arguments[2]:undefined;i=i==null?"default":i;if(i.toString().length<=0||typeof this.list[e]==="undefined"){return false}if(!this.list[e][i]){return true}if(n!==true){this.list[e][i]["callback"](i,this.list[e][i]["callbackParams"])}delete this.list[e][i];return true}},{key:"stopAll",value:function t(e){for(var i in this.list){if(this.list.hasOwnProperty(i)){for(var n in this.list[i]){if(this.list[i].hasOwnProperty(n)){this.stop(i,n,e)}}}}return true}},{key:"worker",value:function t(){for(var e in this.list){if(!this.list.hasOwnProperty(e)){continue}for(var i in this.list[e]){if(!this.list[e].hasOwnProperty(i)||this.list[e][i]["dateStop"]>new Date){continue}this.stop(e,i)}}return true}},{key:"clean",value:function t(){clearInterval(this.updateIntervalId);this.stopAll(true);return true}}]);return t}();t.Timer=e})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:69:"/local/js/im/controller/dist/controller.bundle.min.js?165475981720247";s:6:"source";s:49:"/local/js/im/controller/dist/controller.bundle.js";s:3:"min";s:53:"/local/js/im/controller/dist/controller.bundle.min.js";s:3:"map";s:53:"/local/js/im/controller/dist/controller.bundle.map.js";}"*/
this.BX=this.BX||{};(function(e,t,i,s,n,a,r,o,l,u,d,c){"use strict";var h=function(){function e(){babelHelpers.classCallCheck(this,e);this.controller=null;this.timer=new o.Timer;this._prepareFilesBeforeSave=function(e){return e};this.defaultMessageLimit=50;this.requestMessageLimit=this.getDefaultMessageLimit();this.messageLastReadId={};this.messageReadQueue={}}babelHelpers.createClass(e,[{key:"setCoreController",value:function e(t){this.controller=t}},{key:"getSiteId",value:function e(){return this.controller.getStore().state.application.common.siteId}},{key:"getUserId",value:function e(){return this.controller.getStore().state.application.common.userId}},{key:"getLanguageId",value:function e(){return this.controller.getStore().state.application.common.languageId}},{key:"getCurrentUser",value:function e(){return this.controller.getStore().getters["users/get"](this.controller.getStore().state.application.common.userId,true)}},{key:"getChatId",value:function e(){return this.controller.getStore().state.application.dialog.chatId}},{key:"getDialogId",value:function e(){return this.controller.getStore().state.application.dialog.dialogId}},{key:"getData",value:function e(){return this.controller.getStore().state.application}},{key:"getDialogData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();if(this.controller.getStore().state.dialogues.collection[t]){return this.controller.getStore().state.dialogues.collection[t]}return this.controller.getStore().getters["dialogues/getBlank"]()}},{key:"getDialogCrmData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();var i={enabled:false,entityType:l.DialogCrmType.none,entityId:0};var s=this.getDialogData(t);if(s.type===l.DialogType.call){if(s.entityData1&&typeof s.entityData1==="string"){var n=s.entityData1.split("|"),a=babelHelpers.slicedToArray(n,3),r=a[0],o=a[1],u=a[2];if(r){o=o?o.toString().toLowerCase():l.DialogCrmType.none;i={enabled:r,entityType:o,entityId:u}}}}else if(s.type===l.DialogType.crm){var d=s.entityId.split("|"),c=babelHelpers.slicedToArray(d,2),h=c[0],g=c[1];h=h?h.toString().toLowerCase():l.DialogCrmType.none;i={enabled:true,entityType:h,entityId:g}}return i}},{key:"getDialogIdByChatId",value:function e(t){if(this.getDialogId()==="chat"+t){return this.getDialogId()}var i=this.controller.getStore().getters["dialogues/getByChatId"](t);if(!i){return 0}return i.dialogId}},{key:"getDiskFolderId",value:function e(){return this.controller.getStore().state.application.dialog.diskFolderId}},{key:"getDefaultMessageLimit",value:function e(){return this.defaultMessageLimit}},{key:"getRequestMessageLimit",value:function e(){return this.requestMessageLimit}},{key:"muteDialog",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.getDialogId();if(u.Utils.dialog.isEmptyDialogId(s)){return false}if(i===null){i=!this.isDialogMuted()}this.timer.start("muteDialog",s,.3,function(e){t.controller.restClient.callMethod(l.RestMethod.imChatMute,{DIALOG_ID:s,ACTION:i?"Y":"N"})});var n=[];if(i){n=this.getDialogData().muteList;n.push(this.getUserId())}else{n=this.getDialogData().muteList.filter(function(e){return e!==t.getUserId()})}this.controller.getStore().dispatch("dialogues/update",{dialogId:s,fields:{muteList:n}});return true}},{key:"isDialogMuted",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();return this.getDialogData().muteList.includes(this.getUserId())}},{key:"isUnreadMessagesLoaded",value:function e(){var t=this.controller.getStore().state.dialogues.collection[this.getDialogId()];if(!t){return true}if(t.lastMessageId<=0){return true}var i=this.controller.getStore().state.messages.collection[this.getChatId()];if(!i||i.length<=0){return true}var s=0;for(var n=i.length-1;n>=0;n--){var a=i[n];if(typeof a.id==="number"){s=a.id;break}}return s>=t.lastMessageId}},{key:"prepareFilesBeforeSave",value:function e(t){return this._prepareFilesBeforeSave(t)}},{key:"setPrepareFilesBeforeSaveFunction",value:function e(t){this._prepareFilesBeforeSave=t.bind(this)}},{key:"showSmiles",value:function e(){this.store.dispatch("application/showSmiles")}},{key:"hideSmiles",value:function e(){this.store.dispatch("application/hideSmiles")}},{key:"startOpponentWriting",value:function e(t){var i=this;var s=t.dialogId,n=t.userId,a=t.userName;this.controller.getStore().dispatch("dialogues/updateWriting",{dialogId:s,userId:n,userName:a,action:true});this.timer.start("writingEnd",s+"|"+n,35,function(e,t){var s=t.dialogId,n=t.userId;i.controller.getStore().dispatch("dialogues/updateWriting",{dialogId:s,userId:n,action:false})},{dialogId:s,userId:n});return true}},{key:"stopOpponentWriting",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.dialogId,s=t.userId,n=t.userName;this.timer.stop("writingStart",i+"|"+s,true);this.timer.stop("writingEnd",i+"|"+s);return true}},{key:"startWriting",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();if(u.Utils.dialog.isEmptyDialogId(i)||this.timer.has("writes",i)){return false}this.timer.start("writes",i,28);this.timer.start("writesSend",i,5,function(e){t.controller.restClient.callMethod(l.RestMethod.imDialogWriting,{DIALOG_ID:i}).catch(function(){t.timer.stop("writes",i)})})}},{key:"stopWriting",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();this.timer.stop("writes",t,true);this.timer.stop("writesSend",t,true)}},{key:"joinParentChat",value:function e(t,i){var s=this;return new Promise(function(e,n){if(!t||!i){return n()}if(typeof s.tempJoinChat==="undefined"){s.tempJoinChat={}}else if(s.tempJoinChat["wait"]){return n()}s.tempJoinChat["wait"]=true;s.controller.restClient.callMethod(l.RestMethod.imChatParentJoin,{DIALOG_ID:i,MESSAGE_ID:t}).then(function(){s.tempJoinChat["wait"]=false;s.tempJoinChat[i]=true;return e(i)}).catch(function(){s.tempJoinChat["wait"]=false;return n()})})}},{key:"setTextareaMessage",value:function e(t){var i=t.message,s=i===void 0?"":i,n=t.dialogId,a=n===void 0?this.getDialogId():n;this.controller.getStore().dispatch("dialogues/update",{dialogId:a,fields:{textareaMessage:s}})}},{key:"setSendingMessageFlag",value:function e(t){this.controller.getStore().dispatch("messages/actionStart",{id:t,chatId:this.getChatId()})}},{key:"reactMessage",value:function e(t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"auto";this.controller.restClient.callMethod(l.RestMethod.imMessageLike,{MESSAGE_ID:t,ACTION:i==="auto"?"auto":i==="set"?"plus":"minus"})}},{key:"readMessage",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var a=this.getChatId();if(typeof this.messageLastReadId[a]==="undefined"){this.messageLastReadId[a]=null}if(typeof this.messageReadQueue[a]==="undefined"){this.messageReadQueue[a]=[]}if(i){this.messageReadQueue[a].push(parseInt(i))}this.timer.stop("readMessage",a,true);this.timer.stop("readMessageServer",a,true);if(s){return this.readMessageExecute(a,n)}return new Promise(function(e,i){t.timer.start("readMessage",a,.1,function(i,s){return t.readMessageExecute(i,n).then(function(t){return e(t)})})})}},{key:"readMessageExecute",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise(function(e,n){if(i.messageReadQueue[t]){i.messageReadQueue[t]=i.messageReadQueue[t].filter(function(e){if(!i.messageLastReadId[t]){i.messageLastReadId[t]=e}else if(i.messageLastReadId[t]<e){i.messageLastReadId[t]=e}})}var a=i.getDialogIdByChatId(t);var r=i.messageLastReadId[t]||0;if(r<=0){e({dialogId:a,lastId:0});return true}i.controller.getStore().dispatch("messages/readMessages",{chatId:t,readId:r}).then(function(n){i.controller.getStore().dispatch("dialogues/decreaseCounter",{dialogId:a,count:n.count});if(i.getChatId()===t&&i.controller.getStore().getters["dialogues/canSaveChat"]){var o=i.controller.getStore().getters["dialogues/get"](a);if(o.counter<=0){i.controller.getStore().commit("application/clearDialogExtraCount")}}if(s){e({dialogId:a,lastId:r})}else{i.timer.start("readMessageServer",t,.5,function(){i.controller.restClient.callMethod(l.RestMethod.imDialogRead,{DIALOG_ID:a,MESSAGE_ID:r}).then(function(){return e({dialogId:a,lastId:r})}).catch(function(){return e({dialogId:a,lastId:r})})})}}).catch(function(){e()})})}},{key:"unreadMessage",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=this.getChatId();if(typeof this.messageLastReadId[n]==="undefined"){this.messageLastReadId[n]=null}if(typeof this.messageReadQueue[n]==="undefined"){this.messageReadQueue[n]=[]}if(i){this.messageReadQueue[n]=this.messageReadQueue[n].filter(function(e){return e<i})}this.timer.stop("readMessage",n,true);this.timer.stop("readMessageServer",n,true);this.messageLastReadId[n]=i;this.controller.getStore().dispatch("messages/unreadMessages",{chatId:n,unreadId:this.messageLastReadId[n]}).then(function(e){var a=t.getDialogIdByChatId(n);t.controller.getStore().dispatch("dialogues/update",{dialogId:a,fields:{unreadId:i}});t.controller.getStore().dispatch("dialogues/increaseCounter",{dialogId:a,count:e.count});if(!s){t.controller.restClient.callMethod(l.RestMethod.imDialogUnread,{DIALOG_ID:a,MESSAGE_ID:t.messageLastReadId[n]})}}).catch(function(){})}},{key:"shareMessage",value:function e(t,i){this.controller.restClient.callMethod(l.RestMethod.imMessageShare,{DIALOG_ID:this.getDialogId(),MESSAGE_ID:t,TYPE:i});return true}},{key:"replyToUser",value:function e(t,i){return true}},{key:"openMessageReactionList",value:function e(t,i){return true}},{key:"emit",value:function e(t){var i;for(var s=arguments.length,n=new Array(s>1?s-1:0),a=1;a<s;a++){n[a-1]=arguments[a]}(i=d.Vue.event).$emit.apply(i,[t].concat(n))}},{key:"listen",value:function e(t,i){d.Vue.event.$on(t,i)}}]);return e}();var g=function(){function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.inited=false;this.initPromise=new Promise(function(e,i){t.initPromiseResolver=e});this.offline=false;this.restAnswerHandler=[];this.vuexAdditionalModel=[];this.store=null;this.storeBuilder=null;this.init().then(function(){return t.prepareParams(i)}).then(function(){return t.initController()}).then(function(){return t.initLocalStorage()}).then(function(){return t.initStorage()}).then(function(){return t.initRestClient()}).then(function(){return t.initPullClient()}).then(function(){return t.initEnvironment()}).then(function(){return t.initComplete()}).catch(function(e){c.Logger.error("error initializing core controller",e)})}babelHelpers.createClass(e,[{key:"init",value:function e(){return Promise.resolve()}},{key:"prepareParams",value:function e(n){var a=this;if(typeof n.localize!=="undefined"){this.localize=n.localize}else{if(typeof BX!=="undefined"){this.localize=babelHelpers.objectSpread({},BX.message)}else{this.localize={}}}if(typeof n.host!=="undefined"){this.host=n.host}else{this.host=location.origin}if(typeof n.userId!=="undefined"){var r=parseInt(n.userId);if(!isNaN(r)){this.userId=r}else{this.userId=0}}else{var o=this.getLocalize("USER_ID");this.userId=o?parseInt(o):0}if(typeof n.siteId!=="undefined"){if(typeof n.siteId==="string"&&n.siteId!==""){this.siteId=n.siteId}else{this.siteId="s1"}}else{this.siteId=this.getLocalize("SITE_ID")||"s1"}if(typeof n.siteDir!=="undefined"){if(typeof n.siteDir==="string"&&n.siteDir!==""){this.siteDir=n.siteDir}else{this.siteDir="s1"}}else{this.siteDir=this.getLocalize("SITE_DIR")||"s1"}if(typeof n.languageId!=="undefined"){if(typeof n.languageId==="string"&&n.languageId!==""){this.languageId=n.languageId}else{this.languageId="en"}}else{this.languageId=this.getLocalize("LANGUAGE_ID")||"en"}this.pullInstance=t.PullClient;this.pullClient=t.PULL;if(typeof n.pull!=="undefined"){if(typeof n.pull.instance!=="undefined"){this.pullInstance=n.pull.instance}if(typeof n.pull.client!=="undefined"){this.pullClient=n.pull.client}}this.restInstance=i.RestClient;this.restClient=i.rest;if(typeof n.rest!=="undefined"){if(typeof n.rest.instance!=="undefined"){this.restInstance=n.rest.instance}if(typeof n.rest.client!=="undefined"){this.restClient=n.rest.client}}this.vuexBuilder={database:false,databaseName:"desktop/im",databaseType:s.VuexBuilder.DatabaseType.indexedDb};if(typeof n.vuexBuilder!=="undefined"){if(typeof n.vuexBuilder.database!=="undefined"){this.vuexBuilder.database=n.vuexBuilder.database}if(typeof n.vuexBuilder.databaseName!=="undefined"){this.vuexBuilder.databaseName=n.vuexBuilder.databaseName}if(typeof n.vuexBuilder.databaseType!=="undefined"){this.vuexBuilder.databaseType=n.vuexBuilder.databaseType}if(typeof n.vuexBuilder.models!=="undefined"){n.vuexBuilder.models.forEach(function(e){a.addVuexModel(e)})}}return Promise.resolve()}},{key:"initController",value:function e(){this.application=new h;this.application.setCoreController(this);return new Promise(function(e,t){return e()})}},{key:"initLocalStorage",value:function e(){return new Promise(function(e,t){return e()})}},{key:"initStorage",value:function e(){var t=this;var i={common:{host:this.getHost(),userId:this.getUserId(),siteId:this.getSiteId(),languageId:this.getLanguageId()},dialog:{messageLimit:this.application.getDefaultMessageLimit(),enableReadMessages:true},device:{type:u.Utils.device.isMobile()?l.DeviceType.mobile:l.DeviceType.desktop,orientation:u.Utils.device.getOrientation()}};var a=(new s.VuexBuilder).addModel(n.ApplicationModel.create().useDatabase(false).setVariables(i)).addModel(n.MessagesModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost()})).addModel(n.DialoguesModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost()})).addModel(n.FilesModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost(),default:{name:"File is deleted"}})).addModel(n.UsersModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost(),default:{name:"Anonymous"}})).addModel(n.RecentModel.create().useDatabase(false).setVariables({host:this.getHost()})).addModel(n.NotificationsModel.create().useDatabase(false).setVariables({host:this.getHost()}));this.vuexAdditionalModel.forEach(function(e){a.addModel(e)});a.setDatabaseConfig({name:this.vuexBuilder.databaseName,type:this.vuexBuilder.databaseType,siteId:this.getSiteId(),userId:this.getUserId()});return a.build().then(function(e){t.store=e.store;t.storeBuilder=e.builder;return new Promise(function(e,t){return e()})})}},{key:"initRestClient",value:function e(t){this.addRestAnswerHandler(r.CoreRestHandler.create({store:this.store,controller:this}));return new Promise(function(e,t){return e()})}},{key:"initPullClient",value:function e(){if(!this.pullClient){return false}this.pullClient.subscribe(this.pullBaseHandler=new a.ImBasePullHandler({store:this.store,controller:this}));this.pullClient.subscribe({type:this.pullInstance.SubscriptionType.Status,callback:this.eventStatusInteraction.bind(this)});this.pullClient.subscribe({type:this.pullInstance.SubscriptionType.Online,callback:this.eventOnlineInteraction.bind(this)});return new Promise(function(e,t){return e()})}},{key:"initEnvironment",value:function e(t){var i=this;window.addEventListener("orientationchange",function(){if(!i.store){return}i.store.commit("application/set",{device:{orientation:u.Utils.device.getOrientation()}});if(i.store.state.application.device.type===l.DeviceType.mobile&&i.store.state.application.device.orientation===l.DeviceOrientation.horizontal){document.activeElement.blur()}});return new Promise(function(e,t){return e()})}},{key:"initComplete",value:function e(){this.inited=true;this.initPromiseResolver(this)}},{key:"eventStatusInteraction",value:function e(t){if(t.status===this.pullInstance.PullStatus.Online){this.offline=false}else if(t.status===this.pullInstance.PullStatus.Offline){this.offline=true}}},{key:"eventOnlineInteraction",value:function e(t){if(t.command==="list"||t.command==="userStatus"){for(var i in t.params.users){if(!t.params.users.hasOwnProperty(i)){continue}this.store.dispatch("users/update",{id:t.params.users[i].id,fields:t.params.users[i]})}}}},{key:"executeRestAnswer",value:function e(t,i,s){c.Logger.warn("Core.controller.executeRestAnswer",t,i,s);this.restAnswerHandler.forEach(function(e){e.execute(t,i,s)})}},{key:"createVue",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var s=this;var n=function e(){};if(i.beforeCreate){n=i.beforeCreate}var a=function e(){};if(i.destroyed){a=i.destroyed}var r=function e(){};if(i.created){r=i.created}var o={store:this.store,beforeCreate:function e(){this.$bitrix.Data.set("controller",s);this.$bitrix.Application.set(t);this.$bitrix.Loc.setMessage(s.localize);if(s.restClient){this.$bitrix.RestClient.set(s.restClient)}if(s.pullClient){this.$bitrix.PullClient.set(s.pullClient)}n.bind(this)()},created:function e(){r.bind(this)()},destroyed:function e(){a.bind(this)()}};if(i.el){o.el=i.el}if(i.template){o.template=i.template}if(i.computed){o.computed=i.computed}if(i.data){o.data=i.data}var l=o.created;return new Promise(function(e,t){o.created=function(){l.bind(this)();e(this)};d.BitrixVue.createApp(o)})}},{key:"getHost",value:function e(){return this.host}},{key:"setHost",value:function e(t){this.host=t;this.store.commit("application/set",{common:{host:t}})}},{key:"getUserId",value:function e(){return this.userId}},{key:"setUserId",value:function e(t){var i=parseInt(t);if(!isNaN(i)){this.userId=i}else{this.userId=0}this.store.commit("application/set",{common:{userId:t}})}},{key:"getSiteId",value:function e(){return this.siteId}},{key:"setSiteId",value:function e(t){if(typeof t==="string"&&t!==""){this.siteId=t}else{this.siteId="s1"}this.store.commit("application/set",{common:{siteId:this.siteId}})}},{key:"getLanguageId",value:function e(){return this.languageId}},{key:"setLanguageId",value:function e(t){if(typeof t==="string"&&t!==""){this.languageId=t}else{this.languageId="en"}this.store.commit("application/set",{common:{languageId:this.languageId}})}},{key:"getStore",value:function e(){return this.store}},{key:"getStoreBuilder",value:function e(){return this.storeBuilder}},{key:"addRestAnswerHandler",value:function e(t){this.restAnswerHandler.push(t)}},{key:"addVuexModel",value:function e(t){this.vuexAdditionalModel.push(t)}},{key:"isOnline",value:function e(){return!this.offline}},{key:"ready",value:function e(){if(this.inited){return Promise.resolve(this)}return this.initPromise}},{key:"setError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";c.Logger.error("Messenger.Application.error: ".concat(t," (").concat(i,")"));var s="";if(t.endsWith("LOCALIZED")){s=i}this.store.commit("application/set",{error:{active:true,code:t,description:s}})}},{key:"clearError",value:function e(){this.store.commit("application/set",{error:{active:false,code:"",description:""}})}},{key:"addLocalize",value:function e(t){if(babelHelpers.typeof(t)!=="object"||!t){return false}for(var i in t){if(t.hasOwnProperty(i)){this.localize[i]=t[i]}}return true}},{key:"getLocalize",value:function e(t){var i="";if(typeof t==="undefined"){return this.localize}else if(typeof this.localize[t.toString()]==="undefined"){c.Logger.warn("Controller.Core.getLocalize: message with code '".concat(t.toString(),"' is undefined."))}else{i=this.localize[t]}return i}}]);return e}();e.Controller=g})(this.BX.Messenger=this.BX.Messenger||{},BX,BX,BX,BX.Messenger.Model,BX.Messenger.Provider.Pull,BX.Messenger.Provider.Rest,BX.Messenger.Lib,BX.Messenger.Const,BX.Messenger.Lib,BX,BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:72:"/local/js/im/application/launch/dist/launch.bundle.min.js?16547598171204";s:6:"source";s:53:"/local/js/im/application/launch/dist/launch.bundle.js";s:3:"min";s:57:"/local/js/im/application/launch/dist/launch.bundle.min.js";s:3:"map";s:57:"/local/js/im/application/launch/dist/launch.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,n){"use strict";var i=function e(i){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r="";var s="";if(babelHelpers.typeof(i)==="object"){s=i.name.toString();r=i.application.toString()}else{s=i.toString();r=i}r=r.substr(0,1).toUpperCase()+r.substr(1);if(r==="Launch"||r==="Core"||r.endsWith("Application")){n.Logger.error("BX.Messenger.Application.Launch: specified name is forbidden.");return new Promise(function(e,n){return n()})}var o=function e(){try{BX.Messenger.Application[s]=new BX.Messenger.Application[r+"Application"](t);return BX.Messenger.Application[s].ready()}catch(e){n.Logger.error('BX.Messenger.Application.Launch: application "'.concat(r,'" is not initialized.'));return false}};if(typeof BX.Messenger.Application[r+"Application"]==="undefined"&&typeof BX.Runtime!=="undefined"&&typeof BX.Runtime.loadExtension!=="undefined"){var a="im.application."+r.toString().toLowerCase();return BX.Runtime.loadExtension(a).then(function(){return o()})}return o()};e.Launch=i})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:67:"/local/js/im/application/core/dist/core.bundle.min.js?1654759817436";s:6:"source";s:49:"/local/js/im/application/core/dist/core.bundle.js";s:3:"min";s:53:"/local/js/im/application/core/dist/core.bundle.min.js";s:3:"map";s:53:"/local/js/im/application/core/dist/core.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,s){"use strict";var r=function(){function e(){babelHelpers.classCallCheck(this,e);this.controller=new s.Controller}babelHelpers.createClass(e,[{key:"ready",value:function e(){return this.controller.ready()}}]);return e}();var t=new r;e.Core=t})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/local/js/im/lib/animation/dist/animation.bundle.min.js?16547598171109";s:6:"source";s:51:"/local/js/im/lib/animation/dist/animation.bundle.js";s:3:"min";s:55:"/local/js/im/lib/animation/dist/animation.bundle.min.js";s:3:"map";s:55:"/local/js/im/lib/animation/dist/animation.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var n=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"start",value:function e(n){var i=n.start,e=i===void 0?0:i,t=n.end,r=t===void 0?0:t,a=n.increment,o=a===void 0?20:a,s=n.callback,u=s===void 0?function(){}:s,c=n.duration,l=c===void 0?500:c,m=n.element,f=n.elementProperty;var v=r-e;var w=0;var d=function e(n,i,t,r){n/=r/2;if(n<1){return t/2*n*n+i}n--;return-t/2*(n*(n-2)-1)+i};var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};var h=null;var A=function n(){w+=o;m[f]=d(w,e,v,l);if(w<l){h=b(n)}else{if(u&&typeof u==="function"){u()}}return h};return A()}},{key:"cancel",value:function e(n){var i=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)};i(n)}}]);return e}();n.frameIds={};e.Animation=n})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:74:"/local/js/im/view/element/attach/dist/attach.bundle.min.js?165475981717056";s:6:"source";s:54:"/local/js/im/view/element/attach/dist/attach.bundle.js";s:3:"min";s:58:"/local/js/im/view/element/attach/dist/attach.bundle.min.js";s:3:"map";s:58:"/local/js/im/view/element/attach/dist/attach.bundle.map.js";}"*/
(function(t,e,n,i,l,a){"use strict";var m={property:"DELIMITER",name:"bx-im-view-element-attach-delimiter",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},computed:{styles:function t(){return{width:this.config.DELIMITER.SIZE?this.config.DELIMITER.SIZE+"px":"",backgroundColor:this.config.DELIMITER.COLOR?this.config.DELIMITER.COLOR:this.color}}},template:'<div class="bx-im-element-attach-type-delimiter" :style="styles"></div>'}};var r={property:"FILE",name:"bx-im-element-attach-file",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{openLink:function t(e){l.Utils.platform.openNewPage(e.LINK)},file:function t(){return{name:this.config.FILE.NAME,extension:this.config.FILE.NAME.split(".").splice(-1)[0],size:this.config.FILE.SIZE}},fileName:function t(e){var n=70;if(!e.NAME||e.NAME.length<n){return e.NAME}var i=10;var l=e.NAME.split(".").splice(-1)[0];var a=e.NAME.substring(e.NAME.length-1-(l.length+1+i));var m=e.NAME.substring(0,n-a.length-3);return m.trim()+"..."+a.trim()},fileNameFull:function t(e){return e.NAME},fileSize:function t(e){var n=e.SIZE;if(n<=0){return""}var i=["BYTE","KB","MB","GB","TB"];var l=0;while(n>=1024&&l<4){n/=1024;l++}return Math.round(n)+" "+this.$Bitrix.Loc.getMessage("IM_MESSENGER_ATTACH_FILE_SIZE_"+i[l])},fileIcon:function t(e){return i.FilesModel.getIconType(e.NAME.split(".").splice(-1)[0])}},template:'\n\t\t\t<div class="bx-im-element-attach-type-file-element">\n\t\t\t\t<template v-for="(element, index) in config.FILE">\n\t\t\t\t\t<div class="bx-im-element-attach-type-file" @click="openLink(element)">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-icon">\n\t\t\t\t\t\t\t<div :class="[\'ui-icon\', \'ui-icon-file-\'+fileIcon(element)]"><i></i></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-block">\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-name" :title="fileNameFull(element)">\n\t\t\t\t\t\t\t\t{{fileName(element)}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-size">{{fileSize(element)}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var o={methods:{openLink:function t(e){var n=e.element;var i=e.event;if(!l.Utils.platform.isBitrixMobile()&&n.LINK){return}if(n.LINK&&i.target.tagName!=="A"){l.Utils.platform.openNewPage(n.LINK)}else if(!n.LINK){var a={id:null,type:null};if(n.hasOwnProperty("USER_ID")&&n.USER_ID>0){a.id=n.USER_ID;a.type="user"}if(n.hasOwnProperty("CHAT_ID")&&n.CHAT_ID>0){a.id=n.CHAT_ID;a.type="chat"}if(a.id&&a.type&&window.top["BXIM"]){var m=!BX.MessengerTheme.isDark();window.top["BXIM"].messenger.openPopupExternalData(i.target,a.type,m,{ID:a.id})}else if(navigator.userAgent.toLowerCase().includes("bitrixmobile")){var r="";if(a.type==="chat"){r="chat".concat(a.id)}else{r=a.id}if(r!==""){BXMobileApp.Events.postToComponent("onOpenDialog",[{dialogId:r},true],"im.recent")}}}}}};var c={property:"GRID",name:"bx-im-view-element-attach-grid",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},created:function t(){if(l.Utils.platform.isBitrixMobile()){this.maxCellWith=Math.floor(Math.min(screen.availWidth,screen.availHeight)/4)}else{this.maxCellWith=null}},methods:{getWidth:function t(e){if(e.DISPLAY!=="row"){return e.WIDTH?e.WIDTH+"px":""}if(!e.VALUE){return false}if(this.maxCellWith&&e.WIDTH>this.maxCellWith){return this.maxCellWith+"px"}return e.WIDTH?e.WIDTH+"px":""},getValue:function t(e){var n=this;if(!e.VALUE){return""}var a=l.Utils.text.htmlspecialchars(e.VALUE);a=a.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(t,e,i){var a=n.$store.getters["users/get"](e);i=a?l.Utils.text.htmlspecialchars(a.name):i;return'<span class="bx-im-mention" data-type="USER" data-value="'+e+'">'+i+"</span>"});return i.MessagesModel.decodeBbCode({text:a})}},template:'\n\t\t\t<div class="bx-im-element-attach-type-grid">\n\t\t\t\t<template v-for="(element, index) in config.GRID">\n\t\t\t\t\t<template v-if="element.DISPLAY.toLowerCase() === \'block\'">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-block" :style="{width: getWidth(element)}">\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-name">{{element.NAME}}</div>\n\t\t\t\t\t\t\t<template v-if="element.LINK">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a :href="element.LINK" target="_blank" @click="openLink({element: element, event: $event})" v-html="getValue(element)"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-value" v-html="getValue(element)"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="element.DISPLAY.toLowerCase() === \'line\'">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-card" :style="{width: getWidth(element)}">\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-name">{{element.NAME}}</div>\n\t\t\t\t\t\t\t<template v-if="element.LINK">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link"\n\t\t\t\t\t\t\t\t\t:style="{color: element.COLOR? element.COLOR: \'\'}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a :href="element.LINK" target="_blank" @click="openLink({element: element, event: $event})" v-html="getValue(element)"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-value" :style="{color: element.COLOR? element.COLOR: \'\'}" v-html="getValue(element)"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="element.DISPLAY.toLowerCase() === \'row\'">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-column">\n\t\t\t\t\t\t\t<table class="bx-im-element-attach-type-display-column-table">\n\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<template v-if="element.NAME">\n\t\t\t\t\t\t\t\t\t\t\t<td class="bx-im-element-attach-type-grid-element-name" :colspan="element.VALUE? 1: 2" :style="{width: getWidth(element)}">{{element.NAME}}</td>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t<template v-if="element.VALUE">\n\t\t\t\t\t\t\t\t\t\t\t<template v-if="element.LINK">\n\t\t\t\t\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link"\n\t\t\t\t\t\t\t\t\t\t\t\t\t:colspan="element.NAME? 1: 2"\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style="{color: element.COLOR? element.COLOR: \'\'}"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a :href="element.LINK" target="_blank" @click="openLink({element: element, event: $event})" v-html="getValue(element)"></a>\n\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t<td class="bx-im-element-attach-type-grid-element-value" :colspan="element.NAME? 1: 2" :style="{color: element.COLOR? element.COLOR: \'\'}" v-html="getValue(element)"></td>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var s={property:"HTML",name:"bx-im-view-element-attach-html",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},template:'<div class="bx-im-element-attach-type-html" v-html="config.HTML"></div>'}};var p={property:"IMAGE",name:"bx-im-view-element-attach-image",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{open:function t(e){if(!e){return false}if(l.Utils.platform.isBitrixMobile()){BXMobileApp.UI.Photo.show({photos:[{url:e}],default_photo:e})}else{window.open(e,"_blank")}},getImageSize:function t(e,n,i){var l;if(e>i){l=i/e}else{l=1}return{width:e*l,height:n*l}},getElementSource:function t(e){return e.PREVIEW?e.PREVIEW:e.LINK},getElementTitle:function t(e){return l.Utils.text.htmlspecialcharsback(e.NAME)},lazyLoadCallback:function t(e){if(!e.element.style.width){e.element.style.width=e.element.offsetWidth+"px"}if(!e.element.style.height){e.element.style.height=e.element.offsetHeight+"px"}},styleFileSizes:function t(e){if(!(e.WIDTH&&e.HEIGHT)){return{maxHeight:"100%",backgroundSize:"contain"}}var n=this.getImageSize(e.WIDTH,e.HEIGHT,250);return{width:n.width+"px",height:n.height+"px",backgroundSize:n.width<100||n.height<100?"contain":"initial"}},styleBoxSizes:function t(e){if(!(e.WIDTH&&e.HEIGHT)){return{height:"150px"}}if(parseInt(this.styleFileSizes(e).height)<=250){return{}}return{height:"280px"}}},template:'\n\t\t\t<div class="bx-im-element-attach-type-image">\n\t\t\t\t<template v-for="(image, index) in config.IMAGE">\n\t\t\t\t\t<div class="bx-im-element-attach-type-image-block" @click="open(image.LINK)" :style="styleBoxSizes(image)" :key="index">\n\t\t\t\t\t\t<img v-bx-lazyload="{callback: lazyLoadCallback}"\n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-image-source"\n\t\t\t\t\t\t\t:data-lazyload-src="getElementSource(image)"\n\t\t\t\t\t\t\t:style="styleFileSizes(image)"\n\t\t\t\t\t\t\t:title="getElementTitle(image)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var d={property:"LINK",name:"bx-im-view-element-attach-link",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{getImageConfig:function t(e){return{IMAGE:[{NAME:e.NAME,PREVIEW:e.PREVIEW,WIDTH:e.WIDTH,HEIGHT:e.HEIGHT}]}},getLinkName:function t(e){return e.NAME?e.NAME:e.LINK}},computed:{imageComponentName:function t(){return p.name}},components:babelHelpers.defineProperty({},p.name,p.component),template:'\n\t\t\t<div class="bx-im-element-attach-type-link">\n\t\t\t\t<template v-for="(element, index) in config.LINK">\n\t\t\t\t\t<div class="bx-im-element-attach-type-link-element" :key="index">\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tv-if="element.LINK"\n\t\t\t\t\t\t\t:href="element.LINK"\n\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-link-name" \n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{getLinkName(element)}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-ajax-link"\n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{getLinkName(element)}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if="element.DESC" class="bx-im-element-attach-type-link-desc">{{element.DESC}}</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tv-if="element.PREVIEW" \n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-link-image"\n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is="imageComponentName" :config="getImageConfig(element)" :color="color"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var f={property:"MESSAGE",name:"bx-im-view-element-attach-message",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},computed:{message:function t(){var e=this;var n=l.Utils.text.htmlspecialchars(this.config.MESSAGE);n=n.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(t,n,i){var a=e.$store.getters["users/get"](n);i=a?l.Utils.text.htmlspecialchars(a.name):i;return'<span class="bx-im-mention" data-type="USER" data-value="'+n+'">'+i+"</span>"});return i.MessagesModel.decodeBbCode({text:n})}},template:'<div class="bx-im-element-attach-type-message" v-html="message"></div>'}};var v={property:"RICH_LINK",name:"bx-im-view-element-attach-rich",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{getImageConfig:function t(e){return{IMAGE:[{NAME:e.NAME,PREVIEW:e.PREVIEW,WIDTH:e.WIDTH,HEIGHT:e.HEIGHT}]}}},computed:{imageComponentName:function t(){return p.name}},components:babelHelpers.defineProperty({},p.name,p.component),template:'\n\t\t\t<div class="bx-im-element-attach-type-rich">\n\t\t\t\t<template v-for="(element, index) in config.RICH_LINK">\n\t\t\t\t\t<div class="bx-im-element-attach-type-rich-element" :key="index">\n\t\t\t\t\t\t<div v-if="element.PREVIEW" class="bx-im-element-attach-type-rich-image" @click="openLink({element: element, event: $event})">\n\t\t\t\t\t\t\t<component :is="imageComponentName" :config="getImageConfig(element)" :color="color"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-rich-name" @click="openLink({element: element, event: $event})">{{element.NAME}}</div>\n\t\t\t\t\t\t<div v-if="element.DESC" class="bx-im-element-attach-type-rich-desc">{{element.DESC}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var h={property:"USER",name:"bx-im-view-element-attach-user",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{getAvatarType:function t(e){if(e.AVATAR){return""}var n="user";if(e.AVATAR_TYPE==="CHAT"){n="chat"}else if(e.AVATAR_TYPE==="BOT"){n="bot"}return"bx-im-element-attach-type-user-avatar-type-"+n}},template:'\n\t\t\t<div class="bx-im-element-attach-type-user">\n\t\t\t\t<template v-for="(element, index) in config.USER">\n\t\t\t\t\t<div class="bx-im-element-attach-type-user-body">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-user-avatar">\n\t\t\t\t\t\t\t<div :class="[\'bx-im-element-attach-type-user-avatar-type\', getAvatarType(element)]" :style="{backgroundColor: element.AVATAR? \'\': color}">\n\t\t\t\t\t\t\t\t<img v-if="element.AVATAR" \n\t\t\t\t\t\t\t\t\tv-bx-lazyload\n\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-user-avatar-source"\n\t\t\t\t\t\t\t\t\t:data-lazyload-src="element.AVATAR"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tv-if="element.LINK"\n\t\t\t\t\t\t\t:href="element.LINK" \n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-user-name"\n\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{element.NAME}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span v-else @click.prevent="openLink({element: element, event: $event})">\n\t\t\t\t\t\t\t{{element.NAME}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};function u(t,e){var n;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(n=g(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var i=0;var l=function t(){};return{s:l,n:function e(){if(i>=t.length)return{done:true};return{done:false,value:t[i++]}},e:function t(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,m=false,r;return{s:function e(){n=t[Symbol.iterator]()},n:function t(){var e=n.next();a=e.done;return e},e:function t(e){m=true;r=e},f:function t(){try{if(!a&&n.return!=null)n.return()}finally{if(m)throw r}}}}function g(t,e){if(!t)return;if(typeof t==="string")return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}function y(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,i=new Array(e);n<e;n++){i[n]=t[n]}return i}var b=[m,r,c,s,p,d,f,v,h];var x={};b.forEach(function(t){x[t.name]=t.component});a.BitrixVue.component("bx-im-view-element-attach",{props:{config:{type:Object,default:{}},baseColor:{type:String,default:"#17a3ea"}},methods:{getComponentForBlock:function t(e){var n=u(b),i;try{for(n.s();!(i=n.n()).done;){var l=i.value;if(typeof e[l.property]!=="undefined"){return l.name}}}catch(t){n.e(t)}finally{n.f()}return""}},computed:{color:function t(){if(typeof this.config.COLOR==="undefined"||!this.config.COLOR){return this.baseColor}if(this.config.COLOR==="transparent"){return""}return this.config.COLOR}},components:x,template:'\n\t\t<div class="bx-im-element-attach">\n\t\t\t<div v-if="color" class="bx-im-element-attach-border" :style="{borderColor: color}"></div>\n\t\t\t<div class="bx-im-element-attach-content">\n\t\t\t\t<template v-for="(block, index) in config.BLOCKS">\n\t\t\t\t\t<component :is="getComponentForBlock(block)" :config="block" :color="color" :key="index" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.window=this.window||{},BX,window,BX.Messenger.Model,BX.Messenger.Lib,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:77:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.min.js?16547598173415";s:6:"source";s:58:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.js";s:3:"min";s:62:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.min.js";s:3:"map";s:62:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.map.js";}"*/
(function(exports,ui_vue,im_lib_utils,im_lib_logger){"use strict";var _ButtonType=Object.freeze({newline:"NEWLINE",button:"BUTTON"});ui_vue.BitrixVue.component("bx-im-view-element-keyboard",{props:{buttons:{type:Array,default:function t(){return[]}},messageId:{default:0},userId:{default:0},dialogId:{default:0}},data:function t(){return{isMobile:im_lib_utils.Utils.platform.isMobile(),isBlocked:false,localButtons:[]}},created:function t(){this.localButtons=this.prepareButtons(this.buttons)},watch:{buttons:function t(){clearTimeout(this.recoverStateButton);this.isBlocked=false;this.localButtons=this.prepareButtons(this.buttons)}},methods:{click:function click(button){var _this=this;if(this.isBlocked){return false}if(button.DISABLED&&button.DISABLED==="Y"){return false}if(button.ACTION&&button.ACTION_VALUE.toString()){this.$emit("click",{action:"ACTION",params:{dialogId:this.dialogId,messageId:this.messageId,botId:button.BOT_ID,action:button.ACTION,value:button.ACTION_VALUE}})}else if(button.FUNCTION){var execFunction=button.FUNCTION.toString().replace("#MESSAGE_ID#",this.messageId).replace("#DIALOG_ID#",this.dialogId).replace("#USER_ID#",this.userId);eval(execFunction)}else if(button.APP_ID){im_lib_logger.Logger.warn("Messenger keyboard: open app is not implemented.")}else if(button.LINK){if(im_lib_utils.Utils.platform.isBitrixMobile()){app.openNewPage(button.LINK)}else{window.open(button.LINK,"_blank")}}else if(button.WAIT!=="Y"){if(button.BLOCK==="Y"){this.isBlocked=true}button.WAIT="Y";this.$emit("click",{action:"COMMAND",params:{dialogId:this.dialogId,messageId:this.messageId,botId:button.BOT_ID,command:button.COMMAND,params:button.COMMAND_PARAMS}});this.recoverStateButton=setTimeout(function(){_this.isBlocked=false;button.WAIT="N"},1e4)}return true},getStyles:function t(e){var i={};if(e.WIDTH){i["width"]=e.WIDTH+"px"}else if(e.DISPLAY==="BLOCK"){i["width"]="225px"}if(e.BG_COLOR){i["backgroundColor"]=e.BG_COLOR}if(e.TEXT_COLOR){i["color"]=e.TEXT_COLOR}return i},prepareButtons:function t(e){return e.filter(function(t){if(!t.CONTEXT){return true}if(im_lib_utils.Utils.platform.isBitrixMobile()&&t.CONTEXT==="DESKTOP"){return false}if(!im_lib_utils.Utils.platform.isBitrixMobile()&&t.CONTEXT==="MOBILE"){return false}if(!im_lib_utils.Utils.platform.isBitrixMobile()&&(t.ACTION==="DIALOG"||t.ACTION==="CALL")){return false}return true})}},computed:{ButtonType:function t(){return _ButtonType}},template:'\n\t\t<div :class="[\'bx-im-element-keyboard\', {\'bx-im-element-keyboard-mobile\': isMobile}]">\n\t\t\t<template v-for="(button, index) in localButtons">\n\t\t\t\t<div v-if="button.TYPE === ButtonType.newline" class="bx-im-element-keyboard-button-separator"></div>\n\t\t\t\t<span v-else-if="button.TYPE === ButtonType.button" :class="[\n\t\t\t\t\t\'bx-im-element-keyboard-button\', \n\t\t\t\t\t\'bx-im-element-keyboard-button-\'+button.DISPLAY.toLowerCase(), \n\t\t\t\t\t{\n\t\t\t\t\t\t\'bx-im-element-keyboard-button-disabled\': isBlocked || button.DISABLED === \'Y\',\n\t\t\t\t\t\t\'bx-im-element-keyboard-button-progress\': button.WAIT === \'Y\',\n\t\t\t\t\t}\n\t\t\t\t]" @click="click(button)">\n\t\t\t\t\t<span class="bx-im-element-keyboard-button-text" :style="getStyles(button)">{{button.TEXT}}</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t'})})(this.window=this.window||{},BX,BX.Messenger.Lib,BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:63:"/local/js/im/view/popup/dist/popup.bundle.min.js?16547598189787";s:6:"source";s:44:"/local/js/im/view/popup/dist/popup.bundle.js";s:3:"min";s:48:"/local/js/im/view/popup/dist/popup.bundle.min.js";s:3:"map";s:48:"/local/js/im/view/popup/dist/popup.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t,e,s){"use strict";var n={props:["value","popupInstance"],data:function t(){return{chat:{},hasError:false,requestFinished:false}},created:function t(){var e=this.getChat(this.value);if(e){this.chat=e;this.requestFinished=true}else{this.requestChatData(this.value)}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},methods:{getChat:function t(e){return this.$store.getters["dialogues/get"](e)},requestChatData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imChatGet,{dialog_id:e}).then(function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imChatGet,t);n.chat=n.getChat(n.value);n.requestFinished=true}).catch(function(t){n.hasError=true;console.error(t);n.requestFinished=true})},onOpenChat:function t(e){this.popupInstance.destroy();BXIM.openMessenger(this.value)},onOpenHistory:function t(e){this.popupInstance.destroy();BXIM.openHistory(this.value)}},computed:{avatarStyles:function t(){var e={};if(this.emptyAvatar){e.backgroundColor=this.chat.color}return e},chatAvatar:function t(){if(this.emptyAvatar){return"/bitrix/js/im/images/blank.gif"}else{return this.chat.avatar}},emptyAvatar:function t(){return this.chat.avatar===""||this.chat.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0}},template:'\n\t\t<div class="bx-messenger-external-data" style="width: 272px; max-width: 272px; height: 100px;">\n\t\t\t<div v-if="requestFinished && !hasError">\n\t\t\t\t<div class="bx-messenger-external-avatar">\n\t\t\t\t\t<div class="bx-messenger-panel-avatar bx-messenger-panel-avatar-chat">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t:src="chatAvatar"\n\t\t\t\t\t\t\t:alt="chat.name"\n\t\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t\t\t:class="[emptyAvatar ? \'bx-messenger-panel-avatar-img-default\' : \'\', \'bx-messenger-panel-avatar-img\']"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span v-if="chat.extranet" class="bx-messenger-panel-title"><div class="bx-messenger-user-extranet">{{ chat.name }}</div></span>\n\t\t\t\t\t<span v-else class="bx-messenger-panel-title">{{ chat.name }}</span>\n\t\t\t\t\t<span class="bx-messenger-panel-desc">{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_GROUP_CHAT\') }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-messenger-external-data-buttons">\n\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenChat">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_CHAT\') }}\n\t\t\t\t</span>\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenHistory">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_HISTORY\') }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var a={props:["value","popupInstance"],data:function t(){return{user:{},hasError:false,requestFinished:false}},created:function t(){var e=this.getUser(this.value);if(e){this.user=e;this.requestFinished=true}else{this.requestUserData(this.value)}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},methods:{getUser:function t(e){return this.$store.getters["users/get"](e)},requestUserData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imUserGet,{ID:e}).then(function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imUserGet,t);n.user=n.getUser(n.value);n.requestFinished=true}).catch(function(t){n.hasError=true;console.error(t);n.requestFinished=true})},onOpenChat:function t(e){this.popupInstance.destroy();BXIM.openMessenger(this.value)},onOpenHistory:function t(e){this.popupInstance.destroy();BXIM.openHistory(this.value)}},computed:{avatarStyles:function t(){var e={};if(this.emptyAvatar){e.backgroundColor=this.chat.color}return e},userAvatar:function t(){if(this.emptyAvatar){return"/bitrix/js/im/images/blank.gif"}else{return this.user.avatar}},emptyAvatar:function t(){return this.user.avatar===""||this.user.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0},botStyles:function t(){return"bx-messenger-user-bot"},userStatusText:function t(){return BX.MessengerCommon.getUserStatus(this.user.id,false).statusText},userStatusClass:function t(){return"bx-messenger-panel-avatar-status-"+BX.MessengerCommon.getUserStatus(this.user.id,true)},userPosition:function t(){return BX.MessengerCommon.getUserPosition(this.user.id)}},template:'\n\t\t<div class="bx-messenger-external-data" style="width: 272px; max-width: 272px; height: 100px;">\n\t\t\t<div v-if="requestFinished && !hasError">\n\t\t\t\t<div class="bx-messenger-external-avatar">\n\t\t\t\t\t<div :class="[userStatusClass, \'bx-messenger-panel-avatar\']">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t:src="userAvatar"\n\t\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t\t\t:class="[emptyAvatar ? \'bx-messenger-panel-avatar-img-default\' : \'\', \'bx-messenger-panel-avatar-img\']"\n\t\t\t\t\t\t\t:alt="user.name"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span :title="userStatusText" class="bx-messenger-panel-avatar-status"></span>\n\t\t\t\t\t</div>\n\t\n\t\t\t\t\t<span v-if="user.extranet" class="bx-messenger-panel-title"><div class="bx-messenger-user-extranet">{{ user.name }}</div></span>\n\t\t\t\t\t<span v-else-if="user.bot" class="bx-messenger-panel-title"><div :class="botStyles">{{ user.name }}</div></span>\n\t\t\t\t\t<span v-else class="bx-messenger-panel-title">{{ user.name }}</span>\n\t\n\t\t\t\t\t<span class="bx-messenger-panel-desc">{{ userPosition }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-messenger-external-data-buttons">\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenChat">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_USER_OPEN_CHAT\') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenHistory">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_HISTORY\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var r={props:["value","popupInstance"],data:function t(){return{users:{},hasError:false,requestFinished:false}},created:function t(){var e=this.isNeedUserRequest(this.value);if(e){this.requestUserData(this.value)}else{this.users=this.getUsersForPopup();this.requestFinished=true}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},computed:{popupHeight:function t(){var e=this.value.length*30;if(e>150){e=150}return e+"px"}},methods:{getUser:function t(e){return this.$store.getters["users/get"](e)},getUsersForPopup:function t(){var e=this;return this.value.map(function(t){return e.getUser(t)})},getUserAvatar:function t(e){if(this.isEmptyAvatar(e)){return"/bitrix/js/im/images/blank.gif"}else{return e.avatar}},isEmptyAvatar:function t(e){return e.avatar===""||e.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0},getAvatarStyles:function t(e){var s={};if(this.isEmptyAvatar(e)){s.backgroundColor=e.color}return s},getUserStatusClass:function t(e){return"bx-notifier-popup-avatar-status-".concat(e.status)},isNeedUserRequest:function t(e){for(var s=0;s<e.length;s++){if(!this.getUser(e[s])){return true}}return false},requestUserData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imUserListGet,{ID:e}).then(function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imUserListGet,t);n.users=n.getUsersForPopup();n.requestFinished=true}).catch(function(t){n.hasError=true;console.error(t);n.requestFinished=true})},onUserClick:function t(e){this.popupInstance.destroy();BXIM.openMessenger(e)}},template:'\n\t\t<div\n\t\t\tclass="bx-im-vue-popup-container" \n\t\t\t:style="{height: popupHeight, width: \'180px\', display: \'flex\', alignItems: \'center\', justifyContent: \'center\'}"\n\t\t>\n\t\t\t<span v-if="requestFinished && !hasError" class="bx-notifier-item-help-popup">\n\t\t\t\t<a \n\t\t\t\t\tv-for="user in users"\n\t\t\t\t\tclass="bx-notifier-item-help-popup-img"\n\t\t\t\t\t@click.prevent="onUserClick(user.id)"\n\t\t\t\t>\n\t\t\t\t\t<span :class="[getUserStatusClass(user), \'bx-notifier-popup-avatar\']">\n\t\t\t\t\t\t<img \n\t\t\t\t\t\t\t:src="getUserAvatar(user)"\n\t\t\t\t\t\t\t:class="[\'bx-notifier-popup-avatar-img\', isEmptyAvatar(user) ? \'bx-notifier-popup-avatar-img-default\' : \'\']"\n\t\t\t\t\t\t\t:style="getAvatarStyles(user)"\n\t\t\t\t\t\t\t:alt="user.name"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span \n\t\t\t\t\t\t:class="[\'bx-notifier-item-help-popup-name\', user.extranet ? \'bx-notifier-popup-avatar-extranet\' : \'\']"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var i={props:["type","value","popupInstance"],components:{Chat:n,User:a,Users:r},template:'\n\t\t<component :is="type" :value="value" :popupInstance="popupInstance"/>\n\t'};t.Popup=i})(this.BX.Messenger.View=this.BX.Messenger.View||{},BX,BX.Messenger.Const);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/local/js/im/component/notifications/dist/notifications.bundle.min.js?165475981747876";s:6:"source";s:65:"/local/js/im/component/notifications/dist/notifications.bundle.js";s:3:"min";s:69:"/local/js/im/component/notifications/dist/notifications.bundle.min.js";s:3:"map";s:69:"/local/js/im/component/notifications/dist/notifications.bundle.map.js";}"*/
this.BX=this.BX||{};(function(t,e,i,n,s,o,a,r,c,l,u,d,f,h,p,m){"use strict";var g={props:["listItem"],data:function t(){return{quickAnswerText:"",quickAnswerResultMessage:"",showQuickAnswer:false,isSendingQuickAnswer:false,successSentQuickAnswer:false}},methods:{toggleQuickAnswer:function t(){var e=this;if(this.successSentQuickAnswer){this.showQuickAnswer=true;this.successSentQuickAnswer=false;this.quickAnswerResultMessage=""}else{this.showQuickAnswer=!this.showQuickAnswer}if(this.showQuickAnswer){this.$nextTick(function(){e.$refs["input"].focus()})}},sendQuickAnswer:function t(e){var i=this;if(this.quickAnswerText.trim()===""){return}this.isSendingQuickAnswer=true;var n=e.item.id;this.$Bitrix.RestClient.get().callMethod("im.notify.answer",{notify_id:n,answer_text:this.quickAnswerText}).then(function(t){i.quickAnswerResultMessage=t.data().result_message[0];i.successSentQuickAnswer=true;i.quickAnswerText="";i.isSendingQuickAnswer=false}).catch(function(t){console.error(t);i.quickAnswerResultMessage=result.data().result_message[0];i.isSendingQuickAnswer=false})}},template:'\n\t\t<div class="bx-notifier-item-text-vue">\n\t\t\t<div class="bx-notifier-answer-link-vue">\n\t\t\t\t<span class="bx-notifier-answer-reply bx-messenger-ajax" @click="toggleQuickAnswer()" @dblclick.stop>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_QUICK_ANSWER_BUTTON\') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<transition name="quick-answer-slide">\n\t\t\t\t<div v-if="showQuickAnswer && !successSentQuickAnswer" class="bx-notifier-answer-box-vue">\n\t\t\t\t\t<span v-if="isSendingQuickAnswer" class="bx-notifier-answer-progress-vue bx-messenger-content-load-img"></span>\n\t\t\t\t\t<span class="bx-notifier-answer-input">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tref="input"\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\tclass="bx-messenger-input"\n\t\t\t\t\t\t\tv-model="quickAnswerText"\n\t\t\t\t\t\t\t:disabled="isSendingQuickAnswer"\n\t\t\t\t\t\t\t@keyup.enter="sendQuickAnswer({item: listItem, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="bx-notifier-answer-button" @click="sendQuickAnswer({item: listItem, event: $event})"></div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if="successSentQuickAnswer" class="bx-notifier-answer-text-vue">\n\t\t\t\t{{ quickAnswerResultMessage }}\n\t\t\t</div>\n\t\t</div>\n\t'};var v={props:["listItem"],computed:{moreUsers:function t(){var e=this.$Bitrix.Loc.getMessage("IM_NOTIFICATIONS_MORE_USERS").split("#COUNT#");return{start:e[0],end:this.listItem.params.USERS.length+e[1]}},isMoreUsers:function t(){return this.listItem.params.hasOwnProperty("USERS")&&this.listItem.params.USERS.length>0},isAbleToDelete:function t(){return this.listItem.sectionCode===h.NotificationTypesCodes.simple}},methods:{onDeleteClick:function t(e){if(e.item.sectionCode===h.NotificationTypesCodes.simple){this.$emit("deleteClick",e)}},onMoreUsersClick:function t(e){if(e.users){this.$emit("moreUsersClick",{event:e.event,content:{type:"USERS",value:e.users}})}},onUserTitleClick:function t(e){if(window.top["BXIM"]&&e.userId>0){window.top["BXIM"].openMessenger(e.userId)}}},template:'\n\t\t<div class="bx-im-notifications-item-content-header">\n\t\t\t<div v-if="listItem.title" class="bx-im-notifications-item-header-title">\n\t\t\t\t<span\n\t\t\t\t\tv-if="!listItem.systemType"\n\t\t\t\t\t@click.prevent="onUserTitleClick({userId: listItem.authorId, event: $event})"\n\t\t\t\t\tclass="bx-im-notifications-item-header-title-text"\n\t\t\t\t>\n\t\t\t\t\t{{ listItem.title.value }}\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if="listItem.systemType" class="bx-im-notifications-item-bottom-subtitle-text" v-html="listItem.subtitle.value"></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if="isMoreUsers && !listItem.systemType"\n\t\t\t\t\tclass="bx-im-notifications-item-header-more-users"\n\t\t\t\t>\n\t\t\t\t\t{{ moreUsers.start }}\n\t\t\t\t\t<span class="bx-messenger-ajax" @click="onMoreUsersClick({users: listItem.params.USERS, event: $event})">\n\t\t\t\t\t\t{{ moreUsers.end }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="bx-im-notifications-item-content-header-right">\n\t\t\t\t<div class="bx-im-notifications-item-header-date">\n\t\t\t\t\t{{ listItem.date.value }}\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if="isAbleToDelete"\n\t\t\t\t\tclass="bx-im-notifications-item-header-delete"\n\t\t\t\t\t@click="onDeleteClick({item: listItem, event: $event})">\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t'};var I={template:'\n\t\t<div style="display: flex; width: 100%;">\n\t\t\t<div class="bx-im-notifications-item-image-wrap">\n\t\t\t\t<div class="bx-im-notifications-item-image bx-im-notifications-item-placeholder-image"></div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-notifications-item-content bx-im-notifications-skeleton">\n\t\t\t\t<div class="bx-im-notifications-item-content-header">\n\t\t\t\t\t<div class="bx-im-notifications-item-placeholder-title"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-notifications-item-content-middle">\n\t\t\t\t\t<div class="bx-im-notifications-item-bottom-subtitle">\n\t\t\t\t\t\t<div class="bx-im-notifications-item-placeholder-subtitle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-notifications-item-content-bottom">\n\t\t\t\t\t<div class="bx-im-notifications-item-bottom-subtitle">\n\t\t\t\t\t\t<div class="bx-im-notifications-item-placeholder-subtitle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var T={components:{NotificationQuickAnswer:g,NotificationItemHeader:v,NotificationPlaceholder:I},props:["rawListItem","searchMode"],data:function t(){return{menuId:"popup-window-content-bx-messenger-popup-notify"}},computed:{NotificationTypesCodes:function t(){return h.NotificationTypesCodes},listItem:function t(){return{id:this.rawListItem.id,type:this.rawListItem.type,sectionCode:this.rawListItem.sectionCode,authorId:this.rawListItem.authorId,systemType:this.rawListItem.type===4||this.rawListItem.authorId===0&&this.avatar==="",title:{value:this.userTitle},subtitle:{value:this.rawListItem.textConverted},avatar:{url:this.avatar,color:this.defaultAvatarColor},params:this.rawListItem.params||{},notifyButtons:this.rawListItem.notifyButtons||undefined,unread:this.rawListItem.unread,settingName:this.rawListItem.settingName,date:{value:f.Utils.date.format(this.rawListItem.date,null,this.$Bitrix.Loc.getMessages())}}},isRealItem:function t(){return this.rawListItem.sectionCode!==h.NotificationTypesCodes.placeholder},isNeedQuickAnswer:function t(){return this.listItem.params.CAN_ANSWER&&this.listItem.params.CAN_ANSWER==="Y"},userTitle:function t(){if(this.isRealItem&&this.rawListItem.authorId>0){return this.userData.name}else if(this.isRealItem&&this.rawListItem.authorId===0){return""}else{return""}},avatar:function t(){var t="";if(this.isRealItem&&this.rawListItem.authorId>0){t=this.userData.avatar}else if(this.isRealItem&&this.rawListItem.authorId===0){return""}return t},defaultAvatarColor:function t(){if(this.rawListItem.authorId<=0){return""}return this.userData.color},userData:function t(){return this.$store.getters["users/get"](this.rawListItem.authorId,true)},avatarStyles:function t(){return{backgroundImage:'url("'+this.listItem.avatar.url+'")'}}},methods:{onDoubleClick:function t(e){if(!this.searchMode&&e.item.sectionCode===h.NotificationTypesCodes.simple){this.$emit("dblclick",e)}},onButtonsClick:function t(e){if(e.action==="COMMAND"){this.$emit("buttonsClick",e)}},onDeleteClick:function t(e){this.$emit("deleteClick",e)},onMoreUsersClick:function t(e){this.$emit("contentClick",e)},onContentClick:function t(e){if(o.Vue.testNode(e.target,{className:"bx-im-mention"})){this.$emit("contentClick",{event:e,content:{type:e.target.dataset.type,value:e.target.dataset.value}})}},onRightClick:function t(e){var i=this;if(f.Utils.platform.isBitrixDesktop()&&e.target.tagName==="A"&&(!e.target.href.startsWith("/desktop_app/")||e.target.href.startsWith("/desktop_app/show.file.php"))){var n=e.target.href;if(!n){return}if(this.menuPopup){this.menuPopup.destroy();this.menuPopup=null}var s=d.PopupManager.getPopupById(this.menuId);if(s){s.destroy()}var o=a.Dom.create("span",{attrs:{className:"bx-messenger-popup-menu-item-text bx-messenger-popup-menu-item"},events:{click:function t(e){BX.desktop.clipboardCopy(n);i.menuPopup.destroy();i.menuPopup=null}},text:this.$Bitrix.Loc.getMessage("IM_NOTIFICATIONS_CONTEXT_COPY_LINK")});this.menuPopup=d.PopupManager.create({id:this.menuId,targetContainer:document.body,className:BX.MessengerTheme.isDark()?"bx-im-notifications-popup-window-dark":"",darkMode:BX.MessengerTheme.isDark(),bindElement:e,offsetLeft:13,autoHide:true,closeByEsc:true,events:{onPopupClose:function t(){return i.menuPopup.destroy()},onPopupDestroy:function t(){return i.menuPopup=null}},content:o});if(!BX.MessengerTheme.isDark()){this.menuPopup.setAngle({})}this.menuPopup.show()}}},template:'\n\t\t<div \n\t\t\tclass="bx-im-notifications-item"\n\t\t\t:class="[listItem.unread && !searchMode ? \'bx-im-notifications-item-unread\' : \'\']"\n\t\t\t@dblclick="onDoubleClick({item: listItem, event: $event})"\n\t\t\t@contextmenu="onRightClick"\n\t\t>\n\t\t\t<template v-if="listItem.sectionCode !== NotificationTypesCodes.placeholder">\n\t\t\t\t<div v-if="listItem.avatar" class="bx-im-notifications-item-image-wrap">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if="listItem.avatar.url" \n\t\t\t\t\t\tclass="bx-im-notifications-item-image"\n\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div v-else-if="listItem.systemType" class="bx-im-notifications-item-image bx-im-notifications-image-system"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-else-if="!listItem.avatar.url" \n\t\t\t\t\t\tclass="bx-im-notifications-item-image bx-im-notifications-item-image-default"\n\t\t\t\t\t\t:style="{backgroundColor: listItem.avatar.color}"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-notifications-item-content" @click="onContentClick">\n\t\t\t\t\t<NotificationItemHeader \n\t\t\t\t\t\t:listItem="listItem"\n\t\t\t\t\t\t@deleteClick="onDeleteClick"\n\t\t\t\t\t\t@moreUsersClick="onMoreUsersClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if="listItem.subtitle.value.length > 0" class="bx-im-notifications-item-content-bottom">\n\t\t\t\t\t\t<div class="bx-im-notifications-item-bottom-subtitle">\n\t\t\t\t\t\t\t<span v-if="!listItem.systemType" class="bx-im-notifications-item-bottom-subtitle-text" v-html="listItem.subtitle.value"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NotificationQuickAnswer v-if="isNeedQuickAnswer" :listItem="listItem"/>\n\t\t\t\t\t<div v-if="listItem.params[\'ATTACH\']" class="bx-im-notifications-item-content-additional">\n\t\t\t\t\t\t<div v-for="attach in listItem.params[\'ATTACH\']">\n\t\t\t\t\t\t\t<bx-im-view-element-attach :config="attach"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="listItem.notifyButtons">\n\t\t\t\t\t\t<bx-im-view-element-keyboard @click="onButtonsClick" :buttons="listItem.notifyButtons"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<NotificationPlaceholder v-else-if="listItem.sectionCode === NotificationTypesCodes.placeholder"/>\n\t\t</div>\n\t'};var b={data:function t(){return{placeholderCount:0}},methods:{isReadyToLoadNewPage:function t(e){var i=e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight;return i<200},getLastItemId:function t(e){return e[e.length-1].id},generatePlaceholders:function t(e){var i=[];for(var n=0;n<e;n++){i.push({id:"placeholder".concat(this.placeholderCount),type:h.NotificationTypesCodes.placeholder});this.placeholderCount++}return i},getRestClient:function t(){return this.$Bitrix.RestClient.get()},onContentClick:function t(e){var i=this;this.contentPopupType=e.content.type.toLowerCase();this.contentPopupValue=e.content.value;if(this.popupInstance!=null){this.popupInstance.destroy();this.popupInstance=null}if(this.contentPopupType==="user"||this.contentPopupType==="chat"){var n=!this.isDarkTheme;BXIM.messenger.openPopupExternalData(e.event.target,this.contentPopupType,n,{ID:this.contentPopupValue})}else if(this.contentPopupType==="openlines"){BX.MessengerCommon.linesGetSessionHistory(this.contentPopupValue)}else{var s=d.PopupManager.create({id:"bx-messenger-popup-external-data",targetContainer:document.body,className:this.isDarkTheme?"bx-im-notifications-popup-window-dark":"",bindElement:e.event.target,lightShadow:true,offsetTop:0,offsetLeft:10,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function t(){return i.popupInstance.destroy()},onPopupDestroy:function t(){return i.popupInstance=null}}});if(!this.isDarkTheme){s.setAngle({})}this.popupIdSelector="#".concat(s.getContentContainer().id);this.$nextTick(function(){return i.popupInstance=s})}}},computed:{isDarkTheme:function t(){if(this.darkTheme===undefined){return BX.MessengerTheme.isDark()}return this.darkTheme}}};var y={components:{NotificationItem:T,MountingPortal:l.MountingPortal,Popup:u.Popup},mixins:[b],props:["searchQuery","searchType","searchDate"],data:function t(){return{pageLimit:50,lastId:0,initialDataReceived:false,isLoadingNewPage:false,contentPopupType:"",contentPopupValue:"",popupInstance:null,popupIdSelector:"",searchResultsTotal:0,searchPageLoaded:0,searchPagesRequested:0}},computed:babelHelpers.objectSpread({remainingPages:function t(){return Math.ceil((this.searchResultsTotal-this.searchResults.length)/this.pageLimit)}},r.Vuex.mapState({notification:function t(e){return e.notifications.collection},searchResults:function t(e){return e.notifications.searchCollection}})),watch:{searchQuery:function t(e){if(e.length>=3||e===""){this.search()}},searchType:function t(){this.search()},searchDate:function t(e){if(BX.parseDate(e)instanceof Date||e===""){this.search()}}},created:function t(){this.searchServerDelayed=f.Utils.debounce(this.getSearchResultsFromServer,1500,this);this.search()},beforeDestroy:function t(){this.$store.dispatch("notifications/deleteSearchResults")},methods:{search:function t(){var e=this;this.resetSearchState();var i=this.notification.filter(function(t){var i=false;if(e.searchQuery.length>=3){i=t.textConverted.toLowerCase().includes(e.searchQuery.toLowerCase());if(!i){return i}}if(e.searchType!==""){i=t.settingName===e.searchType;if(!i){return i}}if(e.searchDate!==""){var n=BX.parseDate(e.searchDate);if(n instanceof Date){var s=new Date(t.date.getTime()).setHours(0,0,0,0);var o=n.setHours(0,0,0,0);i=s===o}}return i});if(i.length>0){this.$store.dispatch("notifications/setSearchResults",{notification:i,type:"local"})}var n=this.pageLimit-i.length>0;if(n>0){this.drawPlaceholders(this.pageLimit).then(function(){e.searchServerDelayed()})}else{this.searchServerDelayed()}},getSearchResultsFromServer:function t(){var e=this;var i=this.getSearchRequestParams();this.getRestClient().callMethod("im.notify.history.search",i).then(function(t){c.Logger.warn("im.notify.history.search: first page results",t.data());e.processHistoryData(t.data());e.initialDataReceived=true;e.isLoadingNewPage=false;e.searchPageLoaded++}).catch(function(t){c.Logger.warn("History request error",t)})},processHistoryData:function t(e){this.$store.dispatch("notifications/clearPlaceholders");if(e.notifications.length<=0){return false}this.lastId=this.getLastItemId(e.notifications);this.searchResultsTotal=e.total_results;this.$store.dispatch("notifications/setSearchResults",{notification:e.notifications});this.$store.dispatch("users/set",e.users);this.isLoadingNewPage=false},loadNextPage:function t(){var e=this;c.Logger.warn("Loading more search results!");var i=this.getSearchRequestParams();this.getRestClient().callMethod("im.notify.history.search",i).then(function(t){c.Logger.warn("im.notify.history.search: new page results",t.data());var i=t.data().users;var n=t.data().notifications;if(!n||n.length===0){e.$store.dispatch("notifications/clearPlaceholders");e.searchResultsTotal=e.searchResults.length;return false}e.lastId=e.getLastItemId(n);e.$store.dispatch("users/set",i);return e.$store.dispatch("notifications/updatePlaceholders",{searchCollection:true,items:n,firstItem:e.searchPageLoaded*e.pageLimit})}).then(function(){e.searchPageLoaded++;return e.onAfterLoadNextPageRequest()}).catch(function(t){e.$store.dispatch("notifications/clearPlaceholders");c.Logger.warn("History request error",t)})},onAfterLoadNextPageRequest:function t(){c.Logger.warn("onAfterLoadNextPageRequest");if(this.searchPagesRequested>0){c.Logger.warn("We have delayed requests -",this.searchPagesRequested);this.searchPagesRequested--;return this.loadNextPage()}else{c.Logger.warn("No more delayed requests, clearing placeholders");this.$store.dispatch("notifications/clearPlaceholders");this.isLoadingNewPage=false;return true}},getSearchRequestParams:function t(){var e={SEARCH_TEXT:this.searchQuery,SEARCH_TYPE:this.searchType,LIMIT:this.pageLimit,CONVERT_TEXT:"Y"};if(BX.parseDate(this.searchDate)instanceof Date){e["SEARCH_DATE"]=BX.parseDate(this.searchDate).toISOString()}if(this.lastId>0){e["LAST_ID"]=this.lastId}return e},resetSearchState:function t(){this.$store.dispatch("notifications/deleteSearchResults");this.initialDataReceived=false;this.lastId=0;this.isLoadingNewPage=true;this.placeholderCount=0;this.searchPageLoaded=0},drawPlaceholders:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=this.generatePlaceholders(e);return this.$store.dispatch("notifications/setSearchResults",{notification:i})},onScroll:function t(e){var i=this;if(!this.isReadyToLoadNewPage(e)||!this.initialDataReceived||this.remainingPages<=0){return}if(this.isLoadingNewPage){this.drawPlaceholders(this.pageLimit).then(function(){i.searchPagesRequested++;c.Logger.warn("Already loading! Draw placeholders and add request, total - ",i.pagesRequested)})}else{c.Logger.warn("Starting new request");this.isLoadingNewPage=true;this.drawPlaceholders(this.pageLimit).then(function(){i.loadNextPage()})}},onButtonsClick:function t(e){var i=this;var n=this.getConfirmRequestParams(e);var s=+n.NOTIFY_ID;var o=this.$store.getters["notifications/getById"](s);this.getRestClient().callMethod("im.notify.confirm",n).then(function(){i.$store.dispatch("notifications/delete",{id:s});if(o.unread){i.$store.dispatch("notifications/setCounter",{unreadTotal:i.unreadCounter-1})}}).catch(function(){i.$store.dispatch("notifications/update",{id:s,fields:{display:true}})});this.$store.dispatch("notifications/update",{id:s,fields:{display:false}})},onDeleteClick:function t(e){var i=this;var n=+e.item.id;var s=this.$store.getters["notifications/getSearchItemById"](n);this.getRestClient().callMethod("im.notify.delete",{id:n}).then(function(){i.$store.dispatch("notifications/delete",{id:n,searchMode:true});if(!i.isLoadingNewPage&&i.remainingPages>0&&i.searchResults.length<15){i.isLoadingNewPage=true;i.drawPlaceholders(i.pageLimit).then(function(){i.loadNextPage()})}if(s.unread){i.$store.dispatch("notifications/setCounter",{unreadTotal:i.unreadCounter-1})}}).catch(function(t){console.error(t);i.$store.dispatch("notifications/update",{id:n,fields:{display:true},searchMode:true})});this.$store.dispatch("notifications/update",{id:n,fields:{display:false},searchMode:true})}},template:'\n\t\t<div class="bx-messenger-notifications-search-results-wrap" @scroll.passive="onScroll">\n\t\t\t<notification-item\n\t\t\t\tv-for="listItem in searchResults"\n\t\t\t\tv-if="listItem.display"\n\t\t\t\t:key="listItem.id"\n\t\t\t\t:data-id="listItem.id"\n\t\t\t\t:rawListItem="listItem"\n\t\t\t\tsearchMode="true"\n\t\t\t\t@buttonsClick="onButtonsClick"\n\t\t\t\t@contentClick="onContentClick"\n\t\t\t\t@deleteClick="onDeleteClick"\n\t\t\t/>\n\t\t\t<mounting-portal :mount-to="popupIdSelector" append v-if="popupInstance">\n\t\t\t\t<popup :type="contentPopupType" :value="contentPopupValue" :popupInstance="popupInstance"/>\n\t\t\t</mounting-portal>\n\t\t\t<div \n\t\t\t\tv-if="searchResults.length <= 0" \n\t\t\t\tstyle="padding-top: 210px; margin-bottom: 20px;"\n\t\t\t\tclass="bx-messenger-box-empty bx-notifier-content-empty" \n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_RESULTS_NOT_FOUND\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};function C(t,e){var i;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(i=w(t))||e&&t&&typeof t.length==="number"){if(i)t=i;var n=0;var s=function t(){};return{s:s,n:function e(){if(n>=t.length)return{done:true};return{done:false,value:t[n++]}},e:function t(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,r;return{s:function e(){i=t[Symbol.iterator]()},n:function t(){var e=i.next();o=e.done;return e},e:function t(e){a=true;r=e},f:function t(){try{if(!o&&i.return!=null)i.return()}finally{if(a)throw r}}}}function w(t,e){if(!t)return;if(typeof t==="string")return N(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor)i=t.constructor.name;if(i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return N(t,e)}function N(t,e){if(e==null||e>t.length)e=t.length;for(var i=0,n=new Array(e);i<e;i++){n[i]=t[i]}return n}var x=Object.freeze({read:"read",none:"none"});o.BitrixVue.component("bx-im-component-notifications",{components:{NotificationItem:T,MountingPortal:l.MountingPortal,Popup:u.Popup,NotificationSearchResult:y},directives:{"bx-im-directive-notifications-observer":{inserted:function t(e,i,n){if(i.value===x.none){return false}if(!n.context.observers[i.value]){n.context.observers[i.value]=n.context.getObserver({type:i.value})}n.context.observers[i.value].observe(e);return true},unbind:function t(e,i,n){if(i.value===x.none){return true}if(n.context.observers[i.value]){n.context.observers[i.value].unobserve(e)}return true}}},mixins:[b],props:{darkTheme:{default:undefined}},data:function t(){return{initialDataReceived:false,perPage:50,isLoadingInitialData:false,isLoadingNewPage:false,pagesRequested:0,pagesLoaded:0,lastId:0,lastType:h.NotificationTypesCodes.confirm,ObserverType:x,notificationsOnScreen:[],notificationsToRead:[],notificationsToDelete:[],changeReadStatusBlockTimeout:{},firstUnreadNotificationOnInit:null,contentPopupType:"",contentPopupValue:"",popupInstance:null,popupIdSelector:"",contextPopupInstance:null,searchQuery:"",searchType:"",searchDate:"",showSearch:false,callViewState:false}},computed:babelHelpers.objectSpread({NotificationTypesCodes:function t(){return h.NotificationTypesCodes},remainingPages:function t(){return Math.ceil((this.total-this.notification.length)/this.perPage)},localize:function t(){return o.BitrixVue.getFilteredPhrases("IM_NOTIFICATIONS_",this)},visibleNotifications:function t(){return this.notification.filter(function(t){return t.display})},highestNotificationId:function t(){return this.notification.reduce(function(t,e){return e.id>t?e.id:t},0)},isNeedToReadAll:function t(){var e=this.notification.filter(function(t){return t.sectionCode===h.NotificationTypesCodes.confirm}).length;return e<this.unreadCounter},panelStyles:function t(){if(this.callViewState===BX.Call.Controller.ViewState.Folded&&!this.showSearch){return{paddingBottom:"60px"}}return{}},filterBoxStyles:function t(){if(this.callViewState===BX.Call.Controller.ViewState.Folded&&this.showSearch){return{paddingTop:"70px"}}return{}},firstUnreadNotification:function t(){var e=null;var i=this.notification.length-1;for(var n=0;n<=i;n++){if(this.notification[n].unread&&this.notification[n].sectionCode!==h.NotificationTypesCodes.placeholder){e=this.notification[n];break}}return e},firstUnreadNotificationBelowVisible:function t(){var e=Math.max.apply(Math,babelHelpers.toConsumableArray(this.notificationsOnScreen));var i=null;var n=this.notification.length-1;for(var s=0;s<=n;s++){if(this.notification[s].unread&&e>this.notification[s].id&&this.notification[s].sectionCode===h.NotificationTypesCodes.simple){i=this.notification[s].id;break}}return i},isUnreadNotificationVisible:function t(){var e=this;var i=Array.from(this.notificationsOnScreen).filter(function(t){var i=e.$store.getters["notifications/getById"](t);return i?i.unread:false});return i.length>0},showScrollButton:function t(){if(!this.initialDataReceived){return false}if(this.unreadCounter<=0||!BXIM.settings.notifyAutoRead){return false}if(this.notificationsOnScreen.length===0){return false}if(this.isUnreadNotificationVisible){return false}return true},hasUnreadBelowVisible:function t(){var e=0;for(var i=0;i<=this.notification.length-1;i++){if(this.notification[i].unread&&this.notification[i].sectionCode!==h.NotificationTypesCodes.placeholder){++e}if(this.notificationsOnScreen.includes(this.notification[i].id)&&this.unreadCounter===e){return false}}return true},arrowButtonClass:function t(){var e=!this.hasUnreadBelowVisible;return{"bx-im-notifications-scroll-button-arrow-down":!e,"bx-im-notifications-scroll-button-arrow-up":e,"bx-im-notifications-scroll-button-arrow":true}},filterTypes:function t(){var e=Object.assign({},this.schema);var i=["timeman","mail","disk","bizproc","voximplant","sender","blog","vote","socialnetwork","imopenlines","photogallery","intranet","forum"];i.forEach(function(t){if(e.hasOwnProperty(t)){delete e[t].LIST}});if(e.hasOwnProperty("calendar")){e["calendar"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_CALENDAR"]}if(e.hasOwnProperty("sender")){e["sender"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SENDER"]}if(e.hasOwnProperty("blog")){e["blog"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_BLOG"]}if(e.hasOwnProperty("socialnetwork")){e["socialnetwork"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SOCIALNETWORK"]}if(e.hasOwnProperty("intranet")){e["intranet"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_INTRANET"]}var n=["tasks","calendar","crm","timeman","mail","disk","bizproc","voximplant","sender","blog","vote","socialnetwork","imopenlines","photogallery","intranet","forum"];var s=[];n.forEach(function(t){if(e.hasOwnProperty(t)){s.push(e[t])}});return s}},r.Vuex.mapState({notification:function t(e){return e.notifications.collection},total:function t(e){return e.notifications.total},unreadCounter:function t(e){return e.notifications.unreadCounter},schema:function t(e){return e.notifications.schema}})),created:function t(){var e=this;this.drawPlaceholders().then(function(){e.getInitialData()});m.EventEmitter.subscribe(h.EventType.notification.updateState,this.onUpdateState);window.addEventListener("focus",this.onWindowFocus);window.addEventListener("blur",this.onWindowBlur);if(BXIM&&BX.Call){this.callViewState=BXIM.callController.callViewState;BXIM.callController.subscribe(BX.Call.Controller.Events.onViewStateChanged,this.onCallViewStateChange)}this.timer=new p.Timer;this.readNotificationsQueue=new Set;this.readNotificationsNodes={};this.observers={};this.readVisibleNotificationsDelayed=f.Utils.debounce(this.readVisibleNotifications,50,this)},mounted:function t(){this.windowFocused=document.hasFocus()},beforeDestroy:function t(){this.observers={};window.removeEventListener("focus",this.onWindowFocus);window.removeEventListener("blur",this.onWindowBlur);m.EventEmitter.unsubscribe(h.EventType.notification.updateState,this.onUpdateState);if(BXIM&&BX.Call){BXIM.callController.unsubscribe(BX.Call.Controller.Events.onViewStateChanged,this.onCallViewStateChange)}},methods:{getFirstUnreadNotificationOnInit:function t(){if(this.unreadCounter<=0){return null}var e=null;var i=this.notification.length-1;for(var n=0;n<=i;n++){if(this.notification[n].unread){e=this.notification[n].id;break}}return e},onCallViewStateChange:function t(e){var i=e.data;this.callViewState=i.callViewState},onUpdateState:function t(e){var i=e.data.lastId;if(!this.isLoadingInitialData&&this.highestNotificationId>0&&i!==this.highestNotificationId){this.getInitialData()}},readVisibleNotifications:function t(){var e=this;if(!this.windowFocused||!BXIM.settings.notifyAutoRead){c.Logger.warn("reading is disabled!");return false}this.readNotificationsQueue.forEach(function(t){if(e.readNotificationsNodes[t]){delete e.readNotificationsNodes[t]}e.readNotifications(parseInt(t,10))});this.readNotificationsQueue.clear()},getInitialData:function t(){var e,i=this;this.isLoadingInitialData=true;var n=(e={},babelHelpers.defineProperty(e,h.RestMethodHandler.imNotifyGet,[h.RestMethod.imNotifyGet,{LIMIT:this.perPage,CONVERT_TEXT:"Y"}]),babelHelpers.defineProperty(e,h.RestMethodHandler.imNotifySchemaGet,[h.RestMethod.imNotifySchemaGet,{}]),e);this.getRestClient().callBatch(n,function(t){c.Logger.warn("im.notify.get: initial result",t[h.RestMethodHandler.imNotifyGet].data());i.processInitialData(t[h.RestMethodHandler.imNotifyGet].data());i.processSchemaData(t[h.RestMethodHandler.imNotifySchemaGet].data());i.pagesLoaded++;i.isLoadingInitialData=false;i.firstUnreadNotificationOnInit=i.getFirstUnreadNotificationOnInit()},false,false)},processInitialData:function t(e){if(!e.notifications||e.notifications.length===0){this.$store.dispatch("notifications/clearPlaceholders");this.$store.dispatch("notifications/setTotal",{total:this.notification.length});return false}this.lastId=this.getLastItemId(e.notifications);this.lastType=this.getLastItemType(e.notifications);this.$store.dispatch("notifications/clearPlaceholders");this.$store.dispatch("notifications/setCounter",{unreadTotal:e.total_unread_count});this.$store.dispatch("notifications/set",{notification:e.notifications,total:e.total_count});this.$store.dispatch("users/set",e.users);this.updateRecentList(e.total_unread_count,true);this.initialDataReceived=true},processSchemaData:function t(e){this.$store.dispatch("notifications/setSchema",{data:e})},drawPlaceholders:function t(){var e=this.generatePlaceholders(this.perPage);return this.$store.dispatch("notifications/set",{notification:e})},loadNextPage:function t(){var e=this;c.Logger.warn("Loading more notifications!");var i={LIMIT:this.perPage,LAST_ID:this.lastId,LAST_TYPE:this.lastType,CONVERT_TEXT:"Y"};this.getRestClient().callMethod("im.notify.get",i).then(function(t){c.Logger.warn("im.notify.get: new page results",t.data());var i=t.data().users;var n=t.data().notifications;if(!n||n.length===0){e.$store.dispatch("notifications/clearPlaceholders");e.$store.dispatch("notifications/setTotal",{total:e.notification.length});return false}e.lastId=e.getLastItemId(n);e.lastType=e.getLastItemType(n);e.$store.dispatch("users/set",i);return e.$store.dispatch("notifications/updatePlaceholders",{items:n,firstItem:e.pagesLoaded*e.perPage})}).then(function(){e.pagesLoaded++;c.Logger.warn("Page loaded. Total loaded - ",e.pagesLoaded);return e.onAfterLoadNextPageRequest()}).catch(function(t){c.Logger.warn("Request history error",t)})},onAfterLoadNextPageRequest:function t(){c.Logger.warn("onAfterLoadNextPageRequest");if(this.pagesRequested>0){c.Logger.warn("We have delayed requests -",this.pagesRequested);this.pagesRequested--;return this.loadNextPage()}else{c.Logger.warn("No more delayed requests, clearing placeholders");this.$store.dispatch("notifications/clearPlaceholders");this.isLoadingNewPage=false;return true}},changeReadStatus:function t(e){var i=this;this.$store.dispatch("notifications/read",{ids:[e.id],action:e.unread});var n=this.unreadCounter;var s=e.unread?this.unreadCounter-1:this.unreadCounter+1;this.updateRecentList(s);this.$store.dispatch("notifications/setCounter",{unreadTotal:s});clearTimeout(this.changeReadStatusBlockTimeout[e.id]);this.changeReadStatusBlockTimeout[e.id]=setTimeout(function(){i.getRestClient().callMethod("im.notify.read",{id:e.id,action:e.unread?"Y":"N",only_current:"Y"}).then(function(){c.Logger.warn("Notification ".concat(e.id," unread status set to ").concat(!e.unread))}).catch(function(t){console.error(t);i.$store.dispatch("notifications/read",{ids:[e.id],action:!e.unread});i.updateRecentList(n);i.$store.dispatch("notifications/setCounter",{unreadTotal:n})})},1500)},delete:function t(e){var i=this;var n=+e.id;this.notificationsToDelete.push(n);var s=this.$store.getters["notifications/getById"](n);this.$store.dispatch("notifications/update",{id:n,fields:{display:false}});var o=this.unreadCounter;var a=s.unread?this.unreadCounter-1:this.unreadCounter;this.updateRecentList(a,true);this.$store.dispatch("notifications/setCounter",{unreadTotal:a});this.timer.stop("deleteNotificationServer","notifications",true);this.timer.start("deleteNotificationServer","notifications",.5,function(){var t=i.notificationsToDelete;i.notificationsToDelete=[];i.getRestClient().callMethod("im.notify.delete",{id:t}).then(function(){t.forEach(function(t){i.$store.dispatch("notifications/delete",{id:t})})}).catch(function(e){console.error(e);t.forEach(function(t){i.$store.dispatch("notifications/update",{id:t,fields:{display:true}})});i.updateRecentList(o,true);i.$store.dispatch("notifications/setCounter",{unreadTotal:o})})})},getObserver:function t(e){var i=this;if(typeof window.IntersectionObserver==="undefined"||e.type===x.none){return{observe:function t(){},unobserve:function t(){}}}var n=function t(e){e.forEach(function(t){var e=false;var n=parseInt(t.target.dataset.id,10);if(t.isIntersecting){if(t.intersectionRatio>=.99){e=true;i.notificationsOnScreen.push(n)}else if(t.intersectionRatio>0&&t.intersectionRect.height>t.rootBounds.height/2){e=true;i.notificationsOnScreen.push(n)}else{i.notificationsOnScreen=i.notificationsOnScreen.filter(function(t){return t!==n})}}else{i.notificationsOnScreen=i.notificationsOnScreen.filter(function(t){return t!==n})}if(e){i.readNotificationsQueue.add(n);i.readNotificationsNodes[n]=t.target}else{i.readNotificationsQueue.delete(n);delete i.readNotificationsNodes[n]}i.readVisibleNotificationsDelayed()})};var s={root:this.$refs["listNotifications"],threshold:new Array(101).fill(0).map(function(t,e){return e*.01})};return new IntersectionObserver(n,s)},onScroll:function t(e){var i=this;if(!this.isReadyToLoadNewPage(e)){return}if(this.remainingPages===0||!this.initialDataReceived){return}if(this.isLoadingNewPage){this.drawPlaceholders().then(function(){i.pagesRequested++;c.Logger.warn("Already loading! Draw placeholders and add request, total - ",i.pagesRequested)})}else{c.Logger.warn("Starting new request");this.isLoadingNewPage=true;this.drawPlaceholders().then(function(){i.loadNextPage()})}},onWindowFocus:function t(){this.windowFocused=true;this.readVisibleNotifications()},onWindowBlur:function t(){this.windowFocused=false},onDoubleClick:function t(e){this.changeReadStatus(e.item)},onButtonsClick:function t(e){var i=this;var n=this.getConfirmRequestParams(e);var s=+n.NOTIFY_ID;this.$store.dispatch("notifications/update",{id:s,fields:{display:false}});var o=this.unreadCounter;var a=this.unreadCounter-1;this.updateRecentList(a,true);this.$store.dispatch("notifications/setCounter",{unreadTotal:a});this.getRestClient().callMethod("im.notify.confirm",n).then(function(){i.$store.dispatch("notifications/delete",{id:s})}).catch(function(){i.$store.dispatch("notifications/update",{id:s,fields:{display:true}});i.updateRecentList(o,true);i.$store.dispatch("notifications/setCounter",{unreadTotal:o})})},onDeleteClick:function t(e){var i=this;this.delete(e.item);if(!this.isLoadingNewPage&&this.remainingPages>0&&this.notification.length===this.perPage-1){this.isLoadingNewPage=true;this.drawPlaceholders().then(function(){i.loadNextPage()})}},onRightClick:function t(e){var i=this;if(this.contextPopupInstance!==null){this.closeContextMenuPopup()}var n=this.getContextMenu(e.item);this.contextPopupInstance=d.MenuManager.create({id:"bx-messenger-context-popup-external-data",bindElement:e.event,items:n,events:{onPopupClose:function t(){return i.contextPopupInstance.destroy()},onPopupDestroy:function t(){return i.contextPopupInstance=null}}});this.contextPopupInstance.show()},onDateFilterClick:function t(e){var i=this;if(typeof BX!=="undefined"&&BX.calendar&&BX.calendar.get().popup){BX.calendar.get().popup.close()}BX.calendar({node:e.target,field:e.target,bTime:false,callback_after:function t(){i.searchDate=e.target.value}});return false},getContextMenu:function t(e){var i=this;var n=e.unread?this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_SET_READ"]:this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_SET_UNREAD"];var s=a.Type.isUndefined(BXIM.settingsNotifyBlocked[e.settingName])?this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_DONT_NOTIFY"]:this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_NOTIFY"];return[{text:n,onclick:function t(n,s){i.changeReadStatus(e);i.closeContextMenuPopup()}},{text:this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_DELETE_NOTIFICATION"],onclick:function t(n,s){i.delete(e);i.closeContextMenuPopup()}},{text:s,onclick:function t(n,s){console.log(e);i.closeContextMenuPopup()}}]},closeContextMenuPopup:function t(){this.contextPopupInstance.destroy();this.contextPopupInstance=null},getConfirmRequestParams:function t(e){if(e.params){var i=e.params.params.split("|");return{NOTIFY_ID:i[0],NOTIFY_VALUE:i[1]}}return null},readNotifications:function t(e){var i=this;var n=this.$store.getters["notifications/getById"](e);if(n.unread===false||n.sectionCode===h.NotificationTypesCodes.confirm){return false}this.notificationsToRead.push(e);this.$store.dispatch("notifications/read",{ids:[e],action:true});var s=this.unreadCounter;var o=this.unreadCounter-1;this.$store.dispatch("notifications/setCounter",{unreadTotal:o});this.updateRecentList(o);this.timer.stop("readNotificationServer","notifications",true);this.timer.start("readNotificationServer","notifications",.5,function(){var t=i.notificationsToRead;i.notificationsToRead=[];var e=false;if(i.firstUnreadNotificationOnInit!==null){e=Math.max.apply(Math,babelHelpers.toConsumableArray(t))<=i.firstUnreadNotificationOnInit}var n="im.notify.read.list";var o={ids:t,action:"Y"};if(e){var a=Math.min.apply(Math,babelHelpers.toConsumableArray(t));n="im.notify.read";o={id:a,action:"Y"}}i.getRestClient().callMethod(n,o).then(function(){c.Logger.warn("I have read the notifications",o)}).catch(function(){i.$store.dispatch("notifications/read",{ids:t,action:false});i.$store.dispatch("notifications/setCounter",{unreadTotal:s});i.updateRecentList(s)})})},getLastItemType:function t(e){return this.getItemType(e[e.length-1])},getItemType:function t(e){if(e.notify_type===h.NotificationTypesCodes.confirm){return h.NotificationTypesCodes.confirm}else{return h.NotificationTypesCodes.simple}},getLatest:function t(){var e={id:0};var i=C(this.notification),n;try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s.id>e.id){e=s}}}catch(t){i.e(t)}finally{i.f()}return e},showConfirmPopupOnReadAll:function t(){var e=this.readAll.bind(this);BXIM.openConfirm(this.localize["IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP"],[new BX.PopupWindowButton({text:this.localize["IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_YES"],className:"popup-window-button-accept",events:{click:function t(){e();this.popupWindow.close()}}}),new BX.PopupWindowButton({text:this.localize["IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_CANCEL"],className:"popup-window-button",events:{click:function t(){this.popupWindow.close()}}})])},readAll:function t(){var e=this;if(this.notification.lastId<=0){return}if(!this.isNeedToReadAll){return false}this.$store.dispatch("notifications/readAll");var i=this.notification.filter(function(t){return t.sectionCode===h.NotificationTypesCodes.confirm});this.$store.dispatch("notifications/setCounter",{unreadTotal:i.length});this.updateRecentList(i.length);this.getRestClient().callMethod("im.notify.read",{id:0,action:"Y"}).catch(function(t){e.getInitialData();console.error(t)})},updateRecentList:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n={counter:e};if(i){var s=this.getLatest();n.message={id:s.id,text:s.text,date:s.date}}this.$store.dispatch("recent/update",{id:"notify",fields:n})},onScrollButtonClick:function t(e){if(this.isLoadingNewPage||!this.initialDataReceived){return false}var i=null;if(this.firstUnreadNotificationBelowVisible!==null){i=this.firstUnreadNotificationBelowVisible}else if(!this.hasUnreadBelowVisible){i=this.firstUnreadNotification.id}var n=null;if(i!==null){var s='.bx-im-notifications-item[data-id="'.concat(i,'"]');n=document.querySelector(s)}if(n){this.animatedScrollToPosition({start:this.$refs["listNotifications"].scrollTop,end:n.offsetTop})}else{var o=this.notification[this.notification.length-1];var a='.bx-im-notifications-item[data-id="'.concat(o.id,'"]');var r=document.querySelector(a);this.animatedScrollToPosition({start:this.$refs["listNotifications"].scrollTop,end:r.offsetTop})}},animatedScrollToPosition:function t(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.animateScrollId){e.Animation.cancel(this.animateScrollId);this.scrollAnimating=false}if(typeof n==="function"){n={callback:n}}var s=this.$refs.listNotifications;var o=n,a=o.start,r=a===void 0?s.scrollTop:a,c=o.end,l=c===void 0?s.scrollHeight-s.clientHeight:c,u=o.increment,d=u===void 0?20:u,f=o.callback,h=o.duration,p=h===void 0?500:h;if(s&&l-r>s.offsetHeight*3){r=l-s.offsetHeight*3}this.scrollAnimating=true;this.animateScrollId=e.Animation.start({start:r,end:l,increment:d,duration:p,element:s,elementProperty:"scrollTop",callback:function t(){i.animateScrollId=null;i.scrollAnimating=false;if(f&&typeof f==="function"){f()}}})}},template:'\n\t\t<div class="bx-messenger-next-notify">\n\t\t\t<div class="bx-messenger-panel-next-wrapper" :style="panelStyles">\n\t\t\t\t<div class="bx-messenger-panel-next">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass="bx-messenger-panel-avatar bx-im-notifications-image-system bx-im-notifications-header-image"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class="bx-messenger-panel-title bx-messenger-panel-title-middle" style="flex-shrink: 0;">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_HEADER\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="notification.length > 0" class="bx-im-notifications-header-buttons">\n\t\t\t\t\t\t<transition name="notifications-read-all-fade">\n\t\t\t\t\t\t\t<div v-if="isNeedToReadAll" class="bx-im-notifications-header-read-all">\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\'bx-messenger-panel-button bx-im-notifications-header-read-all-icon\'\n\t\t\t\t\t\t\t\t\t@click="showConfirmPopupOnReadAll"\n\t\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_READ_ALL_BUTTON\')"\n\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</transition>\n\t\t\t\t\t\t<div class="bx-im-notifications-header-filter">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t:class="[\'bx-messenger-panel-button bx-messenger-panel-history bx-im-notifications-header-filter-icon\', (showSearch? \'bx-im-notifications-header-filter-active\': \'\')]"\n\t\t\t\t\t\t\t\t@click="showSearch = !showSearch"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_OPEN_BUTTON\')"\n\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showSearch" class="bx-im-notifications-header-filter-box" :style="filterBoxStyles">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-xs ui-ctl-w25">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="searchType">\n\t\t\t\t\t\t\t<option value="">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_PLACEHOLDER\') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t<template v-for="group in filterTypes">\n\t\t\t\t\t\t\t\t<template v-if="group.LIST">\n\t\t\t\t\t\t\t\t\t<optgroup :label="group.NAME">\n\t\t\t\t\t\t\t\t\t\t<option v-for="option in group.LIST" :value="option.ID">\n\t\t\t\t\t\t\t\t\t\t\t{{ option.NAME }}\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>   \n\t\t\t\t\t\t\t\t\t<option :value="group.MODULE_ID">\n\t\t\t\t\t\t\t\t\t\t{{ group.NAME }}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-xs ui-ctl-w50"> \n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click.prevent="searchQuery=\'\'"></button>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\tv-model="searchQuery" \n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_TEXT_PLACEHOLDER\')"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-before-icon ui-ctl-xs ui-ctl-w25">\n\t\t\t\t\t\t<div class="ui-ctl-before ui-ctl-icon-calendar"></div>\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox" \n\t\t\t\t\t\t\tv-model="searchDate"\n\t\t\t\t\t\t\t@focus.prevent.stop="onDateFilterClick"\n\t\t\t\t\t\t\t@click.prevent.stop="onDateFilterClick"\n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_DATE_PLACEHOLDER\')"\n\t\t\t\t\t\t\treadonly\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click.prevent="searchDate=\'\'"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if="showSearch && (searchQuery.length >= 3 || searchType !== \'\' || searchDate !== \'\')" \n\t\t\t\tclass="bx-messenger-list-notifications-wrap"\n\t\t\t>\n\t\t\t\t<NotificationSearchResult :searchQuery="searchQuery" :searchType="searchType" :searchDate="searchDate"/>\n\t\t\t</div>\n\t\t\t<div v-else class="bx-messenger-list-notifications-wrap">\n\t\t\t\t<div :class="[ darkTheme ? \'bx-messenger-dark\' : \'\', \'bx-messenger-list-notifications\']" @scroll.passive="onScroll" ref="listNotifications">\n\t\t\t\t\t<notification-item\n\t\t\t\t\t\tv-for="listItem in visibleNotifications"\n\t\t\t\t\t\t:key="listItem.id"\n\t\t\t\t\t\t:data-id="listItem.id"\n\t\t\t\t\t\t:rawListItem="listItem"\n\t\t\t\t\t\t@dblclick="onDoubleClick"\n\t\t\t\t\t\t@buttonsClick="onButtonsClick"\n\t\t\t\t\t\t@deleteClick="onDeleteClick"\n\t\t\t\t\t\t@contentClick="onContentClick"\n\t\t\t\t\t\tv-bx-im-directive-notifications-observer="\n\t\t\t\t\t\t\tlistItem.sectionCode !== NotificationTypesCodes.placeholder\n\t\t\t\t\t\t\t? ObserverType.read \n\t\t\t\t\t\t\t: ObserverType.none\n\t\t\t\t\t\t"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="notification.length <= 0"\n\t\t\t\t\t\tstyle="padding-top: 210px; margin-bottom: 20px;"\n\t\t\t\t\t\tclass="bx-messenger-box-empty bx-notifier-content-empty"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_NO_ITEMS\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Scroll button --\x3e\n\t\t\t\t<transition name="bx-im-notifications-scroll-button">\n\t\t\t\t\t<div v-show="showScrollButton" class="bx-im-notifications-scroll-button-box" @click="onScrollButtonClick">\n\t\t\t\t\t\t<div class="bx-im-notifications-scroll-button">\n\t\t\t\t\t\t\t<div class="bx-im-notifications-scroll-button-counter">\n\t\t\t\t\t\t\t\t<div class="bx-im-notifications-scroll-button-counter-digit">{{ unreadCounter }}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div :class="arrowButtonClass"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t\t\n\t\t\t\t<mounting-portal :mount-to="popupIdSelector" append v-if="popupInstance">\n\t\t\t\t\t<popup :type="contentPopupType" :value="contentPopupValue" :popupInstance="popupInstance"/>\n\t\t\t\t</mounting-portal>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.BX.Messenger=this.BX.Messenger||{},BX.Messenger.Lib,BX,window,window,BX,BX,BX,BX.Messenger.Lib,BX.Vue,BX.Messenger.View,BX.Main,BX.Messenger.Lib,BX.Messenger.Const,BX.Messenger.Lib,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:86:"/local/js/im/application/notifications/dist/notifications.bundle.min.js?16547598173079";s:6:"source";s:67:"/local/js/im/application/notifications/dist/notifications.bundle.js";s:3:"min";s:71:"/local/js/im/application/notifications/dist/notifications.bundle.min.js";s:3:"map";s:71:"/local/js/im/application/notifications/dist/notifications.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t,e,n,i,r){"use strict";var o=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.inited=false;this.initPromise=new BX.Promise;this.params=i;this.template=null;this.rootNode=this.params.node||document.createElement("div");this.legacyMode=this.params.mode==="legacy";this.initCounter=this.params.initCounter||null;this.templateTemp=null;this.eventBus=new n.VueVendorV2;this.initCore().then(function(){return e.initParams()}).then(function(){return e.initComponent(e.legacyMode)}).then(function(){return e.initPullClient()}).then(function(){return e.initPullHandlers()}).then(function(){return e.initComplete()})}babelHelpers.createClass(t,[{key:"initPullClient",value:function t(){this.pullClient=BX.PULL;return new Promise(function(t,e){return t()})}},{key:"initPullHandlers",value:function t(){this.pullClient.subscribe(new r.ImNotificationsPullHandler({store:this.controller.getStore(),application:this,controller:this.controller}));return new Promise(function(t,e){return t()})}},{key:"initCore",value:function t(){var n=this;return new Promise(function(t,i){e.Core.ready().then(function(e){n.controller=e;t()})})}},{key:"initParams",value:function t(){var e=this;if(this.initCounter){this.controller.getStore().dispatch("notifications/setCounter",{unreadTotal:this.initCounter})}this.controller.getStore().subscribe(function(t){return e.eventStoreInteraction(t)});return new Promise(function(t,e){return t()})}},{key:"initComponent",value:function t(e){var n=this;if(e){return new Promise(function(t,e){return t()})}var i;if(this.legacyMode){i="<bx-im-component-notifications/>"}else{i='<div style="height: 400px; border: 1px solid #ccc;">\n\t\t\t\t<bx-im-component-notifications/>\n\t\t\t</div>'}return this.controller.createVue(this,{el:this.rootNode,template:i}).then(function(t){n.template=t;n.template.$el.id=n.rootNode.substr(1);return new Promise(function(t,e){return t()})})}},{key:"initComplete",value:function t(){this.inited=true;this.initPromise.resolve(this)}},{key:"ready",value:function t(){if(this.inited){var e=new BX.Promise;e.resolve(this);return e}return this.initPromise}},{key:"emit",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.eventBus.$emit(e,n);return true}},{key:"listen",value:function t(e,n){if(typeof n!=="function"){return false}this.eventBus.$on(e,n);return true}},{key:"hasVueInstance",value:function t(){return this.template!==null}},{key:"destroyVueInstance",value:function t(){this.template.$destroy();this.template=null}},{key:"eventStoreInteraction",value:function t(e){if(e.type==="notifications/setCounter"){if(parseInt(e.payload)>=0){BXIM.notify.updateNotifyNextCount(parseInt(e.payload),true)}}}}]);return t}();t.NotificationsApplication=o})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger.Application,BX,BX.Messenger,BX.Messenger.Provider.Pull);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?165484154813312";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.selectorManagerV2={getById:function(t){if(typeof this.controls[t]!="undefined"){return this.controls[t]}return null},controls:{},loadedEntities:{}};BX.Main.SelectorV2=function(){this.initialized=false;this.blockInit=false;this.id="";this.apiVersion=2;this.fieldName=null;this.inputId=null;this.input=null;this.tagId=null;this.tag=null;this.options=null;this.callback=null;this.callbackBefore=null;this.items=null;this.entities=null;this.mainPopupWindow=null;this.entitiesSet=["users","emails","crmemails","groups","sonetgroups","department","departmentRelation","contacts","companies","leads","deals"];this.entityTypes={};this.auxObject=null;this.selectorInstance=null;this.eventOpenBinded=false};BX.Main.SelectorV2.controls={};BX.Main.SelectorV2.create=function(t){if(typeof t.id=="undefined"||!t.id){t.id=BX.util.hashCode(Math.random().toString())}else if(typeof BX.Main.selectorManagerV2.controls[t.id]!="undefined"){var e=BX.Main.selectorManagerV2.controls[t.id];if(e.bindNode&&!document.body.contains(e.bindNode)){delete BX.Main.selectorManagerV2.controls[t.id]}else{return BX.Main.selectorManagerV2.controls[t.id]}}var i=new BX.Main.SelectorV2;BX.Main.selectorManagerV2.controls[t.id]=i;i.init(t);return i};BX.Main.SelectorV2.proxyCallback=function(t,e){t(e)};BX.Main.SelectorV2.prototype={init:function(t){this.id=t.id;this.apiVersion=t.apiVersion&&parseInt(t.apiVersion)>=2?parseInt(t.apiVersion):2;this.fieldName=t.fieldName?t.fieldName:null;this.inputId=t.inputId?t.inputId:null;this.input=t.inputId&&BX(t.inputId)?BX(t.inputId):null;this.inputBox=t.inputBoxId&&BX(t.inputBoxId)?BX(t.inputBoxId):null;this.inputItemsContainer=t.inputContainerId&&BX(t.inputContainerId)?BX(t.inputContainerId):null;this.containerNode=t.containerId&&BX(t.containerId)?BX(t.containerId):null;this.bindNode=t.bindId&&BX(t.bindId)?BX(t.bindId):this.containerNode;this.tagId=t.tagId?t.tagId:null;this.tag=t.tagId&&BX(t.tagId)?BX(t.tagId):null;this.openDialogWhenInit=typeof t.openDialogWhenInit=="undefined"||!!t.openDialogWhenInit;this.options=t.options||{};this.callback=t.callback||null;this.callbackBefore=t.callbackBefore||null;this.items=t.items||null;this.entities=t.entities||null;this.entityTypes={};BX.onCustomEvent("BX.Main.SelectorV2:onGetEntityTypes",[{selector:this}]);this.selectorInstance=BX.UI.Selector.create({id:this.id,fieldName:this.fieldName,type:"xxx",pathToAjax:BX.type.isNotEmptyString(t.pathToAjax)?t.pathToAjax:null,input:this.input||null,tag:this.tag||null,inputBox:this.inputBox||null,inputItemsContainer:this.inputItemsContainer||null,entities:BX.clone(this.entityTypes),itemsSelected:BX.clone(this.items.selected)||{},itemsUndeletable:BX.clone(this.items.undeletable)||[],options:{multiple:this.getOption("multiple"),useSearch:this.getOption("useSearch"),useContainer:this.getOption("useContainer")=="Y"?"Y":"N",userNameTemplate:this.getOption("userNameTemplate"),siteDepartmentId:this.getOption("siteDepartmentId"),showCloseIcon:"Y",popupAutoHide:this.getOption("popupAutoHide")=="N"?"N":"Y",last:{disable:this.getOption("disableLast")=="Y"?"Y":"N"},search:{useAjax:this.getOption("sendAjaxSearch")!="N"?"Y":"N",useClientDatabase:this.getOption("useClientDatabase")=="Y"?"Y":"N"},focusInputOnSelectItem:this.getOption("focusInputOnSelectItem")!="N"?"Y":"N",focusInputOnSwitchTab:this.getOption("focusInputOnSwitchTab")!="N"?"Y":"N",isCrmFeed:this.getOption("isCrmFeed")=="Y"?"Y":"N",tagLink1:this.getOption("tagLink1"),tagLink2:this.getOption("tagLink2")},bindOptions:{node:this.bindNode,offsetTop:5,offsetLeft:15,zIndex:parseInt(this.getOption("popupZIndex"))>0?parseInt(this.getOption("popupZIndex")):1200},callback:this.callback,callbackBefore:this.callbackBefore});BX.addCustomEvent("BX.UI.SelectorManager:getTreeItemRelation",function(t){if(this.id==t.selectorId){this.getTreeItemRelation(t)}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:loadAll",function(t){this.loadAll(t)}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:initDialog",function(t){if(this.id==t.selectorId){if(!!t.openDialogWhenInit){this.openDialogWhenInit=true}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:reInitDialog",function(t){if(this.id==t.selectorId){this.initialized=false;this.items.selected=BX.type.isNotEmptyObject(t.selectedItems)?t.selectedItems:{};this.items.undeletable=BX.type.isNotEmptyObject(t.undeletableItems)?t.undeletableItems:{};var e=BX.UI.SelectorManager.instances[t.selectorId],i=null,n=null,s=0;if(e){for(var o in e.itemsSelected){if(e.itemsSelected.hasOwnProperty(o)){i=e.itemsSelected[o].toUpperCase();n=BX.UI.SelectorManager.getEntityTypeFullList(i);for(s=0;s<n.length;s++){if(BX.type.isNotEmptyObject(e.entities[n[s]])){e.unselectItem({itemNode:BX.type.isNotEmptyObject(e.entities[n[s]].items)&&BX.type.isNotEmptyObject(e.entities[n[s]].items[o])?e.entities[n[s]].items[o]:false,itemId:o,entityType:n[s],mode:"reinit"})}}}}e.itemsSelected=this.items.selected;e.itemsUndeletable=this.items.undeletable}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:searchRequest",function(t){if(this.id==t.selectorInstance.id){t.selectorInstance.timeouts.search=setTimeout(function(){this.searchRequest(t)}.bind(this),1e3)}}.bind(this));BX.addCustomEvent("BX.UI.Selector:onSelectItem",function(t){if(this.apiVersion>=3&&BX.type.isNotEmptyObject(t)&&this.id==t.selectorId&&BX.type.isNotEmptyString(t.itemId)){this.saveDestination({itemId:t.itemId})}}.bind(this));if(!BX.type.isNotEmptyString(this.getOption("lheName"))){var e=BX("div"+this.getOption("lheName"));if(e){BX.addCustomEvent(e,"OnShowLHE",function(t){if(!t){this.selectorInstance.closeAllPopups()}}.bind(this))}}if(this.getOption("useContainer")!="Y"&&this.input){if(this.getOption("lazyLoad")!="Y"||BX.type.isNotEmptyObject(this.items.selected)){if(BX.type.isNotEmptyObject(this.items.selected)){this.openDialogWhenInit=false}this.initDialog()}if(this.tag){BX.bind(this.tag,"focus",BX.delegate(function(t){this.initDialog({realParams:true,bByFocusEvent:true});return t.preventDefault()},this));this.selectorInstance.setTagTitle()}BX.bind(this.input,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(this.input,"bxchange",function(e){setTimeout(function(){this.selectorInstance.getSearchInstance().searchHandler({event:e,tagInputName:t.tagId})}.bind(this),0)}.bind(this));this.input.setAttribute("data-bxchangehandler","Y")}else if(this.getOption("useContainer")=="Y"&&(this.getOption("lazyLoad")!="Y"||this.getOption("useContainer")=="Y")){this.initDialog()}if(this.items.hidden){for(var i in this.items.hidden){if(this.items.hidden.hasOwnProperty(i)){this.callback.select.apply({id:(typeof this.items.hidden[i]["PREFIX"]!="undefined"?this.items.hidden[i]["PREFIX"]:"SG")+this.items.hidden[i]["ID"],name:this.items.hidden[i]["NAME"]},typeof this.items.hidden[i]["TYPE"]!="undefined"?this.items.hidden[i]["TYPE"]:"sonetgroups","",true,"","init")}}}},show:function(){this.initDialog()},initDialog:function(t){if(typeof t=="undefined"||typeof t.realParams=="undefined"){t=null}if(this.blockInit){return}var e={id:this.id};if(!this.initialized){BX.onCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",[e])}setTimeout(BX.delegate(function(){if(typeof e.blockInit=="undefined"||e.blockInit!==true){if(this.initialized){if(!this.mainPopupWindow||!this.mainPopupWindow.isShown()){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}}else{this.getData(BX.delegate(function(e){if(!!this.openDialogWhenInit){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}BX.onCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",[{id:this.id}]);if(typeof this.options.eventOpen!="undefined"&&!this.eventOpenBinded){this.eventOpenBinded=true;BX.addCustomEvent(window,this.options.eventOpen,function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(this.options.multiple!="Y"&&this.inputItemsContainer&&this.inputItemsContainer.children.length>0){return}if(this.mainPopupWindow&&this.mainPopupWindow.isShown()){return}if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}var e=BX.type.isNotEmptyObject(t)&&t.bindNode?t.bindNode:this.bindNode;var i=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:false;if(e){var n=BX.findChild(e,{tagName:"input",attr:{type:"text"}},true);if(n){this.selectorInstance.nodes.input=n;var s=this.tag||BX(t.tagId);if(s){this.selectorInstance.nodes.tag=s}if(n.getAttribute("data-bxchangehandler")!=="Y"){BX.bind(n,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(n,"bxchange",function(t){this.selectorInstance.getSearchInstance().searchHandler({event:t})}.bind(this));n.setAttribute("data-bxchangehandler","Y")}}}if(i||e){if(!this.initialized){this.selectorInstance.itemsSelected={}}if(typeof t.value!="undefined"){this.selectorInstance.itemsSelected=t.value}this.openDialog({bindNode:e,bindPosition:i})}}.bind(this))}},this))}}},this),1)},openDialog:function(t){if(BX.type.isNotEmptyObject(t)){if(typeof t.bindNode!="undefined"){this.selectorInstance.bindOptions.node=t.bindNode}if(typeof t.bindPosition!="undefined"){this.selectorInstance.bindOptions.position=t.bindPosition}}this.selectorInstance.openDialog();this.mainPopupWindow=this.getOption("useContainer")=="Y"?this.selectorInstance.popups.container:this.selectorInstance.popups.main},closeDialog:function(){this.selectorInstance.closeDialog()},getData:function(t){this.blockInit=true;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataStart",[this.id]);BX.ajax.runComponentAction("bitrix:main.ui.selector","getData",{mode:"ajax",data:{options:this.options,entityTypes:this.entityTypes,selectedItems:this.items.selected||{}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id]);this.addData(e.data,t);this.initialized=true}}.bind(this),function(t){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id])}.bind(this))},loadAll:function(t){var e=BX.type.isNotEmptyString(t.entity)?t.entity.toUpperCase():"USERS";if(BX.type.isNotEmptyObject(t)&&BX.type.isFunction(t.callback)&&!BX.Main.selectorManagerV2.loadedEntities[e]){BX.Main.selectorManagerV2.loadedEntities[e]=true;BX.ajax.runComponentAction("bitrix:main.ui.selector","loadAll",{mode:"ajax",data:{entityType:e}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){for(var i in e.data){if(e.data.hasOwnProperty(i)){BX.onCustomEvent("onFinderAjaxLoadAll",[e.data[i],BX.UI.SelectorManager,i.toLowerCase()])}}t.callback()}}.bind(this),function(t){}.bind(this))}},searchRequest:function(t){this.blockInit=true;if(this.selectorInstance.timeouts.search){clearTimeout(this.selectorInstance.timeouts.search)}var e=new Date;this.selectorInstance.searchRequestId=e.getTime();BX.ajax.runComponentAction("bitrix:main.ui.selector","doSearch",{mode:"ajax",data:{searchString:t.searchString,searchStringConverted:BX.message("LANGUAGE_ID")=="ru"&&BX.correctText?BX.correctText(t.searchString):"",currentTimestamp:this.selectorInstance.searchRequestId,options:this.options,entityTypes:this.entityTypes,additionalData:BX.type.isNotEmptyObject(t.additionalData)?t.additionalData:{}},onrequeststart:function(t){this.selectorInstance.searchXhr=t}.bind(this)}).then(function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(e.data)&&e.data.currentTimestamp&&e.data.currentTimestamp==this.selectorInstance.searchRequestId&&BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.success)){t.callback.success(e.data,{searchString:t.searchString,searchStringOriginal:BX.type.isNotEmptyObject(t.searchStringOriginal)?t.searchStringOriginal:t.searchString})}}.bind(this),function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.failure)){t.callback.failure(BX.type.isNotEmptyObject(e.data)?e.data:{})}}.bind(this))},getTreeItemRelation:function(t){BX.ajax.runComponentAction("bitrix:main.ui.selector","getTreeItemRelation",{mode:"ajax",data:{entityType:t.entityType,categoryId:t.categoryId}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)&&typeof t.callback!="undefined"){t.callback({selectorInstanceId:this.selectorInstance.id,entityType:t.entityType,categoryId:t.categoryId,data:e.data})}}.bind(this),function(t){})},addData:function(t,e){BX.onCustomEvent("BX.Main.SelectorV2:onAddData",[this.id,t]);if(typeof t.ENTITIES.CRM!="undefined"&&typeof t.ENTITIES.CRM.ITEMS_LAST!="undefined"&&BX.type.isNotEmptyObject(t.ENTITIES.CRM.ITEMS_LAST)){}e.apply(this,t)},getId:function(){return this.id},getOption:function(t){return typeof this.options[t]!="undefined"?this.options[t]:null},saveDestination:function(t){if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.itemId)){var e=this.getOption("context");if(BX.type.isNotEmptyString(e)){BX.ajax.runComponentAction("bitrix:main.ui.selector","saveDestination",{mode:"ajax",data:{context:e,itemId:t.itemId}}).then(function(t){},function(t){})}}}}})();
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?165484154145567*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1654841541575*/
; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16548423932527*/
; /* /bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?16548425225071*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/script.min.js?165475981818040*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/utils.min.js?1654759818735*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/stresslevel.min.js?16547598187950*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/grats.min.js?16547598187573*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/profilepost.min.js?16547598186181*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags.min.js?165475981814658*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/tags-users-popup.min.js?16547598185162*/
; /* /local/templates/.default/components/bitrix/intranet.user.profile/.default/js/form-entity.min.js?165475981816030*/
; /* /bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?16548420241622*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?165484154462061*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1654841551814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?165484184530971*/
; /* /local/js/im/lib/localstorage/dist/localstorage.bundle.min.js?16547598172914*/
; /* /local/js/im/lib/logger/dist/logger.bundle.min.js?16547598174491*/
; /* /local/js/im/const/dist/registry.bundle.min.js?16547598176519*/
; /* /local/js/im/lib/utils/dist/utils.bundle.min.js?165475981718118*/
; /* /local/js/im/model/dist/registry.bundle.min.js?165475981797207*/
; /* /local/js/im/provider/pull/dist/registry.bundle.min.js?165475981718727*/
; /* /local/js/im/provider/rest/dist/registry.bundle.min.js?16547598175400*/
; /* /local/js/im/lib/timer/dist/timer.bundle.min.js?16547598172172*/
; /* /local/js/im/controller/dist/controller.bundle.min.js?165475981720247*/
; /* /local/js/im/application/launch/dist/launch.bundle.min.js?16547598171204*/
; /* /local/js/im/application/core/dist/core.bundle.min.js?1654759817436*/
; /* /local/js/im/lib/animation/dist/animation.bundle.min.js?16547598171109*/
; /* /local/js/im/view/element/attach/dist/attach.bundle.min.js?165475981717056*/
; /* /local/js/im/view/element/keyboard/dist/keyboard.bundle.min.js?16547598173415*/
; /* /local/js/im/view/popup/dist/popup.bundle.min.js?16547598189787*/
; /* /local/js/im/component/notifications/dist/notifications.bundle.min.js?165475981747876*/
; /* /local/js/im/application/notifications/dist/notifications.bundle.min.js?16547598173079*/
; /* /bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?165484154813312*/

//# sourceMappingURL=page_7283c227b887328c78237e93ce230f2d.map.js