
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16548423932527";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var waitDiv = null;
var waitPopup = null;
var waitTimeout = null;
var waitTime = 500;

function __SASSetAdmin()
{
	__SASShowWait();
	BX.ajax({
		url: '/bitrix/components/bitrix/socialnetwork.admin.set/ajax.php',
		method: 'POST',
		dataType: 'json',
		data: {'ACTION': 'SET', 'sessid': BX.bitrix_sessid(), 'site': BX.util.urlencode(BX.message('SASSiteId'))},
		onsuccess: function(data) { __SASProcessAJAXResponse(data); }
	});
}

function __SASProcessAJAXResponse(data)
{
	if (data["SUCCESS"] != "undefined" && data["SUCCESS"] == "Y")
	{
		BX.reload();
		return false;
	}
	else if (data["ERROR"] != "undefined" && data["ERROR"].length > 0)
	{
		if (data["ERROR"].indexOf("SESSION_ERROR", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorSessionWrong'));
			BX.reload();
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_ADMIN", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorNotAdmin'));
			return false;
		}
		else if (data["ERROR"].indexOf("CURRENT_USER_NOT_AUTH", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorCurrentUserNotAuthorized'));
			return false;
		}
		else if (data["ERROR"].indexOf("SONET_MODULE_NOT_INSTALLED", 0) === 0)
		{
			__SASShowError(BX.message('SASErrorModuleNotInstalled'));
			return false;
		}
		else
		{
			__SASShowError(data["ERROR"]);
			return false;		
		}
	}
}
				
function __SASShowError(errorText) 
{
	__SASCloseWait();

	var errorPopup = new BX.PopupWindow('sas-error' + Math.random(), window, {
		autoHide: true,
		lightShadow: false,
		zIndex: 2,
		content: BX.create('DIV', {props: {'className': 'sonet-adminset-error-text-block'}, html: errorText}),
		closeByEsc: true,
		closeIcon: true
	});
	errorPopup.show();

}

function __SASShowWait(timeout)
{
	if (timeout !== 0)
	{
		return (waitTimeout = setTimeout(function(){
			__SASShowWait(0)
		}, 50));
	}

	if (!waitPopup)
	{
		waitPopup = new BX.PopupWindow('sas_wait', window, {
			autoHide: true,
			lightShadow: true,
			zIndex: 2,
			content: BX.create('DIV', {
				props: {
					className: 'sonet-adminset-wait-cont'
				},
				children: [
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-icon'
						}
					}),
					BX.create('DIV', {
						props: {
							className: 'sonet-adminset-wait-text'
						},
						html: BX.message('SASWaitTitle')
					})
				]
			})
		});
	}
	else
		waitPopup.setBindElement(window);

	waitPopup.show();
}

function __SASCloseWait()
{
	if (waitTimeout)
	{
		clearTimeout(waitTimeout);
		waitTimeout = null;
	}

	if (waitPopup)
		waitPopup.close();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:82:"/bitrix/components/bitrix/app.placement/templates/menu/script.min.js?1654842249580";s:6:"source";s:64:"/bitrix/components/bitrix/app.placement/templates/menu/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.rest");if(!!BX.rest.PlacementMenu){return}BX.rest.PlacementMenu=function(e){BX.rest.PlacementMenu.superclass.constructor.apply(this,arguments)};BX.extend(BX.rest.PlacementMenu,BX.rest.Placement);BX.rest.PlacementMenu.prototype.load=function(e,t,n,a){this.initializeInterface(a);BX.rest.AppLayout.openApplication(t,n,{PLACEMENT_ID:e,PLACEMENT:this.param.placement})};BX.rest.PlacementMenu.prototype.initializeInterface=function(e){var t=top.BX.rest.AppLayout.initializePlacement(this.param.placement);t.prototype.reloadData=function(t,n){e();n()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js?165484247031714";s:6:"source";s:70:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/tasks.task.list/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks.Grid");BX.Tasks.GridActions={gridId:null,groupSelector:null,registeredTimerNodes:{},defaultPresetId:"",taskPath:"",getTotalCountProceed:false,currentGroupAction:null,groupId:0,checkCanMove:function(){return!BX.Tasks.GridInstance||BX.Tasks.GridInstance.checkCanMove()},initPopupBalloon:function(t,e,i){this.groupSelector=null;BX.bind(BX(e+"_control"),"click",BX.delegate(function(){if(!this.groupSelector){this.groupSelector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:BX(e+"_control"),id:"group-selector-"+this.gridId,mode:t,query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this.groupSelector.bindEvent("item-selected",BX.delegate(function(t){BX(e+"_control").value=BX.util.htmlspecialcharsback(t.nameFormatted)||"";BX(i+"_control").value=t.id||"";this.groupSelector.close()},this))}this.groupSelector.open()},this))},toggleFilter:function(t,e){var i=BX.Main.filterManager.getById(this.gridId);if(!i){console.log("BX.Main.filterManager not initialised");return}if(!e){i.getApi().extendFilter(t);return}var s=i.getFilterFields();Object.keys(t).forEach(function(t){s.forEach(function(e){if(e.getAttribute("data-name")===t){i.getFields().deleteField(e)}})});i.getSearch().apply()},filter:function(t){var e=BX.Main.filterManager.getById(this.gridId);if(!e){console.log("BX.Main.filterManager not initialised");return}var i=e.getFilterFieldsValues();var s=e.getApi();Object.keys(t).forEach(function(e){i[e]=t[e]});s.setFields(i);s.apply()},changePin:function(t){var e=t.getData();var i=e.button;var s=e.row;var r=BX.Tasks.GridActions.groupId;if(BX.Dom.hasClass(i,BX.Grid.CellActionState.ACTIVE)){BX.Tasks.GridActions.action("unpin",s.getId(),{groupId:r});BX.Dom.removeClass(i,BX.Grid.CellActionState.ACTIVE);BX.Dom.addClass(i,BX.Grid.CellActionState.SHOW_BY_HOVER)}else{BX.Tasks.GridActions.action("pin",s.getId(),{groupId:r});BX.Dom.addClass(i,BX.Grid.CellActionState.ACTIVE);BX.Dom.removeClass(i,BX.Grid.CellActionState.SHOW_BY_HOVER)}},changeMute:function(t){var e=t.getData();var i=e.button;var s=e.row;if(BX.Dom.hasClass(i,BX.Grid.CellActionState.ACTIVE)){BX.Tasks.GridActions.action("unmute",s.getId());BX.Dom.removeClass(i,BX.Grid.CellActionState.ACTIVE);BX.Dom.addClass(i,BX.Grid.CellActionState.SHOW_BY_HOVER)}else{BX.Tasks.GridActions.action("mute",s.getId());BX.Dom.addClass(i,BX.Grid.CellActionState.ACTIVE);BX.Dom.removeClass(i,BX.Grid.CellActionState.SHOW_BY_HOVER)}},onCounterClick:function(t){var e=t.getData();var i=e.row;if(BX.Tasks.GridActions.taskPath){BX.SidePanel.Instance.open(BX.Tasks.GridActions.taskPath.replace("#task_id#",i.getId()))}},action:function(t,e,i){if(t==="add2Timeman"){if(BX.addTaskToPlanner){BX.addTaskToPlanner(e)}else if(window.top.BX.addTaskToPlanner){window.top.BX.addTaskToPlanner(e)}}else{this.doAction(t,e,i)}},doAction:function(t,e,i){i=i||{};i["id"]=e;this.getQuery(t).add("task."+t.toLowerCase(),i,{},BX.delegate(function(t,i){if(!t.checkHasErrors()){if(i.OPERATION=="task.delete"){BX.Tasks.Util.fireGlobalTaskEvent("DELETE",{ID:e});BX.UI.Notification.Center.notify({content:BX.message("TASKS_DELETE_SUCCESS")})}if(!this.gridId){window.location.href=window.location.href;return}if(!this.checkCanMove()){this.reloadRow(e)}}},this))},getQuery:function(t){var e=BX.message("_VIEW_TYPE");var i="/bitrix/components/bitrix/tasks.base/ajax.php?_CODE="+(t||"")+"&viewType="+e;if(!this.query){this.query=new BX.Tasks.Util.Query({url:i,autoExec:true})}return this.query},getTotalCount:function(t,e,i,s){if(this.getTotalCountProceed){return}this.getTotalCountProceed=true;var r=document.getElementById(t+"_row_count_wrapper");this.showCountLoader(r);var a=new BX.Tasks.Util.Query({url:"/bitrix/components/bitrix/tasks.task.list/ajax.php"});a.run("this.getTotalCount",{userId:e,groupId:i,parameters:JSON.stringify(s)}).then(function(t){this.hideCountLoader(r);if(t.data){t.data=typeof t.data=="number"?t.data:0;var e=r.querySelector("a");if(e){e.remove()}r.append(t.data)}this.getTotalCountProceed=false}.bind(this));a.execute()},showCountLoader:function(t){var e=t.querySelector("a");if(e){e.style.display="none"}var i=t.querySelector(".tasks-circle-loader-circular");if(i){i.style.display="inline"}},hideCountLoader:function(t){var e=t.querySelector(".tasks-circle-loader-circular");if(e){e.style.display="none"}},reloadRow:function(t){var e=BX.Main.gridManager.getById(this.gridId);if(e&&e.hasOwnProperty("instance")){e.instance.updateRow(t.toString())}},reloadGrid:function(){if(BX.Bitrix24&&BX.Bitrix24.Slider&&BX.Bitrix24.Slider.getLastOpenPage()){BX.Bitrix24.Slider.destroy(BX.Bitrix24.Slider.getLastOpenPage().getUrl())}var t=BX.Main.gridManager.getById(this.gridId);if(t&&t.hasOwnProperty("instance")){t.instance.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}},setCurrentGroupAction:function(t){this.currentGroupAction=t},processBeforeGroupActionSent:function(){if(this.currentGroupAction==="ping"){BX.UI.Notification.Center.notify({content:BX.message("TASKS_LIST_GROUP_ACTION_PING_NOTIFICATION")})}this.currentGroupAction=null},confirmGroupAction:function(t){BX.Tasks.confirm(BX.message("TASKS_CONFIRM_GROUP_ACTION")).then(function(){this.processBeforeGroupActionSent();BX.Main.gridManager.getById(t).instance.sendSelected()}.bind(this))},onDeadlineChangeClick:function(t,e,i){i=i||(new Date).getDate();var s=BX.calendar({node:e,value:i,form:"",bTime:true,currentTime:Math.round(new Date/1e3)-(new Date).getTimezoneOffset()*60,bHideTimebar:true,bCompatibility:true,bCategoryTimeVisibilityOption:"tasks.bx.calendar.deadline",bTimeVisibility:BX.Tasks.GridInstance?BX.Tasks.GridInstance.calendarSettings.deadlineTimeVisibility==="Y":false,callback_after:function(t,e){return function(i){var s=new Date;if(i.getTime()>s.getTime()){BX.onCustomEvent("Tasks.Tour.ExpiredTasksDeadlineChange:saveDeadline",[])}var r=BX.CJSTask.ajaxUrl;BX.CJSTask.ajaxUrl=BX.CJSTask.ajaxUrl+"&_CODE=CHANGE_DEADLINE&viewType=VIEW_MODE_LIST";BX.CJSTask.batchOperations([{operation:"CTaskItem::update()",taskData:{ID:e,DEADLINE:BX.calendar.ValueToString(i,true)}}],{callbackOnSuccess:function(t,e,i){return function(t){}}(t,e,i)});BX.CJSTask.ajaxUrl=r;if(!BX.Tasks.GridActions.checkCanMove()){BX.Tasks.GridActions.reloadRow(e)}}}(e,t)});var r=BX.Tasks.TourGuideController.getGuide();if(r&&r.setCalendarPopup&&r.isCorrectRow(t)&&!r.getIsStopped()){r.setCalendarPopup(s.popup)}},onMarkChangeClick:function(t,e,i){BX.TaskGradePopup.show(t,e,i,{events:{onPopupClose:this.__onGradePopupClose,onPopupChange:this.__onGradePopupChange}});BX.addClass(e,"task-grade-and-report-selected");return false},__onGradePopupClose:function(){BX.removeClass(this.bindElement,"task-grade-and-report-selected")},__onGradePopupChange:function(){this.bindElement.className="task-grade-and-report"+(this.listValue!=="NULL"?" task-grade-"+this.listItem.className:"")+(this.report?" task-in-report":"");this.bindElement.title=BX.message("TASKS_MARK")+": "+this.listItem.name;BX.Tasks.GridActions.action("update",this.id,{data:{MARK:this.listValue==="NULL"?"":this.listValue}})},renderTimerItem:function(t,e,i,s,r,a){a=a||false;var n="task-timer-inner";var o=e+r;if(s){n=n+" task-timer-play"}else if(a){n=n+" task-timer-pause"}else{n=n+" task-timer-clock"}if(i>0&&o>i){n=n+" task-timer-overdue"}return BX.create("span",{props:{id:"task-timer-block-"+t,className:"task-timer-block"},events:{click:function(t,e){return function(){if(BX.hasClass(BX("task-timer-block-inner-"+t),"task-timer-play")){BX.TasksTimerManager.stop(t)}else if(e){BX.TasksTimerManager.start(t)}}}(t,a)},children:[BX.create("span",{props:{id:"task-timer-block-inner-"+t,className:n},children:[BX.create("span",{props:{className:"task-timer-icon"}}),BX.create("span",{props:{id:"task-timer-block-value-"+t,className:"task-timer-time"},text:BX.Tasks.GridActions.renderTimerTimes(o,i,s)})]})]})},renderTimerTimes:function(t,e,i){var s="";var r=!!i;s=BX.Tasks.GridActions.renderSecondsToHHMMSS(t,r);if(e>0){s=s+" / "+BX.Tasks.GridActions.renderSecondsToHHMMSS(e,false)}return s},renderSecondsToHHMMSS:function(t,e){var i="00";var s="";var r="";var a=0;if(t>0){s+=Math.floor(t/3600);r+=Math.floor(t/60)%60}else{s+=Math.ceil(t/3600);r+=Math.ceil(t/60)%60}var n=i.substring(0,2-s.length)+s+":"+i.substring(0,2-r.length)+r;if(e){a=""+t%60;n=n+":"+i.substring(0,2-a.length)+a}return n},redrawTimerNode:function(t,e,i,s,r,a){var n=BX("task-timer-block-"+t);var o=BX.Tasks.GridActions.renderTimerItem(t,e,i,s,r,a);if(n){n.parentNode.replaceChild(o,n)}else{var d=BX("task-timer-block-container-"+t);if(d){if(this.registeredTimerNodes[t]){BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[t])}d.appendChild(o);if(BX("task-timer-block-"+t)){this.registeredTimerNodes[t]=this.__getTimerChangeCallback(t);BX.addCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[t])}}}},removeTimerNode:function(t){if(this.registeredTimerNodes[t]){BX.removeCustomEvent(window,"onTaskTimerChange",this.registeredTimerNodes[t])}var e=BX("task-timer-block-"+t);if(e){e.parentNode.removeChild(e)}},__getTimerChangeCallback:function(t){var e=null;return function(i){var s=null;var r=null;if(i.action==="refresh_daemon_event"){if(Number(i.taskId)!==Number(t)){if(e==="paused"){return}s="paused"}else{if(e!=="playing"){s="playing"}BX.Tasks.GridActions.redrawTimerNode(i.taskId,i.data.TASK.TIME_SPENT_IN_LOGS,i.data.TASK.TIME_ESTIMATE,true,i.data.TIMER.RUN_TIME,true)}}else if(i.action==="start_timer"){if(Number(t)===Number(i.taskId)&&i.timerData&&Number(t)===Number(i.timerData.TASK_ID)){s="playing"}else{s="paused"}}else if(i.action==="stop_timer"){if(Number(t)==Number(i.taskId)){s="paused"}}else if(i.action==="init_timer_data"){if(i.data.TIMER){if(Number(i.data.TIMER.TASK_ID)===Number(t)){s=i.data.TIMER.TIMER_STARTED_AT>0?"playing":"paused"}else if(i.data.TIMER.TASK_ID>0){s="paused"}}}if(s!==null){r=BX("task-timer-block-inner-"+t);if(r&&!BX.hasClass(r,"task-timer-clock")){if(s==="paused"){BX.removeClass(r,"task-timer-play");BX.addClass(r,"task-timer-pause")}else if(s==="playing"){BX.removeClass(r,"task-timer-pause");BX.addClass(r,"task-timer-play")}}e=s}}}};BX(function(){"use strict";BX.Tasks.Grid=function(t){this.grid=BX.Main.gridManager.getInstanceById(t.gridId);this.userId=Number(t.userId);this.ownerId=Number(t.ownerId);this.groupId=Number(t.groupId);this.sorting=t.sorting;this.groupByGroups=t.groupByGroups==="true";this.groupBySubTasks=t.groupBySubTasks==="true";this.arParams=t.arParams;this.calendarSettings=t.calendarSettings?t.calendarSettings:{};this.taskList=new Map;this.comments=new Map;this.query=new BX.Tasks.Util.Query({url:"/bitrix/components/bitrix/tasks.task.list/ajax.php"});this.actions={taskAdd:"taskAdd",taskUpdate:"taskUpdate",taskRemove:"taskRemove",commentAdd:"commentAdd",pinChanged:"pinChanged"};this.classes={highlighted:"task-list-item-highlighted",pinned:"tasks-list-item-pinned"};this.isMyList=this.userId===this.ownerId;this.canPin=this.isMyList;this.updateCanMove();this.init(t)};BX.Tasks.Grid.prototype={init:function(t){this.bindEvents();this.fillTaskListItems(t.taskList);this.colorPinnedRows();if(t.arParams&&t.arParams["LAZY_LOAD"]){this.grid.reload()}},bindEvents:function(){var t={comment_add:this.onPullCommentAdd,comment_read_all:this.onPullCommentReadAll,project_read_all:this.onPullProjectReadAll,task_add:this.onPullTaskAdd,task_update:this.onPullTaskUpdate,task_view:this.onPullTaskView,task_remove:this.onPullTaskRemove,user_option_changed:this.onUserOptionChanged};BX.addCustomEvent("onPullEvent-tasks",function(e,i){if(t[e]){t[e].apply(this,[i])}}.bind(this));BX.addCustomEvent("BX.Main.grid:sort",function(t,e){if(e===this.grid){this.sorting.sort={};this.sorting.sort[t.sort_by]=t.sort_order}}.bind(this));BX.addCustomEvent("BX.Main.grid:paramsUpdated",function(){this.updateCanMove();this.colorPinnedRows();this.clearTaskListItems();this.getRows().map(function(t){return t.getId()}).filter(function(t){return t!=="template_0"}).forEach(function(t){this.addTaskListItem(t)}.bind(this))}.bind(this));BX.addCustomEvent("BX.Tasks.Filter.group",function(t,e,i){if(this.getGrid()===t){this[e]=i}}.bind(this))},updateCanMove:function(){this.canMove=this.isMyList&&this.sorting.sort.ACTIVITY_DATE&&this.sorting.sort.ACTIVITY_DATE==="desc"&&!this.groupByGroups&&!this.groupBySubTasks},checkCanMove:function(){return this.canMove},colorPinnedRows:function(){this.getRows().forEach(function(t){var e=t.getNode();this.getIsPinned(t.getId())?BX.addClass(e,this.classes.pinned):BX.removeClass(e,this.classes.pinned)}.bind(this))},getIsPinned:function(t){return this.isRowExist(t)&&this.getRowNodeById(t).querySelector(".main-grid-cell-content-action-pin.main-grid-cell-content-action-active")instanceof HTMLElement},onPullTaskView:function(t){if(this.userId!==Number(t.USER_ID)||!this.isRowExist(t.TASK_ID.toString())){return}this.updateActivityDateCellForTasks([t.TASK_ID])},onPullCommentReadAll:function(t){this.onReadAll(t)},onPullProjectReadAll:function(t){this.onReadAll(t)},onReadAll:function(t){if(this.userId!==Number(t.USER_ID)){return}this.updateActivityDateCellForTasks(this.getTaskListItems())},updateActivityDateCellForTasks:function(t,e,i){e=e||{};i=i||{};var s={taskIds:t,data:{},arParams:this.arParams};if(e){Object.keys(e).forEach(function(t){s.data[t]=e[t]})}this.query.run("this.prepareGridRowsForTasks",s).then(function(t){if(t.data){Object.keys(t.data).forEach(function(e){if(this.isRowExist(e)){var s=this.getRowById(e);var r=t.data[e];if(s.getCellById("ACTIVITY_DATE")){s.setCellsContent({ACTIVITY_DATE:r.content.ACTIVITY_DATE})}s.setCellActions(r.cellActions);s.setCounters(r.counters);if(i.highlightRow===true){this.highlightGridRow(e)}}}.bind(this))}}.bind(this));this.query.execute()},onPullCommentAdd:function(t){if(this.checkComment(t)){var e=t.entityXmlId.split("_");if(e){this.checkTask(e[1],{action:this.actions.commentAdd,userId:Number(t.ownerId),isCompleteComment:t.isCompleteComment})}}},onPullTaskAdd:function(t){if(t.params.addCommentExists===false){this.checkTask(t.TASK_ID.toString(),{action:this.actions.taskAdd,userId:this.ownerId})}},onPullTaskUpdate:function(t){if(t.params.updateCommentExists===false){this.checkTask(t.TASK_ID.toString(),{action:this.actions.taskUpdate,userId:this.ownerId})}else if(t.params.removedParticipants.includes(this.ownerId.toString())&&(!this.groupId||this.groupId!==Number(t.AFTER.GROUP_ID))){this.removeItem(t.TASK_ID.toString())}},onPullTaskRemove:function(t){if(this.checkCanMove()){this.removeItem(t.TASK_ID.toString())}},onUserOptionChanged:function(t){if(!this.checkCanMove()||this.userId!==Number(t.USER_ID)){return}var e=t.TASK_ID.toString();switch(Number(t.OPTION)){case 1:this.updateActivityDateCellForTasks([e]);break;case 2:case 3:if(this.canPin){this.placeToNearTasks(e,null,{action:this.actions.pinChanged})}break;default:break}},placeToNearTasks:function(t,e,i){var s={taskId:t,navigation:{pageNumber:this.getPageNumber(),pageSize:this.getPageSize()},arParams:this.arParams};this.query.run("this.getNearTasks",s).then(function(s){if(s.data){var r=s.data.before;var a=s.data.after;if(r&&this.isRowExist(r)||a&&this.isRowExist(a)){var n={before:r,after:a};Object.keys(i).forEach(function(t){n[t]=i[t]});this.updateItem(t,e,n)}else{this.removeItem(t)}}}.bind(this));this.query.execute()},checkComment:function(t){var e=t.entityXmlId.split("_");if(!e){return false}var i=e[0];var s=e[1];if(i!=="TASK"){return false}if(!this.comments.has(s)){this.comments.set(s,new Set)}var r=this.comments.get(s);var a=t.messageId;var n=t.participants.map(function(t){return t.toString()});if(r.has(a)){return false}r.add(a);return n.includes(this.userId.toString())||this.groupId===t.groupId},checkTask:function(t,e){e=e||{};var i={RETURN_ACCESS:"Y"};if(e.isCompleteComment===false||e.userId===this.userId){i.SIFT_THROUGH_FILTER={userId:this.ownerId,groupId:this.groupId}}BX.ajax.runAction("tasks.task.list",{data:{filter:{ID:t},params:i}}).then(function(i){this.onCheckTaskSuccess(i,t,e)}.bind(this))},onCheckTaskSuccess:function(t,e,i){if(!t.data.tasks.length){this.removeItem(e);return}var s=t.data.tasks[0];if(this.isRowExist(e)){if(this.checkCanMove()){i.canMoveRow=i.action!==this.actions.taskUpdate;this.updateGridRow(e,s,i)}else{if(i.action===this.actions.commentAdd){var r={};r[e]=s;this.updateActivityDateCellForTasks([e],r,{highlightRow:true})}else if(i.action===this.actions.taskUpdate){this.getGrid().updateRow(e)}}}else if(this.checkCanMove()){if(i.action===this.actions.taskUpdate){this.placeToNearTasks(e,s,i)}else{this.updateItem(e,s,i)}}},updateItem:function(t,e,i){e=e||null;i=i||{};if(!this.hasTaskListItem(t)){this.addTaskListItem(t);this.addGridRow(t,e,i)}else{this.updateGridRow(t,e,i)}},addGridRow:function(t,e,i){var s={taskIds:[t],data:{},arParams:this.arParams};if(e){s.data[t]=e}this.query.run("this.prepareGridRowsForTasks",s).then(function(e){if(e.data&&e.data[t]){var s=e.data[t];var r={id:t,columns:s.content,actions:s.actions,cellActions:s.cellActions,counters:s.counters};var a=this.getGridMoveRows(t,i);if(a.rowAfter){r.insertAfter=a.rowAfter}else if(a.rowBefore){r.insertBefore=a.rowBefore}else{r.append=true}if(this.taskList.size>this.getPageNumber()*this.getPageSize()){var n=this.getLastRowId();this.removeTaskListItem(n);BX.remove(this.getRowNodeById(n));this.showMoreButton()}this.hideStub();this.getRealtime().addRow(r);this.colorPinnedRows()}}.bind(this));this.query.execute()},updateGridRow:function(t,e,i){if(!this.isRowExist(t)){return}var s={taskIds:[t],data:{},arParams:Object.assign(this.arParams,i.arParams||{})};if(e){s.data[t]=e}this.query.run("this.prepareGridRowsForTasks",s).then(function(e){if(e.data&&e.data[t]){var s=e.data[t];var r=this.getRowById(t);r.setCellsContent(s.content);r.setActions(s.actions);r.setCellActions(s.cellActions);r.setCounters(s.counters);if(i.canMoveRow!==false){this.getGrid().getRows().reset();var a=this.getGridMoveRows(t,i);this.moveRow(t,a.rowAfter,a.rowBefore)}this.highlightGridRow(t).then(function(){this.colorPinnedRows()}.bind(this));this.getGrid().bindOnRowEvents()}}.bind(this));this.query.execute()},removeItem:function(t){if(!this.isRowExist(t)){return}this.removeTaskListItem(t);this.getGrid().removeRow(t)},getGridMoveRows:function(t,e){var i;var s;switch(e.action){case this.actions.pinChanged:case this.actions.taskUpdate:i=e.before;s=e.after;break;default:i=this.getFirstRowId();s=this.getIsPinned(t)?0:this.getLastPinnedRowId();break}return{rowBefore:i,rowAfter:s}},moveRow:function(t,e,i){if(e){this.getGrid().getRows().insertAfter(t,e)}else if(i){this.getGrid().getRows().insertBefore(t,i)}},getLastPinnedRowId:function(){var t=Object.values(this.getRows()).filter(function(t){return this.getIsPinned(t.getId())}.bind(this));var e=Object.keys(t);if(e.length>0){return t[e[e.length-1]].getId()}return 0},getFirstRowId:function(){var t=this.getRows();return t.length?this.getRowProp(t[0],"id"):0},getLastRowId:function(){var t=this.getGrid().getRows().getBodyLastChild();return t?this.getRowProp(t,"id"):0},highlightGridRow:function(t){var e=new BX.Promise;if(!this.isRowExist(t)){e.reject();return e}var i=this.getRowNodeById(t);var s=BX.hasClass(i,this.classes.pinned);if(s){BX.removeClass(i,this.classes.pinned)}BX.addClass(i,this.classes.highlighted);setTimeout(function(){BX.removeClass(i,this.classes.highlighted);if(s){BX.addClass(i,this.classes.pinned)}e.fulfill()}.bind(this),900);return e},getGrid:function(){return this.grid},getRows:function(){return this.getGrid().getRows().getBodyChild()},isRowExist:function(t){return this.getRowById(t)!==null},getRowById:function(t){return this.getGrid().getRows().getById(t)},getRowNodeById:function(t){return this.getRowById(t).getNode()},getRowProp:function(t,e){return BX.data(t.getNode(),e)},setRowProp:function(t,e,i){t.getNode().setAttribute("data-"+e,i)},getPageNumber:function(){var t=1;var e=this.getGrid().getContainer().querySelector(".main-grid-nav-panel");if(e){var i=e.querySelector(".main-ui-pagination");if(i){var s=i.querySelector(".main-ui-pagination-active");if(s){t=s.innerText}}}return t},getPageSize:function(){var t=50;var e=BX(this.getGrid().getContainerId()+"_"+this.getGrid().settings.get("pageSizeId"));if(e){t=BX.data(e,"value")}return t},getRealtime:function(){return this.getGrid().getRealtime()},showStub:function(){if(this.stub){this.getRealtime().showStub({content:this.stub})}},hideStub:function(){this.getGrid().hideEmptyStub()},showMoreButton:function(){this.getGrid().getMoreButton().getNode().style.display="inline-block"},hideMoreButton:function(){this.getGrid().getMoreButton().getNode().style.display="none"},getTaskListItems:function(){return Array.from(this.taskList.keys())},hasTaskListItem:function(t){return this.taskList.has(parseInt(t,10))},addTaskListItem:function(t){this.taskList.set(parseInt(t,10))},removeTaskListItem:function(t){this.taskList.delete(parseInt(t,10))},fillTaskListItems:function(t){Object.keys(t).forEach(function(t){this.addTaskListItem(t)}.bind(this))},clearTaskListItems:function(){this.taskList.clear()}};BX.addCustomEvent("tasksTaskEvent",BX.delegate(function(t,e){if(!BX.Tasks.GridActions.checkCanMove()){BX.Tasks.GridActions.reloadGrid()}},this));BX.addCustomEvent("SidePanel.Slider:onCloseByEsc",function(t){var e=/tasks\/task\/edit/;var i=t.getSlider().getUrl();if(e.test(i)&&!confirm(BX.message("TASKS_CLOSE_PAGE_CONFIRM"))){t.denyAction()}});BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,i){var s=window.location.href;var r=new URL(s);var a=r.searchParams.get("F_STATE");var n=a==="sR"?s.replace("&F_STATE=sR",""):s;window.history.replaceState(null,null,n)}.bind(this));BX.addCustomEvent("Tasks.TopMenu:onItem",function(t,e){var i=BX.Main.filterManager.getById(BX.Tasks.GridActions.gridId);if(!i){console.log("BX.Main.filterManager not initialised");return}var s={preset_id:BX.Tasks.GridActions.defaultPresetId,additional:{ROLEID:t==="view_all"?0:t}};var r=i.getApi();r.setFilter(s,{ROLE_TYPE:"TASKS_ROLE_TYPE_"+(t===""?"view_all":t)});window.history.pushState(null,null,e)});BX.addCustomEvent("Tasks.Toolbar:onItem",function(t){var e=t.getData();if(e.counter&&e.counter.filter){e.counter.filter.toggleByField({PROBLEM:e.counter.filterValue})}});BX.Tasks.Grid.Sorting=function(t){this.grid=BX.Main.gridManager.getInstanceById(t.gridId);this.currentGroupId=t.currentGroupId;this.treeMode=t.treeMode;BX.message(t.messages);this.init();BX.addCustomEvent("BX.Main.grid:rowDragStart",this.handleRowDragStart.bind(this));BX.addCustomEvent("BX.Main.grid:rowDragMove",this.handleRowDragMove.bind(this));BX.addCustomEvent("BX.Main.grid:rowDragEnd",this.handleRowDragEnd.bind(this))};BX.Tasks.Grid.Sorting.prototype={init:function(){this.dragRow=null;this.targetRow=null;this.error=false;this.targetTask=null;this.before=true;this.newGroup=null;this.newParentId=null},getGrid:function(){return this.grid},getRow:function(t){return this.getGrid().getRows().get(t)},getRowById:function(t){return this.getGrid().getRows().getById(t)},getRows:function(){return this.getGrid().getRows().getBodyChild()},getRowProp:function(t,e){return t.getNode().dataset[e]},getRowType:function(t){return this.getRowProp(t,"type")},getRowGroupId:function(t){return this.getRowProp(t,"groupId")},handleRowDragStart:function(t,e){this.dragRow=this.getRow(t.getDragItem())},handleRowDragMove:function(t,e){this.targetRow=this.getRow(t.getTargetItem());var i=this.targetRow?this.getRowType(this.targetRow):null;this.newParentId=null;this.error=false;var s=null;if(i==="task"){var r=this.targetRow.getParentId();if(r!==this.dragRow.getParentId()){this.newParentId=r}s=this.getGroupByRow(this.targetRow);this.targetTask=this.targetRow;this.before=true}else{if(i==="group"){s=this.getPreviousGroup(this.targetRow)}else{s=this.getLastGroup()}var a=this.getClosestTask(this.targetRow);this.targetTask=a.task;this.before=a.before}this.newGroup=s.id!==this.getGroupByRow(this.dragRow).id?s:null;if(i==="task"&&this.isChildOf(this.targetTask,this.dragRow)){this.error=true}else if(this.newGroup&&(this.getRowProp(this.dragRow,"canEdit")==="false"||!this.newGroup.canCreateTasks)){this.error=true}else if(this.newParentId!==null&&this.getRowProp(this.dragRow,"canEdit")==="false"){this.error=true}this.error?t.disallowMove(BX.message("TASKS_ACCESS_DENIED")):t.allowMove()},handleRowDragEnd:function(t,e){if(!this.error){this.save()}this.init()},save:function(){var t=this.dragRow.getId();var e=this.targetTask?this.targetTask.getId():null;if(t===e){return}var i={sourceId:t,targetId:e,before:this.before,currentGroupId:this.currentGroupId};if(this.newGroup!==null){i.newGroupId=this.newGroup.id;this.setGroupId(this.dragRow,i.newGroupId)}if(this.newParentId!==null&&this.treeMode){i.newParentId=this.newParentId}var s=new BX.Tasks.Util.Query;s.run("task.sorting.move",{data:i}).then(function(t){if(!t.getErrors().isEmpty()){BX.Tasks.confirm(t.getErrors().getMessages().join(" "),function(){BX.reload()},{buttonSet:[]})}});s.execute()},getParentRow:function(t){return this.getRowById(t.getParentId())},isChildOf:function(t,e){var i=this.getParentRow(t);while(i!==null){if(i===e){return true}i=this.getParentRow(i)}return false},getGroupById:function(t){var e=this.getRows();for(var i=0;i<e.length;i++){var s=e[i];if(this.getRowType(s)==="group"&&this.getRowGroupId(s)===String(t)){return this.getGroupByRow(s)}}return this.getDefaultProject()},setGroupId:function(t,e){t.getDataset().groupId=e;var i=t.getChildren();for(var s=0;s<i.length;s++){this.setGroupId(i[s],e)}},getDefaultProject:function(){return{id:"0",canCreateTasks:true}},getGroupByRow:function(t){if(this.getRowType(t)==="group"){return{id:this.getRowGroupId(t),canCreateTasks:this.getRowProp(t,"canCreateTasks")==="true"}}else{return this.getGroupById(this.getRowGroupId(t))}},getLastGroup:function(){var t=null;var e=this.getRows();for(var i=e.length-1;i>=0;i--){var s=e[i];if(this.getRowType(s)==="group"){return this.getGroupByRow(s)}}return this.getDefaultProject()},getPreviousGroup:function(t){var e=null;var i=this.getRows();var s=false;for(var r=i.length-1;r>=0;r--){var a=i[r];if(t===a){s=true;continue}if(s&&this.getRowType(a)==="group"){return this.getGroupByRow(a)}}return this.getDefaultProject()},getClosestTask:function(t){var e=this.getRows();var i=t?t.getIndex()-1:e.length;for(var s=i-1;s>=0;s--){if(this.getRowType(e[s])==="task"&&e[s].getDepth()==="0"){return{task:e[s],before:false}}}for(s=i+1;s<e.length;s++){if(this.getRowType(e[s])==="task"&&e[s].getDepth()==="0"){return{task:e[s],before:true}}}return{task:null,before:true}}};BX.Tasks.TourGuideController=function(t){this.tours=t.tours;this.guide=null;this.initGuides(t)};BX.Tasks.TourGuideController.prototype={initGuides:function(t){var e=this.tours.firstGridTaskCreation;var i=this.tours.expiredTasksDeadlineChange;if(e.show){this.guide=new BX.Tasks.TourGuideController.FirstGridTaskCreationTourGuide(t)}else if(i.show||i.backgroundCheck){this.guide=new BX.Tasks.TourGuideController.ExpiredTasksDeadlineChangeTourGuide(t)}},getGuide:function(){return this.guide}};BX.Tasks.TourGuideController.FirstGridTaskCreationTourGuide=function(t){this.tour=t.tours.firstGridTaskCreation;this.popupData=this.tour.popupData;this.start()};BX.Tasks.TourGuideController.FirstGridTaskCreationTourGuide.prototype={start:function(){var t=BX("tasks-buttonAdd");if(!t){return}t.href=BX.Uri.addParam(t.href,{FIRST_GRID_TASK_CREATION_TOUR_GUIDE:"Y"});this.guide=new BX.UI.Tour.Guide({steps:[{target:t,title:this.popupData[0].title,text:this.popupData[0].text}],onEvents:true});BX.addCustomEvent("UI.Tour.Guide:onFinish",function(e){if(e.getData().guide===this.guide){t.href=BX.Uri.removeParam(t.href,["FIRST_GRID_TASK_CREATION_TOUR_GUIDE"])}}.bind(this));this.showNextStep()},showNextStep:function(){setTimeout(function(){this.guide.showNextStep()}.bind(this),500)}};BX.Tasks.TourGuideController.ExpiredTasksDeadlineChangeTourGuide=function(t){this.userId=t.userId;this.tour=t.tours.expiredTasksDeadlineChange;this.popupData=this.tour.popupData;this.counterToCheck=this.tour.counterToCheck;this.rowId=0;this.calendarPopup=0;this.isStopped=false;this.viewMode="grid";this.ajaxActionPrefix="tasks.tourguide.expiredtasksdeadlinechange.";this.grid=BX.Main.gridManager.getInstanceById(t.gridId);if(this.tour.show){this.start()}else if(this.tour.backgroundCheck){this.isPullListening=true}this.bindEvents()};BX.Tasks.TourGuideController.ExpiredTasksDeadlineChangeTourGuide.prototype={bindEvents:function(){var t={user_counter:this.onUserCounter.bind(this)};BX.addCustomEvent("onPullEvent-tasks",function(e,i){if(t[e]){t[e].apply(this,[i])}}.bind(this));BX.addCustomEvent("UI.Tour.Guide:onPopupClose",function(){this.stop()}.bind(this));BX.addCustomEvent("UI.Tour.Guide:onFinish",function(t){if(t.getData().guide===this.guide&&this.getCurrentStepIndex()===0){BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onExpiredCounterGridReloaded,this))}}.bind(this))},onUserCounter:function(t){if(!this.isPullListening||this.userId!==Number(t.userId)){return}var e=Number(t[0].view_role_originator.expired)+Number(t[0].view_role_responsible.expired);if(e>=Number(this.counterToCheck)){this.isPullListening=false;BX.ajax.runAction(this.ajaxActionPrefix+"proceed",{analyticsLabel:{viewMode:this.viewMode}}).then(function(t){if(t.data){this.start()}}.bind(this))}},start:function(){this.guide=new BX.UI.Tour.Guide({steps:[{target:document.querySelector(".tasks-counters--item-counter"),title:this.popupData[0].title,text:this.popupData[0].text}],onEvents:true});this.showNextStep()},markShowedStep:function(t){BX.ajax.runAction(this.ajaxActionPrefix+"markShowedStep",{analyticsLabel:{viewMode:this.viewMode,step:t}})},onExpiredCounterGridReloaded:function(){BX.removeCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onExpiredCounterGridReloaded,this));var t=null;Object.values(this.grid.getRows().getBodyChild()).forEach(function(e){if(!this.rowId&&e.getNode().querySelector(".ui-label.ui-label-danger.ui-label-fill.ui-label-link")){this.rowId=e.getId();t=e.getNode().querySelector(".ui-label.ui-label-danger.ui-label-fill.ui-label-link")}}.bind(this));if(this.rowId>0&&t){this.guide.steps.push(new BX.UI.Tour.Step({target:t,title:this.popupData[1].title,text:this.popupData[1].text}));this.showNextStep()}},setCalendarPopup:function(t){if(!this.calendarPopup&&this.getCurrentStepIndex()===1){this.calendarPopup=t;BX.addCustomEvent(this.calendarPopup,"onPopupAfterClose",BX.proxy(this.onCalendarPopupClose,this))}},onCalendarPopupClose:function(){BX.removeCustomEvent(this.calendarPopup,"onPopupAfterClose",BX.proxy(this.onCalendarPopupClose,this));setTimeout(function(){BX.removeCustomEvent("Tasks.Tour.ExpiredTasksDeadlineChange:saveDeadline",BX.proxy(this.onDeadlineSave,this))}.bind(this),500);BX.addCustomEvent("Tasks.Tour.ExpiredTasksDeadlineChange:saveDeadline",BX.proxy(this.onDeadlineSave,this))},onDeadlineSave:function(){BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onGridReloaded,this))},onGridReloaded:function(){BX.removeCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onGridReloaded,this));if(this.grid.getRows().getById(this.rowId)===null){this.guide.steps.push(new BX.UI.Tour.Step({title:this.popupData[2].title,text:this.popupData[2].text,buttons:[{text:this.popupData[2].buttons[0],event:function(){this.stop()}.bind(this)}]}));this.showNextStep()}},showNextStep:function(){if(this.isStopped){return}setTimeout(function(){this.guide.showNextStep();this.markShowedStep(this.getCurrentStepIndex())}.bind(this),500)},getCurrentStepIndex:function(){return this.guide.currentStepIndex},isCorrectRow:function(t){return Number(this.rowId)===Number(t)},getIsStopped:function(){return this.isStopped},stop:function(){this.isStopped=true;this.guide.close()}}});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js?16548424641711";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.header/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Tasks");BX.Tasks.InterfaceToolbar=function(t){this.gridId=t.gridId||"";this.grid={};this.containerId=t.containerId;this.container={};this.itemSelector="a.tasks-counter-container";this.params=t||{};this.filterManager=null;this.filterApi=null;this.itemClickHandler=null;return this.init()};BX.Tasks.InterfaceToolbar.prototype={init:function(){this.itemClickHandler=BX.delegate(this.onItemClick,this);this.container=BX(this.containerId);if(!BX.type.isElementNode(this.container)){throw"BX.Tasks.InterfaceToolbar: Could not find container: "+this.containerId}var t=this.container.querySelectorAll(this.itemSelector);for(var e=0,i=t.length;e<i;e++){BX.bind(t[e],"click",this.itemClickHandler)}this.filterManager=BX.Main.filterManager.getById(this.gridId);if(!this.filterManager){alert("BX.Main.filterManager not initialised");return}this.filterApi=this.filterManager.getApi()},onItemClick:function(t){var e=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"tasks-counter-container"});if(e){var i=e.getAttribute("data-type-id");if(BX.type.isNotEmptyString(i)){var r={counterTypeId:i,cancel:false};this.applyFilter(r);if(r.cancel){return BX.PreventDefault(t)}}}return true},applyFilter:function(t){var e={};switch(t.counterTypeId){case"tasks_my_expired":var i=BX.date.format("d.m.Y",new Date,null,true);e={DEADLINE_datesel:"RANGE",DEADLINE_to:i};break;case"tasks_my_expired_cand":var r=new Date;var a=new Date;r.setUTCHours(r.getUTCHours()-24);var n=BX.date.format("d.m.Y H:i:s",r,null,true);a.setUTCHours(a.getUTCHours()+24);var s=BX.date.format("d.m.Y H:i:s",a,null,true);e={DEADLINE_datesel:"RANGE",DEADLINE_from:n,DEADLINE_to:s};break}this.filterApi.setFields(e);this.filterApi.apply()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?165484246460";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?165484154145567";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),getSubmenu:BX.delegate(this.getSubmenu,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame();var o=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));o.forEach(function(t){var e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;var i=e.closest(".main-buttons-item-child-button-cloned");if(i){this.clonedChildButton=i}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))},this)},calculateChildListWidth:function(){if(this.realChildButton){var t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");var e=10;return Array.from(t).reduce(function(t,e){var i=BX.Text.toNumber(BX.Dom.style(e,"width"));var s=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));var n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+i+s+n},e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}var e=this.realChildButton.querySelector(".main-buttons-item-child-list");var i=BX.Dom.attr(this.realChildButton,"data-child-items");var s=BX.Dom.attr(this.realChildButton,"data-is-opened");var n={};if(s){BX.Dom.attr(this.realChildButton,"data-is-opened",null);i.forEach(function(t){var e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}},this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);i.forEach(function(t){var e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}},this);setTimeout(function(){BX.Dom.style(e,"overflow","unset")}.bind(this),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout(function(){this._onResizeHandler()}.bind(this),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);var e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout(function(){BX.Dom.style(this.clonedChildButton,"transition",null)}.bind(this))},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,r;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var u,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{u=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(u,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();r=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&r>2){this.disableItem(n)}if(r===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var r=BX.pos(i);var u={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:r.width/2,zIndex:20,angle:{position:"top",offset:r.width/2}}};s=BX.PopupMenu.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){this.saveOptions("firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e&&t.parentNode===this.listContainer){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({html:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a={},o=[],r=n.hasOwnProperty("AJAX_OPTIONS");if(r){a=this._getEvents(n["AJAX_OPTIONS"]);o=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}var u,h={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],events:a,items:o};if(r){h.cacheable=true}else{u=this.getListItems(t,s);if(u.length){h.items=u}}i.push(h);delete t[s]}}return i},_setAjaxMode:function(t){for(var e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){var e=this;return{onSubMenuShow:function(){if(this.subMenuLoaded){return}var i=this.getSubMenu();i.removeMenuItem("loading");var s=i.getMenuItem("loading");e.getSubItems(t).then(function(t){e._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()}.bind(this)).catch(function(t){if(s){s.getLayout().text.innerText=t}})}}},getSubItems:function(t){return new Promise(function(e,i){if(this.progress){i(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then(function(t){this.progress=false;e(t.data)}.bind(this))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then(function(t){this.progress=false;e(t.data)}.bind(this))}})},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}var t={};this.optionsToSave.forEach(function(e){t[e.name]=e.value});this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1654841541575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?16548424642911";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TopMenu!="undefined"){return}BX.Tasks.Component.TopMenu=BX.Tasks.Component.extend({sys:{code:"topmenu"},methodsStatic:{instances:{},getInstance:function(t){return BX.Tasks.Component.TopMenu.instances[t]},addInstance:function(t,e){BX.Tasks.Component.TopMenu.instances[t]=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TopMenu.addInstance(this.sys.code,this);this.userId=Number(this.option("userId"));this.ownerId=Number(this.option("ownerId"));this.groupId=Number(this.option("groupId"));this.sliderInit()},bindEvents:function(){try{var t=this.option("use_ajax_filter")?this.scope().getElementsByClassName("tasks_role_link"):{};if(t.length){for(var e=0;e<t.length;e++){BX.bind(t[e],"click",function(t){t.preventDefault();var e=t.target.className;var n=this.dataset.id=="view_all"?"":this.dataset.id;var s=this.dataset.url;if(e==="main-buttons-item-sublink "&&n===""||e==="main-buttons-item-edit-button"){return}BX.onCustomEvent("Tasks.TopMenu:onItem",[n,s]);var i=this.parentElement.getElementsByClassName("tasks_role_link");if(i.length){for(var o=0;o<i.length;o++){BX.removeClass(i[o],"main-buttons-item-active")}}BX.addClass(this,"main-buttons-item-active")})}}}catch(t){}BX.addCustomEvent("onPullEvent-tasks",function(t,e){if(t==="user_counter"){this.onUserCounter(e)}}.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",function(t,e,n){this.onFilterApply(t,e,n)}.bind(this))},isMyList:function(){return this.userId===this.ownerId},onUserCounter:function(t){if(!this.isMyList()||this.userId!==Number(t.userId)){return}var e=BX("tasks_panel_menu_view_projects");if(e){e.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t.projects_major)}Object.keys(t[0]).forEach(function(e){var n=BX("tasks_panel_menu_"+(this.groupId?"group_":"")+e);if(n){n.querySelector(".main-buttons-item-counter").innerText=this.getCounterValue(t[0][e].total)}}.bind(this))},getCounterValue:function(t){if(!t){return""}var e=99;return t>e?e+"+":t},onFilterApply:function(t,e,n){try{var s=n.getFilterFieldsValues().ROLEID;var i=BX.Tasks.Component.TopMenu.getInstance("topmenu").scope();var o=i.querySelectorAll(".tasks_role_link");for(var a=0;a<o.length;a++){BX.removeClass(o[a],"main-buttons-item-active")}if(typeof s!=="undefined"){if(!s){s="view_all"}BX.addClass(BX("tasks_panel_menu_"+s),"main-buttons-item-active");var r=BX.Tasks.Component.TasksToolbar.getInstance();if(r){r.rerender(s)}}}catch(t){}},sliderInit:function(){if(window===window.top){top.BX.SidePanel.Instance.bindAnchors({rules:[{condition:["/tasks/config/permissions/"],loader:"default-loader",options:{cacheable:false,events:{onClose:function(){},onOpen:function(){var t=BX.Main.interfaceButtonsManager;for(var e in t.data){t.data[e].closeSubmenu()}}}}}]})}}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js?16548424645577";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.map.js";}"*/
if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},keypress:function(t){},open:function(t,e){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:t,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:e?e:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate(function(t){this._control.setData(BX.util.htmlspecialcharsback(t.nameFormatted),t.id);if(!this.getSetting("multi")){this._selector.close()}},this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(t){this._control=t;if(this._fieldId!==t.getId()){this._selector=null;this.close()}else{this._selector=t;this.open(t.field)}},onCustomEntitySelectorClose:function(t){if(this._fieldId!==t.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(t,e){var i=new BX.FilterEntitySelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(t){var e=null,i=t.selectorId,n=t.buttonAddId,o=t.pathTaskAdd.indexOf("?")===-1?t.pathTaskAdd+"?GROUP_ID=":t.pathTaskAdd+"&GROUP_ID=",s=t.messages,r=t.groups,a=t.currentGroup,l=t.groupLimit,d=t.offsetLeft;var c=function(t){if(BX(n)){BX(n).setAttribute("href",o+t)}};a.id=parseInt(a.id);a.text=BX.util.htmlspecialchars(a.text);c(a.id);BX.bind(BX(i),"click",function(){if(e===null){var t=[];var n=function(t,o){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[o.id,a.id]);BX.onCustomEvent(window,"BX.Tasks.ChangeGroup",[o.id,a.id]);if(o.id!==a.id){var s=e.getMenuItems();e.addMenuItem({id:a.id,text:a.text,onclick:BX.delegate(n,this)},s.length>0?s[0]["id"]:null);if(o.id!=="wo"){if(e.getMenuItem(o.id)){e.removeMenuItem(o.id)}else if(s.length>=l){e.removeMenuItem(s[s.length-3].id)}}}e.close();a={id:o.id,text:o.text};c(o.id);if(BX(i+"_text")){BX(i+"_text").innerHTML=o.text}BX.onCustomEvent(this,"onTasksGroupSelectorChange",[a])};for(var o=0,u=r.length;o<u;o++){t.push({id:parseInt(r[o]["id"]),text:BX.util.htmlspecialchars(r[o]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(n,this)})}if(r.length>0){t.push({delimiter:true});t.push({id:"new",text:s.TASKS_BTN_GROUP_SELECT,onclick:function(t,i){e.getPopupWindow().setAutoHide(false);var o=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:i.getContainer(),id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});o.bindEvent("item-selected",function(t){n(null,{id:t.id,text:t.nameFormatted.length>50?t.nameFormatted.substring(0,50)+"...":t.nameFormatted});o.close()});o.bindEvent("close",function(t){e.getPopupWindow().setAutoHide(true)});o.open()}})}if(!d){d=0}e=BX.PopupMenu.create(i,BX(i),t,{autoHide:true,closeByEsc:true,offsetLeft:d})}e.popupWindow.show()})}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(t,e,i){e=e||"asc";if(BX.Main.gridManager!=undefined){var n=BX.Main.gridManager.getById(i).instance;n.sortByColumn({sort_by:t,sort_order:e});if(t==="SORTING"){n.getRows().enableDragAndDrop()}else{n.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:i,action:"setSort"}),{by:t,order:e},function(t){try{t=JSON.parse(t);if(!t.error){window.location.reload()}}catch(t){}})}}}}if(typeof BX.Tasks.SprintSelector==="undefined"){BX.Tasks.SprintSelector=function(t,e,i){if(!BX(t)){return}var n=[];for(var o=0,s=e.length;o<s;o++){var r=e[o]["NAME"]?e[o]["NAME"]:"";var a=r?r+" ":"";var l=e[o]["START_TIME"]+" - "+e[o]["FINISH_TIME"];if(r){l="("+l+")"}n.push({id:e[o]["ID"],entityId:"sprint",tabs:"recents",title:a+l,customData:{sprintName:r,sprintDateStart:e[o]["START_TIME"],sprintDateEnd:e[o]["FINISH_TIME"]}})}var d=new BX.UI.EntitySelector.Dialog({targetNode:BX(t),width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,recentTabOptions:{itemOrder:null},items:n,events:{"Item:onSelect":function(e){var n=e.getData().item;BX.onCustomEvent(BX(t),"onTasksGroupSelectorChange",[{id:i.groupId,sprintId:n.id,name:n.customData.get("sprintName")}]);var o=BX(t).querySelector(".webform-small-button-text");o.innerHTML=BX.util.htmlspecialchars(n.customData.get("sprintDateStart"))+" - "+BX.util.htmlspecialchars(n.customData.get("sprintDateEnd"))}}});BX.bind(BX(t).querySelector(".webform-small-button"),"click",function(){d.show()})}}if(typeof BX.Tasks.ProjectSelector==="undefined"){BX.Tasks.ProjectSelector={reloadProject:function(t){var e=document.location.href;e=BX.util.add_url_param(e,{group_id:t});document.location.href=e}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?165484154813312";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.selectorManagerV2={getById:function(t){if(typeof this.controls[t]!="undefined"){return this.controls[t]}return null},controls:{},loadedEntities:{}};BX.Main.SelectorV2=function(){this.initialized=false;this.blockInit=false;this.id="";this.apiVersion=2;this.fieldName=null;this.inputId=null;this.input=null;this.tagId=null;this.tag=null;this.options=null;this.callback=null;this.callbackBefore=null;this.items=null;this.entities=null;this.mainPopupWindow=null;this.entitiesSet=["users","emails","crmemails","groups","sonetgroups","department","departmentRelation","contacts","companies","leads","deals"];this.entityTypes={};this.auxObject=null;this.selectorInstance=null;this.eventOpenBinded=false};BX.Main.SelectorV2.controls={};BX.Main.SelectorV2.create=function(t){if(typeof t.id=="undefined"||!t.id){t.id=BX.util.hashCode(Math.random().toString())}else if(typeof BX.Main.selectorManagerV2.controls[t.id]!="undefined"){var e=BX.Main.selectorManagerV2.controls[t.id];if(e.bindNode&&!document.body.contains(e.bindNode)){delete BX.Main.selectorManagerV2.controls[t.id]}else{return BX.Main.selectorManagerV2.controls[t.id]}}var i=new BX.Main.SelectorV2;BX.Main.selectorManagerV2.controls[t.id]=i;i.init(t);return i};BX.Main.SelectorV2.proxyCallback=function(t,e){t(e)};BX.Main.SelectorV2.prototype={init:function(t){this.id=t.id;this.apiVersion=t.apiVersion&&parseInt(t.apiVersion)>=2?parseInt(t.apiVersion):2;this.fieldName=t.fieldName?t.fieldName:null;this.inputId=t.inputId?t.inputId:null;this.input=t.inputId&&BX(t.inputId)?BX(t.inputId):null;this.inputBox=t.inputBoxId&&BX(t.inputBoxId)?BX(t.inputBoxId):null;this.inputItemsContainer=t.inputContainerId&&BX(t.inputContainerId)?BX(t.inputContainerId):null;this.containerNode=t.containerId&&BX(t.containerId)?BX(t.containerId):null;this.bindNode=t.bindId&&BX(t.bindId)?BX(t.bindId):this.containerNode;this.tagId=t.tagId?t.tagId:null;this.tag=t.tagId&&BX(t.tagId)?BX(t.tagId):null;this.openDialogWhenInit=typeof t.openDialogWhenInit=="undefined"||!!t.openDialogWhenInit;this.options=t.options||{};this.callback=t.callback||null;this.callbackBefore=t.callbackBefore||null;this.items=t.items||null;this.entities=t.entities||null;this.entityTypes={};BX.onCustomEvent("BX.Main.SelectorV2:onGetEntityTypes",[{selector:this}]);this.selectorInstance=BX.UI.Selector.create({id:this.id,fieldName:this.fieldName,type:"xxx",pathToAjax:BX.type.isNotEmptyString(t.pathToAjax)?t.pathToAjax:null,input:this.input||null,tag:this.tag||null,inputBox:this.inputBox||null,inputItemsContainer:this.inputItemsContainer||null,entities:BX.clone(this.entityTypes),itemsSelected:BX.clone(this.items.selected)||{},itemsUndeletable:BX.clone(this.items.undeletable)||[],options:{multiple:this.getOption("multiple"),useSearch:this.getOption("useSearch"),useContainer:this.getOption("useContainer")=="Y"?"Y":"N",userNameTemplate:this.getOption("userNameTemplate"),siteDepartmentId:this.getOption("siteDepartmentId"),showCloseIcon:"Y",popupAutoHide:this.getOption("popupAutoHide")=="N"?"N":"Y",last:{disable:this.getOption("disableLast")=="Y"?"Y":"N"},search:{useAjax:this.getOption("sendAjaxSearch")!="N"?"Y":"N",useClientDatabase:this.getOption("useClientDatabase")=="Y"?"Y":"N"},focusInputOnSelectItem:this.getOption("focusInputOnSelectItem")!="N"?"Y":"N",focusInputOnSwitchTab:this.getOption("focusInputOnSwitchTab")!="N"?"Y":"N",isCrmFeed:this.getOption("isCrmFeed")=="Y"?"Y":"N",tagLink1:this.getOption("tagLink1"),tagLink2:this.getOption("tagLink2")},bindOptions:{node:this.bindNode,offsetTop:5,offsetLeft:15,zIndex:parseInt(this.getOption("popupZIndex"))>0?parseInt(this.getOption("popupZIndex")):1200},callback:this.callback,callbackBefore:this.callbackBefore});BX.addCustomEvent("BX.UI.SelectorManager:getTreeItemRelation",function(t){if(this.id==t.selectorId){this.getTreeItemRelation(t)}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:loadAll",function(t){this.loadAll(t)}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:initDialog",function(t){if(this.id==t.selectorId){if(!!t.openDialogWhenInit){this.openDialogWhenInit=true}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:reInitDialog",function(t){if(this.id==t.selectorId){this.initialized=false;this.items.selected=BX.type.isNotEmptyObject(t.selectedItems)?t.selectedItems:{};this.items.undeletable=BX.type.isNotEmptyObject(t.undeletableItems)?t.undeletableItems:{};var e=BX.UI.SelectorManager.instances[t.selectorId],i=null,n=null,s=0;if(e){for(var o in e.itemsSelected){if(e.itemsSelected.hasOwnProperty(o)){i=e.itemsSelected[o].toUpperCase();n=BX.UI.SelectorManager.getEntityTypeFullList(i);for(s=0;s<n.length;s++){if(BX.type.isNotEmptyObject(e.entities[n[s]])){e.unselectItem({itemNode:BX.type.isNotEmptyObject(e.entities[n[s]].items)&&BX.type.isNotEmptyObject(e.entities[n[s]].items[o])?e.entities[n[s]].items[o]:false,itemId:o,entityType:n[s],mode:"reinit"})}}}}e.itemsSelected=this.items.selected;e.itemsUndeletable=this.items.undeletable}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:searchRequest",function(t){if(this.id==t.selectorInstance.id){t.selectorInstance.timeouts.search=setTimeout(function(){this.searchRequest(t)}.bind(this),1e3)}}.bind(this));BX.addCustomEvent("BX.UI.Selector:onSelectItem",function(t){if(this.apiVersion>=3&&BX.type.isNotEmptyObject(t)&&this.id==t.selectorId&&BX.type.isNotEmptyString(t.itemId)){this.saveDestination({itemId:t.itemId})}}.bind(this));if(!BX.type.isNotEmptyString(this.getOption("lheName"))){var e=BX("div"+this.getOption("lheName"));if(e){BX.addCustomEvent(e,"OnShowLHE",function(t){if(!t){this.selectorInstance.closeAllPopups()}}.bind(this))}}if(this.getOption("useContainer")!="Y"&&this.input){if(this.getOption("lazyLoad")!="Y"||BX.type.isNotEmptyObject(this.items.selected)){if(BX.type.isNotEmptyObject(this.items.selected)){this.openDialogWhenInit=false}this.initDialog()}if(this.tag){BX.bind(this.tag,"focus",BX.delegate(function(t){this.initDialog({realParams:true,bByFocusEvent:true});return t.preventDefault()},this));this.selectorInstance.setTagTitle()}BX.bind(this.input,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(this.input,"bxchange",function(e){setTimeout(function(){this.selectorInstance.getSearchInstance().searchHandler({event:e,tagInputName:t.tagId})}.bind(this),0)}.bind(this));this.input.setAttribute("data-bxchangehandler","Y")}else if(this.getOption("useContainer")=="Y"&&(this.getOption("lazyLoad")!="Y"||this.getOption("useContainer")=="Y")){this.initDialog()}if(this.items.hidden){for(var i in this.items.hidden){if(this.items.hidden.hasOwnProperty(i)){this.callback.select.apply({id:(typeof this.items.hidden[i]["PREFIX"]!="undefined"?this.items.hidden[i]["PREFIX"]:"SG")+this.items.hidden[i]["ID"],name:this.items.hidden[i]["NAME"]},typeof this.items.hidden[i]["TYPE"]!="undefined"?this.items.hidden[i]["TYPE"]:"sonetgroups","",true,"","init")}}}},show:function(){this.initDialog()},initDialog:function(t){if(typeof t=="undefined"||typeof t.realParams=="undefined"){t=null}if(this.blockInit){return}var e={id:this.id};if(!this.initialized){BX.onCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",[e])}setTimeout(BX.delegate(function(){if(typeof e.blockInit=="undefined"||e.blockInit!==true){if(this.initialized){if(!this.mainPopupWindow||!this.mainPopupWindow.isShown()){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}}else{this.getData(BX.delegate(function(e){if(!!this.openDialogWhenInit){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}BX.onCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",[{id:this.id}]);if(typeof this.options.eventOpen!="undefined"&&!this.eventOpenBinded){this.eventOpenBinded=true;BX.addCustomEvent(window,this.options.eventOpen,function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(this.options.multiple!="Y"&&this.inputItemsContainer&&this.inputItemsContainer.children.length>0){return}if(this.mainPopupWindow&&this.mainPopupWindow.isShown()){return}if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}var e=BX.type.isNotEmptyObject(t)&&t.bindNode?t.bindNode:this.bindNode;var i=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:false;if(e){var n=BX.findChild(e,{tagName:"input",attr:{type:"text"}},true);if(n){this.selectorInstance.nodes.input=n;var s=this.tag||BX(t.tagId);if(s){this.selectorInstance.nodes.tag=s}if(n.getAttribute("data-bxchangehandler")!=="Y"){BX.bind(n,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(n,"bxchange",function(t){this.selectorInstance.getSearchInstance().searchHandler({event:t})}.bind(this));n.setAttribute("data-bxchangehandler","Y")}}}if(i||e){if(!this.initialized){this.selectorInstance.itemsSelected={}}if(typeof t.value!="undefined"){this.selectorInstance.itemsSelected=t.value}this.openDialog({bindNode:e,bindPosition:i})}}.bind(this))}},this))}}},this),1)},openDialog:function(t){if(BX.type.isNotEmptyObject(t)){if(typeof t.bindNode!="undefined"){this.selectorInstance.bindOptions.node=t.bindNode}if(typeof t.bindPosition!="undefined"){this.selectorInstance.bindOptions.position=t.bindPosition}}this.selectorInstance.openDialog();this.mainPopupWindow=this.getOption("useContainer")=="Y"?this.selectorInstance.popups.container:this.selectorInstance.popups.main},closeDialog:function(){this.selectorInstance.closeDialog()},getData:function(t){this.blockInit=true;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataStart",[this.id]);BX.ajax.runComponentAction("bitrix:main.ui.selector","getData",{mode:"ajax",data:{options:this.options,entityTypes:this.entityTypes,selectedItems:this.items.selected||{}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id]);this.addData(e.data,t);this.initialized=true}}.bind(this),function(t){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id])}.bind(this))},loadAll:function(t){var e=BX.type.isNotEmptyString(t.entity)?t.entity.toUpperCase():"USERS";if(BX.type.isNotEmptyObject(t)&&BX.type.isFunction(t.callback)&&!BX.Main.selectorManagerV2.loadedEntities[e]){BX.Main.selectorManagerV2.loadedEntities[e]=true;BX.ajax.runComponentAction("bitrix:main.ui.selector","loadAll",{mode:"ajax",data:{entityType:e}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){for(var i in e.data){if(e.data.hasOwnProperty(i)){BX.onCustomEvent("onFinderAjaxLoadAll",[e.data[i],BX.UI.SelectorManager,i.toLowerCase()])}}t.callback()}}.bind(this),function(t){}.bind(this))}},searchRequest:function(t){this.blockInit=true;if(this.selectorInstance.timeouts.search){clearTimeout(this.selectorInstance.timeouts.search)}var e=new Date;this.selectorInstance.searchRequestId=e.getTime();BX.ajax.runComponentAction("bitrix:main.ui.selector","doSearch",{mode:"ajax",data:{searchString:t.searchString,searchStringConverted:BX.message("LANGUAGE_ID")=="ru"&&BX.correctText?BX.correctText(t.searchString):"",currentTimestamp:this.selectorInstance.searchRequestId,options:this.options,entityTypes:this.entityTypes,additionalData:BX.type.isNotEmptyObject(t.additionalData)?t.additionalData:{}},onrequeststart:function(t){this.selectorInstance.searchXhr=t}.bind(this)}).then(function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(e.data)&&e.data.currentTimestamp&&e.data.currentTimestamp==this.selectorInstance.searchRequestId&&BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.success)){t.callback.success(e.data,{searchString:t.searchString,searchStringOriginal:BX.type.isNotEmptyObject(t.searchStringOriginal)?t.searchStringOriginal:t.searchString})}}.bind(this),function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.failure)){t.callback.failure(BX.type.isNotEmptyObject(e.data)?e.data:{})}}.bind(this))},getTreeItemRelation:function(t){BX.ajax.runComponentAction("bitrix:main.ui.selector","getTreeItemRelation",{mode:"ajax",data:{entityType:t.entityType,categoryId:t.categoryId}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)&&typeof t.callback!="undefined"){t.callback({selectorInstanceId:this.selectorInstance.id,entityType:t.entityType,categoryId:t.categoryId,data:e.data})}}.bind(this),function(t){})},addData:function(t,e){BX.onCustomEvent("BX.Main.SelectorV2:onAddData",[this.id,t]);if(typeof t.ENTITIES.CRM!="undefined"&&typeof t.ENTITIES.CRM.ITEMS_LAST!="undefined"&&BX.type.isNotEmptyObject(t.ENTITIES.CRM.ITEMS_LAST)){}e.apply(this,t)},getId:function(){return this.id},getOption:function(t){return typeof this.options[t]!="undefined"?this.options[t]:null},saveDestination:function(t){if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.itemId)){var e=this.getOption("context");if(BX.type.isNotEmptyString(e)){BX.ajax.runComponentAction("bitrix:main.ui.selector","saveDestination",{mode:"ajax",data:{context:e,itemId:t.itemId}}).then(function(t){},function(t){})}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?1654841546154696";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};(function(e,t,i,s){"use strict";(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(e){var t,i,s,n,a;t={block:"main-ui-control-field-group",name:e.name+"_datesel",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:"","data-time":e.enableTime},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:e.label};t.content.push(n)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",items:"items"in e?e.items:"",name:"name"in e?e.name+"_datesel":"",params:"params"in e?e.params:"",valueDelete:false}};t.content.push(i);if("content"in e&&BX.type.isArray(e.content)){e.content.forEach(function(e){t.content.push(e)})}if("content"in e&&(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content))){t.content.push(e.content)}s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(s);if(!("dragButton"in e)||e.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(a)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(e){var t,i,s,n,a;t={block:"main-ui-control-field",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:e.label};t.content.push(n)}if(BX.type.isArray(e.content)){e.content.forEach(function(e){t.content.push(e)})}else if(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content)){t.content.push(e.content)}if("valueDelete"in e&&e.valueDelete===true){s={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};t.content.push(s)}if("deleteButton"in e&&e.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(i)}if(!("dragButton"in e)||e.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(a)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(e){var t,i,s,n;t={block:"main-ui-control-field-group",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){s={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:e.label};t.content.push(s)}if(BX.type.isArray(e.content)){e.content.forEach(function(e){t.content.push(e)})}else if(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content)){t.content.push(e.content)}if("deleteButton"in e&&e.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(i)}if(!("dragButton"in e)||e.dragButton!==false){n={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(n)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(e){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in e?e.type:"text",name:"name"in e?e.name:"",placeholder:"placeholder"in e?e.placeholder:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:""}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-textarea"]=function(e){return{block:"main-ui-control-string",mix:["main-ui-control main-ui-control-textarea"],tag:"textarea",attrs:{name:"name"in e?e.name:"",placeholder:"placeholder"in e?e.placeholder:"",tabindex:"tabindex"in e?e.tabindex:""},content:"value"in e?e.value:""}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(e){var t={block:"main-ui-select-inner-label",content:"label"in e?e.label:""};var i={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":e.id,"data-name":e.name,"data-item":"item"in e?JSON.stringify(e.item):{}},events:{click:"onClick"in e?e.onClick:""},content:t};return i}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(e){return{block:"main-ui-filter-info",tag:"span",content:e.content,attrs:{title:e.title}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var t,i,s;t={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach(function(e){t.mix.push(e)})}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};t.content.push(i);if("valueDelete"in e&&e.valueDelete===true){s={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};t.content.push(s)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(e){var t=["main-ui-filter-search-square"];if("isPreset"in e&&e.isPreset){t.push("main-ui-filter-search-square-preset")}return{block:"main-ui-square",mix:t,attrs:{"data-item":"item"in e?JSON.stringify(e.item):"",title:"title"in e?e.title:""},content:[{block:"main-ui-square-item",content:"name"in e?BX.util.htmlspecialcharsback(e.name):""},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(e){var t,i,s,n,a;t={block:"main-ui-control-field-group",name:"name"in e?e.name+"_numsel":"",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:e.label};t.content.push(n)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",items:"items"in e?e.items:"",name:"name"in e?e.name+"_numsel":"",params:"params"in e?e.params:"",valueDelete:false}};t.content.push(i);if("content"in e&&BX.type.isArray(e.content)){e.content.forEach(function(e){t.content.push(e)})}if("content"in e&&(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content))){t.content.push(e.content)}s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(s);if(!("dragButton"in e)||e.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(a)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(e){return{block:"main-ui-filter-sidebar-item"+("pinned"in e&&e.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in e?e.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in e?e.placeholder:"",value:"text"in e?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(e.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in e?e.text:""},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in e&&e.noEditPinTitle?e.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in e&&e.editNameTitle?e.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in e&&e.removeTitle?e.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in e&&e.editPinTitle?e.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function e(t,i){var s;i=BX.type.isPlainObject(i)?i:null;s=Object.keys(i);[].forEach.call(t||[],function(e){s.forEach(function(t){BX.style(e,t,i[t])})})},closestParent:function e(t,i){if(t){if(!i){return t.parentNode||null}else{return BX.findParent(t,{className:i})}}},closestChilds:function e(t){return!!t?t.children:null},getNext:function e(t){return!!t?t.nextElementSibling:null},getPrev:function e(t){return!!t?t.previousElementSibling:null},collectionSort:function e(t,i){var s,n,a,r,l;if(t&&i&&t!==i&&t.parentNode===i.parentNode){s=this.closestParent(i);n=this.closestChilds(s);a=n.length;r=this.getIndex(n,t);l=this.getIndex(n,i);if(a===l){s.appendChild(i)}if(r>l){s.insertBefore(t,i)}if(r<l&&a!==l){s.insertBefore(t,this.getNext(i))}}},getIndex:function e(t,i){return[].indexOf.call(t||[],i)},getByClass:function e(t,i,s){var n=[];if(i){n=(t||document.body).getElementsByClassName(i);if(!s){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function e(t,i,s){var n=[];if(i){n=(t||document.body).getElementsByTagName(i);if(!s){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function e(t,i,s){var n=[];if(i){if(!s){n=(t||document.body).querySelector(i)}else{n=(t||document.body).querySelectorAll(i);n=[].slice.call(n)}}return n},requestAnimationFrame:function e(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.apply(window,arguments)},sortObject:function e(t){var i={};Object.keys(t).sort().forEach(function(e){i[e]=t[e]});return i},objectsIsEquals:function e(t,i){return JSON.stringify(t)===JSON.stringify(i)},isKey:function e(t,i){var s={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var n=!!t?"keyCode"in t?t.keyCode:"which"in t?t.which:0:0;return n in s&&s[n]===i}}})();(function(){BX.namespace("BX.Filter");BX.Filter.DestinationSelectorManager={fields:[],controls:{},onSelect:function e(t,i,s){if(!BX.type.isNotEmptyObject(s)||!BX.type.isNotEmptyObject(s.item)||!BX.type.isNotEmptyString(s.selectorId)){return}var n=s.selectorId,a=s.item;var r=BX.Filter.DestinationSelectorManager.controls[n];if(r){var l=a.id;if(BX.type.isNotEmptyString(t)&&t=="Y"&&BX.type.isNotEmptyString(i)){var o=new RegExp("^"+i+"(\\d+)$");var u=l.match(o);if(BX.type.isArray(u)){l=u[1]}}else{var c={};BX.onCustomEvent(window,"BX.Filter.DestinationSelector:convert",[{selectorId:n,value:l},c]);if(BX.type.isNotEmptyString(c.value)){l=c.value}}r.setData(BX.util.htmlspecialcharsback(a.name),l);r.getLabelNode().value="";r.getLabelNode().blur()}},onDialogOpen:function e(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.selectorId)){return}var i=t.selectorId;var s=BX.Filter.DestinationSelector.items[i];if(s){s.onDialogOpen()}},onDialogClose:function e(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.selectorId)){return}var i=t.selectorId;var s=BX.Filter.DestinationSelector.items[i];if(s){s.onDialogClose()}}};BX.Filter.DestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BX.Filter.DestinationSelector.items={};BX.Filter.DestinationSelector.create=function(e,t){if(typeof this.items[e]!="undefined"){return this.items[e]}var i=new BX.Filter.DestinationSelector(e,t);i.initialize(e,t);this.items[e]=i;BX.onCustomEvent(window,"BX.Filter.DestinationSelector:create",[e]);return i};BX.Filter.DestinationSelector.prototype.getSetting=function(e,t){return this.settings.hasOwnProperty(e)?this.settings[e]:t};BX.Filter.DestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BX.Filter.DestinationSelector.prototype.initialize=function(e,t){this.id=e;this.settings=t?t:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var s={};s[this.fieldId]=i.itemId;s[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(s)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BX.Filter.DestinationSelector.prototype.open=function(){var e=this.id;if(!this.inited){var t=this.getSearchInput();t.id=t.name;BX.addCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",BX.delegate(function(e){if(typeof e.id!="undefined"||e.id!=this.id){return}this.opened=true},this));BX.addCustomEvent(window,"BX.UI.SelectorManager:onCreate",BX.delegate(function(e){if(!BX.type.isNotEmptyString(e)||e!=this.id){return}BX.onCustomEvent(window,"BX.Filter.DestinationSelector:setSelected",[{selectorId:e,current:this.control.getCurrentValues()}])},this));BX.onCustomEvent(window,"BX.Filter.DestinationSelector:openInit",[{id:this.id,inputId:t.id,containerId:t.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Filter.DestinationSelector:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BX.Filter.DestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManagerV2.controls[this.id]!=="undefined"){BX.Main.selectorManagerV2.controls[this.id].closeDialog()}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorOpen=function(e){var t=e.getId();if(this.fieldId!==t){this.control=null}else{this.control=e;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BX.Filter.DestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorClose=function(e){if(this.fieldId===e.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BX.Filter.DestinationSelector.prototype.onGetStopBlur=function(e,t){if(BX.findParent(e.target,{className:"bx-lm-box"})){t.stopBlur=true}};BX.Filter.DestinationSelector.prototype.onCustomEntityRemove=function(e){if(this.fieldId===e.getId()){var t=BX.UI.SelectorManager.instances[e.getId()];if(t&&typeof e.hiddenInput!="undefined"&&typeof e.hiddenInput.value!="undefined"&&BX.type.isNotEmptyObject(t.itemsSelected)&&typeof t.itemsSelected[e.hiddenInput.value]!="undefined"){delete t.itemsSelected[e.hiddenInput.value]}}};BX.Filter.DestinationSelector.prototype.onBeforeInitDialog=function(e){if(typeof e.id=="undefined"||e.id!=this.id){return}this.inited=true;if(!this.control){e.blockInit=true}};BX.Filter.DestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BX.Filter.DestinationSelector.prototype.onDialogClose=function(){this.opened=false}})();var n=function(){function e(t,s){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"filter",null);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"dialogOptions",null);babelHelpers.defineProperty(this,"control",null);babelHelpers.defineProperty(this,"isMultiple",false);babelHelpers.defineProperty(this,"needAddEntityIdToFilter",false);babelHelpers.defineProperty(this,"isActive",false);this.id=t;this.settings=s?s:{};this.filter=this.getSetting("filter",null);if(!this.filter){throw new Error("Filter option is required for EntitySelector field")}this.isMultiple=!!this.getSetting("isMultiple",false);this.needAddEntityIdToFilter=this.getSetting("addEntityIdToResult","N")==="Y";this.dialogOptions=this.getSetting("dialogOptions",{});this.dialog=null;i.EventEmitter.subscribe("BX.Main.Filter:customEntityFocus",this.onCustomEntityFocus.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:customEntityBlur",this.onCustomEntityBlur.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:onGetStopBlur",this.onGetStopBlur.bind(this));i.EventEmitter.subscribe('BX.Main.Filter:move", ',this.onCustomEntityRemove.bind(this));this.controlInputChangeHandler=this.onSearchInputChange.bind(this)}babelHelpers.createClass(e,[{key:"open",value:function e(){var t=this;this.isActive=true;if(!this.dialog){this.initDialog().then(function(){if(t.isActive){t.openDialog()}})}else{this.openDialog()}}},{key:"close",value:function e(){this.isActive=false;if(this.dialog&&this.dialog.isOpen()){this.dialog.hide()}s.Event.unbind(this.getFilterFieldInput(),"input",this.controlInputChangeHandler)}},{key:"getFilterField",value:function e(){return this.filter.getField(this.id)}},{key:"getFilterFieldInputWrapper",value:function e(){var t=this.getFilterField();if(!t){return null}return BX.Filter.Utils.getBySelector(t.node,".main-ui-control-entity")}},{key:"getFilterFieldInput",value:function e(){var t=this.getFilterField();if(!t){return null}return BX.Filter.Utils.getBySelector(t.node,"."+this.filter.settings.classStringInput+'[type="text"]')}},{key:"setControl",value:function e(t){this.control=t}},{key:"unsetControl",value:function e(){this.control=null}},{key:"getSetting",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"openDialog",value:function e(){if(this.dialog.isOpen()){return}var t=this.getFilterFieldInputWrapper();this.dialog.setTargetNode(t);this.dialog.setWidth(t.offsetWidth);this.dialog.show();this.updateSelectedItemsInDialog(this.dialog);var i=this.getFilterFieldInput();var n=s.Type.isDomNode(i)?i.value.trim():"";if(n.length){this.dialog.search(n)}s.Event.bind(i,"input",this.controlInputChangeHandler)}},{key:"initDialog",value:function t(){var i=this;return e.initDialogExtension().then(function(e){var t=e.Dialog;i.dialog=new t(babelHelpers.objectSpread({},i.dialogOptions,{id:i.getDialogId(),multiple:i.isMultiple,enableSearch:false,hideOnSelect:true,autoHide:false,hideByEsc:false,events:{"Item:onSelect":i.onDialogItemSelect.bind(i),"Item:onDeselect":i.onDialogItemDeSelect.bind(i),onLoad:i.onDialogLoad.bind(i)}}))})}},{key:"addItemToFilter",value:function e(t,i){if(!this.control){return}if(this.isMultiple){var s=this.control.getCurrentValues();if(!s.filter(function(e){return e.value===t}).length){s.push({value:t,label:i});this.control.setMultipleData(s)}}else{this.control.setSingleData(i,t)}}},{key:"removeItemFromFilter",value:function e(t){if(!this.control){return}if(this.isMultiple){var i=this.control.getCurrentValues();this.control.setMultipleData(i.filter(function(e){return e.value!==t}))}else{this.control.clearValue()}}},{key:"getDialogId",value:function e(){return this.id+"_"+this.filter.getParam("FILTER_ID")}},{key:"getItemId",value:function e(t){if(this.needAddEntityIdToFilter){return JSON.stringify([t.getEntityId()+"",t.getId()+""])}return t.getId()+""}},{key:"updateSelectedItemsInDialog",value:function e(t){var i=this;if(!this.control){return}var s=this.control.getCurrentValues();if(!this.isMultiple){s=[s]}var n=s.map(function(e){return e.value});t.getItems().forEach(function(e){if(n.indexOf(i.getItemId(e))>-1){e.select(true)}else{e.deselect()}})}},{key:"onCustomEntityFocus",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,1),n=s[0];if(this.id!==n.getId()){return}this.setControl(n);this.open()}},{key:"onCustomEntityBlur",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,1),n=s[0];if(this.id!==n.getId()){return}this.close();this.unsetControl()}},{key:"onGetStopBlur",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,2),a=n[0],r=n[1];if(!(this.dialog&&this.dialog.isOpen())){return}var l=this.getFilterField();if(!l){return}var o=a.target;if(o===l.node||l.node.contains(o)&&!s.Dom.hasClass(o,this.filter.settings.classFieldDelete)||o===document.body){r.stopBlur=true;return}var u=this.dialog.getPopup().getContentContainer();if(o===u||u.contains(o)){r.stopBlur=true}}},{key:"onCustomEntityRemove",value:function e(t){var i=t.getData(),n=babelHelpers.slicedToArray(i,1),a=n[0];if(this.id!==a.getId()){return}if(this.dialog){this.dialog.destroy();this.dialog=null}s.Event.unbind(this.getFilterFieldInput(),"input",this.controlInputChangeHandler);this.unsetControl()}},{key:"onSearchInputChange",value:function e(t){if(this.dialog){this.dialog.search(t.target.value)}}},{key:"onDialogItemSelect",value:function e(t){var i=t.getData(),s=i.item;this.addItemToFilter(this.getItemId(s),s.getTitle());this.getFilterFieldInput().value=""}},{key:"onDialogItemDeSelect",value:function e(t){var i=t.getData(),s=i.item;this.removeItemFromFilter(this.getItemId(s))}},{key:"onDialogLoad",value:function e(t){var i=t.getTarget();this.updateSelectedItemsInDialog(i)}}],[{key:"initDialogExtension",value:function t(){if(!e.initExtensionPromise){e.initExtensionPromise=s.Runtime.loadExtension("ui.entity-selector")}return e.initExtensionPromise}},{key:"create",value:function t(i,n){if(s.Type.isObject(this.items[i])){return this.items[i]}var a=new e(i,n);this.items[i]=a;return a}}]);return e}();babelHelpers.defineProperty(n,"initExtensionPromise",null);babelHelpers.defineProperty(n,"items",{});var a=s.Reflection.namespace("BX.Filter");a.EntitySelector=n;(function(){BX.namespace("BX.Filter");BX.Filter.FieldController=function(e,t){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(e,t)};BX.Filter.FieldController.prototype={init:function e(t,i){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(i instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=i;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function e(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function e(){return this.field},getInput:function e(){var t,i;if(!BX.type.isDomNode(this.input)){t=this.getType();i=this.parent.types;if(t===i.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===i.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===i.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===i.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function e(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function e(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function e(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function e(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function e(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function e(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach(function(e){BX.remove(e)})}},_onDeleteClick:function e(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function e(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function e(){var t="";var i=this.getInput();if(BX.type.isDomNode(i)){t=i.value}return t},getType:function e(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();(function(){BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(e){if(!!e&&!BX.hasClass(e,"main-ui-control-entity")){e=BX.Filter.Utils.getByClass(e,"main-ui-control-entity")}return!!e&&JSON.parse(BX.data(e,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function e(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function e(){return BX.Main.ui.CustomEntity.isMultiple(this.getField())},reset:function e(){this.labelInput=null;this.hiddenInput=null},getField:function e(){return this.field},getId:function e(){var t=this.getHiddenNode();var i=null;if(BX.type.isDomNode(t)){i=t.name}return i},getLabelNode:function e(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function e(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function e(t){return BX.Filter.Utils.getBySelector(this.getField(),['[data-item*=":'+BX.util.jsencode(t)+'}"]','[data-item*=":\\"'+BX.util.jsencode(t)+'\\"}"]'].join(", "))},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function e(){this.getSquares().forEach(BX.remove)},setSquare:function e(t,i){var s=this.getField();var n={block:"main-ui-square",name:t,item:{_label:t,_value:i}};var a=BX.decl(n);var r=this.getSquares();if(!r.length){BX.prepend(a,s)}else{BX.insertAfter(a,r[r.length-1])}},getCurrentValues:function e(){var t=this.getSquares();var i,s;if(this.isMultiple()){s=[];for(var n=0,a=t.length;n<a;n++){try{i=JSON.parse(BX.data(t[n],"item"));s.push({label:i._label,value:i._value})}catch(e){}}}else{if(t.length===0){s={label:"",value:""}}else{try{i=JSON.parse(BX.data(t[0],"item"));s={label:i._label,value:i._value}}catch(e){s={label:"",value:""}}}}return s},setData:function e(t,i){return this.isMultiple()?this.setMultipleData(t,i):this.setSingleData(t,i)},setSingleData:function e(t,i){var s=this.getHiddenNode();this.removeSquares();this.setSquare(t,i);if(BX.type.isDomNode(s)){s.value=i;BX.fireEvent(s,"input")}},setMultipleData:function e(t,i){var s=[];var n=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach(function(e){s.push(e.value);this.setSquare(e.label,e.value)},this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(s);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(t)&&i!==null){if(!this.getSquareByValue(i)){this.setSquare(t,i);this.getSquares().forEach(function(e){var t=JSON.parse(BX.data(e,"item"));if(BX.type.isPlainObject(t)){s.push(t._value)}});n.value=JSON.stringify(s);BX.fireEvent(n,"input")}}},clearValue:function e(){this.removeSquares();var t=this.getHiddenNode();t.value=this.isMultiple()?"[]":""},setPopupContainer:function e(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function e(){return this.popupContainer}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Search=function(e){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(e)};BX.Filter.Search.prototype={init:function e(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.removeAutofocus();this.firstInit=true},removeAutofocus:function e(){var t=this.getInput();if(!!t){t.blur();t.autofocus=null}},getFindButton:function e(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function e(){this.apply()},selectSquare:function e(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function e(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function e(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function e(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function e(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function e(){var t=this.getSquares();return t.length&&t.every(this.isSquareSelected,this)},isSquareSelected:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function e(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function e(){var t=this.getSearchString().length;var i=this.getInput();var s=i.selectionStart;var n=i.selectionEnd;return s===0&&n!==0&&n===t},isSelectionStart:function e(){var t=this.getInput();var i=t.selectionStart;var s=t.selectionEnd;return i===0&&s===0},isSquareRemoveButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},getClearButton:function e(){return this.getContainer().querySelector("."+this.parent.settings.classClearSearchValueButton)},isSearchButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function e(){if(!BX.browser.IsMobile()){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}}},findSquareByChild:function e(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function e(t){var i=BX.data(t,"item");return!!t&&!!i?JSON.parse(i):null},isSquareControl:function e(t){var i=this.getSquareData(t);return!!i&&(i.type==="control"||BX.type.isArray(i))},onPresetSquareRemove:function e(){var t=this.parent;var i=t.getPreset();var s=i.getCurrentPresetId();var n=t.getParam("RESET_TO_DEFAULT_MODE");var a=t.getParam("VALUE_REQUIRED");var r=i.isPinned(s);var l=this.getSquares();if(l.length===1){if(a&&r){this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{if(n&&r||!n){var o=true;this.lastPromise=t.resetFilter(o);t.closePopup()}}if(n&&!r){this.lastPromise=t.getPreset().applyPinnedPreset()}}if(l.length>1){var u=i.getPreset(i.getCurrentPresetId());var c=i.getPreset("tmp_filter");c.FIELDS=BX.clone(u.ADDITIONAL);u.ADDITIONAL=[];i.deactivateAllPresets();i.applyPreset("tmp_filter");t.applyFilter()}},onControlSquareRemove:function e(t){var i=this.parent;var s=i.getPreset();var n=i.getParam("RESET_TO_DEFAULT_MODE");var a=i.getParam("VALUE_REQUIRED");var r;if(n&&this.getSquares().length===1){if(a){r=this.getSquareData(t);i.clearControls(r);this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{this.lastPromise=i.getPreset().applyPinnedPreset()}}else{r=this.getSquareData(t);i.clearControls(r);i.closePopup();if(BX.type.isArray(r)){r.forEach(function(e){s.removeAdditionalField(e.name)})}if(BX.type.isPlainObject(r)){s.removeAdditionalField(r.name)}this.apply()}},onValueRequiredSquareRemove:function e(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function e(t){var i=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(t);if(i){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function e(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function e(t){!!t&&BX.remove(t)},_onSearchContainerClick:function e(t){var i=this.parent;if(this.isClearButton(t.target)){if(!i.getParam("VALUE_REQUIRED")){if(!i.getParam("VALUE_REQUIRED_MODE")){if(i.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{var s=i.getPreset().isPinned(i.getPreset().getCurrentPresetId());if(s||i.getPreset().getCurrentPresetId()==="tmp_filter"){var n=i.getPreset().getPreset(i.getPreset().getCurrentPresetId());if(n.ADDITIONAL.length){n.ADDITIONAL=[];this.lastPromise=i.getPreset().applyPreset(i.getPreset().getCurrentPresetId());this.apply()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{if(i.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}this.clearInput()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var a=this.findSquareByChild(t.target);this.complexSquareRemove(a);this.adjustFocus()}else{if(!i.getPopup().isShown()){i.showPopup()}else{var r=this.getInput();var l=r.selectionStart;var o=r.selectionEnd;var u=this.getSearchString().length;if(!(u&&l===0&&o===u)){if(i.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.closePopup()}}else{i.closePopup();if(i.getParam("VALUE_REQUIRED_MODE")){i.restoreRemovedPreset()}}}}}},_onKeyDown:function e(t){var i=BX.Filter.Utils;var s=this.parent;if(i.isKey(t,"enter")){if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}s.closePopup()}if(i.isKey(t,"tab")||i.isKey(t,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(i.isKey(t,"upArrow")){s.closePopup();if(s.getParam("VALUE_REQUIRED_MODE")){this.parent.restoreRemovedPreset()}if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}}}if(i.isKey(t,"a")&&t.metaKey||i.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(i.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("VALUE_REQUIRED")){var n=this.parent.getPreset().isPinned(this.parent.getPreset().getCurrentPresetId());if(n){this.removeSquares();this.parent.showPopup();this.adjustPlaceholder();this.hideClearButton();this.parent.getPreset().deactivateAllPresets()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.parent.resetFilter()}this.parent.closePopup();this.adjustFocus()}this.clearInput()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}}if(i.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var a=this.getLastSquare();this.isSquareSelected(a)?this.complexSquareRemove(a):this.selectSquare(a)}if(!i.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function e(){var t=this.getInput();return!!t?t.value:""},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function e(){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}},isResolvedRequest:function e(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function e(){if(this.isResolvedRequest()){this.lastPromise=this.parent._onFindButtonClick()}return this.lastPromise},reset:function e(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate(function(){this.lastPromise=this.parent.resetFilter()},this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function e(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton()}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}}if(this.parent.isAppliedUserFilter()){BX.Dom.addClass(this.container,"main-ui-filter-search--active")}else{BX.Dom.removeClass(this.container,"main-ui-filter-search--active")}},_onInput:function e(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function e(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function e(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function e(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function e(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function e(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function e(t){var i=this.getInput();i.placeholder=t},clearInput:function e(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function e(){this.clearInput();this.removePreset()},makeSquares:function e(t,i,s){var n;var a=null;var r=this.getContainer();var l={squares:[],moreSquares:[]};t.forEach(function(e,t){if(t<i){n=BX.decl(e);a=a||n;if(!s){if(t===0){BX.prepend(n,r)}else{BX.insertAfter(n,a)}}else{var o=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(o){BX.insertAfter(n,o)}else{BX.prepend(n,r)}}a=n;l.squares.push(n)}else{l.moreSquares.push({type:"control",name:e.value,title:e.title})}},this);return l},squares:function e(t,i,s){var n,a,r,l,o;var e=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){e.forEach(function(e){var t=BX.data(e,"item");if(t){BX.remove(e)}})}else{e.forEach(BX.remove)}n=this.prepareSquaresData(t);a=this.makeSquares(n,i,s);l=0;o={squaresData:n,width:0};if(a.moreSquares.length){r={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+a.moreSquares.length,item:a.moreSquares,title:a.moreSquares.map(function(e){return e.title}).join(", \n")};r=BX.decl(r);a.squares.push(r);BX.insertAfter(r,a.squares[a.squares.length-2]);l=a.squares.reduce(function(e,t){return e+BX.width(t)+(parseFloat(BX.style(t,"margin-right"))||0)},0)}o.width=l;return o},setPreset:function e(t){var i=this.getContainer();var s,n;var a;if(BX.type.isPlainObject(t)){n=BX.Filter.Utils.getByClass(i,this.parent.settings.classSquare,true);n.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(s,i);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){a=this.squares(t.ADDITIONAL,1,true);if(BX.width(i)-a.width<100){a=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach(function(e,i){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+i}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+i}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}})}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){a=this.squares(t.FIELDS,2);if(BX.width(i)-a.width<100){a=this.squares(t.FIELDS,1)}}}if(a&&BX.type.isArray(a.squaresData)&&a.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"))}this.showClearButton()}else{this.adjustPlaceholder()}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function e(t){var i,s,n;var a=[];t=t.filter(function(e){return!!e&&this.parent.params.FIELDS.some(function(t){return e.NAME===t.NAME})},this);t.map(function(e){i=null;switch(e.TYPE){case this.parent.types.DATE:{i=e.LABEL+": "+e.SUB_TYPE.NAME;if(e.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(e.VALUES._quarter)){var t=e.QUARTERS.filter(function(t){return t.VALUE==e.VALUES._quarter}).map(function(e){return e.NAME});t=t.length?t.join(""):"";i=e.LABEL+": "+t+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(e.VALUES._year)){i=e.LABEL+": "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(e.VALUES._month)){var r=e.MONTHS.filter(function(t){return t.VALUE==e.VALUES._month}).map(function(e){return e.NAME});r=r.length?r.join(""):"";i=e.LABEL+": "+r+" "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": "+e.VALUES._from}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+e.VALUES._from+"-"+e.VALUES._to}else if(!BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+e.VALUES._to}else if(BX.type.isNotEmptyString(e.VALUES._from)&&!BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+e.VALUES._from}}if((e.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||e.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(e.VALUES._days))){i=null}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(e.VALUES._days))){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",e.VALUES._days)}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(e.VALUES._days))){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",e.VALUES._days)}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){i=null}break}case this.parent.types.CUSTOM_DATE:{if(BX.type.isArray(e.VALUE.days)&&e.VALUE.days.length||BX.type.isArray(e.VALUE.months)&&e.VALUE.months.length||BX.type.isArray(e.VALUE.years)&&e.VALUE.years.length){i=e.LABEL}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE||e.STRICT){i=e.LABEL+": "+e.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){s=[];i=e.LABEL+": ";e.VALUE.forEach(function(e,t){if(t<2){s.push(e.NAME)}});i+=s.join(", ");if(e.VALUE.length>2){n=[];e.VALUE.forEach(function(e){n.push(e.NAME)});i=n.join(", ")}}break}case this.parent.types.NUMBER:{if(e.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": "+e.VALUES._from}else{i=null}}if(e.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+e.VALUES._from+"-"+e.VALUES._to}else if(!BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+e.VALUES._to}else if(BX.type.isNotEmptyString(e.VALUES._from)&&!BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+e.VALUES._from}else{i=null}}if(e.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": > ";i+=e.VALUES._from}}if(e.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": < ";i+=e.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:case this.parent.types.DEST_SELECTOR:case this.parent.types.ENTITY_SELECTOR:{if(e.MULTIPLE){var l=!!e.VALUES._label?e.VALUES._label:[];if(BX.type.isPlainObject(l)){l=Object.keys(l).map(function(e){return l[e]})}if(!BX.type.isArray(l)){l=[l]}if(l.length>0){i=e.LABEL+": ";i+=l.join(", ")}}else{if(BX.type.isNotEmptyString(e.VALUES._value)&&BX.type.isNotEmptyString(e.VALUES._label)){i=e.LABEL+": ";i+=e.VALUES._label}}break}case this.parent.types.CUSTOM:{i="_VALUE"in e&&BX.type.isNotEmptyString(e._VALUE)?e.LABEL:null;break}default:{if(BX.type.isNotEmptyString(e.VALUE)){i=e.LABEL+": "+e.VALUE}break}}if(i!==null){a.push({block:"main-ui-search-square",name:i,value:e.NAME,item:{type:"control",name:e.NAME},title:i})}},this);return a},getPreset:function e(){var t=this.getContainer();var i=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.Filter.Utils.getByClass(t,i)}return s},removePreset:function e(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);this.adjustPlaceholder()}this.hideClearButton()},updatePreset:function e(t){this.removePreset();this.setPreset(t)}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Settings=function(e,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classLimitsAnimation="main-ui-filter-field-limits-animate";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="ui-btn-clock";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.classPresetField="main-ui-filter-preset-field";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.init(e,t)};BX.Filter.Settings.prototype={init:function e(t,i){this.generalTemplateId=i.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(t)},get:function e(t,i){return t&&t in this&&!BX.type.isFunction(this[t])?this[t]:i},mergeSettings:function e(t){if(BX.type.isPlainObject(t)){Object.keys(t).forEach(function(e){if(!BX.type.isFunction(this[e])){this[e]=t[e]}},this)}}}})();(function(){BX.namespace("BX.Main");BX.Main.Filter=function(e,t,i,s,n,a){this.params=e;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=i;this.dateTypes=s;this.additionalDateTypes=a;this.numberTypes=n;this.settings=new BX.Filter.Settings(t,this);this.filter=null;this.api=null;this.isAddPresetModeState=false;this.firstInit=true;this.analyticsLabel=null;this.emitter=new BX.Event.EventEmitter;this.emitter.setEventNamespace("BX.Filter.Field");this.emitter.subscribe=function(e,t){BX.Event.EventEmitter.subscribe(this.emitter,e.replace("BX.Filter.Field:",""),t)}.bind(this);this.init()};function e(e){if(BX.type.isString(e)){e=e.toLowerCase();e=e.replace(/[\-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""});return e.substr(0,1).toLowerCase()+e.substr(1)}return e}BX.Main.Filter.prototype={init:function e(){BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));BX.bind(window,"load",BX.delegate(this.onWindowLoad,this));BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"))},getEmitter:function e(){return this.emitter},onWindowLoad:function e(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},clearGet:function e(){if("history"in window){var t=window.location.toString();var i=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",i)}},adjustFocus:function e(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}}},getApi:function e(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function e(t,i,s){var n=this.getPreset();var a=n.getContainer();var r=n.createSidebarItem(t,i,s);var l=n.getPresetNodeById(t);if(BX.type.isDomNode(l)){BX.remove(l);BX.prepend(r,a)}else{a&&a.insertBefore(r,n.getAddPresetField())}BX.bind(r,"click",BX.delegate(n._onPresetClick,n))},saveUserSettings:function e(t){var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var n=s.getCurrentPresetId();var a={};this.params["PRESETS"]=BX.clone(this.editablePresets);a.current_preset=n;s.getPresets().forEach(function(e,i){var n=s.getPresetId(e);if(n&&n!=="tmp_filter"){var r=s.getPreset(n);r.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(r.TITLE));r.SORT=i;s.updatePresetName(e,r.TITLE);a[n]={sort:i,name:r.TITLE,fields:this.preparePresetSettingsFields(r.FIELDS),for_all:t&&!BX.type.isBoolean(r.FOR_ALL)||t&&r.FOR_ALL===true}}},this);this.saveOptions(a,i,null,t)},isForAll:function e(t){var i=this.getForAllCheckbox();return BX.type.isBoolean(t)&&t||!!i&&!!i.checked},getForAllCheckbox:function e(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function e(t){var i={};var s;(t||[]).forEach(function(e){switch(e.TYPE){case this.types.STRING:{i[e.NAME]=e.VALUE;break}case this.types.TEXTAREA:{i[e.NAME]=e.VALUE;break}case this.types.SELECT:{i[e.NAME]="VALUE"in e.VALUE?e.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){e.VALUE.forEach(function(t,s){i[e.NAME]=BX.type.isPlainObject(i[e.NAME])?i[e.NAME]:{};i[e.NAME][s]=t.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){e.VALUE.forEach(function(t,s){i[e.NAME]=BX.type.isPlainObject(i[e.NAME])?i[e.NAME]:{};i[e.NAME][s]=t.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(e.VALUES)){s=Object.keys(e.VALUES);i[e.NAME+"_datesel"]=e.SUB_TYPE.VALUE;s.forEach(function(t){i[e.NAME+t]=e.VALUES[t]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(e.VALUES)){s=Object.keys(e.VALUES);i[e.NAME+"_numsel"]=e.SUB_TYPE.VALUE;s.forEach(function(t){i[e.NAME+t]=e.VALUES[t]},this)}break}case this.types.DEST_SELECTOR:{if(BX.type.isPlainObject(e.VALUES)){i[e.NAME]=e.VALUES._value;i[e.NAME+"_label"]=e.VALUES._label}break}case this.types.DEST_SELECTOR:case this.types.ENTITY_SELECTOR:case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(e.VALUES)){i[e.NAME]=e.VALUES._value;i[e.NAME+"_label"]=e.VALUES._label}break}default:{break}}},this);return i},savePreset:function e(){var t="filter_"+ +new Date;var i=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,i,null,true,null,null,true);this.addSidebarItem(t,i);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function e(t,i,s,n,a,r,l){var o=this.getFilterFieldsValues();var u=this.getPreset().getFields().map(function(e){return BX.data(e,"name")});var c=this.getPreset().getCurrentPresetData();var h={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var d,p,f,m,E;var g={};g.additional={};if(t!=="tmp_filter"&&t!=="default_filter"&&!l){var y=BX.type.isArray(c.ADDITIONAL)?c.ADDITIONAL:[];y.forEach(function(e){Object.keys(o).forEach(function(t){if(t.indexOf(e.NAME)!==-1){g.additional[t]=o[t];delete o[t]}})})}d=Object.keys(o);if(!s){g.apply_filter="Y"}else{g.clear_filter="Y"}g.save="Y";g.fields=o;g.rows=u.join(",");g.preset_id=t||c.ID;if(BX.type.isNotEmptyString(i)){g.name=BX.util.htmlspecialchars(i)}else{f=this.getPreset().getPresetNodeById(g.preset_id);m=this.getPreset().getPresetInput(f);if(BX.type.isDomNode(m)&&BX.type.isNotEmptyString(m.value)){g.name=m.value}else{g.name=c.TITLE}}if((!("sort"in g)||!BX.type.isNumber(g.sort))&&n){E=this.getParam("PRESETS");g.sort=E.length+2}if(!s){d.forEach(function(e){if(BX.type.isArray(g.fields[e])){p=g.fields[e].length?{}:"";g.fields[e].forEach(function(e,t){p[t]=e},this);if(p||BX.type.isNumber(p)||BX.type.isBoolean(p)){g.fields[e]=p}}},this)}if(g.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(g)}if(BX.type.isFunction(a)){a()}var B=new BX.Promise(null,this);B.setAutoResolve("fulfill",0);B.then(function(){var e=new BX.Promise(null,this);this.saveOptions(g,h,BX.proxy(e.fulfill,e));return e}).then(function(){!!r&&r()});return B},saveFieldsSort:function e(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var i=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(i)){s.rows=i.map(function(e){return BX.data(e,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function e(t){var i,s;if(BX.type.isPlainObject(t)&&"preset_id"in t){i=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(i)){if("name"in t&&BX.type.isNotEmptyString(t.name)){i.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach(function(e){t.fields[e]=""})}if("fields"in t){i.FIELDS=this.preparePresetFields(t.fields,t.rows)}if("additional"in t&&i.ID!=="tmp_filter"){i.ADDITIONAL=this.preparePresetFields(t.additional,t.rows)}}else{s=this.getParam("PRESETS");i={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(i)}}},preparePresetFields:function e(t,i){var s,n;var a=[];if(BX.type.isPlainObject(t)){i=BX.type.isNotEmptyString(i)?i.split(","):[];s=i.length?i:Object.keys(t);s.forEach(function(e){e=e.replace("_datesel","").replace("_numsel","");n=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(n)){if(n.TYPE===this.types.STRING){n.VALUE=t[e]}if(n.TYPE===this.types.TEXTAREA){n.VALUE=t[e]}if(n.TYPE===this.types.MULTI_SELECT){n.VALUE=this.prepareMultiSelectValue(t[e],n.ITEMS)}if(n.TYPE===this.types.SELECT||n.TYPE===this.types.CHECKBOX){n.VALUE=this.prepareSelectValue(t[e],n.ITEMS)}if(n.TYPE===this.types.DATE){n.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],n.SUB_TYPES);n.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_month"],_quarter:t[e+"_quarter"],_year:t[e+"_year"],_allow_year:t[e+"_allow_year"]}}if(n.TYPE===this.types.CUSTOM_DATE){n.VALUE={days:Object.keys(t[e+"_days"]||{}).map(function(i){return t[e+"_days"][i]}),months:Object.keys(t[e+"_months"]||{}).map(function(i){return t[e+"_months"][i]}),years:Object.keys(t[e+"_years"]||{}).map(function(i){return t[e+"_years"][i]})}}if(n.TYPE===this.types.NUMBER){n.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],n.SUB_TYPES);n.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(n.TYPE===this.types.DEST_SELECTOR||n.TYPE===this.types.ENTITY_SELECTOR||n.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){n.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){n.VALUES._value=t[e]}}if(n.TYPE===this.types.CUSTOM){n._VALUE=t[e]}a.push(n)}},this)}return a},prepareSelectValue:function e(t,i){var s={};var n;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(i)){n=this.prepareMultiSelectValue({0:t},i);s=n.length>0?n[0]:{}}else{s=i[0]}return s},prepareMultiSelectValue:function e(t,i){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(i)){var n=Object.keys(t);var a=n.map(function(e){return t[e]});s=i.filter(function(e){return a.some(function(t){return t===e.VALUE})},this)}return s},getFieldByName:function e(t){var i=this.getParam("FIELDS");var s=i.find(function(e){return e.NAME===t});if(s){return s}var n=this.getFieldListContainer().querySelector('[data-name="'+t+'"]');s=BX.Filter.Field.instances.get(n);if(s){return s.options}return null},confirmSaveForAll:function e(){return new Promise(function(e){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,e)}.bind(this))},saveOptions:function t(i,s,n,a){s.action=e(s.action);s.forAll=this.isForAll(a);s.commonPresetsId=this.getParam("COMMON_PRESETS_ID");s.apply_filter=i.apply_filter||"N";s.clear_filter=i.clear_filter||"N";s.with_preset=i.with_preset||"N";s.save=i.save||"N";var r={params:s,data:i};delete i.apply_filter;delete i.save;delete i.clear_filter;delete i.with_preset;if(s.forAll&&s.action==="setFilterArray"){return this.confirmSaveForAll().then(function(){return this.backend(s.action,r)}.bind(this)).then(function(){this.disableEdit();this.disableAddPreset()}.bind(this))}return this.backend(s.action,r).then(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(n)&&n()}.bind(this))},backend:function e(t,i){var s=this.analyticsLabel||{};this.analyticsLabel={};return BX.ajax.runComponentAction("bitrix:main.ui.filter",t,{mode:"ajax",data:i,analyticsLabel:babelHelpers.objectSpread({FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),PRESET_ID:i["data"]["preset_id"],FIND:i["data"].hasOwnProperty("fields")&&i["data"]["fields"].hasOwnProperty("FIND")&&!!i["data"]["fields"]["FIND"]?"Y":"N",ROWS:BX.Type.isObject(i["data"]["additional"])&&Object.keys(i["data"]["additional"]).length==0?"N":"Y"},s)})},limitAnalyticsSend:function e(){BX.ajax.runComponentAction("bitrix:main.ui.filter","limitAnalytics",{mode:"ajax",data:{},analyticsLabel:{FILTER_ID:this.getParam("FILTER_ID"),LIMIT:this.getParam("FILTER_ID")}})},prepareEvent:function e(t){var i,s;if(!("path"in t)||!t.path.length){t.path=[t.target];i=0;while((s=t.path[i++].parentNode)!==null){t.path.push(s)}}return t},restoreRemovedPreset:function e(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var i=t.ID;var s=this.getPreset().getPresetNodeById(i);this.getPreset().applyPreset(i);this.getPreset().activatePreset(s)}}},hasScrollClick:function e(t){var i="clientX"in t?t.clientX:"x"in t?t.x:0;return i>=document.documentElement.offsetWidth},isUseCommonPresets:function e(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function e(t){t=this.prepareEvent(t);return(t.path||[]).some(function(e){return BX.type.isDomNode(e)&&(BX.hasClass(e,this.settings.classFilterContainer)||BX.hasClass(e,this.settings.classSearchContainer)||BX.hasClass(e,this.settings.classDefaultPopup)||BX.hasClass(e,this.settings.classPopupOverlay))},this)},_onDocumentClick:function e(t){var i=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(i&&i.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function e(t){var i=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(i&&!i.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function e(t){if(BX.type.isPlainObject(t)){if(t.cache===false){this.fieldsPopupItems=null}}var i=this.getPreset().getFields();var s=this.getFieldsPopupItems();var n,a;if(BX.type.isArray(s)&&s.length){s.forEach(function(e){n=BX.data(e,"name").replace("_datesel","").replace("_numsel","");a=i.some(function(e){return BX.data(e,"name")===n});if(a){BX.addClass(e,this.settings.classMenuItemChecked)}else{BX.removeClass(e,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function e(){if(!BX.type.isArray(this.fieldsPopupItems)){var t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListContainerClassName:function e(t){var i=this.settings.classPopupFieldList1Column;if(t>6&&t<12){i=this.settings.classPopupFieldList2Column}if(t>12){i=this.settings.classPopupFieldList3Column}return i},prepareFieldsDecl:function e(t){return(t||[]).map(function(e){return{block:"main-ui-filter-field-list-item",label:"LABEL"in e?e.LABEL:"",id:"ID"in e?e.ID:"",name:"NAME"in e?e.NAME:"",item:e,onClick:BX.delegate(this._clickOnFieldListItem,this)}},this)},getLazyLoadFields:function e(){var t=new BX.Promise;BX.ajax({method:"GET",url:this.getParam("LAZY_LOAD")["GET_LIST"],dataType:"json",onsuccess:function e(i){t.fulfill(i)}});return t},getFieldsListPopupContent:function e(){var t=new BX.Promise;var i=this.getParam("FIELDS");var s=BX.type.isArray(i)?i.length:0;if(this.getParam("LAZY_LOAD")){var n=function(e){var i={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(e.length),content:this.prepareFieldsDecl(e)};t.fulfill(BX.decl(i))}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var a=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var r=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getList"],{data:{filterId:this.getParam("FILTER_ID"),componentName:BX.type.isNotEmptyString(a)?a:"",signedParameters:BX.type.isNotEmptyString(r)?r:""}}).then(function(e){n(e.data)}.bind(this),function(e){})}else{this.getLazyLoadFields().then(n)}return t}var l={block:this.settings.classPopupFieldList,mix:this.getFieldListContainerClassName(s),content:this.prepareFieldsDecl(i)};t.fulfill(BX.decl(l));return t},getFieldLoader:function e(){if(!this.fieldLoader){this.fieldLoader=new BX.Loader({mode:"custom",size:18,offset:{left:"5px",top:"5px"}})}return this.fieldLoader},_clickOnFieldListItem:function e(t){var i=t.target;var s;if(!BX.hasClass(i,this.settings.classFieldListItem)){i=BX.findParent(i,{className:this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(i)){try{s=JSON.parse(BX.data(i,"item"))}catch(e){}var n=new BX.Promise;if(this.getParam("LAZY_LOAD")){this.getFieldLoader().show(i);var a=i.querySelector(".main-ui-select-inner-label");if(a){a.classList.add("main-ui-no-before")}var r=function(e){n.fulfill(e);this.getFieldLoader().hide();if(a){a.classList.remove("main-ui-no-before")}}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var l=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var o=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getField"],{data:{filterId:this.getParam("FILTER_ID"),id:s.NAME,componentName:BX.type.isNotEmptyString(l)?l:"",signedParameters:BX.type.isNotEmptyString(o)?o:""}}).then(function(e){r(e.data)}.bind(this),function(e){})}else{this.getLazyLoadField(s.NAME).then(r)}}else{n.fulfill(s)}n.then(function(e){this.params.FIELDS.push(e);if(BX.hasClass(i,this.settings.classMenuItemChecked)){BX.removeClass(i,this.settings.classMenuItemChecked);this.getPreset().removeField(e)}else{if(BX.type.isPlainObject(e)){this.getPreset().addField(e);BX.addClass(i,this.settings.classMenuItemChecked);if(BX.type.isString(e.HTML)){var t=BX.create("div");this.getHiddenElement().appendChild(t);BX.html(t,e.HTML)}}}this.syncFields()}.bind(this))}},getHiddenElement:function e(){if(!this.hiddenElement){this.hiddenElement=BX.create("div");document.body.appendChild(this.hiddenElement)}return this.hiddenElement},getLazyLoadField:function e(t){var i=new BX.Promise;BX.ajax({method:"get",url:BX.util.add_url_param(this.getParam("LAZY_LOAD")["GET_FIELD"],{id:t}),dataType:"json",onsuccess:function e(t){i.fulfill(t)}});return i},showFieldsPopup:function e(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function e(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function e(){var t=this.getFieldsPopup();var i=BX.pos(this.getAddField());i.forceBindPosition=true;t.adjustPosition(i)},getFieldsPopup:function e(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopupLoader=new BX.Loader({target:this.fieldsPopup.contentContainer});this.fieldsPopupLoader.show();this.fieldsPopup.contentContainer.style.width="630px";this.fieldsPopup.contentContainer.style.height="330px";this.getFieldsListPopupContent().then(function(e){this.fieldsPopup.contentContainer.removeAttribute("style");this.fieldsPopupLoader.hide();this.fieldsPopup.setContent(e);this.syncFields({cache:false})}.bind(this))}return this.fieldsPopup},_onAddPresetClick:function e(){this.enableAddPreset()},enableWaitSate:function e(t){!!t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function e(t){!!t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function e(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;var i=this.getPreset().getAddPresetFieldInput();var s=i.parentNode.querySelector(".main-ui-filter-edit-mask");var n;function a(e){if(e.animationName==="fieldError"){e.currentTarget.removeEventListener("animationend",a);e.currentTarget.removeEventListener("oAnimationEnd",a);e.currentTarget.removeEventListener("webkitAnimationEnd",a);e.currentTarget.classList.remove("main-ui-filter-error")}}function r(e){e.addEventListener("animationend",a);e.addEventListener("oAnimationEnd",a);e.addEventListener("webkitAnimationEnd",a);e.classList.add("main-ui-filter-error");var t=new BX.Promise;t.fulfill(true);return t}this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){n=i.value;if(n.length){this.savePreset();this.disableAddPreset()}else{r(s).then(function(){i.focus()})}}if(this.isEditEnabled()){var l=this.getPreset();var o=l.getPresetNodeById(l.getCurrentPresetId());var u=l.getPresetInput(o);if(u.value.length){l.updateEditablePreset(l.getCurrentPresetId());this.saveUserSettings(t);!t&&this.disableEdit()}else{var c=o.querySelector(".main-ui-filter-edit-mask");r(c).then(function(){u.focus()})}}},_onCancelButtonClick:function e(){this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function e(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function e(t){var i=t.target;if(this.getFields().isDragButton(i)){var s=BX.Filter.Utils.getByTag(i.parentNode,"input",true);(s||[]).forEach(function(e){BX.fireEvent(e,"blur")});BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function e(t){var i=this.getFields();var s=this.getPreset();var n;if(i.isFieldDelete(t.target)){n=i.getField(t.target);s.removeField(n)}if(i.isFieldValueDelete(t.target)){n=i.getField(t.target);i.clearFieldValue(n)}},getButtonsContainer:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function e(){return this.isAddPresetModeState},enableAddPreset:function e(){var t=this.getPreset();var i=t.getAddPresetField();var s=t.getAddPresetFieldInput();var n=this.getButtonsContainer();BX.show(i);BX.show(n);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function e(){var t=this.getPreset();var i=t.getAddPresetField();var s=this.getButtonsContainer();BX.hide(i);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function e(){var t=this.getFieldListContainer();var i=null;if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return i},getFilterFields:function e(){var t=this.getFieldListContainer();var i=[];var s=[];if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(i)){i=[]}if(BX.type.isArray(s)){s.forEach(function(e){i.push(e)})}}return i},getFilterFieldsValues:function e(){var t=this.getPreset().getFields();var i=this.getSearch();var s={};var n,a;s["FIND"]=i.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach(function(e){n=BX.data(e,"type");a=BX.data(e,"name");switch(n){case this.types.STRING:{this.prepareControlStringValue(s,e);break}case this.types.TEXTAREA:{this.prepareControlTextareaValue(s,e);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,a,e);break}case this.types.DATE:{this.prepareControlDateValue(s,a,e);break}case this.types.CUSTOM_DATE:{this.prepareControlCustomDateValue(s,a,e);break}case this.types.SELECT:{this.prepareControlSelectValue(s,a,e);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,a,e);break}case this.types.DEST_SELECTOR:case this.types.CUSTOM_ENTITY:case this.types.ENTITY_SELECTOR:{this.prepareControlCustomEntityValue(s,a,e);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,a,e);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function e(t,i,s){var n=this.fetchSquares(s);var a=this.fetchSquaresData(n);var r=BX.Main.ui.CustomEntity.isMultiple(s);t[i]="";t[i+"_label"]="";if(r){t[i]=[];t[i+"_label"]=[];!!a&&a.forEach(function(e){t[i].push(e._value.toString());t[i+"_label"].push(e._label.toString())})}else{if(a.length){t[i]=a[0]._value.toString();t[i+"_label"]=a[0]._label.toString()}}},fetchSquares:function e(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function e(t){return t.map(function(e){return JSON.parse(BX.data(e,"item"))},this)},prepareControlCustomValue:function e(t,i,s){var n=BX.Filter.Utils.getByTag(s,"input",true);t[i]="";if(BX.type.isArray(n)){n.forEach(function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}})}},prepareControlMultiselectValue:function e(t,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var a=JSON.parse(BX.data(n,"value"));t[i]="";if(BX.type.isArray(a)&&a.length){t[i]={};a.forEach(function(e,s){t[i][s]=e.VALUE})}},prepareControlSelectValue:function e(t,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=JSON.parse(BX.data(n,"value"));t[i]=a.VALUE},prepareControlCustomDateValue:function e(t,i,s){var n=s.querySelector('[data-name="'+i+"_days"+'"]');if(n){var a=JSON.parse(n.dataset.value);t[i+"_days"]=a.map(function(e){return e.VALUE})}var r=s.querySelector('[data-name="'+i+"_months"+'"]');if(r){var l=JSON.parse(r.dataset.value);t[i+"_months"]=l.map(function(e){return e.VALUE})}var o=s.querySelector('[data-name="'+i+"_years"+'"]');if(o){var u=JSON.parse(o.dataset.value);t[i+"_years"]=u.map(function(e){return e.VALUE})}},prepareControlDateValue:function e(t,i,s,n){var a=s.querySelector(".main-ui-filter-additional-fields-container");if(a&&!n){BX.remove(a)}var r=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var l=s.querySelector('.main-ui-select[data-name*="_allow_year"]');var o=i+this.settings.datePostfix;var u=i+this.settings.fromPostfix;var c=i+this.settings.toPostfix;var h=i+this.settings.daysPostfix;var d=i+this.settings.monthPostfix;var p=i+this.settings.quarterPostfix;var f=i+this.settings.yearPostfix;var m=i+"_allow_year";var E,g,y,B,v;t[o]="";t[u]="";t[c]="";t[h]="";t[d]="";t[p]="";t[f]="";var A=s.querySelector(".main-ui-date-input");if(A&&A.dataset.isValid==="false"){return}E=JSON.parse(BX.data(r,"value"));t[o]=E.VALUE;if(l){v=JSON.parse(BX.data(l,"value"));t[m]=v.VALUE}switch(E.VALUE){case this.dateTypes.EXACT:{g=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[u]=g.value;t[c]=g.value;break}case this.dateTypes.QUARTER:{y=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_quarter")!==-1){t[p]=JSON.parse(BX.data(e,"value")).VALUE}if(B&&B.endsWith("_year")&&!B.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{y=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach(function(e){B=BX.data(e,"name");if(B&&B.endsWith("_year")&&!B.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{y=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach(function(e){B=BX.data(e,"name");if(B&&B.indexOf("_month")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}if(B&&B.endsWith("_year")&&!B.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.additionalDateTypes.PREV_DAY:case this.additionalDateTypes.NEXT_DAY:case this.additionalDateTypes.MORE_THAN_DAYS_AGO:case this.additionalDateTypes.AFTER_DAYS:case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var P=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!P&&P.name===h){t[h]=P.value}break}case this.dateTypes.RANGE:{g=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);g.forEach(function(e){if(e.name===u){t[u]=e.value}else if(e.name===c){t[c]=e.value}},this);break}case"CUSTOM_DATE":{var S={};this.prepareControlCustomDateValue(S,i,s);t[i+"_days"]=S[i+"_days"];t[d]=S[i+"_months"];t[f]=S[i+"_years"];break}default:{break}}if(a&&!n){BX.append(a,s)}var _=Array.from(s.querySelectorAll('.main-ui-filter-additional-fields-container > [data-type="DATE"]'));if(_){_.forEach(function(e){var i=e.dataset.name;this.prepareControlDateValue(t,i,e,true)},this)}},prepareControlNumberValue:function e(t,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var a=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=i+this.settings.numberPostfix;var l=i+this.settings.fromPostfix;var o=i+this.settings.toPostfix;var u;t[l]="";t[o]="";u=JSON.parse(BX.data(a,"value"));t[r]=u.VALUE;n.forEach(function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[l]=e.value||"";if(t[r]==="exact"){t[o]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[o]=e.value||""}},this)},prepareControlStringValue:function e(t,i){var s=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var n;if(BX.type.isDomNode(s)){n=s.name;t[n]=s.value}},prepareControlTextareaValue:function e(t,i){var s=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var n;if(BX.type.isDomNode(s)){n=s.name;t[n]=s.value}},showGridAnimation:function e(){this.grid&&this.grid.tableFade()},hideGridAnimation:function e(){this.grid&&this.grid.tableUnfade()},getPresetId:function e(t,i){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!i||s==="default_filter"&&!t){s="tmp_filter"}return s},isAppliedUserFilter:function e(){var t=this;var i=this.getPreset().getCurrentPresetData();if(BX.Type.isPlainObject(i)){var s=BX.Type.isArrayFilled(i.FIELDS)&&i.FIELDS.some(function(e){return!t.getPreset().isEmptyField(e)});var n=BX.Type.isArrayFilled(i.ADDITIONAL)&&i.ADDITIONAL.some(function(e){return!t.getPreset().isEmptyField(e)});return!i.IS_PINNED&&(s||n)||i.IS_PINNED&&BX.Type.isArrayFilled(i.ADDITIONAL)||BX.Type.isStringFilled(this.getSearch().getSearchString())}return false},applyFilter:function e(t,i){var s=this.getPresetId(t,i);var n=this.getParam("FILTER_ID");var a=new BX.Promise(null,this);var r=this.getPreset();var l=this.getSearch();var o={autoResolve:!this.grid};var u=this;if(this.isAppliedUserFilter()){BX.Dom.addClass(this.getSearch().container,"main-ui-filter-search--active")}else{BX.Dom.removeClass(this.getSearch().container,"main-ui-filter-search--active")}this.clearGet();this.showGridAnimation();var c=t?"clear":"apply";BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[n,{action:c},this,a]);this.updatePreset(s,null,t,null).then(function(){l.updatePreset(r.getPreset(s));if(u.getParam("VALUE_REQUIRED")){if(!l.getSquares().length){u.lastPromise=r.applyPinnedPreset()}}}).then(function(){var e={apply_filter:"Y",clear_nav:"Y"};var t=BX.delegate(a.fulfill,a);var i=BX.delegate(a.reject,a);u.grid&&u.grid.reloadTable("POST",e,t,i);BX.onCustomEvent(window,"BX.Main.Filter:apply",[n,{action:c},u,a,o]);o.autoResolve&&a.fulfill()});return a},getAddField:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function e(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function e(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function e(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.CUSTOM_DATE:{t.VALUES={days:[],months:[],years:[]};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.DEST_SELECTOR:case this.types.ENTITY_SELECTOR:case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function e(t){var i=this.getPreset().getField({NAME:t});var s,n;if(BX.type.isDomNode(i)){s=this.getFieldByName(t);s=this.resetControlData(s);n=this.getPreset().createControl(s);BX.insertAfter(n,i);BX.remove(i)}},clearControls:function e(t){if(BX.type.isArray(t)){t.forEach(function(e){"name"in e&&this.clearControl(e.name)},this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function e(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function e(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function e(){var t=this.getPopup();var i=t.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var n;BX.Dom.removeClass(this.getSearch().container,"main-ui-filter-search--showed");setTimeout(BX.delegate(function(){if(!this.isIe()){BX.removeClass(i,this.settings.classAnimationShow);BX.addClass(i,this.settings.classAnimationClose);n=parseFloat(BX.style(i,"animation-duration"));if(BX.type.isNumber(n)){n=n*1e3}setTimeout(function(){t.close()},n)}else{t.close()}},this),s);if(this.getParam("LIMITS_ENABLED")){BX.removeClass(this.getFilter(),this.settings.classLimitsAnimation)}this.closeFieldListPopup();this.adjustFocus()},showPopup:function e(){var t=this.getPopup();var i;if(!t.isShown()){BX.Dom.addClass(this.getSearch().container,"main-ui-filter-search--showed");this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");if(this.getParam("LIMITS_ENABLED")===true){this.limitAnalyticsSend()}setTimeout(BX.delegate(function(){t.show();if(!this.isIe()){i=t.popupContainer;BX.removeClass(i,this.settings.classAnimationClose);BX.addClass(i,this.settings.classAnimationShow);BX.onCustomEvent(window,"BX.Main.Filter:show",[this])}var e=[].slice.call(this.getFieldListContainer().querySelectorAll("textarea"));e.forEach(function(e){BX.style(e,"height",e.scrollHeight+"px")})},this),s)}},getSaveForAllCheckbox:function e(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function e(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function e(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function e(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function e(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var i=null;if(BX.type.isNotEmptyString(t)){i=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!i?i:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function e(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function e(){this.restoreDefaultFields()},restoreDefaultFields:function e(){var t=this.getPreset().getPreset("default_filter",true);var i=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var n={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var a=t.FIELDS.map(function(e){return e.NAME});var r=a.join(",");i.forEach(function(e,s){if(e.ID==="default_filter"){i[s]=BX.clone(t)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(e,i){if(e.ID==="default_filter"){this.editablePresets[i]=BX.clone(t)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:r,save:"Y",apply_filter:"N"},n)},getRestoreFieldsButton:function e(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function e(){var t=this.getParam("DEFAULT_PRESETS");var i=this.getParam("PRESETS");var s=false;var n,a,r;if(BX.type.isArray(t)){t.sort(function(e,t){return e.SORT<t.SORT});t.forEach(function(e){s=i.some(function(t,i){if(t.ID===e.ID){n=i;return true}});if(s){i[n]=BX.clone(e)}else{i.push(BX.clone(e))}if(e.ID!=="default_filter"){this.addSidebarItem(e.ID,e.TITLE,e.IS_PINNED);if(e.IS_PINNED){a=e.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!a){a="default_filter"}r=this.getPreset().getPresetNodeById(a);if(r){BX.fireEvent(r,"click")}},saveRestoreFilter:function e(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var i=this.getParam("PRESETS");var s={};var n;if(BX.type.isArray(i)){i.forEach(function(e){n=e.FIELDS.map(function(e){return e.NAME});n=n.join(",");s[e.ID]={name:e.TITLE||null,sort:e.SORT,preset_id:e.ID,fields:this.prepareFields(e.FIELDS),rows:n,for_all:e.FOR_ALL}},this);this.saveOptions(s,t)}},prepareFields:function e(t){var i={};var s;if(BX.type.isArray(t)){t.forEach(function(e){if(e.TYPE===this.types.SELECT){i[e.NAME]="VALUE"in e.VALUE?e.VALUE.VALUE:""}if(e.TYPE===this.types.MULTI_SELECT){e.VALUE.forEach(function(t,s){i[e.NAME]=i[e.NAME]||{};i[e.NAME][s]=t.VALUE});i[e.NAME]=i[e.NAME]||""}if(e.TYPE===this.types.DATE||e.TYPE===this.types.NUMBER){s=Object.keys(e.VALUES);s.forEach(function(t){i[e.NAME+t]=e.VALUES[t]});if(e.TYPE===this.types.DATE){i[e.NAME+"_datesel"]="VALUE"in e.SUB_TYPE?e.SUB_TYPE.VALUE:e.SUB_TYPES[0].VALUE}if(e.TYPE===this.types.NUMBER){i[e.NAME+"_numsel"]="VALUE"in e.SUB_TYPE?e.SUB_TYPE.VALUE:e.SUB_TYPES[0].VALUE}}if(e.TYPE===this.types.DEST_SELECTOR||e.TYPE===this.types.ENTITY_SELECTOR||e.TYPE===this.types.CUSTOM_ENTITY){i[e.NAME+"_label"]=e.VALUES._label;i[e.NAME+"_value"]=e.VALUES._value}},this)}return i},getRestoreButton:function e(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getFindButton(),"click")}},_onFindButtonClick:function e(){var t=this.getPreset();var i=t.getCurrentPresetId();var s;if(i!=="tmp_filter"&&i!=="default_filter"&&!t.isPresetValuesModified(i)){var n=t.getPreset(i);var a=t.getAdditionalValues(i);var r=t.getFields().map(function(e){return BX.data(e,"name")});n.ADDITIONAL=this.preparePresetFields(a,r);n.ADDITIONAL=n.ADDITIONAL.filter(function(e){return!this.getPreset().isEmptyField(e)},this);s=this.applyFilter(false,i);this.closePopup()}else{t.deactivateAllPresets();s=this.applyFilter();this.closePopup()}return s},_onResetButtonClick:function e(){if(this.getParam("VALUE_REQUIRED")){var t=this.getPreset().getCurrentPresetData();if(t.ADDITIONAL.length){this.closePopup()}BX.fireEvent(this.getSearch().getClearButton(),"click")}else{if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()}},resetFilter:function e(t){var i=this.getSearch();var s=this.getPreset();if(!t){i.clearInput()}i.removePreset();s.deactivateAllPresets();s.resetPreset(true);i.hideClearButton();i.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function e(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function e(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function e(t){var i=this.getDragButton(t);if(i){i.onbxdragstart=BX.delegate(this._onFieldDragStart,this);i.onbxdragstop=BX.delegate(this._onFieldDragStop,this);i.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(i);jsDD.registerDest(i)}return t},unregisterDragItem:function e(t){var i=this.getDragButton(t);if(i){jsDD.unregisterObject(i);jsDD.unregisterDest(i)}},_onFieldDragStart:function e(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function e(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function e(){var t=this;var i,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(e,n){if(e){i=e.getBoundingClientRect();s=i.top+BX.scrollTop(window)+i.height/2;if(n>t.dragIndex&&t.sortOffset>s&&e.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if(n<t.dragIndex&&t.sortOffset<s&&e.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if((n<t.dragIndex&&t.sortOffset>s||n>t.dragIndex&&t.sortOffset<s)&&e.style.transform!=="translate3d(0px, 0px, 0px)"){if(e.style.transform!==""){t.targetItem=e}BX.style(e,"transform","translate3d(0px, 0px, 0px)");BX.style(e,"transition","300ms")}}})},disableFieldsDragAndDrop:function e(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function e(){var t,i,s,n;t=this.getPreset();i=t.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach(function(e){n=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&n!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function e(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function e(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)){jsDD.unregisterObject(e);jsDD.unregisterDest(e)}},this)}},_onDragStart:function e(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function e(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function e(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function e(){var t,i;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();i=t.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach(function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)&&!BX.hasClass(e,this.settings.classDefaultFilter)){this.presetsList.push(e)}},this)}},_onDrag:function e(){var t=this;var i,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(e,n){if(e){i=e.getBoundingClientRect();s=i.top+BX.scrollTop(window)+i.height/2;if(n>t.dragIndex&&t.sortOffset>s&&e.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if(n<t.dragIndex&&t.sortOffset<s&&e.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if((n<t.dragIndex&&t.sortOffset>s||n>t.dragIndex&&t.sortOffset<s)&&e.style.transform!=="translate3d(0px, 0px, 0px)"){if(e.style.transform!==""){t.targetItem=e}BX.style(e,"transform","translate3d(0px, 0px, 0px)");BX.style(e,"transition","300ms")}}})},getSidebarControlsContainer:function e(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function e(){var t=this.getPreset();var i=t.getPresets();var s;if(BX.type.isArray(i)&&i.length){i.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function e(){var t=this.getPreset();var i=t.getPresets();if(BX.type.isArray(i)&&i.length){i.forEach(function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)){BX.removeClass(e,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(e)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function e(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function e(){return this.isEditEnabledState},getEditButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function e(t,i){return t in this.params?this.params[t]:i},getFilter:function e(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function e(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function e(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function e(t,i,s){if("CONFIRM"in t&&t.CONFIRM){var n=this.getParam("FILTER_ID")+"-confirm-dialog";var a='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var r="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var l=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function e(){BX.type.isFunction(i)?i():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function e(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var u=new BX.PopupWindow(n,null,{content:a,titleBar:r,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[l,o]});BX.addCustomEvent(u,"onPopupClose",BX.delegate(function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},this));if(!u.isShown()){u.show();var c=u.popupContainer;BX.removeClass(c,this.settings.classAnimationShow);BX.addClass(c,this.settings.classAnimationShow)}}else{BX.type.isFunction(i)?i():null}},getInitialValue:function e(t){if(BX.type.isString(t)){var i=this.params.INITIAL_FILTER;if(BX.type.isPlainObject(i)){var s=Object.entries(i).reduce(function(e,i){if(i[0].startsWith(t)){e.push(i)}return e},[]);if(s.length===1){return s[0][1]}if(s.length>1){return s.reduce(function(e,i){e[i[0].replace(t,"")]=i[1];return e},{})}}}return""},getField:function e(t){var i=this.getFieldListContainer().querySelector('[data-name="'+t+'"]');return BX.Filter.Field.instances.get(i)}}})();(function(){BX.Main.filterManager={data:{},push:function e(t,i){if(BX.type.isNotEmptyString(t)&&i){this.data[t]=i}},getById:function e(t){var i=null;if(t in this.data){i=this.data[t]}return i}}})();function r(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-filter-additional-fields-container"></div>\n\t\t\t']);r=function t(){return e};return e}var l=Symbol("onValueChange");var o=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Filter.Field");i.id=e.options.NAME;i.parent=e.parent;i.node=e.node;i.options=babelHelpers.objectSpread({},e.options);i.cache=new s.Cache.MemoryCache;i[l]=i[l].bind(babelHelpers.assertThisInitialized(i));s.Event.bind(i.node,"input",i[l]);s.Event.bind(i.node,"change",i[l]);var n=babelHelpers.toConsumableArray(i.node.querySelectorAll(".main-ui-control-value-delete"));n.forEach(function(e){e.addEventListener("click",function(){setTimeout(function(){i[l]()})})});var a=new MutationObserver(function(){i[l]()});var r=babelHelpers.toConsumableArray(i.node.querySelectorAll(".main-ui-select"));r.forEach(function(e){a.observe(e,{attributes:true,attributeFilter:["data-value"]})});t.instances.set(i.node,babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"subscribe",value:function e(t,i){s.Event.EventEmitter.subscribe(this,t.replace("BX.Filter.Field:",""),i)}},{key:l,value:function e(){this.emit("change",{field:this,value:this.getValue()})}},{key:"getAdditionalFieldContainer",value:function e(){return this.cache.remember("additionalFieldsContainer",function(){return s.Tag.render(r())})}},{key:"hasAdditional",value:function e(){return s.Dom.hasClass(this.node,"main-ui-filter-field-with-additional-fields")}},{key:"addAdditionalField",value:function e(i){if(!this.hasAdditional()){s.Dom.addClass(this.node,"main-ui-filter-field-with-additional-fields");s.Dom.append(this.getAdditionalFieldContainer(),this.node)}var n=this.parent.getPreset();var a=this.prepareFieldOptions(i);var r=n.createControl(a);this.appendRenderedField(r);return t.instances.get(r)}},{key:"prepareListItems",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(s.Type.isPlainObject(t)){return Object.entries(t).map(function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],s=t[1];return{NAME:s,VALUE:i}})}return{}}},{key:"prepareFieldOptions",value:function e(t){var i=this;if(s.Type.isPlainObject(t)){var n=this.parent.params.FIELDS_STUBS;var a=t.type,r=a===void 0?"string":a;var l=n.find(function(e){return e.NAME===r});if(s.Type.isPlainObject(l)){var o=babelHelpers.objectSpread({},l,{NAME:t.id,LABEL:t.name,TYPE:r==="checkbox"?"SELECT":l.TYPE,VALUE_REQUIRED:t.valueRequired===true});if(r==="list"){return babelHelpers.objectSpread({},o,{ITEMS:[].concat(babelHelpers.toConsumableArray(o.ITEMS),[this.prepareListItems(t.items)]),params:{isMulti:function(){if(s.Type.isPlainObject(t.params)){return t.params===true}return false}()}})}if(r==="date"){var u=function(){if(s.Type.isPlainObject(t.value)&&Reflect.has(t.value,"_datesel")){return t.value._datesel}return i.parent.dateTypes.NONE}();return babelHelpers.objectSpread({},o,{SUB_TYPES:function(){if(s.Type.isArray(t.exclude)){return o.SUB_TYPES.filter(function(e){return!t.exclude.includes(e.VALUE)})}return o.SUB_TYPES}(),SUB_TYPE:function(){return o.SUB_TYPES.find(function(e){return e.VALUE===u})}(),VALUES:function(){if(s.Type.isPlainObject(t.value)){return babelHelpers.objectSpread({},t.value)}return o.VALUES}()})}if(r==="string"||r==="custom_date"||r==="number"||r==="checkbox"||r==="custom_entity"){return o}}}return t}},{key:"appendRenderedField",value:function e(t){if(s.Type.isDomNode(t)){var i=this.getAdditionalFieldContainer();s.Dom.append(t,i)}}},{key:"getValue",value:function e(){var t=this.parent.getFilterFieldsValues();var i=this.options,s=i.TYPE,n=i.NAME;if(s==="DATE"||s==="NUMBER"){return Object.entries(t).reduce(function(e,t){var i=babelHelpers.slicedToArray(t,2),s=i[0],a=i[1];if(s.startsWith(n)){e[s.replace(n,"")]=a}return e},{})}if(n in t){return t[n]}return""}},{key:"setValue",value:function e(t){var i=this;var n=this.options.TYPE;if(n==="DATE"||n==="NUMBER"){if(s.Type.isPlainObject(t)){var a=this.parent.getFieldListContainer();Object.entries(t).forEach(function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],r=t[1];var l=a.querySelector('[data-name="'.concat(i.id,'"] [data-name="').concat(i.id).concat(n,'"], [data-name="').concat(i.id,'"] [name="').concat(i.id).concat(n,'"]'));if(l){if(s.Dom.hasClass(l,"main-ui-select")){var o=s.Dom.attr(l,"data-items");if(s.Type.isArray(o)){var u=o.find(function(e){return e.VALUE===r});if(s.Type.isPlainObject(u)){s.Dom.attr(l,"data-value",u);var c=l.querySelector(".main-ui-select-name");if(c){c.innerText=u.NAME}var h=BX.Main.ui.Factory.get(l);if(!h){h={node:l,instance:new BX.Main.ui.select(l)};BX.Main.ui.Factory.data.push(h)}if(s.Type.isPlainObject(h)){BX.onCustomEvent(window,"UI::Select::Change",[h.instance,u])}}}}else if(l.tagName==="INPUT"){l.value=r}}})}}}}]);return t}(s.Event.EventEmitter);babelHelpers.defineProperty(o,"instances",new WeakMap);var u=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=t}babelHelpers.createClass(e,[{key:"setFields",value:function e(t){if(s.Type.isPlainObject(t)){this.parent.getPopup();var i=this.parent.getPreset();i.deactivateAllPresets();var n={preset_id:"tmp_filter",fields:t};this.parent.updateParams(n);i.applyPreset("tmp_filter")}}},{key:"setFilter",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.setAnalyticsLabel(i);if(s.Type.isObject(t)){this.parent.updateParams(t);this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().activatePreset(t.preset_id);this.parent.getPreset().applyPreset(t.preset_id);if(!t.checkFields||!this.parent.getPreset().isPresetValuesModified(t.preset_id)){this.parent.applyFilter(false,t.preset_id)}else{var n={};if(s.Type.isPlainObject(t.fields)){n=Object.assign({},t.fields)}if(s.Type.isPlainObject(t.additional)){n=Object.assign({},t.additional)}this.parent.getPreset().deactivateAllPresets();this.setFields(n);this.apply()}}}},{key:"extendFilter",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.setAnalyticsLabel(n);if(s.Type.isObject(t)){Object.keys(t).forEach(function(e){if(s.Type.isNumber(t[e])){t[e]=String(t[e])}});var a=this.parent.getPreset().getCurrentPresetId();if(i||a==="tmp_filter"||a==="default_filter"){var r=Object.assign({},this.parent.getFilterFieldsValues(),t);this.setFields(r);this.apply();return}var l=this.parent.getPreset().getAdditionalValues(a);if(s.Type.isPlainObject(l)&&Object.keys(l).length){t=Object.assign({},l,t)}this.setFilter({preset_id:a,additional:t,checkFields:true})}}},{key:"apply",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.setAnalyticsLabel(t);if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){this.parent.applyFilter()}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}},{key:"getEmitter",value:function e(){return this.parent.emitter}},{key:"setAnalyticsLabel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(s.Type.isObject(t)){this.parent.analyticsLabel=t}}}]);return e}();function c(e){return{block:"main-ui-control-field",type:e.type,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:e.placeholder,name:e.name,tabindex:e.tabindex,value:e.value,enableTime:e.enableTime}}}function h(e){return{block:"main-ui-control-field",type:e.type,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],valueDelete:true,placeholder:e.placeholder,name:e.name,tabindex:e.tabindex,value:e.value}}}function d(){return{block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}}}function p(e){return{block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:e.tabindex,value:e.value,items:e.items,name:e.name,valueDelete:false}}}function f(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="main-ui-filter-error-message" \n\t\t\t\ttitle="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);f=function t(){return e};return e}var m=new WeakMap;var E=new WeakMap;var g=new WeakMap;var y=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",this._onDateTypeChange.bind(this))}},{key:"deleteField",value:function e(t){s.Dom.remove(t)}},{key:"isFieldDelete",value:function e(t){return s.Dom.hasClass(t,this.parent.settings.classFieldDelete)}},{key:"isFieldValueDelete",value:function e(t){return s.Dom.hasClass(t,this.parent.settings.classValueDelete)||s.Dom.hasClass(t.parentNode,this.parent.settings.classValueDelete)}},{key:"isDragButton",value:function e(t){return t&&s.Dom.hasClass(t,this.parent.settings.classPresetDragButton)}},{key:"clearFieldValue",value:function e(t){if(t){var i=babelHelpers.toConsumableArray(t.querySelectorAll(".main-ui-control"));var n=babelHelpers.toConsumableArray(t.querySelectorAll(".main-ui-square"));n.forEach(function(e){return s.Dom.remove(e)});i.forEach(function(e){if(Reflect.has(e,"value")){e.value=""}})}}},{key:"getField",value:function e(t){if(s.Type.isDomNode(t)){return t.closest(".main-ui-control-field, .main-ui-control-field-group")}return null}},{key:"render",value:function e(t,i){if(s.Type.isString(t)&&s.Type.isPlainObject(i)){var n=Object.entries(i).reduce(function(e,t){var i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];return e.replace(new RegExp("{{".concat(s,"}}"),"g"),n)},t);var a=s.Dom.create("div",{html:n});var r=a.querySelector(".main-ui-control-field-group");if(r){return r}var l=a.querySelector(".main-ui-control-field");if(l){return l}var o=a.querySelector(".main-ui-filter-field-line");if(o){return o}}return null}},{key:"createInputText",value:function e(t){var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:s.Type.isString(t.VALUE)||s.Type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]};var n=BX.decl(i);this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:n})});return n}},{key:"createTextarea",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-textarea",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:s.Type.isString(t.VALUE)||s.Type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]});var n=i.querySelector("textarea");var a=function e(){s.Dom.style(n,"height","1px");s.Dom.style(n,"height","".concat(n.scrollHeight,"px"))};s.Event.bind(n,"input",a);s.Event.bind(n,"change",a);s.Event.bind(n,"keyup",a);s.Event.bind(n,"cut",a);s.Event.bind(n,"paste",a);this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"createCustomEntityFieldLayout",value:function e(t){var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var n=t.VALUES._label?t.VALUES._label:[];if(s.Type.isPlainObject(n)){n=Object.keys(n).map(function(e){return n[e]})}if(!s.Type.isArray(n)){n=[n]}var a=t.VALUES._value?t.VALUES._value:[];if(s.Type.isPlainObject(a)){a=Object.keys(a).map(function(e){return a[e]})}if(!s.Type.isArray(a)){a=[a]}n.forEach(function(e,t){i.content.content.push({block:"main-ui-square",tag:"span",name:e,item:{_label:e,_value:a[t]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES._label:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:"".concat(t.NAME,"_label"),tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES._value:"",tabindex:t.TABINDEX});i=BX.decl(i);var r=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(r,"main-ui-square-search-item");r.autocomplete="off";s.Event.bind(r,"focus",BX.proxy(this._onCustomEntityInputFocus,this));s.Event.bind(r,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){s.Event.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}s.Event.bind(r,"keydown",BX.proxy(this._onCustomEntityKeydown,this));s.Event.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i}},{key:"createDestSelector",value:function e(t){var i=this.createCustomEntityFieldLayout(t);BX.ready(BX.proxy(function(){BX.Filter.DestinationSelector.create(t.NAME,{filterId:this.parent.getParam("FILTER_ID"),fieldId:t.NAME})},this));this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"createEntitySelector",value:function e(t){var i=this.createCustomEntityFieldLayout(t);BX.Filter.EntitySelector.create(t.NAME,{filter:this.parent,isMultiple:t.MULTIPLE,addEntityIdToResult:t.ADD_ENTITY_ID_TO_RESULT,dialogOptions:t.DIALOG_OPTIONS});this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"createCustomEntity",value:function e(t){var i=this.createCustomEntityFieldLayout(t);this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"_onCustomEntityInputFocus",value:function e(t){BX.fireEvent(t.currentTarget,"click")}},{key:"_onCustomEntityInputClick",value:function e(t){t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}var i=new Date(this.trustTimestamp);var s=new Date(this.notTrustTimestamp);var n="".concat(i.getMinutes(),":").concat(i.getSeconds());var a="".concat(s.getMinutes(),":").concat(s.getSeconds());if(n!==a){this._onCustomEntityFocus(t)}}},{key:"_onDocumentFocus",value:function e(t){var i=this.getCustomEntityInstance();var s=i.getPopupContainer();var n=i.getLabelNode()===t.target;var a=!!s&&s.contains(t.target);if(!n&&!a){this._onCustomEntityBlur(t)}}},{key:"_onCustomEntityKeydown",value:function e(t){var i=t.target,n=t.currentTarget;var a=i.parentNode.parentNode;var r=a.querySelectorAll(".main-ui-square");var l=r[r.length-1];if(!s.Type.isDomNode(l)){return}if(BX.Filter.Utils.isKey(t,"backspace")&&n.selectionStart===0){if(s.Dom.hasClass(l,"main-ui-square-selected")){var o=a.querySelector('input[type="hidden"]');if(s.Type.isDomNode(o)){o.value="";BX.fireEvent(o,"input")}s.Dom.remove(l);return}s.Dom.addClass(l,"main-ui-square-selected");return}s.Dom.removeClass(l,"main-ui-square-selected")}},{key:"_onCustomEntityFieldClick",value:function e(t){var i=t.target;if(s.Dom.hasClass(i,"main-ui-square-delete")){var n=i.closest(".main-ui-square");if(s.Type.isDomNode(n)){var a=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[a]);s.Dom.remove(n)}return}var r=i.querySelector('input[type="text"]');if(s.Type.isDomNode(r)){BX.fireEvent(r,"focus")}}},{key:"_onCustomEntityBlur",value:function e(t){var i={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,i]);if(typeof i.stopBlur==="undefined"||!i.stopBlur){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);s.Event.unbind(n.getPopupContainer(),"click",this._stopPropagation);s.Dom.removeClass(n.getField(),"main-ui-focus")}}},{key:"_stopPropagation",value:function e(t){t.stopPropagation()}},{key:"getCustomEntityInstance",value:function e(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance}},{key:"_onCustomEntityFocus",value:function e(t){t.stopPropagation();var i=t.currentTarget;var n=i.closest(".main-ui-control-entity");var a=this.getCustomEntityInstance();a.setField(n);BX.onCustomEvent("BX.Main.Filter:customEntityFocus",[a]);var r=a.getPopupContainer();if(s.Type.isElementNode(r)){s.Event.bind(r,"click",this._stopPropagation)}s.Dom.addClass(n,"main-ui-focus")}},{key:"createCustom",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:["main-ui-control","main-ui-custom-style"],attrs:{"data-name":t.NAME},content:""}});if(s.Type.isString(t.VALUE)){var n=function(){if(Reflect.has(t,"_VALUE")){return t._VALUE}return""}();var a=s.Text.decode(t.VALUE).replace('name="'.concat(t.NAME,'"'),'name="'.concat(t.NAME,'" value="').concat(n,'"'));var r=i.querySelector(".main-ui-custom");s.Runtime.html(r,a)}this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"createSelect",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}});this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"createMultiSelect",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}});this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:i})});return i}},{key:"createCustomDate",value:function e(t){var i={block:"main-ui-control-field-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(s.Type.isPlainObject(t.VALUE.days)){t.VALUE.days=Object.keys(t.VALUE.days).map(function(e){return t.VALUE.days[e]})}var n=t.DAYS.filter(function(e){return t.VALUE.days.some(function(t){return t===e.VALUE})});var a={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],placeholder:t.DAYS_PLACEHOLDER,dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_days"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.DAYS,value:n,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.DAYS_PLACEHOLDER}}};if(s.Type.isPlainObject(t.VALUE.months)){t.VALUE.months=Object.keys(t.VALUE.months).map(function(e){return t.VALUE.months[e]})}var r=t.MONTHS.filter(function(e){return t.VALUE.months.some(function(t){return t===e.VALUE})});var l={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_months"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.MONTHS,value:r,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.MONTHS_PLACEHOLDER}}};if(s.Type.isPlainObject(t.VALUE.years)){t.VALUE.years=Object.keys(t.VALUE.years).map(function(e){return t.VALUE.years[e]})}var u=t.YEARS.filter(function(e){return t.VALUE.years.some(function(t){return t===e.VALUE})});var c={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_years"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.YEARS,value:u,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.YEARS_PLACEHOLDER}}};i.content.push(a);i.content.push(l);i.content.push(c);var h=BX.decl(i);this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:h})});return h}},{key:"_onDateTypeChange",value:function e(t,i){var n=this;if(this.parent.getPopup().contentContainer.contains(t.node)){var a={};var r=null;var l;var o;var u;if(s.Type.isPlainObject(i)&&Reflect.has(i,"VALUE")){var c=t.getNode();var h=t.getParams();var d=c.dataset.name;if(!s.Type.isPlainObject(h)&&(d.endsWith("_datesel")||d.endsWith("_numsel"))){var p=c.parentNode.parentNode;a.TABINDEX=t.getInput().getAttribute("tabindex");a.SUB_TYPES=t.getItems();a.SUB_TYPE=i;a.NAME=p.dataset.name;a.TYPE=p.dataset.type;a.VALUE_REQUIRED=p.dataset.valueRequired==="true";var f=this.parent.getPreset().getCurrentPresetData();if(s.Type.isArray(f.FIELDS)){var m=f.FIELDS.find(function(e){return e.NAME===a.NAME});if(s.Type.isNil(m)){m=this.parent.params.FIELDS_STUBS.find(function(e){return e.TYPE===a.TYPE})}if(!s.Type.isNil(m)){if(d.endsWith("_datesel")){a.MONTHS=m.MONTHS;a.MONTH=m.MONTH;a.YEARS=m.YEARS;a.YEAR=m.YEAR;a.QUARTERS=m.QUARTERS;a.QUARTER=m.QUARTER;a.ENABLE_TIME=m.ENABLE_TIME;a.YEARS_SWITCHER=m.YEARS_SWITCHER}a.VALUES=m.VALUES;a.REQUIRED=m.REQUIRED}}if(this.parent.getParam("ENABLE_LABEL")){l=p.querySelector(".main-ui-control-field-label");a.LABEL=l.innerText}if(d.endsWith("_datesel")){r=this.createDate(a)}else{r=this.createNumber(a)}if(s.Type.isArray(this.parent.fieldsList)){u=this.parent.fieldsList.indexOf(p);if(u!==-1){this.parent.fieldsList[u]=r;this.parent.registerDragItem(r)}}this.parent.unregisterDragItem(p);o=babelHelpers.toConsumableArray(r.querySelectorAll(".main-ui-control-field"));if(s.Type.isArray(o)&&o.length){o.forEach(function(e){e.FieldController=new BX.Filter.FieldController(e,n.parent)})}s.Dom.insertAfter(r,p);s.Dom.remove(p)}}}}},{key:"createNumber",value:function e(t){var i=this.parent.numberTypes;var s=this.parent.params.ENABLE_LABEL;var n=t.SUB_TYPE,a=n===void 0?{}:n,r=t.SUB_TYPES,l=r===void 0?[]:r,u=t.TABINDEX,c=u===void 0?"":u,h=t.VALUES,d=h===void 0?{_from:"",_to:""}:h,p=t.LABEL,f=p===void 0?"":p,m=t.TYPE;var E=a.VALUE||i.SINGLE;var g=a.PLACEHOLDER||"";var y=t.NAME.replace("_numsel","");var B=function(){if(s){return["main-ui-filter-wield-with-label","main-ui-filter-number-group"]}return["main-ui-filter-number-group"]}();var v={block:"number-group",type:m,mix:B,label:s?f:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:c,value:a,items:l,name:y,deleteButton:true,content:[]};if(E!==i.LESS){var A={block:"main-ui-control-field",type:m,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:g,name:"".concat(y,"_from"),tabindex:c,value:d._from||""}};v.content.push(A)}if(E===i.RANGE){var P={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};v.content.push(P)}if(E===i.RANGE||E===i.LESS){var S={block:"main-ui-control-field",type:m,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"".concat(y,"_to"),tabindex:c,value:d._to||""}};v.content.push(S)}var _=BX.decl(v);this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t),node:_})});return _}},{key:"createDate",value:function e(t){var i=this;var n=this.parent,a=n.dateTypes,r=n.additionalDateTypes;var l=t.SUB_TYPE,u=l===void 0?{}:l,f=t.SUB_TYPES,m=f===void 0?[]:f,E=t.PLACEHOLDER,g=E===void 0?"":E,y=t.VALUES,B=y===void 0?{_from:"",_to:"",_quarter:"",_days:"",_month:"",_year:"",_allow_year:""}:y,v=t.TABINDEX,A=v===void 0?"":v,P=t.ENABLE_TIME,S=P===void 0?false:P,_=t.LABEL,L=_===void 0?"":_,b=t.TYPE,I=t.VALUE_REQUIRED,T=I===void 0?false:I,X=t.REQUIRED,F=X===void 0?false:X;var D=this.parent.params.ENABLE_LABEL;var C=u.VALUE||a.NONE;var N=t.NAME.replace("_datesel","");var U=function(){if(D){return["main-ui-filter-wield-with-label","main-ui-filter-date-group"]}return["main-ui-filter-date-group"]}();var R={block:"date-group",type:b,mix:U,label:D?L:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:A,value:u,items:m,name:N,enableTime:S,deleteButton:true,content:[]};if(C===a.EXACT){var k=c({type:b,name:"".concat(N.NAME,"_from"),placeholder:g,tabindex:A,value:B._from||"",enableTime:S});R.content.push(k)}if(C===a.NEXT_DAYS||C===a.PREV_DAYS||C===r.PREV_DAY||C===r.NEXT_DAY||C===r.MORE_THAN_DAYS_AGO||C===r.AFTER_DAYS){var O=h({type:b,name:"".concat(N,"_days"),tabindex:A,value:B._days||"",placeholder:g});R.content.push(O)}if(C===a.RANGE){var M={block:"main-ui-filter-range-group",content:[c({type:b,name:"".concat(N,"_from"),placeholder:g,tabindex:A,value:B._from||"",enableTime:S}),d(),c({type:b,name:"".concat(N,"_to"),placeholder:g,tabindex:A,value:B._to||"",enableTime:S})]};R.content.push(M)}if(C===a.MONTH){var V=t.MONTHS,x=t.MONTH,w=t.YEARS,q=t.YEAR;var j=V.find(function(e){return e.VALUE===B._month})||x||V[0];var Y=w.find(function(e){return e.VALUE===B._year})||q||w[0];R.content.push(p({name:"".concat(N,"_month"),value:j,items:V,tabindex:A}),p({name:"".concat(N,"_year"),value:Y,items:w,tabindex:A}))}if(C===a.QUARTER){var H=t.YEARS,G=t.YEAR,W=t.QUARTERS,Q=t.QUARTER,K=t.PARAMS;var J=H.find(function(e){return e.VALUE===B._year})||G||H[0];var z=W.find(function(e){return e.VALUE===B._quarter})||Q||W[0];R.content.push(p({name:"".concat(N,"_year"),value:J,items:H,tabindex:A}),p({name:"".concat(N,"_quarter"),value:z,items:W,tabindex:A,params:K}))}if(C===a.YEAR){var Z=t.YEARS,$=t.YEAR;var ee=Z.find(function(e){return e.VALUE===B._year})||$||Z[0];R.content.push(p({name:"".concat(N,"_year"),value:ee,items:Z,tabindex:A}))}if(C==="CUSTOM_DATE"){var te=m.find(function(e){return e.VALUE==="CUSTOM_DATE"});if(te){var ie=s.Runtime.clone(te.DECL);if(s.Type.isArray(B._days)){ie.VALUE.days=B._days}if(s.Type.isArray(B._month)){ie.VALUE.months=B._month}if(s.Type.isArray(B._year)){ie.VALUE.years=B._year}ie.mix=ie.filter(function(e){return e!=="main-ui-filter-wield-with-label"});var se=this.createCustomDate(ie);var ne=babelHelpers.toConsumableArray(se.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));ne.forEach(function(e){return s.Dom.remove(e)});R.content.push(se);R.push("main-ui-filter-custom-date-group")}}if(C!==a.NONE&&C!==r.CUSTOM_DATE&&t.YEARS_SWITCHER){var ae=s.Runtime.clone(t.YEARS_SWITCHER);var re=ae.ITEMS;ae.VALUE=re.reduce(function(e,t){return t.VALUE===B._allow_year?t:e});var le=this.createSelect(ae);s.Dom.addClass(le,["main-ui-filter-year-switcher","main-ui-filter-with-padding"]);s.Dom.removeClass(le,"main-ui-filter-wield-with-label");var oe=babelHelpers.toConsumableArray(le.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));oe.forEach(function(e){return s.Dom.remove(e)});var ue=R.content.length-1;var ce=R.content[ue];if(s.Type.isPlainObject(ce)){if(!s.Type.isArray(ce.mix)){ce.mix=[]}ce.mix.push("main-ui-filter-remove-margin-right")}if(s.Type.isDomNode(ce)){s.Dom.addClass(ce,"main-ui-filter-remove-margin-right")}requestAnimationFrame(function(){s.Dom.addClass(le.previousElementSibling,"main-ui-filter-remove-margin-right")});R.content.push(le);R.mix.push("main-ui-filter-date-with-years-switcher")}var he=BX.decl(R);var de=s.Runtime.debounce(this.onDateChange,500,this);var pe=babelHelpers.toConsumableArray(he.querySelectorAll(".main-ui-date-input"));pe.forEach(function(e){e.addEventListener("change",de);e.addEventListener("input",de);var t=e.parentNode;var s=t.querySelector(".main-ui-control-value-delete");if(s){s.addEventListener("click",function(){setTimeout(function(){i.onDateChange({target:e})})})}});if(T){he.dataset.valueRequired=true;var fe=[].concat(babelHelpers.toConsumableArray(pe),babelHelpers.toConsumableArray(he.querySelectorAll(".main-ui-number-input")));fe.forEach(function(e){e.addEventListener("change",i.checkRequiredDateValue.bind(i));e.addEventListener("input",i.checkRequiredDateValue.bind(i));var t=e.parentNode;var n=t.querySelector(".main-ui-control-value-delete");if(n){n.addEventListener("click",function(){setTimeout(function(){i.checkRequiredDateValue({target:e})})})}s.Event.bindOnce(e,"mouseout",function(){i.checkRequiredDateValue({target:e})})})}if(F){var me=he.querySelector(".main-ui-filter-field-delete");if(me){BX.remove(me)}}var Ee={};this.parent.prepareControlDateValue(Ee,N,he);Object.entries(Ee).forEach(function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],s=t[1];Ee[i.replace(N,"")]=s;delete Ee[i]});this.parent.getEmitter().emit("init",{field:new o({parent:this.parent,options:babelHelpers.objectSpread({},t,{VALUES:Ee}),node:he})});return he}},{key:"checkRequiredDateValue",value:function e(t){if(t.target.value===""){this.showError({id:"valueError",target:t.target,text:this.parent.params.MAIN_UI_FILTER__VALUE_REQUIRED});return}this.hideError({id:"valueError",target:t.target})}},{key:"onDateChange",value:function e(t){var i=this;if(g.get(t.target)===t.target.value){return}g.set(t.target,t.target.value);if(t.target.value===""){this.hideError({id:"formatError",target:t.target});return}BX.ajax.runComponentAction("bitrix:main.ui.filter","checkDateFormat",{mode:"ajax",data:{value:t.target.value,format:BX.message("FORMAT_DATETIME")}}).then(function(e){if(!e.data.result){i.showError({id:"formatError",target:t.target});return}i.hideError({id:"formatError",target:t.target})})}},{key:"showError",value:function e(t){var i=t.id,n=t.target,a=t.text,r=a===void 0?null:a;s.Dom.style(n,"border-color","#FF5752");if(m.has(n)&&E.get(n)===i){s.Dom.remove(m.get(n))}var l=this.parent.params,o=l.MAIN_UI_FILTER__DATE_ERROR_TITLE,u=l.MAIN_UI_FILTER__DATE_ERROR_LABEL;var c=r||"".concat(u," ").concat(s.Loc.getMessage("FORMAT_DATE"));var h=s.Tag.render(f(),o,c);m.set(n,h);E.set(n,i);s.Dom.insertAfter(h,n);s.Dom.attr(n,"is-valid","false")}},{key:"hideError",value:function e(t){var i=t.id,n=t.target;s.Dom.style(n,"border-color",null);if(m.has(n)&&E.get(n)===i){s.Dom.remove(m.get(n))}s.Dom.attr(n,"is-valid","true")}}]);return e}();var B=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=null;this.presets=null;this.container=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.parent=t}},{key:"bindOnPresetClick",value:function e(){var t=this;(this.getPresets()||[]).forEach(function(e){s.Event.bind(e,"click",BX.delegate(t._onPresetClick,t))})}},{key:"getAddPresetField",value:function e(){return this.getContainer().querySelector(".main-ui-filter-new-filter")}},{key:"getAddPresetFieldInput",value:function e(){return this.getAddPresetField().querySelector(".main-ui-filter-sidebar-edit-control")}},{key:"clearAddPresetFieldInput",value:function e(){var t=this.getAddPresetFieldInput();if(s.Type.isDomNode(t)){t.value=""}}},{key:"normalizePreset",value:function e(t){return t.closest(".main-ui-filter-sidebar-item")}},{key:"deactivateAllPresets",value:function e(){this.getPresets().forEach(function(e){s.Dom.removeClass(e,"main-ui-filter-current-item")})}},{key:"createSidebarItem",value:function e(t,i,n){return BX.decl({block:"sidebar-item",text:s.Text.decode(i),id:t,pinned:n,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})}},{key:"activatePreset",value:function e(t){var i=this;this.deactivateAllPresets();var n=function(){if(s.Type.isString(t)){return i.getPresetNodeById(t)}return t}();if(s.Type.isDomNode(n)){s.Dom.addClass(n,"main-ui-filter-current-item")}}},{key:"getPresetNodeById",value:function e(t){return this.getPresets().find(function(e){return s.Dom.attr(e,"data-id")===t})}},{key:"getPresetId",value:function e(t){return s.Dom.attr(t,"data-id")}},{key:"updatePresetName",value:function e(t,i){if(s.Type.isDomNode(t)&&s.Type.isString(i)&&i!==""){var n=this.getPresetNameNode(t);if(s.Type.isDomNode(n)){s.Runtime.html(n,i)}}}},{key:"removePreset",value:function e(t,i,s){var n=this.getCurrentPresetId();var a=[];var r={preset_id:i,is_default:s};var l={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(r,l);BX.remove(t);if(BX.type.isArray(this.parent.params.PRESETS)){a=this.parent.params.PRESETS.filter(function(e){return e.ID!==i},this);this.parent.params.PRESETS=a}if(BX.type.isArray(this.parent.editablePresets)){a=this.parent.editablePresets.filter(function(e){return e.ID!==i},this);this.parent.editablePresets=a}if(i===n){this.parent.getSearch().removePreset();this.resetPreset()}}},{key:"pinPreset",value:function e(t){if(!BX.type.isNotEmptyString(t)){t="default_filter"}var i=this.getPresetNodeById(t);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(t==="default_filter"){return}}var n={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var a={preset_id:t};this.getPresets().forEach(function(e){s.Dom.removeClass(e,this.parent.settings.classPinnedPreset)},this);BX.addClass(i,this.parent.settings.classPinnedPreset);this.parent.saveOptions(a,n)}},{key:"_onPresetClick",value:function e(t){var i;var n;var a;var r;var l;var o;var u;t.preventDefault();u=this.parent;o=u.settings;l=t.target;i=t.currentTarget;n=this.getPresetId(i);a=this.getPreset(n);if(s.Dom.hasClass(l,o.classPinButton)){if(this.parent.isEditEnabled()){if(s.Dom.hasClass(i,o.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(n)}}}if(s.Dom.hasClass(l,o.classPresetEditButton)){this.enableEditPresetName(i)}if(s.Dom.hasClass(l,o.classPresetDeleteButton)){r="IS_DEFAULT"in a?a.IS_DEFAULT:false;this.removePreset(i,n,r);return false}if(!s.Dom.hasClass(l,o.classPresetDragButton)&&!s.Dom.hasClass(l,o.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}var c=this.getPreset(this.getCurrentPresetId());var h=this.getPreset(n);c.ADDITIONAL=[];h.ADDITIONAL=[];this.activatePreset(i);this.applyPreset(n);if(!this.parent.isEditEnabled()){u.applyFilter(null,true);if(t.isTrusted){u.closePopup()}if(u.isAddPresetEnabled()){u.disableAddPreset()}}}}},{key:"applyPinnedPreset",value:function e(){var t=this.parent;var i=this.isPinned(this.getCurrentPresetId());var s;if(this.parent.getParam("VALUE_REQUIRED")&&this.getPinnedPresetId()==="default_filter"){this.applyPreset("default_filter");this.deactivateAllPresets();s=this.parent.applyFilter()}else if(!i){var n=this.getPinnedPresetId();var a=this.getPinnedPresetNode();var r=false;var l=true;this.deactivateAllPresets();this.activatePreset(a);this.applyPreset(n);s=t.applyFilter(r,l);t.closePopup()}else{s=t.resetFilter()}return s}},{key:"updateEditablePreset",value:function e(t){var i=this.parent.getFilterFieldsValues();var s=this.getFields().map(function(e){return BX.data(e,"name")});var n=this.parent.preparePresetFields(i,s);var a=this.getPreset(t);a.FIELDS=n;a.TITLE=this.getPresetInput(this.getPresetNodeById(t)).value;a.ROWS=s}},{key:"getPresetInput",value:function e(t){return BX.Filter.Utils.getByClass(t,this.parent.settings.classPresetEditInput)}},{key:"enableEditPresetName",value:function e(t){var i=this.getPresetInput(t);BX.addClass(t,this.parent.settings.classPresetNameEdit);i.focus();i.value=BX.util.htmlspecialcharsback(i.value);s.Event.bind(i,"input",BX.delegate(this._onPresetNameInput,this))}},{key:"_onPresetNameInput",value:function e(t){var i=this.parent.getSearch();var s=t.currentTarget.value;var n=BX.findParent(t.currentTarget,{className:this.parent.settings.classPreset},true,false);var a=this.getPresetId(n);var r=this.getCurrentPresetId();var l={ID:a,TITLE:s};if(a===r){i.updatePreset(l)}}},{key:"getPresetNameNode",value:function e(t){return BX.Filter.Utils.getByClass(t,this.parent.settings.classPresetName)}},{key:"disableEditPresetName",value:function e(t){var i=this.getPresetInput(t);s.Dom.removeClass(t,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(i)){i.blur();BX.unbind(i,"input",BX.delegate(this._onPresetNameInput,this))}}},{key:"getPreset",value:function e(t,i){var s=this.parent.getParam(i?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!i){s=this.parent.editablePresets}var n=s.filter(function(e){return e.ID===t});if(t==="tmp_filter"&&!n.length){var a=BX.clone(this.getPreset("default_filter"));a.ID="tmp_filter";s.push(a);n.push(a)}return n.length!==0?n[0]:null}},{key:"getPresetField",value:function e(t,i){var s=this.getPreset(t);var n=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){n=s.FIELDS.filter(function(e){return e.NAME===i});n=n.length?n[0]:null}return n}},{key:"applyPreset",value:function e(t,i){t=i?"default_filter":t||"default_filter";var s=this.getPreset(t);if(t!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,i)}},{key:"extendPreset",value:function e(t){var i=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(t)){t=BX.clone(t);t.FIELDS.forEach(function(e){var t;var s=i.FIELDS.some(function(i,s){var n=false;if(i.NAME===e.NAME){t=s;n=true}return n},this);if(s&&t||s&&t===0){i.FIELDS[t]=e}else if(!this.isEmptyField(e)){i.FIELDS.push(e)}},this);t.FIELDS=i.FIELDS}return t}},{key:"isEmptyField",value:function e(t){var i=true;if(t.TYPE===this.parent.types.STRING){if(t.VALUE&&t.VALUE.length){i=false}}if(t.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(t.VALUE)&&"VALUE"in t.VALUE&&t.VALUE.VALUE){i=false}}if(t.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(t.VALUE)&&t.VALUE.length){i=false}}if(t.TYPE===this.parent.types.CUSTOM_DATE){if(BX.type.isArray(t.VALUE.days)&&t.VALUE.days.length||BX.type.isArray(t.VALUE.months)&&t.VALUE.months.length||BX.type.isArray(t.VALUE.years)&&t.VALUE.years.length){i=false}}if(t.TYPE===this.parent.types.CUSTOM_ENTITY||t.TYPE===this.parent.types.DEST_SELECTOR||t.TYPE===this.parent.types.ENTITY_SELECTOR){if(BX.type.isPlainObject(t.VALUES)){if(BX.type.isNotEmptyString(t.VALUES._label)&&BX.type.isNotEmptyString(t.VALUES._value)){i=false}if(BX.type.isPlainObject(t.VALUES._label)&&BX.type.isPlainObject(t.VALUES._value)&&Object.keys(t.VALUES._label).length&&Object.keys(t.VALUES._value).length){i=false}if(BX.type.isArray(t.VALUES._label)&&BX.type.isArray(t.VALUES._value)&&t.VALUES._label.length&&t.VALUES._value.length){i=false}if((BX.type.isArray(t.VALUES._label)&&t.VALUES._label.length||BX.type.isPlainObject(t.VALUES._label)&&Object.keys(t.VALUES._label).length)&&(BX.type.isArray(t.VALUES._value)&&t.VALUES._value.length||BX.type.isPlainObject(t.VALUES._value)&&Object.keys(t.VALUES._value).length)){i=false}}}if(t.TYPE===this.parent.types.DATE){var s="_datesel"in t.VALUES?t.VALUES._datesel:t.SUB_TYPE.VALUE;if(BX.type.isPlainObject(t.VALUES)&&(t.VALUES._from||t.VALUES._to||t.VALUES._quarter||t.VALUES._month&&!BX.type.isArray(t.VALUES._month)||t.VALUES._year&&!BX.type.isArray(t.VALUES._year)||t.VALUES._days&&!BX.type.isArray(t.VALUES._days))||BX.type.isArray(t.VALUES._days)&&t.VALUES._days.length||BX.type.isArray(t.VALUES._month)&&t.VALUES._month.length||BX.type.isArray(t.VALUES._year)&&t.VALUES._year.length||s===this.parent.dateTypes.CURRENT_DAY||s===this.parent.dateTypes.CURRENT_WEEK||s===this.parent.dateTypes.CURRENT_MONTH||s===this.parent.dateTypes.CURRENT_QUARTER||s===this.parent.dateTypes.LAST_7_DAYS||s===this.parent.dateTypes.LAST_30_DAYS||s===this.parent.dateTypes.LAST_60_DAYS||s===this.parent.dateTypes.LAST_90_DAYS||s===this.parent.dateTypes.LAST_WEEK||s===this.parent.dateTypes.LAST_MONTH||s===this.parent.dateTypes.TOMORROW||s===this.parent.dateTypes.YESTERDAY||s===this.parent.dateTypes.NEXT_WEEK||s===this.parent.dateTypes.NEXT_MONTH){i=false}}if(t.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(t.VALUES)&&(t.VALUES._from||t.VALUES._to)){i=false}}if(t.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE){i=false}}return i}},{key:"resetPreset",value:function e(t){this.applyPreset("",t)}},{key:"getFields",value:function e(){var t=this.parent.getFieldListContainer();var i=null;if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getBySelector(t.parentNode,".".concat(this.parent.settings.classFileldControlList," > div"),true)}return i}},{key:"getField",value:function e(t){var i=this.getFields();var s=null;var n;var a;if(BX.type.isArray(i)&&i.length){a=i.filter(function(e){if(BX.type.isDomNode(e)){n=BX.data(e,"name")}return n===t.NAME},this);s=a.length>0?a[0]:null}return s}},{key:"removeField",value:function e(t,i){var s;var n;i=i||false;if(BX.type.isPlainObject(t)){n=t.NAME;t=this.getField(t);if(BX.type.isArray(this.parent.fieldsList)){s=this.parent.fieldsList.indexOf(t);if(s!==-1){delete this.parent.fieldsList[s]}}this.parent.unregisterDragItem(t)}if(BX.type.isDomNode(t)){n=BX.data(t,"name");this.parent.getFields().deleteField(t)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var r=this.getPresetField(a,n);if(r&&!this.isEmptyField(r)){this.deactivateAllPresets();this.parent.applyFilter()}}if(!i){this.parent.saveFieldsSort()}}},{key:"removeFields",value:function e(t){t.forEach(function(e){this.removeField(e,true)},this);this.parent.saveFieldsSort()}},{key:"addField",value:function e(t){var i;var s;var n;if(BX.type.isPlainObject(t)){i=this.parent.getFieldListContainer();n=this.parent.getControls();s=BX.type.isArray(n)?n[n.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){t.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{t.TABINDEX=2}if(BX.type.isDomNode(i)){s=this.createControl(t);if(BX.type.isDomNode(s)){BX.append(s,i);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var r=this.getPresetField(a,t.NAME);if(r&&!this.isEmptyField(r)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()}},{key:"createControl",value:function e(t){var i;switch(t.TYPE){case this.parent.types.STRING:{i=this.parent.getFields().createInputText(t);break}case this.parent.types.TEXTAREA:{i=this.parent.getFields().createTextarea(t);break}case this.parent.types.SELECT:{i=this.parent.getFields().createSelect(t);break}case this.parent.types.MULTI_SELECT:{i=this.parent.getFields().createMultiSelect(t);break}case this.parent.types.NUMBER:{i=this.parent.getFields().createNumber(t);break}case this.parent.types.DATE:{i=this.parent.getFields().createDate(t);break}case this.parent.types.CUSTOM_DATE:{i=this.parent.getFields().createCustomDate(t);break}case this.parent.types.DEST_SELECTOR:{i=this.parent.getFields().createDestSelector(t);break}case this.parent.types.ENTITY_SELECTOR:{i=this.parent.getFields().createEntitySelector(t);break}case this.parent.types.CUSTOM:{i=this.parent.getFields().createCustom(t);break}case this.parent.types.CUSTOM_ENTITY:{i=this.parent.getFields().createCustomEntity(t);break}default:{break}}if(BX.type.isDomNode(i)){i.dataset.name=t.NAME;i.FieldController=new BX.Filter.FieldController(i,this.parent);if(t.REQUIRED){var s=i.querySelector(".main-ui-filter-field-delete");if(s){BX.remove(s)}}}return i}},{key:"removeNotCompareVariables",value:function e(t,i){if(BX.type.isPlainObject(t)){var s=this.parent.dateTypes;var n=this.parent.additionalDateTypes;if("FIND"in t){delete t.FIND}if(!i){Object.keys(t).forEach(function(e){if(e.indexOf("_numsel")!==-1){delete t[e]}if(e.indexOf("_datesel")!==-1){var i=t[e];if(i===s.EXACT||i===s.RANGE||i===n.PREV_DAY||i===n.NEXT_DAY||i===n.MORE_THAN_DAYS_AGO||i===n.AFTER_DAYS||i===s.PREV_DAYS||i===s.NEXT_DAYS||i===s.YEAR||i===s.MONTH||i===s.QUARTER||i===s.NONE||i===s.CUSTOM_DATE){delete t[e]}}var a=this.parent.getFieldByName(e);if(t[e]===""&&(!a||!a.STRICT)){delete t[e]}},this)}}}},{key:"isPresetValuesModified",value:function e(t){var i=this.getPreset(t);var s=this.parent.preparePresetSettingsFields(i.FIELDS);var n=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(n);var a=BX.Filter.Utils.sortObject(s);var r=BX.Filter.Utils.sortObject(n);return!Object.keys(a).every(function(e){return a[e]===r[e]||(BX.type.isPlainObject(a[e])||BX.type.isArray(a[e]))&&BX.Filter.Utils.objectsIsEquals(a[e],r[e])})}},{key:"getAdditionalValues",value:function e(t){var i=this.getPreset(t);var s=i.FIELDS.filter(function(e){return!this.isEmptyField(e)},this);var n=this.parent.preparePresetSettingsFields(s);var a=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(n,true);this.removeNotCompareVariables(a,true);this.removeSameProperties(a,n);return a}},{key:"removeSameProperties",value:function e(t,i){if(BX.type.isPlainObject(t)&&BX.type.isPlainObject(i)){Object.keys(i).forEach(function(e){if(e in t){delete t[e]}})}}},{key:"removeAdditionalField",value:function e(t){var i=this.getPreset(this.getCurrentPresetId());if(BX.type.isArray(i.ADDITIONAL)){i.ADDITIONAL=i.ADDITIONAL.filter(function(e){return e.NAME!==t})}}},{key:"updatePresetFields",value:function e(t,i){var s=this;var n;var a;var r=[];if(BX.type.isPlainObject(t)&&"FIELDS"in t){n=t.FIELDS;if(BX.type.isArray(t.ADDITIONAL)){t.ADDITIONAL.filter(function(e){return s.parent.params.FIELDS.some(function(t){return e.NAME===t.NAME})}).forEach(function(e){var t=false;e.IS_PRESET_FIELD=true;n.forEach(function(i,s){if(e.NAME===i.NAME){n[s]=e;t=true}});if(!t){n.push(e)}})}(n||[]).filter(function(e){return s.parent.params.FIELDS.some(function(t){return e.NAME===t.NAME})}).forEach(function(e,t){e.TABINDEX=t+1;if(i){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.CUSTOM_DATE:{e.VALUE={days:[],months:[],years:[]};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}r.push(this.createControl(e))},this);this.parent.disableFieldsDragAndDrop();a=this.parent.getFieldListContainer();BX.cleanNode(a);if(r.length){r.forEach(function(e,i){if(BX.type.isDomNode(e)){if(t.ID!=="tmp_filter"&&t.ID!=="default_filter"&&!("IS_PRESET_FIELD"in n[i])&&!this.isEmptyField(n[i])){BX.addClass(e,this.parent.settings.classPresetField)}BX.append(e,a);if(BX.type.isString(n[i].HTML)){var s=BX.create("div");this.parent.getHiddenElement().appendChild(s);BX.html(s,n[i].HTML)}}},this);this.parent.enableFieldsDragAndDrop()}}}},{key:"showCurrentPresetFields",value:function e(){var t=this.getCurrentPresetData();this.updatePresetFields(t)}},{key:"getCurrentPreset",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)}},{key:"getCurrentPresetId",value:function e(){var t=this.getCurrentPreset();var i=null;if(BX.type.isDomNode(t)){i=this.getPresetId(t)}else{i="tmp_filter"}return i}},{key:"getCurrentPresetData",value:function e(){var t=this.getCurrentPresetId();var i=null;if(BX.type.isNotEmptyString(t)){i=this.getPreset(t);i=this.extendPreset(i)}return i}},{key:"getContainer",value:function e(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)}},{key:"getPresets",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)}},{key:"getDefaultPresets",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)}},{key:"getPinnedPresetNode",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)}},{key:"isPinned",value:function e(t){return this.getPinnedPresetId()===t}},{key:"getPinnedPresetId",value:function e(){var t=this.getPinnedPresetNode();var i="default_filter";if(t){var s=BX.data(t,"id");i=s||i}return i}}]);return e}();e.Field=o;e.Api=u;e.Fields=y;e.Presets=B})(this.BX.Filter=this.BX.Filter||{},BX.UI.EntitySelector,BX.Event,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js?16548424641339";s:6:"source";s:78:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.map.js";}"*/
BX.namespace("BX.Tasks");BX.Tasks.InterfaceToolbar=function(t){this.filterId=t.filterId;this.grid={};this.containerId=t.containerId;this.container={};this.itemSelector="a.tasks-counter-container";this.params=t||{};this.filterManager=null;this.filterApi=null;this.itemClickHandler=null;return this.init()};BX.Tasks.InterfaceToolbar.prototype={init:function(){this.itemClickHandler=BX.delegate(this.onItemClick,this);this.container=BX(this.containerId);if(!BX.type.isElementNode(this.container)){throw"BX.Tasks.InterfaceToolbar: Could not find container: "+this.containerId}var t=this.container.querySelectorAll(this.itemSelector);for(var e=0,i=t.length;e<i;e++){BX.bind(t[e],"click",this.itemClickHandler)}this.filterManager=BX.Main.filterManager.getById(this.filterId);if(!this.filterManager){alert("BX.Main.filterManager not initialised");return}this.filterApi=this.filterManager.getApi()},onItemClick:function(t){var e=BX.findParent(BX.getEventTarget(t),{tagName:"A",className:"tasks-counter-container"});if(e){var i=e.getAttribute("data-type-id");if(BX.type.isNotEmptyString(i)){var r={counterTypeId:i,cancel:false};this.applyFilter(r);if(r.cancel){return BX.PreventDefault(t)}}}return true},applyFilter:function(t){var e={PROBLEM:t.counterTypeId};this.filterApi.setFields(e);this.filterApi.apply()}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.min.js?165484246317136";s:6:"source";s:79:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.js";s:3:"min";s:83:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(t,e,n,i){"use strict";var r=function(){function t(e){babelHelpers.classCallCheck(this,t);this.filterId=e.filterId;this.filterManager=BX.Main.filterManager.getById(this.filterId);this.bindEvents();this.updateFields()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){i.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){this.updateFields()}},{key:"updateFields",value:function t(){this.fields=this.filterManager.getFilterFieldsValues()}},{key:"isFilteredByField",value:function t(e){if(!Object.keys(this.fields).includes(e)){return false}if(n.Type.isArray(this.fields[e])){return this.fields[e].length>0}return this.fields[e]!==""}},{key:"isFilteredByFieldValue",value:function t(e,n){return this.isFilteredByField(e)&&this.fields[e]===n}},{key:"toggleByField",value:function t(e){var n=this;var i=Object.keys(e)[0];var r=e[i];if(!this.isFilteredByFieldValue(i,r)){this.filterManager.getApi().extendFilter(babelHelpers.defineProperty({},i,r),false,{COUNTER_TYPE:"TASKS_COUNTER_TYPE_"+r});return}this.filterManager.getFilterFields().forEach(function(t){if(t.getAttribute("data-name")===i){n.filterManager.getFields().deleteField(t)}});this.filterManager.getSearch().apply()}},{key:"getFilter",value:function t(){return this.filterManager}}]);return t}();function s(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter ','">\n\t\t\t\t\t<div class="tasks-counters--item-counter-wrapper">\n\t\t\t\t\t\t','\n\t\t\t\t\t\t<div class="tasks-counters--item-counter-title">',"</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);s=function e(){return t};return t}function o(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t<div class="task-counters--popup-item">\n\t\t\t\t\t<span class="tasks-counters--item-counter-num ','">','</span>\n\t\t\t\t\t<span class="task-counters--popup-item-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);o=function e(){return t};return t}function a(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-remove"></div>\n\t\t\t']);a=function e(){return t};return t}function u(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-num-text ','">',"</div>\n\t\t\t"]);u=function e(){return t};return t}function l(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-num ','">\n\t\t\t\t\t<div class="tasks-counters--item-counter-num-text --stop --without-animate">',"</div>\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t"]);l=function e(){return t};return t}var c=function(){function t(e){babelHelpers.classCallCheck(this,t);this.count=e.count;this.name=e.name;this.type=e.type;this.color=e.color;this.filterField=e.filterField;this.filterValue=e.filterValue;this.filter=e.filter;this.$container=null;this.$remove=null;this.$counter=null;this.bindEvents()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){var e=this;i.EventEmitter.subscribe("BX.Tasks.Counters:active",function(t){e!==t.data?e.unActive():null})}},{key:"getCounter",value:function t(){if(!this.$counter){var e=this.count>99?"99+":this.count;this.$counter=n.Tag.render(l(),this.getCounterColor(),e)}return this.$counter}},{key:"getCounterColor",value:function t(){if(!this.color){return null}return"--".concat(this.color)}},{key:"animateCounter",value:function t(e,i){var r=this;if(e>99&&i>99)return;i>99?i=99:null;if(e>99)e=99;var s=e-i;if(s<0)s=s*-1;this.$counter.innerHTML="";this.getCounter().classList.remove("--update");this.getCounter().classList.remove("--update-multi");if(s>5){setTimeout(function(){r.getCounter().style.animationDuration=s*50+"ms";r.getCounter().classList.add("--update-multi")})}var o=setInterval(function(){i<e?e--:e++;var t=n.Tag.render(u(),i<e?"--decrement":"",e);if(e===i){t.classList.add("--stop");if(s<5)r.getCounter().classList.add("--update");clearInterval(o);e===0?r.fade():r.unFade()}if(e!==i){n.Event.bind(t,"animationend",function(){t.parentNode.removeChild(t)})}r.$counter.appendChild(t)},50)}},{key:"updateCount",value:function t(e){if(this.count===e)return;this.animateCounter(this.count,e);this.count=e}},{key:"getRemove",value:function t(){if(!this.$remove){this.$remove=n.Tag.render(a())}return this.$remove}},{key:"fade",value:function t(){this.getContainer().classList.add("--fade")}},{key:"unFade",value:function t(){this.getContainer().classList.remove("--fade")}},{key:"active",value:function t(e){var r=n.Type.isDomNode(e)?e:this.getContainer();r.classList.add("--hover");i.EventEmitter.emit("BX.Tasks.Counters:active",this)}},{key:"unActive",value:function t(e){var r=n.Type.isDomNode(e)?e:this.getContainer();r.classList.remove("--hover");i.EventEmitter.emit("BX.Tasks.Counters:unActive",this)}},{key:"adjustClick",value:function t(){i.EventEmitter.emit("Tasks.Toolbar:onItem",{counter:this});this.$container.classList.contains("--hover")?this.unActive():this.active()}},{key:"getPopupMenuItemContainer",value:function t(){var e=n.Loc.getMessage("TASKS_COUNTER_OTHER_TASKS").replace("#TITLE#",this.name.toLowerCase());return n.Tag.render(o(),this.getCounterColor(),this.count,e)}},{key:"getContainer",value:function t(e){if(!this.$container){this.$container=n.Tag.render(s(),Number(this.count)===0?" --fade":"",this.getCounter(),this.name,this.getRemove());if(this.filter.isFilteredByFieldValue(this.filterField,this.filterValue)){this.active(this.$container)}n.Event.bind(this.$container,"click",this.adjustClick.bind(this))}return this.$container}}]);return t}();function d(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters tasks-counters--scope">\n\t\t\t\t<div class="tasks-counters--item">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="tasks-counters--item-content">',"</div>\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);d=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item-head">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);h=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item --other" ','">\n\t\t\t\t<div data-role="tasks-counters--item-head-other" class="tasks-counters--item-head">','</div>\n\t\t\t\t<div class="tasks-counters--item-content">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);p=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item-counter--more">\n\t\t\t\t<div class="tasks-counters--item-counter-wrapper">\n\t\t\t\t\t<div class="tasks-counters--item-counter-title">',':</div>\n\t\t\t\t\t<div class="tasks-counters--item-counter-num">',"</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);f=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item-counter-arrow"></div>\n\t\t']);v=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="tasks-counters--item-counter-arrow"></div>\n\t\t\t']);m=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="tasks-counters--item">',"</div>\n\t\t"]);g=function e(){return t};return t}function y(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div data-role="tasks-counters--item-head-read-all" class="tasks-counters--item-head\n\t\t\t\t\t\t',' \n\t\t\t\t\t\t--action \n\t\t\t\t\t\t--read-all">\n\t\t\t\t<div class="tasks-counters--item-head-read-all--icon"></div>\n\t\t\t\t<div class="tasks-counters--item-head-read-all--text">',"</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t"]);y=function e(){return t};return t}var k=function(){babelHelpers.createClass(t,null,[{key:"counterTypes",get:function t(){return{my:["expired","my_expired","originator_expired","accomplices_expired","auditor_expired","new_comments","my_new_comments","originator_new_comments","accomplices_new_comments","auditor_new_comments","projects_total_expired","projects_total_comments","sonet_total_expired","sonet_total_comments","groups_total_expired","groups_total_comments"],other:["project_expired","project_comments","projects_foreign_expired","projects_foreign_comments","groups_foreign_expired","groups_foreign_comments","sonet_foreign_expired","sonet_foreign_comments"],expired:["expired","my_expired","originator_expired","accomplices_expired","auditor_expired","project_expired","projects_total_expired","projects_foreign_expired","groups_total_expired","groups_foreign_expired","sonet_total_expired","sonet_foreign_expired"],comment:["new_comments","my_new_comments","originator_new_comments","accomplices_new_comments","auditor_new_comments","project_comments","projects_total_comments","projects_foreign_comments","groups_total_comments","groups_foreign_comments","sonet_total_comments","sonet_foreign_comments"]}}}]);function t(e){babelHelpers.classCallCheck(this,t);this.userId=e.userId;this.targetUserId=e.targetUserId;this.groupId=e.groupId;this.counters=e.counters;this.initialCounterTypes=e.counterTypes;this.renderTo=e.renderTo;this.role=e.role;this.signedParameters=e.signedParameters;this.popupMenu=null;this.$readAll={cropped:null,layout:null};this.$more=null;this.$moreArrow=null;this.$other={cropped:null,layout:null};this.$myTaskHead=null;this.filter=new r({filterId:e.filterId});this.bindEvents();this.setData(this.counters);this.initPull()}babelHelpers.createClass(t,[{key:"isMyTaskList",value:function t(){return this.userId===this.targetUserId}},{key:"isUserTaskList",value:function t(){return Object.keys(this.otherCounters).length===0}},{key:"isProjectsTaskList",value:function t(){return this.groupId>0}},{key:"isProjectList",value:function t(){return!this.isUserTaskList()&&!this.isProjectsTaskList()}},{key:"initPull",value:function t(){var e=this;BX.PULL.subscribe({moduleId:"tasks",callback:function t(n){return e.processPullEvent(n)}});this.extendWatch()}},{key:"extendWatch",value:function t(){var e=this;if(this.isProjectsTaskList()||this.isProjectList()){var n="TASKS_PROJECTS";if(this.isProjectsTaskList()){n="TASKS_PROJECTS_".concat(this.groupId)}BX.PULL.extendWatch(n,true);setTimeout(function(){return e.extendWatch()},29*60*1e3)}}},{key:"processPullEvent",value:function t(e){var n={user_counter:this.onUserCounter.bind(this),project_counter:this.onProjectCounter.bind(this)};var i=Object.prototype.hasOwnProperty;var r=e.command,s=e.params;if(i.call(n,r)){var o=n[r];if(o){o.apply(this,[s])}}}},{key:"bindEvents",value:function t(){i.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){var e=this;this.filter.updateFields();if(this.isRoleChanged()){this.updateRole();this.updateCountersData()}else{var n=Object.assign({},this.myCounters,this.otherCounters);Object.values(n).forEach(function(t){if(t){e.filter.isFilteredByFieldValue(t.filterField,t.filterValue)?t.active():t.unActive()}})}}},{key:"updateCountersData",value:function t(){var e=this;n.ajax.runComponentAction("bitrix:tasks.interface.counters","getCounters",{mode:"class",data:{groupId:this.groupId,role:this.role,counters:this.initialCounterTypes},signedParameters:this.signedParameters}).then(function(t){return e.rerender(t.data)},function(t){return console.log(t)})}},{key:"isRoleChanged",value:function t(){return this.role!==(this.filter.isFilteredByField("ROLEID")?this.filter.fields.ROLEID:"view_all")}},{key:"updateRole",value:function t(){this.role=this.filter.isFilteredByField("ROLEID")?this.filter.fields.ROLEID:"view_all"}},{key:"onUserCounter",value:function e(n){var i=this;var r=Object.prototype.hasOwnProperty;if(!this.isUserTaskList()||!this.isMyTaskList()||!r.call(n,this.groupId)||this.userId!==Number(n.userId)){return}Object.entries(n[this.groupId][this.role]).forEach(function(e){var n=babelHelpers.slicedToArray(e,2),r=n[0],s=n[1];if(i.myCounters[r]){i.myCounters[r].updateCount(s);if(s===0){i.myCounters[r].unActive()}else if(t.counterTypes.comment.includes(r)){i.$readAllInner.classList.remove("--fade")}}})}},{key:"onProjectCounter",value:function t(e){if(this.isUserTaskList()){return}this.updateCountersData()}},{key:"getCounterItem",value:function t(e){return new c({count:e.count,name:e.name,type:e.type,color:e.color,filterField:e.filterField,filterValue:e.filterValue,filter:this.filter})}},{key:"getCounterNameByType",value:function e(i){if(t.counterTypes.expired.includes(i)){return n.Loc.getMessage("TASKS_COUNTER_EXPIRED")}else if(t.counterTypes.comment.includes(i)){return n.Loc.getMessage("TASKS_COUNTER_NEW_COMMENTS")}}},{key:"setData",value:function e(n){var i=this;this.myCounters={};this.otherCounters={};Object.entries(n).forEach(function(e){var n=babelHelpers.slicedToArray(e,2),r=n[0],s=n[1];if(!t.counterTypes.my.includes(r)&&!t.counterTypes.other.includes(r)){return}var o=i.getCounterItem({type:r,name:i.getCounterNameByType(r),count:Number(s.VALUE),color:s.STYLE,filterField:s.FILTER_FIELD,filterValue:s.FILTER_VALUE});if(t.counterTypes.my.includes(r)){i.myCounters[r]=o}else if(t.counterTypes.other.includes(r)){i.otherCounters[r]=o}})}},{key:"isCroppedBlock",value:function t(e){if(e)return e.classList.contains("--cropp")}},{key:"getReadAllBlock",value:function e(){var i=this;var r=Object.assign({},this.myCounters,this.otherCounters);var s=0;Object.entries(r).forEach(function(e){var n=babelHelpers.slicedToArray(e,2),i=n[0],r=n[1];if(t.counterTypes.comment.includes(i)){s+=r.count}});this.$readAllInner=n.Tag.render(y(),s===0?"--fade":"",n.Loc.getMessage("TASKS_COUNTER_READ_ALL"));var o=this.isUserTaskList()||this.isProjectsTaskList()&&this.role!=="view_all"?this.readAllByRole.bind(this):this.readAllForProjects.bind(this);n.Event.bind(this.$readAllInner,"click",o);n.Event.bind(this.$readAllInner,"click",function(){return i.$readAllInner.classList.add("--fade")});this.$readAll.layout=n.Tag.render(g(),this.$readAllInner);return this.$readAll.layout}},{key:"readAllByRole",value:function t(){n.ajax.runAction("tasks.task.comment.readAll",{data:{groupId:this.groupId,userId:this.userId,role:this.role}})}},{key:"readAllForProjects",value:function e(){var i=Object.assign(this.myCounters,this.otherCounters);Object.entries(i).forEach(function(e){var n=babelHelpers.slicedToArray(e,1),r=n[0];if(i[r]&&t.counterTypes.comment.includes(r)){i[r].updateCount(0);i[r].unActive()}});n.ajax.runAction("tasks.task.comment.readProject",{data:{groupId:this.groupId}})}},{key:"getPopup",value:function t(){var n=this;var i=[];Object.values(this.otherCounters).forEach(function(t){var r=new e.MenuItem({html:t.getPopupMenuItemContainer().innerHTML});r.onclick=n.onPopupItemClick.bind(n,r,t);i.push(r)});this.popupMenu=new e.Menu({bindElement:this.$moreArrow,className:"tasks-counters--scope",angle:{offset:96},autoHide:true,closeEsc:true,offsetTop:5,offsetLeft:-67,animation:"fading-slide",items:i,events:{onPopupShow:function t(){return n.$more.classList.add("--hover")},onPopupClose:function t(){n.$more.classList.remove("--hover");n.popupMenu.destroy()}}});return this.popupMenu}},{key:"onPopupItemClick",value:function t(e,n){n.adjustClick();this.popupMenu.close()}},{key:"getMoreArrow",value:function t(){if(!this.$moreArrow){this.$moreArrow=n.Tag.render(m())}return this.$moreArrow}},{key:"getMore",value:function t(){var e=this;var i=0;Object.values(this.otherCounters).forEach(function(t){i+=Number(t.count)});var r=i>99?"99+":i;this.$moreArrow=n.Tag.render(v());this.$more=n.Tag.render(f(),n.Loc.getMessage("TASKS_COUNTER_MORE"),r,this.$moreArrow);n.Event.bind(this.$more,"click",function(){return e.getPopup().show()});return this.$more}},{key:"getOther",value:function t(){if(Object.keys(this.otherCounters).length===0){return""}var e=[];var i=0;Object.values(this.otherCounters).forEach(function(t){e.push(t.getContainer());if(t.count)i+=t.count});this.$other.cropped=this.isCroppedBlock(this.$other.layout);this.$other.layout=n.Tag.render(p(),this.$other.cropped?"--cropp":"",n.Loc.getMessage("TASKS_COUNTER_OTHER"),e,this.getMore());return this.$other.layout}},{key:"getContainer",value:function t(){var e=[];var i=0;Object.values(this.myCounters).forEach(function(t){e.push(t.getContainer());if(t.count)i+=t.count});this.$myTaskHead=n.Tag.render(h(),n.Loc.getMessage("TASKS_COUNTER_MY"));this.$element=n.Tag.render(d(),this.$myTaskHead,e,this.getOther(),this.isUserTaskList()&&!this.isMyTaskList()?"":this.getReadAllBlock());return this.$element}},{key:"rerender",value:function t(e){this.setData(e);this.render()}},{key:"render",value:function t(){var e=this.getContainer();var i=e.cloneNode(true);i.classList.add("task-interface-toolbar");i.style.position="fixed";i.style.opacity="0";i.style.width="auto";i.style.pointerEvents="none";document.body.appendChild(i);this.nodeWidth=i.offsetWidth;document.body.removeChild(i);n.Dom.replace(this.renderTo.firstChild,e)}}]);return t}();t.Counters=k})(this.BX.Tasks.Counters=this.BX.Tasks.Counters||{},BX.Main,BX,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?16548420241622";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Intranet.Binding.Menu");BX.Intranet.Binding.Menu=function(i,t,n){n=n||{};this.id=i||"intranet_binding_menu";this.idTop=this.id+"_top";this.items=t;this.menu=null;this.menuShowed=false;this.sections=n.sections||{};this.frequencyItem=n.frequencyItem||{};this.ajaxPath=n.ajaxPath||"";this.bindingId=n.bindingId||""};BX.Intranet.Binding.Menu.prototype={binding:function(){if(BX(this.id)){BX.bind(BX(this.id),"click",BX.delegate(this.clickMenuButton,this));if(BX(this.idTop)&&BX(this.idTop).getAttribute("href")==="#"){BX.bind(BX(this.idTop),"click",BX.delegate(this.clickMenuButton,this))}}},onItemClick:function(id,onclick){this.menu.close();if(BX.type.isString(onclick)){eval(onclick)}BX.ajax({url:this.ajaxPath,method:"POST",data:{action:"openingLog",payload:{bindingId:this.bindingId,menuItemId:id},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){}.bind(this)})},buildMenu:function(i){var t=[];for(var n=0,e=i.length;n<e;n++){i[n]["text"]=i[n]["text"];if(typeof i[n]["items"]!=="undefined"){i[n]["items"]=this.buildMenu(i[n]["items"])}else if(!i[n]["system"]){i[n]["onclick"]=this.onItemClick.bind(this,i[n]["id"],i[n]["onclick"])}t.push(i[n])}return t},clickMenuButton:function(i){if(!this.menu){this.menu=new BX.PopupMenuWindow(this.id,i.target===BX(this.idTop)?BX(this.idTop):BX(this.id),this.buildMenu(this.items),{autoHide:true,events:{onClose:function(){this.menuShowed=false}.bind(this)}})}if(this.menu){if(this.menuShowed){this.menu.close()}else{this.menuShowed=true;this.menu.show()}}BX.PreventDefault()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.min.js?16548424644483";s:6:"source";s:77:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.js";s:3:"min";s:81:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.map.js";}"*/
"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksToolbar!="undefined"){return}BX.Tasks.Component.TasksToolbar=BX.Tasks.Component.extend({sys:{code:"toolbar"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksToolbar.instance},addInstance:function(e){BX.Tasks.Component.TasksToolbar.instance=e}},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksToolbar.addInstance(this);if(!this.option("counters")){this.rerender("")}else{this.render()}},bindEvents:function(){var e={user_counter:this.onUserCounter};BX.addCustomEvent("onPullEvent-tasks",function(t,n){if(e[t]){e[t].apply(this,[n])}}.bind(this));BX.addCustomEvent("Tasks.TopMenu:onItem",function(e){this.rerender(e)}.bind(this));BX.addCustomEvent("BX.Kanban.ChangeGroup",function(e,t){this.option("groupId",e);this.rerender("")}.bind(this))},onUserCounter:function(e){var t=Number(this.option("userId"));var n=Number(this.option("ownerId"));var o=Number(this.option("groupId"));if(!this.option("showCounters")||!e.hasOwnProperty(o)||t!==n||t!==Number(e.userId)){return}var r=this.option("filterId")||null;if(r){var i="view_all";var s=BX.Main.filterManager.getById(r);if(s){var a=s.getFilterFieldsValues();i=a.ROLEID||i}this.option("counters",this.prepareCounters(e[o][i]));this.render()}},prepareCounters:function(e){var t={total:"",expired:6291456,new_comments:12582912};var n={};Object.keys(e).forEach(function(o){n[o]={code:t[o],counter:e[o]}});return n},rerender:function(e){return;this.getToolbarData(e,this.render.bind(this))},getToolbarData:function(e,t){e=e||"";t=t||{};var n=this.option("ownerId");var o=this.option("groupId")||0;this.callRemote("ui.counters.get",{userId:n,type:e,groupId:o}).then(function(e){this.option("counters",e.getData());t.call(this)}.bind(this))},render:function(){return;var e=this.option("templates");var t=this.option("counters");var n=this.option("foreign_counters");var o=this.option("messages");var r=this.option("classes");var i=this.option("buttons");var s=this.option("project_mode");var a=[];if(typeof t.total==="object"&&"counter"in t.total&&t.total.counter>0){a.push(e.total.replace("#COUNTER#",t.total.counter).replace("#TEXT#",o.total));Object.keys(t).forEach(function(n){var s=t[n];if(s.counter>0&&n!=="total"){a.push(e.counter.replace("#COUNTER#",s.counter).replace("#COUNTER#",s.counter).replace("#COUNTER_ID#",n).replace("#COUNTER_CODE#",s.code).replace("#TEXT#",o[n+"_"+this.getPluralForm(s.counter)]).replace("#CLASS#",r[n]).replace("#BUTTON#",i[n]||""))}}.bind(this))}if(typeof n.foreign_expired==="object"&&"counter"in n.foreign_expired&&n.foreign_expired.counter>0||typeof n.foreign_comments==="object"&&"counter"in n.foreign_comments&&n.foreign_comments.counter>0){a.push(e.foreign.replace("#TEXT#",o.foreign));Object.keys(n).forEach(function(t){var s=n[t];if(s.counter>0){a.push(e.counter.replace("#COUNTER#",s.counter).replace("#COUNTER#",s.counter).replace("#COUNTER_ID#",t).replace("#COUNTER_CODE#",s.code).replace("#TEXT#",o[t+"_"+this.getPluralForm(s.counter)]).replace("#CLASS#",r[t]).replace("#BUTTON#",i[t]||""))}}.bind(this))}if(!a.length){a.push(e.empty.replace("#TEXT#",o.empty))}this.scope().innerHTML=a.join("");var c=this.option("filterId")||null;var u=this.option("roleId")||"view_all";if(c){var l=BX.Main.filterManager.getById(c);if(l){var p=l.getFilterFieldsValues();u=p.ROLEID||u}}var d=this.scope().getElementsByClassName("tasks-counter-container");Object.values(d).forEach(function(e){BX.bind(e,"click",function(e){BX.PreventDefault(e);BX.onCustomEvent("Tasks.Toolbar:onItem",[this.dataset.counterCode,window.location.href])});if(e.nextSibling&&BX.hasClass(e.nextSibling,"tasks-counter-counter-button")&&e.nextSibling.dataset.counterId==="new_comments"){if(s){BX.bind(e.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readProject",{data:{groupId:this.option("groupId")||0}})}.bind(this))}else{BX.bind(e.nextSibling,"click",function(){BX.ajax.runAction("tasks.task.comment.readAll",{data:{groupId:this.option("groupId")||0,userId:this.option("ownerId"),role:u}})}.bind(this))}}}.bind(this))},getPluralForm:function(e){var t,n;n=BX.message("LANGUAGE_ID");e=parseInt(e);if(e<0){e=-1*e}if(n){switch(n){case"de":case"en":t=e!==1?1:0;break;case"ru":case"ua":t=e%10===1&&e%100!==11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2;break;default:t=1;break}}else{t=1}return t}}})}).call(this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js?165484246415089";s:6:"source";s:81:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.js";s:3:"min";s:85:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js";s:3:"map";s:85:"/bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Tasks");BX.Tasks.QuickForm=function(t,e){var i=BX(t);if(!i){throw"BX.Tasks.QuickForm: wrong container id"}this.parameters=e||{};this.layout={container:i,button:BX(this.parameters.button),form:BX("task-new-item-form"),responsible:BX("task-new-item-responsible"),responsibleId:BX("task-new-item-responsible-id"),deadline:BX("task-new-item-deadline"),title:BX("task-new-item-title"),projectLink:BX("task-new-item-project-link"),projectClearing:BX("task-new-item-project-clearing"),projectId:BX("task-new-item-project-id"),descriptionBlock:BX("task-new-item-description-block"),descriptionLink:BX("task-new-item-description-link"),description:BX("task-new-item-description"),saveButton:BX("task-new-item-save"),cancelButton:BX("task-new-item-cancel")};this.gridId=BX.type.isNotEmptyString(this.parameters.gridId)?this.parameters.gridId:null;this.messages=this.parameters.messages||{};this.canManageTask=this.parameters.canManageTask!==false;this.canAddMailUsers=this.parameters.canAddMailUsers===true;if(this.canManageTask){BX.bind(this.layout.title,"keypress",BX.proxy(this.fireEnterKey,this));if(this.layout.button){BX.bind(this.layout.button,"click",BX.proxy(this.handleButtonClick,this))}BX.bind(this.layout.cancelButton,"click",BX.proxy(this.hide,this));BX.bind(this.layout.saveButton,"click",BX.proxy(this.submit,this));BX.bind(this.layout.descriptionLink,"click",BX.proxy(this.toggleDescription,this));BX.bind(this.layout.deadline,"click",BX.proxy(this.calendar,this));BX.bind(this.layout.deadline,"focus",BX.proxy(this.calendar,this))}else{this.disable()}this.query=new BX.Tasks.Util.Query({url:"/bitrix/components/bitrix/tasks.task.list/ajax.php"});this.query.bindEvent("executed",BX.proxy(this.onQueryExecuted,this));this.operation="taskQuickAdd";this.errorPopup=null;this.notification=new BX.Tasks.QuickForm.Notification(this);this.projectSelector=new BX.Tasks.QuickForm.ProjectSelector("task-new-item-project-selector",this);this.userSelector=new BX.Tasks.QuickForm.UserSelector("task-new-item-user-selector",this);this.calendarSettings=this.parameters.calendarSettings?this.parameters.calendarSettings:{}};BX.Tasks.QuickForm.prototype.submit=function(){var t=this.layout.title.value;if(BX.util.trim(t).length===0){return false}var e={title:t,deadline:this.layout.deadline.value,description:this.layout.description.value,project:this.layout.projectId.value,pathToTask:this.parameters.pathToTask,siteId:BX.message("SITE_ID"),nameTemplate:this.parameters.nameTemplate,getListParams:this.parameters.getListParams,ganttMode:this.parameters.ganttMode};var i=this.userSelector.getUserId();var s=this.userSelector.getUserEmail();if(i>0){e.responsibleId=i}else if(this.canAddMailUsers&&s.length){e.userEmail=s;e.userName=this.userSelector.getUserName();e.userLastName=this.userSelector.getUserLastName()}this.disable();this.fadeGrid();this.query.deleteAll();this.query.add("ui.listcontrols.add",{data:e,parameters:{}},{code:this.operation});this.query.execute()};BX.Tasks.QuickForm.prototype.onQueryExecuted=function(result){if(!result.success){return this.showError(result.clientProcessErrors,result.serverProcessErrors)}else if(!result.data[this.operation]){return this.showError("Could not process this operation.")}else if(!result.data[this.operation].SUCCESS){return this.showError(result.data[this.operation].ERRORS)}var data=result.data[this.operation].RESULT;var taskId=data["taskId"];var found=data.position&&data.position.found===true;if(found){var grid=this.getGrid();if(grid&&BX.Tasks.GridInstance&&!BX.Tasks.GridInstance.checkCanMove()){BX.onCustomEvent(window,"onTasksQuickFormExecuted",[data]);return grid.reloadTable("GET",{},this.applyChanges.bind(this,data,found))}else if(data.task){var task=null;try{eval("result = "+data.task);task=result}catch(t){}this.insertIntoGantt(task,data.position)}}BX.onCustomEvent(window,"onTasksQuickFormExecuted",[data]);this.applyChanges(data,found)};BX.Tasks.QuickForm.prototype.applyChanges=function(t,e){var i=t["taskRaw"]&&t["taskRaw"]["TITLE"]?t["taskRaw"]["TITLE"]:"";var s=t["taskPath"];this.notification.show(t["taskId"],i,s,e);this.highlight(t["taskId"],false);this.unfadeGrid();this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.insertIntoGantt=function(t,e){if(!window.ganttChart||!t){return}BX.onCustomEvent("onTaskListTaskAdd",[t]);if(t.projectId&&!ganttChart.getProjectById(t.projectId)&&this.parameters.currentGroupId===0&&this.parameters.groupByProject===true){ganttChart.addProjectFromJSON({id:t.projectId,name:t.projectName,opened:true,canCreateTasks:t.projectCanCreateTasks,canEditTasks:t.projectCanEditTasks})}var i=ganttChart.addTaskFromJSON(t);if(i.parentTaskId){var s=ganttChart.getTaskById(i.parentTaskId);if(s){s.expand()}}var o=ganttChart.getTaskById(e.nextTaskId);var a=ganttChart.getTaskById(e.prevTaskId);if(o&&o.projectId===i.projectId){ganttChart.moveTask(i.id,o.id)}else if(a&&a.projectId===i.projectId){ganttChart.moveTask(i.id,a.id,true)}};BX.Tasks.QuickForm.prototype.getNextProject=function(t,e){var i=BX.findChildrenByClassName(t,"task-list-project-item");if(!e&&i.length){return i[0]}var s=null;for(var o=0;o<i.length;o++){if(parseInt(i[o].getAttribute("data-project-id"),10)>e){s=i[o];break}}return s};BX.Tasks.QuickForm.prototype.showError=function(){if(this.errorPopup===null){this.errorPopup=new BX.PopupWindow(this.operation,null,{lightShadow:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"",events:{click:BX.proxy(this.onPopupErrorClose,this)}})]})}var t=[];for(var e=0;e<arguments.length;e++){var i=arguments[e];if(BX.type.isArray(i)){t=BX.util.array_merge(t,i)}else if(BX.type.isString(i)){t.push(i)}}var s="";for(e=0;e<t.length;e++){s+=(typeof t[e].MESSAGE!=="undefined"?t[e].MESSAGE:t[e])+"<br>"}this.errorPopup.setContent("<div class='task-new-item-error-popup'>"+s+"</div>");this.errorPopup.show()};BX.Tasks.QuickForm.prototype.fadeGrid=function(){if(this.getGrid()&&BX.Tasks.GridInstance&&!BX.Tasks.GridInstance.checkCanMove()){this.getGrid().tableFade()}};BX.Tasks.QuickForm.prototype.unfadeGrid=function(){if(this.getGrid()&&BX.Tasks.GridInstance&&!BX.Tasks.GridInstance.checkCanMove()){this.getGrid().tableUnfade()}};BX.Tasks.QuickForm.prototype.onPopupErrorClose=function(){this.errorPopup.close();this.unfadeGrid();this.enable();this.clear();this.focus()};BX.Tasks.QuickForm.prototype.calendar=function(t){BX.PreventDefault(t);var e=this.layout.deadline;BX.calendar({node:e,field:e.name,bTime:true,bSetFocus:false,bCompatibility:true,bCategoryTimeVisibilityOption:"tasks.bx.calendar.deadline",bTimeVisibility:this.calendarSettings?this.calendarSettings.deadlineTimeVisibility==="Y":false,value:BX.CJSTask.ui.getInputDateTimeValue(e),bHideTimebar:false});BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.prototype.show=function(){BX.addClass(this.layout.container,"task-top-panel-righttop-open");BX.addClass(this.layout.button,"tasks-quick-form-button-active");this.focus()};BX.Tasks.QuickForm.prototype.hide=function(){BX.removeClass(this.layout.container,"task-top-panel-righttop-open");BX.removeClass(this.layout.button,"tasks-quick-form-button-active");this.notification.hide();this.focus()};BX.Tasks.QuickForm.prototype.handleButtonClick=function(t){if(BX.hasClass(this.layout.container,"task-top-panel-righttop-open")){this.hide()}else{this.show()}};BX.Tasks.QuickForm.prototype.toggleDescription=function(t){BX.toggleClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open");if(BX.hasClass(this.layout.descriptionBlock,"task-top-panel-leftmiddle-open")){this.layout.description.focus()}else{this.focus()}BX.PreventDefault(t)};BX.Tasks.QuickForm.prototype.fireEnterKey=function(t){t=t||window.event;if(t.keyCode===13){this.submit();BX.PreventDefault(t)}};BX.Tasks.QuickForm.prototype.getGrid=function(){if(this.gridId&&BX.Main&&BX.Main.gridManager){return BX.Main.gridManager.getInstanceById(this.gridId)}return null};BX.Tasks.QuickForm.prototype.disable=function(){this.layout.title.disabled=true;this.layout.deadline.disabled=true;this.layout.responsible.disabled=true;this.layout.description.disabled=true;BX.addClass(this.layout.saveButton,"ui-btn-clock")};BX.Tasks.QuickForm.prototype.enable=function(){this.layout.title.disabled=false;this.layout.deadline.disabled=false;this.layout.responsible.disabled=false;this.layout.description.disabled=false;BX.removeClass(this.layout.saveButton,"ui-btn-clock")};BX.Tasks.QuickForm.prototype.clear=function(){this.layout.title.value="";this.layout.deadline.value="";this.layout.description.value=""};BX.Tasks.QuickForm.prototype.focus=function(){this.layout.title.focus()};BX.Tasks.QuickForm.prototype.highlight=function(t,e){if(window.ganttChart){var i=ganttChart.getTaskById(t);if(i){i.highlight();if(e===true){i.scrollIntoView(false)}}}else if(this.getGrid()){var s=this.getGrid().getRows().getById(t);if(s){var o=s.getNode();BX.addClass(o,"task-list-item-highlighted");setTimeout(function(){BX.removeClass(o,"task-list-item-highlighted")},1e3);if(e===true){o.scrollIntoView(false)}}}};BX.Tasks.QuickForm.Notification=function(t){this.form=t;this.taskId=0;this.layout={block:BX("task-new-item-notification"),message:BX("task-new-item-message"),openLink:BX("task-new-item-open"),highlightLink:BX("task-new-item-highlight"),hideLink:BX("task-new-item-notification-hide")};BX.bind(this.layout.hideLink,"click",BX.proxy(this.hide,this));BX.bind(this.layout.highlightLink,"click",BX.proxy(this.highlight,this))};BX.Tasks.QuickForm.Notification.prototype.show=function(t,e,i,s){this.taskId=t;this.layout.message.innerHTML=e;this.layout.openLink.href=i;if(s){this.layout.highlightLink.style.display="inline"}else{this.layout.highlightLink.style.display="none"}BX.addClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.hide=function(){BX.removeClass(this.layout.block,"task-top-notification-active")};BX.Tasks.QuickForm.Notification.prototype.highlight=function(){this.form.highlight(this.taskId,true)};BX.Tasks.QuickForm.ProjectSelector=function(t,e){this.id=t;this.form=e;this.projectName=this.form.layout.projectLink.innerHTML;this.projectId=parseInt(this.form.layout.projectId.value,10);var i=this.form.parameters.destination||{};BX.SocNetLogDestination.init({name:t,showSearchInput:true,sendAjaxSearch:typeof i["SONETGROUPS_LIMITED"]!="undefined"&&i["SONETGROUPS_LIMITED"]=="Y",useClientDatabase:false,allowUserSearch:false,allowSonetGroupsAjaxSearch:typeof i["SONETGROUPS_LIMITED"]!="undefined"&&i["SONETGROUPS_LIMITED"]=="Y",departmentSelectDisable:true,bindMainPopup:{node:this.form.layout.projectLink},bindSearchPopup:{node:this.form.layout.projectLink},callback:{select:BX.proxy(this.onSelect,this)},items:{users:{},groups:{},department:{},departmentRelation:{},projects:i["PROJECTS"]||{},sonetgroups:i["SONETGROUPS"]||{}},itemsLast:{users:{},groups:{},department:{},projects:i["LAST"]&&i["LAST"]["PROJECTS"]?i["LAST"]["PROJECTS"]:{},sonetgroups:i["LAST"]&&i["LAST"]["SONETGROUPS"]?i["LAST"]["SONETGROUPS"]:{}},itemsSelected:{}});BX.bind(this.form.layout.projectLink,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.projectClearing,"click",BX.proxy(this.clearProject,this))};BX.Tasks.QuickForm.ProjectSelector.prototype.openDialog=function(t){if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(this.id)}if(t){BX.PreventDefault(t)}};BX.Tasks.QuickForm.ProjectSelector.prototype.onSelect=function(t){this.projectId=parseInt(t.entityId,10);this.projectName=t.name;this.form.layout.projectId.value=this.projectId;this.form.layout.projectLink.innerHTML=this.projectName;BX.addClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");BX.SocNetLogDestination.deleteLastItem(this.id);BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.ProjectSelector.prototype.clearProject=function(){this.form.layout.projectLink.innerHTML=this.form.messages.taskInProject;this.form.layout.projectId.value=0;this.projectId=0;this.projectName="";BX.removeClass(this.form.layout.projectClearing,"task-top-panel-tab-close-active");BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.UserSelector=function(t,e){this.id=t;this.form=e;this.userId=this.form.layout.responsibleId.value;this.userNameFormatted=this.form.layout.responsible.value;this.userEmail="";this.userName="";this.userLastName="";var i=this.form.parameters.destination||{};BX.SocNetLogDestination.init({name:t,searchInput:this.form.layout.responsible,departmentSelectDisable:true,bindMainPopup:{node:this.form.layout.responsible},bindSearchPopup:{node:this.form.layout.responsible},allowAddUser:this.form.canAddMailUsers,callback:{select:BX.proxy(this.onSelect,this)},items:{users:i["USERS"]||{},department:i["DEPARTMENT"]||{},departmentRelation:i["DEPARTMENT_RELATION"]||{}},itemsLast:{users:i["LAST"]&&i["LAST"]["USERS"]?i["LAST"]["USERS"]:{}},itemsSelected:i["SELECTED"]||{}});BX.addCustomEvent("BX.SocNetLogDestination:onBeforeSelectItemFocus",BX.proxy(this.onBeforeSelectItemFocus,this));BX.bind(this.form.layout.responsible,"focus",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"click",BX.proxy(this.openDialog,this));BX.bind(this.form.layout.responsible,"blur",BX.proxy(this.onBlur,this));var s={formName:this.id,inputName:this.form.layout.responsible.getAttribute("id")};BX.bind(this.form.layout.responsible,"keyup",BX.proxy(BX.SocNetLogDestination.BXfpSearch,s));BX.bind(this.form.layout.responsible,"keydown",BX.proxy(BX.SocNetLogDestination.BXfpSearchBefore,s))};BX.Tasks.QuickForm.UserSelector.prototype.getUserId=function(){return this.userId};BX.Tasks.QuickForm.UserSelector.prototype.getUserEmail=function(){return this.userEmail};BX.Tasks.QuickForm.UserSelector.prototype.getUserName=function(){return this.userName};BX.Tasks.QuickForm.UserSelector.prototype.getUserLastName=function(){return this.userLastName};BX.Tasks.QuickForm.UserSelector.prototype.openDialog=function(t){BX.calendar.get().Close();BX.PreventDefault(t);this.form.layout.responsible.value="";if(!BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.openDialog(this.id)}};BX.Tasks.QuickForm.UserSelector.prototype.onBeforeSelectItemFocus=function(t){if(t.id===this.id){t.blockFocus=true}};BX.Tasks.QuickForm.UserSelector.prototype.onSelect=function(t,e,i){this.userId=t.entityId||0;this.userNameFormatted=BX.util.htmlspecialcharsback(t.name);var s=t.params||{};this.userEmail=s.email||"";this.userName=s.name||"";this.userLastName=s.lastName||"";this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId;BX.SocNetLogDestination.deleteLastItem(this.id);BX.SocNetLogDestination.closeDialog()};BX.Tasks.QuickForm.UserSelector.prototype.onBlur=function(){setTimeout(BX.proxy(function(){if(!BX.SocNetLogDestination.isOpenDialog()&&!BX.SocNetLogDestination.isOpenSearch()&&this.form.layout.responsible.value.length<=0){this.form.layout.responsible.value=this.userNameFormatted;this.form.layout.responsibleId.value=this.userId}},this),100)}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js?1654841547186327";s:6:"source";s:67:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/main.ui.grid/templates/.default/script.map.js";}"*/
(function(exports,main_core_events,ui_cnt,main_core){"use strict";(function(){BX.namespace("BX.Grid");BX.Grid.ActionPanel=function(t,e,i){this.parent=null;this.rel={};this.actions=null;this.types=null;this.lastActivated=[];this.init(t,e,i);this.button=[];this.elements=[];this.buttonOnChange=[];this.buttonData={}};BX.Grid.ActionPanel.prototype={init:function init(parent,actions,types){this.parent=parent;this.actions=eval(actions);this.types=eval(types);BX.addCustomEvent(window,"Dropdown::change",BX.proxy(function(t,e,i,n){this.isPanelControl(BX(t))&&this._dropdownChange(t,e,i,n)},this));BX.addCustomEvent(window,"Dropdown::load",BX.proxy(function(t,e,i,n){this.isPanelControl(BX(t))&&this._dropdownChange(t,e,i,n)},this));var panel=this.getPanel();BX.bind(panel,"change",BX.delegate(this._checkboxChange,this));BX.bind(panel,"click",BX.delegate(this._clickOnButton,this));BX.addCustomEvent(window,"Grid::updated",function(){var t=BX("grid_cancel_button");t&&BX.fireEvent(BX.firstChild(t),"click")})},resetForAllCheckbox:function t(){var e=this.getForAllCheckbox();if(BX.type.isDomNode(e)){e.checked=null}},getForAllCheckbox:function t(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classForAllCheckbox"),true)},getPanel:function t(){return BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classActionPanel"),true)},getApplyButton:function t(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelApplyButton"),true)},isPanelControl:function t(e){return BX.hasClass(e,this.parent.settings.get("classPanelControl"))},getTextInputs:function t(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="text"]')},getHiddenInputs:function t(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="hidden"]')},getSelects:function t(){return BX.Grid.Utils.getBySelector(this.getPanel(),"select")},getDropdowns:function t(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classDropdown"))},getCheckboxes:function t(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelCheckbox"))},getButtons:function t(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelButton"))},isDropdown:function t(e){return BX.hasClass(e,this.parent.settings.get("classDropdown"))},isCheckbox:function t(e){return BX.hasClass(e,this.parent.settings.get("classPanelCheckbox"))},isTextInput:function t(e){return e.type==="text"},isHiddenInput:function t(e){return e.type==="hidden"},isSelect:function t(e){return e.tagName==="SELECT"},createDropdown:function t(e,i){var n=this.createContainer(e.ID,i);var s=BX.create("div",{props:{className:"main-dropdown main-grid-panel-control",id:e.ID+"_control"},attrs:{name:e.NAME,"data-name":e.NAME,"data-items":JSON.stringify(e.ITEMS),"data-value":e.ITEMS[0].VALUE,"data-popup-position":"fixed"},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:e.ITEMS[0].NAME})]});n.appendChild(s);return n},createCheckbox:function t(e,i){var n=this.createContainer(e.ID,i);var s=BX.create("span",{props:{className:"main-grid-checkbox-container"}});var a=BX.create("span",{props:{className:"main-grid-control-panel-content-title"}});var r=BX.create("input",{props:{type:"checkbox",className:this.parent.settings.get("classPanelCheckbox")+" main-grid-checkbox",id:e.ID+"_control"},attrs:{value:e.VALUE||"",title:e.TITLE||"",name:e.NAME||"","data-onchange":JSON.stringify(e.ONCHANGE)}});r.checked=e.CHECKED||null;n.appendChild(s);n.appendChild(a);s.appendChild(r);s.appendChild(BX.create("label",{props:{className:"main-grid-checkbox"},attrs:{for:e.ID+"_control",title:e.TITLE}}));a.appendChild(BX.create("label",{attrs:{for:e.ID+"_control",title:e.TITLE},html:e.LABEL}));return n},createText:function t(e,i){var n=this.createContainer(e.ID,i);var s=BX.type.isNotEmptyString(e["TITLE"])?e["TITLE"]:"";if(s!==""){n.appendChild(BX.create("label",{attrs:{title:s,for:e.ID+"_control"},text:s}))}n.appendChild(BX.create("input",{props:{className:"main-grid-control-panel-input-text main-grid-panel-control",id:e.ID+"_control"},attrs:{name:e.NAME,title:s,placeholder:e.PLACEHOLDER||"",value:e.VALUE||"",type:"text","data-onchange":JSON.stringify(e.ONCHANGE||[])}}));return n},createHidden:function t(e,i){var n=this.createContainer(e.ID,i);n.appendChild(BX.create("input",{props:{id:e.ID+"_control",type:"hidden"},attrs:{name:e.NAME,value:e.VALUE||""}}));return n},createButton:function t(e,i){this.buttonOnChange=e.ONCHANGE||[];this.buttonData=e;this.button=this.createButtonNode(e);BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this.prepareButton,this));BX.removeCustomEvent(window,"Grid::selectRow",BX.proxy(this.prepareButton,this));BX.removeCustomEvent(window,"Grid::allRowsSelected",BX.proxy(this.prepareButton,this));BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this.prepareButton,this));if(this.buttonData.SETTINGS&&e.ID===this.buttonData.SETTINGS.buttonId){BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this.prepareButton,this));BX.addCustomEvent(window,"Grid::selectRow",BX.proxy(this.prepareButton,this));BX.addCustomEvent(window,"Grid::allRowsSelected",BX.proxy(this.prepareButton,this));BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this.prepareButton,this))}this.prepareButton();var n=this.createContainer(e.ID,i);n.appendChild(this.button);return n},createButtonNode:function t(e){return BX.create("button",{props:{className:"main-grid-buttons"+(e.CLASS?" "+e.CLASS:""),id:e.ID+"_control",title:BX.type.isNotEmptyString(e.TITLE)?e.TITLE:""},attrs:{name:e.NAME||""},html:e.TEXT})},prepareButton:function t(){if(this.isSetButtonDisabled()){BX.Dom.attr(this.button,"data-onchange",[]);BX.Dom.addClass(this.button,"ui-btn ui-btn-disabled")}else{BX.Dom.attr(this.button,"data-onchange",this.buttonOnChange);BX.Dom.removeClass(this.button,"ui-btn ui-btn-disabled")}},isSetButtonDisabled:function t(){return!!(this.buttonData.SETTINGS&&this.buttonData.SETTINGS.minSelectedRows&&this.getSelectedIds().length<this.buttonData.SETTINGS.minSelectedRows)},createLink:function t(e,i){var n=this.createContainer(e.ID,i);var s=BX.create("a",{props:{className:"main-grid-link"+(e.CLASS?" "+e.CLASS:""),id:e.ID+"_control"},attrs:{href:e.HREF||"","data-onchange":JSON.stringify(e.ONCHANGE||[])},html:e.TEXT});n.appendChild(s);return n},createCustom:function t(e,i){var n=this.createContainer(e.ID,i);var s=BX.create("div",{props:{className:"main-grid-panel-custom"+(e.CLASS?" "+e.CLASS:"")},html:e.VALUE});n.appendChild(s);return n},createContainer:function t(e,i){e=e.replace("_control","");i=i.replace("_control","");return BX.create("span",{props:{className:this.parent.settings.get("classPanelControlContainer"),id:e},attrs:{"data-relative":i}})},removeItemsRelativeCurrent:function t(e){var i=e;var n=[e.id];var s=[];var a;while(i){a=BX.data(i,"relative");if(n.includes(a)){n.push(i.id);s.push(i)}i=i.nextElementSibling}s.forEach(function(t){BX.remove(t)})},validateData:function t(e){return"ONCHANGE"in e&&BX.type.isArray(e.ONCHANGE)},activateControl:function t(e){var i=BX(e);if(BX.type.isDomNode(i)){BX.removeClass(i,this.parent.settings.get("classDisable"));i.disabled=null}},deactivateControl:function t(e){var i=BX(e);if(BX.type.isDomNode(i)){BX.addClass(i,this.parent.settings.get("classDisable"));i.disabled=true}},showControl:function t(e){var i=BX(e);i&&BX.show(i)},hideControl:function t(e){var i=BX(e);i&&BX.hide(i)},validateActionObject:function t(e){return BX.type.isPlainObject(e)&&"ACTION"in e&&BX.type.isNotEmptyString(e.ACTION)&&(e.ACTION===this.actions.RESET_CONTROLS||"DATA"in e&&BX.type.isArray(e.DATA))},validateControlObject:function t(e){return BX.type.isPlainObject(e)&&"TYPE"in e&&"ID"in e},createDate:function t(e,i){var n=this.createContainer(e.ID,i);var s=BX.decl({block:"main-ui-date",mix:["main-grid-panel-date"],calendarButton:true,valueDelete:true,placeholder:"PLACEHOLDER"in e?e.PLACEHOLDER:"",name:"NAME"in e?e.NAME+"_from":"",tabindex:"TABINDEX"in e?e.TABINDEX:"",value:"VALUE"in e?e.VALUE:"",enableTime:"TIME"in e?e.TIME?"true":"false":"false"});n.appendChild(s);return n},createControl:function t(e,i){var n=null;switch(e.TYPE){case this.types.DROPDOWN:n=this.createDropdown(e,i);break;case this.types.CHECKBOX:n=this.createCheckbox(e,i);break;case this.types.TEXT:n=this.createText(e,i);break;case this.types.HIDDEN:n=this.createHidden(e,i);break;case this.types.BUTTON:n=this.createButton(e,i);break;case this.types.LINK:n=this.createLink(e,i);break;case this.types.CUSTOM:n=this.createCustom(e,i);break;case this.types.DATE:n=this.createDate(e,i);break}return n},onChangeHandler:function onChangeHandler(container,actions,isPseudo){var newElement,callback;var self=this;if(BX.type.isDomNode(container)&&BX.type.isArray(actions)){actions.forEach(function(action){if(self.validateActionObject(action)){if(action.ACTION===self.actions.CREATE){self.removeItemsRelativeCurrent(container);action.DATA.reverse();action.DATA.forEach(function(t){if(self.validateControlObject(t)){newElement=self.createControl(t,container.id||BX.data(container,"relative"));if(BX.type.isDomNode(newElement)){BX.insertAfter(newElement,container);if("ONCHANGE"in t&&t.TYPE===self.types.CHECKBOX&&"CHECKED"in t&&t.CHECKED){self.onChangeHandler(newElement,t.ONCHANGE)}if(t.TYPE===self.types.DROPDOWN&&BX.type.isArray(t.ITEMS)&&t.ITEMS.length&&"ONCHANGE"in t.ITEMS[0]&&BX.type.isArray(t.ITEMS[0].ONCHANGE)){self.onChangeHandler(newElement,t.ITEMS[0].ONCHANGE)}}}})}if(action.ACTION===self.actions.ACTIVATE){self.removeItemsRelativeCurrent(container);if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.lastActivated.push(t.ID);self.activateControl(t.ID)})}}if(action.ACTION===self.actions.SHOW){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.showControl(t.ID)})}}if(action.ACTION===self.actions.HIDE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.hideControl(t.ID)})}}if(action.ACTION===self.actions.HIDE_ALL_EXPECT){if(BX.type.isArray(action.DATA)){(self.getControls()||[]).forEach(function(t){if(!action.DATA.some(function(e){return e.ID===t.id})){self.hideControl(t.id)}})}}if(action.ACTION===self.actions.SHOW_ALL){(self.getControls()||[]).forEach(function(t){self.showControl(t.id)})}if(action.ACTION===self.actions.REMOVE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){BX.remove(BX(t.ID))})}}if(action.ACTION===self.actions.CALLBACK){this.confirmDialog(action,BX.delegate(function(){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(currentCallback){if(currentCallback.JS.indexOf("Grid.")!==-1){callback=currentCallback.JS.replace("Grid","self.parent");callback=callback.replace("()","");callback+=".apply(self.parent, [container])";try{eval(callback)}catch(t){throw new Error(t)}}else if(BX.type.isNotEmptyString(currentCallback.JS)){try{eval(currentCallback.JS)}catch(t){throw new Error(t)}}})}},this))}if(action.ACTION===self.actions.RESET_CONTROLS){this.removeItemsRelativeCurrent(container)}}},this)}else{if(!isPseudo){this.removeItemsRelativeCurrent(container)}self.lastActivated.forEach(function(t){self.deactivateControl(t)});self.lastActivated=[]}},confirmDialog:function t(e,i,n){this.parent.confirmDialog(e,i,n)},_dropdownChange:function t(e,i,n,s){var a=BX(e);var r=a.parentNode;var o=s&&"ONCHANGE"in s?s.ONCHANGE:null;var l=s&&"PSEUDO"in s&&s.PSEUDO!==false;this.onChangeHandler(r,o,l)},_checkboxChange:function _checkboxChange(event){var onChange;try{onChange=eval(BX.data(event.target,"onchange"))}catch(t){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),event.target.checked||event.target.id.indexOf("actallrows_")!==-1?onChange:null)},_clickOnButton:function _clickOnButton(event){var onChange;if(this.isButton(event.target)){event.preventDefault();try{onChange=eval(BX.data(event.target,"onchange"))}catch(t){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),onChange)}},isButton:function t(e){return BX.hasClass(e,this.parent.settings.get("classPanelButton"))},getSelectedIds:function t(){var e=this.parent.getRows().getSelected().filter(function(t){return t.isShown()});return e.map(function(t){return t.getId()})},getControls:function t(){return BX.findChild(this.getPanel(),{className:this.parent.settings.get("classPanelControlContainer")},true,true)},getValues:function t(){var e={};var i=this;var n=[].concat(this.getDropdowns(),this.getTextInputs(),this.getHiddenInputs(),this.getSelects(),this.getCheckboxes(),this.getButtons());(n||[]).forEach(function(t){if(BX.type.isDomNode(t)){if(i.isDropdown(t)){var n=BX.data(t,"value");n=n!==null&&n!==undefined?n:"";e[BX.data(t,"name")]=n}if(i.isSelect(t)){e[t.getAttribute("name")]=t.options[t.selectedIndex].value}if(i.isCheckbox(t)&&t.checked){e[t.getAttribute("name")]=t.value}if(i.isTextInput(t)||i.isHiddenInput(t)){e[t.getAttribute("name")]=t.value}if(i.isButton(t)){var s=BX.data(t,"name");var a=BX.data(t,"value");a=a!==null&&a!==undefined?a:"";if(s){e[s]=a}}}});return e}}})();(function(){BX.namespace("BX.Grid");BX.Grid.BaseClass=function(t){this.parent=t};BX.Grid.BaseClass.prototype={getParent:function t(){return this.parent}}})();(function(){BX.namespace("BX.Grid");BX.Grid.ColsSortable=function(t){this.parent=null;this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.init(t)};BX.Grid.ColsSortable.prototype={init:function t(e){this.parent=e;this.colsList=this.getColsList();this.rowsList=this.getRowsList();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::updated",BX.proxy(this.reinit,this));BX.addCustomEvent("Grid::headerUpdated",BX.proxy(this.reinit,this))}this.registerObjects()},destroy:function t(){BX.removeCustomEvent("Grid::updated",BX.proxy(this.reinit,this));this.unregisterObjects()},reinit:function t(){this.unregisterObjects();this.reset();this.init(this.parent)},reset:function t(){this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.fixedTableColsList=null},isActive:function t(){return this.isDrag},registerObjects:function t(){this.unregisterObjects();this.getColsList().forEach(this.register,this);this.getFixedHeaderColsList().forEach(this.register,this)},unregisterObjects:function t(){this.getColsList().forEach(this.unregister,this);this.getFixedHeaderColsList().forEach(this.unregister,this)},unregister:function t(e){jsDD.unregisterObject(e)},register:function t(e){e.onbxdragstart=BX.proxy(this._onDragStart,this);e.onbxdrag=BX.proxy(this._onDrag,this);e.onbxdragstop=BX.proxy(this._onDragEnd,this);jsDD.registerObject(e)},getColsList:function t(){if(!this.colsList){this.colsList=BX.Grid.Utils.getByTag(this.parent.getRows().getHeadFirstChild().getNode(),"th");this.colsList=this.colsList.filter(function(t){return!this.isStatic(t)},this)}return this.colsList},getFixedHeaderColsList:function t(){if(!this.fixedTableColsList&&this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTableColsList=BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"th");this.fixedTableColsList=this.fixedTableColsList.filter(function(t){return!this.isStatic(t)},this)}return this.fixedTableColsList||[]},getRowsList:function t(){var e=this.parent.getRows().getSourceRows();if(this.parent.getParam("ALLOW_PIN_HEADER")){e=e.concat(BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"tr"))}return e},isStatic:function t(e){return BX.hasClass(e,this.parent.settings.get("classCellStatic"))&&!BX.hasClass(e,"main-grid-fixed-column")},getDragOffset:function t(){var e=this.parent.getScrollContainer().scrollLeft-this.startScrollOffset;return jsDD.x-this.startDragOffset-this.dragRect.left+e},getColumn:function t(e){var i=[];if(e instanceof HTMLTableCellElement){i=this.rowsList.map(function(t){return t.cells[e.cellIndex]})}return i},_onDragStart:function t(){if(this.parent.getParam("ALLOW_PIN_HEADER")&&this.parent.getPinHeader().isPinned()){this.colsList=this.getFixedHeaderColsList()}else{this.colsList=this.getColsList()}this.startScrollOffset=this.parent.getScrollContainer().scrollLeft;this.isDrag=true;this.dragItem=jsDD.current_node;this.dragRect=this.dragItem.getBoundingClientRect();this.offset=Math.ceil(this.dragRect.width);this.startDragOffset=jsDD.start_x-this.dragRect.left;this.dragColumn=this.getColumn(this.dragItem);this.dragIndex=BX.Grid.Utils.getIndex(this.colsList,this.dragItem);this.parent.preventSortableClick=true},isDragToRight:function t(e,i){var n=e.getBoundingClientRect();var s=Math.ceil(n.left+n.width/2+BX.scrollLeft(window));var a=this.dragIndex;var r=jsDD.x;return i>a&&r>s},isDragToLeft:function t(e,i){var n=e.getBoundingClientRect();var s=Math.ceil(n.left+n.width/2+BX.scrollLeft(window));var a=this.dragIndex;var r=jsDD.x;return i<a&&r<s},isDragToBack:function t(e,i){var n=e.getBoundingClientRect();var s=Math.ceil(n.left+n.width/2+BX.scrollLeft(window));var a=this.dragIndex;var r=jsDD.x;return i>a&&r<s||i<a&&r>s},isMovedToRight:function t(e){return e.style.transform==="translate3d("+-this.offset+"px, 0px, 0px)"},isMovedToLeft:function t(e){return e.style.transform==="translate3d("+this.offset+"px, 0px, 0px)"},isMoved:function t(e){return e.style.transform!=="translate3d(0px, 0px, 0px)"&&e.style.transform!==""},moveColumn:function t(e,i,n){n=BX.type.isNumber(n)?n:300;BX.Grid.Utils.styleForEach(e,{transition:n+"ms",transform:"translate3d("+i+"px, 0px, 0px)"})},_onDrag:function t(){this.dragOffset=this.getDragOffset();this.targetItem=this.targetItem||this.dragItem;this.targetColumn=this.targetColumn||this.dragColumn;var e=-this.offset;var i=this.offset;var n=0;var s=0;this.moveColumn(this.dragColumn,this.dragOffset,s);[].forEach.call(this.colsList,function(t,s){if(t&&!t.classList.contains("main-grid-cell-static")){if(this.isDragToRight(t,s)&&!this.isMovedToRight(t)){this.targetColumn=this.getColumn(t);this.moveColumn(this.targetColumn,e)}if(this.isDragToLeft(t,s)&&!this.isMovedToLeft(t)){this.targetColumn=this.getColumn(t);this.moveColumn(this.targetColumn,i)}if(this.isDragToBack(t,s)&&this.isMoved(t)){this.targetColumn=this.getColumn(t);this.moveColumn(this.targetColumn,n)}}},this)},_onDragEnd:function t(){[].forEach.call(this.dragColumn,function(t,e){BX.Grid.Utils.collectionSort(t,this.targetColumn[e])},this);this.rowsList.forEach(function(t){BX.Grid.Utils.styleForEach(t.cells,{transition:"",transform:""})});this.reinit();var e=this.colsList.map(function(t){return BX.data(t,"name")});this.parent.getUserOptions().setColumns(e);BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent]);setTimeout(function(){this.parent.preventSortableClick=false}.bind(this),10)}}})();(function(){BX.namespace("BX.Grid");var t=window.parent.BX.ajax.UpdatePageData;function e(){window.parent.BX.ajax.UpdatePageData=function(){}}function i(){window.parent.BX.ajax.UpdatePageData=t}BX.Grid.Data=function(t){this.parent=t;this.reset()};BX.Grid.Data.prototype.reset=function(){this.response=null;this.xhr=null;this.headRows=null;this.bodyRows=null;this.footRows=null;this.moreButton=null;this.pagination=null;this.counterDisplayed=null;this.counterSelected=null;this.counterTotal=null;this.limit=null;this.actionPanel=null;this.rowsByParentId={};this.rowById={};this.isValidResponse=null};BX.Grid.Data.prototype.getParent=function(){return this.parent};BX.Grid.Data.prototype.validateResponse=function(){if(!BX.type.isBoolean(this.isValidResponse)){this.isValidResponse=!!this.getResponse()&&!!BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classContainer"),true)}return this.isValidResponse};BX.Grid.Data.prototype.request=function(t,n,s,a,r,o){if(!BX.type.isString(t)){t=""}if(!BX.type.isNotEmptyString(n)){n="GET"}if(!BX.type.isPlainObject(s)){s={}}var l={gridId:this.parent.getId(),url:t,method:n,data:s};this.parent.disableCheckAllCheckboxes();BX.onCustomEvent(window,"Grid::beforeRequest",[this,l]);if(l.hasOwnProperty("cancelRequest")&&l.cancelRequest===true){return}t=l.url;if(!BX.type.isNotEmptyString(t)){t=this.parent.baseUrl}t=BX.Grid.Utils.addUrlParams(t,{sessid:BX.bitrix_sessid(),internal:"true",grid_id:this.parent.getId()});if("apply_filter"in s&&s.apply_filter==="Y"){t=BX.Grid.Utils.addUrlParams(t,{apply_filter:"Y"})}else{t=BX.util.remove_url_param(t,"apply_filter")}if("clear_nav"in s&&s.clear_nav==="Y"){t=BX.Grid.Utils.addUrlParams(t,{clear_nav:"Y"})}else{t=BX.util.remove_url_param(t,"clear_nav")}t=BX.Grid.Utils.addUrlParams(t,{grid_action:a||"showpage"});n=l.method;s=l.data;this.reset();var d=this;setTimeout(function(){var l=BX.Http.Data.convertObjectToFormData(s);e();var c=BX.ajax({url:BX.Grid.Utils.ajaxUrl(t,d.getParent().getAjaxId()),data:l,method:n,dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:d.getParent().getAjaxId()},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:a||"showpage"})}],processData:true,scriptsRunFirst:false,start:false,preparePost:false,onsuccess:function t(e){d.response=BX.create("div",{html:e});d.response=d.response.querySelector("#"+d.parent.getContainerId());d.xhr=c;if(d.parent.getParam("HANDLE_RESPONSE_ERRORS")){var n;try{n=JSON.parse(e)}catch(t){n={messages:[]}}if(n.messages.length){d.parent.arParams["MESSAGES"]=n.messages;d.parent.messages.show();d.parent.tableUnfade();if(BX.type.isFunction(o)){BX.delegate(o,d)(c)}return}}if(BX.type.isFunction(r)){d.parent.enableCheckAllCheckboxes();BX.delegate(r,d)(e,c)}i()},onerror:function t(e){d.error=o;d.xhr=c;if(BX.type.isFunction(o)){d.parent.enableCheckAllCheckboxes();BX.delegate(o,d)(c,e)}}});c.send(l)},0)};BX.Grid.Data.prototype.getResponse=function(){return this.response};BX.Grid.Data.prototype.getHeadRows=function(){if(!this.headRows){this.headRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classHeadRow"))}return this.headRows};BX.Grid.Data.prototype.getBodyRows=function(){if(!this.bodyRows){this.bodyRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classBodyRow"))}return this.bodyRows};BX.Grid.Data.prototype.getRowsByParentId=function(t){if(!(t in this.rowsByParentId)){this.rowsByParentId[t]=BX.Grid.Utils.getBySelector(this.getResponse(),"."+this.getParent().settings.get("classBodyRow")+'[data-parent-id="'+t+'"]')}return this.rowsByParentId[t]};BX.Grid.Data.prototype.getRowById=function(t){if(!(t in this.rowById)){this.rowById[t]=BX.Grid.Utils.getBySelector(this.getResponse(),"."+this.getParent().settings.get("classBodyRow")+'[data-id="'+t+'"]',true)}return this.rowById[t]};BX.Grid.Data.prototype.getFootRows=function(){if(!this.footRows){this.footRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classFootRow"))}return this.footRows};BX.Grid.Data.prototype.getMoreButton=function(){if(!this.moreButton){this.moreButton=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classMoreButton"),true)}return this.moreButton};BX.Grid.Data.prototype.getPagination=function(){if(!this.pagination){this.pagination=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPagination"),true);if(BX.type.isDomNode(this.pagination)){this.pagination=BX.firstChild(this.pagination)}}return this.pagination};BX.Grid.Data.prototype.getCounterDisplayed=function(){if(!this.counterDisplayed){this.counterDisplayed=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterDisplayed"),true)}return this.counterDisplayed};BX.Grid.Data.prototype.getCounterSelected=function(){if(!this.counterSelected){this.counterSelected=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterSelected"),true)}return this.counterSelected};BX.Grid.Data.prototype.getCounterTotal=function(){if(!BX.type.isDomNode(this.counterTotal)){var t="."+this.getParent().settings.get("classCounterTotal")+" ."+this.getParent().settings.get("classPanelCellContent");this.counterTotal=BX.Grid.Utils.getBySelector(this.getResponse(),t,true)}return this.counterTotal};BX.Grid.Data.prototype.getLimit=function(){if(!this.limit){this.limit=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPageSize"),true)}return this.limit};BX.Grid.Data.prototype.getPageSize=function(){return this.getLimit()};BX.Grid.Data.prototype.getActionPanel=function(){if(!this.actionPanel){this.actionPanel=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classActionPanel"),true)}return this.actionPanel}})();(function(){BX.namespace("BX.Main");BX.Main.dropdown=function(t){this.id=null;this.dropdown=null;this.items=null;this.value=null;this.menuId=null;this.menu=null;this.menuItems=null;this.dataItems="items";this.dataValue="value";this.dataPseudo="pseudo";this.dropdownItemClass="main-dropdown-item";this.activeClass="main-dropdown-active";this.selectedClass="main-dropdown-item-selected";this.notSelectedClass="main-dropdown-item-not-selected";this.lockedClass="main-dropdown-item-locked";this.menuItemClass="menu-popup-item";this.init(t)};BX.Main.dropdown.prototype={init:function t(e){this.id=e.id;this.dropdown=e;this.items=this.getItems();this.value=this.getValue();this.menuId=this.getMenuId();this.menu=this.createMenu();this.menu.popupWindow.show();this.adjustPosition();BX.bind(this.dropdown,"click",BX.delegate(this.showMenu,this))},getMenuId:function t(){return this.id+"_menu"},getItems:function getItems(){var result;try{var str=BX.data(this.dropdown,this.dataItems);result=eval(str)}catch(t){result=[]}return result},getValue:function t(){return BX.data(this.dropdown,this.dataValue)},prepareMenuItems:function t(){var e=this;var i,n;var s=this.getValue();function a(t){var r=e.dropdown.dataset["htmlEntity"]==="true";return t.map(function(t){i={};i["data-"+e.dataValue]=t.VALUE;i["data-"+e.dataPseudo]="PSEUDO"in t&&t.PSEUDO?"true":"false";n=BX.create("div",{children:[BX.create("span",{props:{className:e.dropdownItemClass},attrs:i,html:r?t.NAME:null,text:r?null:t.NAME})]});return{html:n.innerHTML,className:s===t.VALUE?e.selectedClass:e.notSelectedClass,delimiter:t.DELIMITER,items:"ITEMS"in t?a(t.ITEMS):null}})}var r=a(this.getItems());BX.onCustomEvent(window,"Dropdown::onPrepareItems",[this.id,this.menuId,r]);return r},createMenu:function t(){var e=this;return BX.PopupMenu.create(this.getMenuId(),this.dropdown,this.prepareMenuItems(),{autoHide:true,offsetTop:-8,offsetLeft:+(this.dropdown.dataset.menuOffsetLeft||40),maxHeight:+(this.dropdown.dataset.menuMaxHeight||170),angle:{position:"bottom",offset:0},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:function t(){e._onShowMenu()}}})},showMenu:function t(){this.menu=BX.PopupMenu.getMenuById(this.menuId);if(!this.menu){this.menu=this.createMenu();this.menu.popupWindow.show()}this.adjustPosition()},adjustPosition:function t(){if(this.dropdown.dataset.popupPosition==="fixed"){var e=this.menu.popupWindow.popupContainer;e.style.setProperty("top","auto");e.style.setProperty("bottom","45px");e.style.setProperty("left","0px");this.dropdown.appendChild(e)}},getSubItem:function t(e){return BX.Grid.Utils.getByClass(e,this.dropdownItemClass,true)},refresh:function t(e){var i=this.getSubItem(e);var n=BX.data(i,this.dataValue);if(BX.Type.isUndefined(n)){n=""}BX.firstChild(this.dropdown).innerText=i.innerText;this.dropdown.dataset[this.dataValue]=n},selectItem:function t(e){var i=this;(this.menu.menuItems||[]).forEach(function(t){BX.removeClass(t.layout.item,i.selectedClass);if(e!==t.layout.item){BX.addClass(t.layout.item,i.notSelectedClass)}else{BX.removeClass(t.layout.item,i.notSelectedClass)}});BX.addClass(e,this.selectedClass)},lockedItem:function t(e){BX.addClass(e,this.lockedClass)},getDataItemIndexByValue:function t(e,i){if(BX.type.isArray(e)){e.map(function(t,e){if(t.VALUE===i){return false}})}return false},getDataItemByValue:function t(e){var i=this.getItems().filter(function(t){return t.VALUE===e});return i.length>0?i[0]:null},_onShowMenu:function t(){var e=this;BX.addClass(this.dropdown,this.activeClass);(this.menu.menuItems||[]).forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(e._onItemClick,e))})},_onCloseMenu:function t(){BX.removeClass(this.dropdown,this.activeClass);BX.PopupMenu.destroy(this.menuId)},_onItemClick:function t(e){var i=this.getMenuItem(e.target);var n,s;var a=this.getSubItem(i);var r=BX.data(a,"pseudo");if(!(r==="true")){this.refresh(i);this.selectItem(i);this.menu.popupWindow.close();n=this.getValue();s=this.getDataItemByValue(n)}else{n=BX.data(a,"value");s=this.getDataItemByValue(n)}e.stopPropagation();BX.onCustomEvent(window,"Dropdown::change",[this.dropdown.id,e,i,s,n])},getMenuItem:function t(e){var i=e;if(!BX.hasClass(i,this.menuItemClass)){i=BX.findParent(i,{class:this.menuItemClass})}return i}}})();(function(){BX.namespace("BX.Main");BX.Main.dropdownManager={dropdownClass:"main-dropdown",data:{},init:function init(){var self=this;var result;var onLoadItems;var items;BX.bind(document,"click",BX.delegate(function(t){if(BX.hasClass(t.target,this.dropdownClass)){t.preventDefault();result=this.getById(t.target.id);if(result&&result.dropdown===t.target){self.push(t.target.id,this.getById(t.target.id))}else{self.push(t.target.id,new BX.Main.dropdown(t.target))}}},this));onLoadItems=BX.Grid.Utils.getByClass(document.body,this.dropdownClass);if(BX.type.isArray(onLoadItems)){onLoadItems.forEach(function(current){result=self.getById(current.id);try{items=eval(BX.data(current,"items"))}catch(t){}BX.onCustomEvent(window,"Dropdown::load",[current.id,{},null,BX.type.isArray(items)&&items.length?items[0]:[],BX.data(current,"value")])})}},push:function t(e,i){this.data[e]=i},getById:function t(e){return e in this.data?this.data[e]:null}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Element=function(t,e){this.node=null;this.href=null;this.parent=null;this.init(t,e)};BX.Grid.Element.prototype={init:function t(e,i){this.node=e;this.parent=i;this.resetOnclickAttr()},getParent:function t(){return this.parent},load:function t(){BX.addClass(this.getNode(),this.getParent().settings.get("classLoad"))},unload:function t(){BX.removeClass(this.getNode(),this.getParent().settings.get("classLoad"))},isLoad:function t(){return BX.hasClass(this.getNode(),this.getParent().settings.get("classLoad"))},resetOnclickAttr:function t(){if(BX.type.isDomNode(this.getNode())){this.getNode().onclick=null}},getObserver:function t(){return BX.Grid.observer},getNode:function t(){return this.node},getLink:function t(){var e;try{e=this.getNode().href}catch(t){e=null}return e}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Fader=function(t){this.parent=null;this.table=null;this.container=null;this.init(t)};BX.Grid.Fader.prototype={init:function t(e){this.parent=e;this.table=this.parent.getTable();this.container=this.table.parentNode;this.scrollStartEventName=this.parent.isTouch()?"touchstart":"mouseenter";this.scrollEndEventName=this.parent.isTouch()?"touchend":"mouseleave";if(this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTable=this.parent.getPinHeader().getFixedTable()}this.debounceScrollHandler=BX.debounce(this._onWindowScroll,400,this);BX.bind(window,"resize",BX.proxy(this.toggle,this));document.addEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:true}));this.container.addEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:true}));BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this));BX.addCustomEvent(window,"Grid::resize",BX.proxy(this.toggle,this));BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this));BX.addCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this));BX.bind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this));BX.bind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this));BX.bind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));BX.bind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));this.toggle();this.adjustEarOffset(true)},destroy:function t(){BX.unbind(window,"resize",BX.proxy(this.toggle,this));document.removeEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:true}));this.container.removeEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:true}));BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this));BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this));BX.removeCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this));BX.unbind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this));BX.unbind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this));BX.unbind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));BX.unbind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this));this.hideLeftEar();this.hideRightEar();this.stopScroll()},_onHeaderUpdated:function t(){if(this.parent.getParam("ALLOW_PIN_HEADER")){this.fixedTable=this.parent.getPinHeader().getFixedTable()}},_onMouseoverLeft:function t(e){this.parent.isTouch()&&e.preventDefault();this.startScrollByDirection("left")},_onMouseoverRight:function t(e){this.parent.isTouch()&&e.preventDefault();this.startScrollByDirection("right")},stopScroll:function t(){clearTimeout(this.scrollTimer);clearInterval(this.scrollInterval)},startScrollByDirection:function t(e){var i=this.container;var n=i.scrollLeft;var s=this;var a=8;var r=1e3/60/2;this.scrollTimer=setTimeout(function(){s.scrollInterval=setInterval(function(){i.scrollLeft=e=="right"?n+=a:n-=a},r)},100)},getEarLeft:function t(){if(!this.earLeft){this.earLeft=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarLeft"),true)}return this.earLeft},getEarRight:function t(){if(!this.earRight){this.earRight=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarRight"),true)}return this.earRight},getShadowLeft:function t(){return this.parent.getContainer().querySelector(".main-grid-fade-shadow-left")},getShadowRight:function t(){return this.parent.getContainer().querySelector(".main-grid-fade-shadow-right")},adjustEarOffset:function t(e){if(e){this.windowHeight=BX.height(window);this.tbodyPos=BX.pos(this.table.tBodies[0]);this.headerPos=BX.pos(this.table.tHead)}var i=window.scrollY;if(this.parent.isIE()){i=document.documentElement.scrollTop}var n=i+this.windowHeight-this.tbodyPos.top;var s=i-this.tbodyPos.top;if(n>this.tbodyPos.bottom-this.tbodyPos.top){n=this.tbodyPos.bottom-this.tbodyPos.top}if(s<this.headerPos.height){s=this.headerPos.height}else{n-=s;n+=this.headerPos.height}BX.Grid.Utils.requestAnimationFrame(BX.proxy(function(){if(s!==this.lastPosTop){var t="translate3d(0px, "+s+"px, 0)";this.getEarLeft().style.transform=t;this.getEarRight().style.transform=t}if(n!==this.lastBottomPos){this.getEarLeft().style.height=n+"px";this.getEarRight().style.height=n+"px"}this.lastPosTop=s;this.lastBottomPos=n},this))},_onWindowScroll:function t(){this.adjustEarOffset()},hasScroll:function t(){return this.table.offsetWidth>this.container.clientWidth},hasScrollLeft:function t(){return this.container.scrollLeft>0},hasScrollRight:function t(){return this.table.offsetWidth>this.container.scrollLeft+this.container.clientWidth},showLeftEar:function t(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.addClass(this.getEarLeft(),this.parent.settings.get("classShow"))},hideLeftEar:function t(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft"));BX.removeClass(this.getEarLeft(),this.parent.settings.get("classShow"))},showRightEar:function t(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"));BX.addClass(this.getEarRight(),this.parent.settings.get("classShow"))},hideRightEar:function t(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight"));BX.removeClass(this.getEarRight(),this.parent.settings.get("classShow"))},adjustFixedTablePosition:function t(){var e=this.container.scrollLeft;BX.Grid.Utils.requestAnimationFrame(BX.delegate(function(){this.fixedTable.style.marginLeft=-e+"px"},this))},toggle:function t(){this.adjustEarOffset(true);this.fixedTable&&this.adjustFixedTablePosition();if(this.hasScroll()){this.hasScrollLeft()?this.showLeftEar():this.hideLeftEar();this.hasScrollRight()?this.showRightEar():this.hideRightEar()}else{this.hideLeftEar();this.hideRightEar()}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Updater=function(t){this.parent=t};BX.Grid.Updater.prototype.getParent=function(){return this.parent};BX.Grid.Updater.prototype.updateHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){e=BX.cleanNode(e);t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}})})}};BX.Grid.Updater.prototype.appendHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(BX.clone(t))}})})}};BX.Grid.Updater.prototype.prependHeadRows=function(t){var e;if(BX.type.isArray(t)&&t.length){e=this.getParent().getHeaders();e.forEach(function(e){e=BX.cleanNode(e);t.forEach(function(t){if(BX.type.isDomNode(t)){e.prepend(BX.clone(t))}})})}};BX.Grid.Updater.prototype.updateBodyRowById=function(t,e){if((BX.type.isNumber(t)||BX.type.isNotEmptyString(t))&&BX.type.isDomNode(e)){var i=this.getParent().getRows().getById(t);if(i){var n=i.getNode();BX.insertAfter(e,n);BX.remove(n)}}};BX.Grid.Updater.prototype.updateBodyRows=function(t){if(BX.type.isArray(t)){var e=this.getParent().getBody();e.innerHTML="";t.forEach(function(t){!!t&&e.appendChild(t)})}};BX.Grid.Updater.prototype.appendBodyRows=function(t){var e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};BX.Grid.Updater.prototype.prependBodyRows=function(t){var e;if(BX.type.isArray(t)){e=this.getParent().getBody();t.forEach(function(t){if(BX.type.isDomNode(t)){BX.prepend(e,t)}})}};BX.Grid.Updater.prototype.updateFootRows=function(t){var e;if(BX.type.isArray(t)){e=BX.cleanNode(this.getParent().getFoot());t.forEach(function(t){if(BX.type.isDomNode(t)){e.appendChild(t)}})}};BX.Grid.Updater.prototype.updateCounterTotal=function(t){var e;if(BX.type.isDomNode(t)){e=BX.cleanNode(this.getParent().getCounterTotal());e.appendChild(t)}};BX.Grid.Updater.prototype.updatePagination=function(t){var e=this.getParent().getPagination().getContainer();if(!!e){e.innerHTML="";if(BX.type.isDomNode(t)){e.appendChild(t)}}};BX.Grid.Updater.prototype.updateMoreButton=function(t){if(BX.type.isDomNode(t)){var e=BX.Grid.Utils.closestParent(this.getParent().getMoreButton().getNode());e.innerHTML="";e.appendChild(t)}};BX.Grid.Updater.prototype.updateGroupActions=function(t){var e=this.parent.getActionsPanel();if(!!e&&BX.type.isDomNode(t)){var i=e.getPanel();if(BX.type.isDomNode(i)){i.innerHTML="";var n=BX.firstChild(t);if(BX.type.isDomNode(n)){i.appendChild(n)}}}}})();(function(){BX.Reflection.namespace("BX.Grid");BX.Grid.ImageField=function(t,e){this.parent=t;this.options=e;this.cache=new BX.Cache.MemoryCache};BX.Grid.ImageField.prototype={getPreview:function t(){return this.cache.remember("preview",function(){return BX.create("img",{props:{className:"main-grid-image-editor-preview"},attrs:{src:this.options.VALUE}})}.bind(this))},getFileInput:function t(){return this.cache.remember("fileInput",function(){return BX.create("input",{props:{className:"main-grid-image-editor-file-input"},attrs:{type:"file",accept:"image/*",name:this.options.NAME},events:{change:function(t){var e=new FileReader;e.onload=function(t){this.getPreview().src=t.currentTarget.result}.bind(this);e.readAsDataURL(t.target.files[0]);BX.Dom.remove(this.getFakeField());BX.Dom.append(this.getFileInput(),this.getLayout());BX.Dom.removeClass(this.getRemoveButton(),"ui-btn-disabled");BX.Dom.style(this.getPreview(),null)}.bind(this)}})}.bind(this))},getUploadButton:function t(){return this.cache.remember("uploadButton",function(){return BX.create("button",{props:{className:"ui-btn ui-btn-xs"},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_EDIT"),events:{click:function(t){t.preventDefault();this.getFileInput().click()}.bind(this)}})}.bind(this))},getRemoveButton:function t(){return this.cache.remember("removeButton",function(){return BX.create("button",{props:{className:"ui-btn ui-btn-xs ui-btn-danger"},events:{click:function(t){t.preventDefault();BX.Dom.append(this.getFakeField(),this.getLayout());BX.Dom.remove(this.getFileInput());BX.Dom.addClass(this.getRemoveButton(),"ui-btn-disabled");BX.Dom.style(this.getPreview(),{opacity:.4})}.bind(this)},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_REMOVE")})}.bind(this))},getFakeField:function t(){return this.cache.remember("deleted",function(){return BX.create("input",{props:{className:"main-grid-image-editor-fake-file-input"},attrs:{type:"hidden",name:this.options.NAME,value:"null"}})}.bind(this))},getLayout:function t(){return this.cache.remember("layout",function(){return BX.create("div",{props:{className:"main-grid-image-editor main-grid-editor"},attrs:{name:this.options.NAME},children:[BX.create("div",{props:{className:"main-grid-image-editor-left"},children:[this.getPreview()]}),BX.create("div",{props:{className:"main-grid-image-editor-right"},children:[this.getUploadButton(),this.getRemoveButton()]}),this.getFileInput()]})}.bind(this))}}})();function _templateObject2(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="main-grid-editor main-ui-control main-ui-multi-select"\n\t\t\t\t\tname="','"\n\t\t\t\t\tid="','"\n\t\t\t\t>\n\t\t\t\t\t<span class="main-ui-square-container">','</span>\n\t\t\t\t\t<span class="main-ui-hide main-ui-control-value-delete">\n\t\t\t\t\t\t<span class="main-ui-control-value-delete-item"></span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="main-ui-square-search">\n\t\t\t\t\t\t<input type="text" class="main-ui-square-search-item">\n\t\t\t\t\t</span>\t\n\t\t\t\t</div>\n\t\t\t']);_templateObject2=function e(){return t};return t}function _templateObject(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="main-ui-square">\n\t\t\t\t\t\t\t\t<span class="main-ui-square-item">','</span>\n\t\t\t\t\t\t\t\t<span class="main-ui-item-icon main-ui-square-delete"></span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t']);_templateObject=function e(){return t};return t}(function(){BX.namespace("BX.Grid");BX.Grid.InlineEditor=function(t,e){this.parent=null;this.types=null;this.isDropdownChangeEventSubscribed=false;this.init(t,e)};BX.Grid.InlineEditor.prototype={init:function init(parent,types){this.parent=parent;try{this.types=eval(types)}catch(t){this.types=null}},createContainer:function t(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea:function t(e,i){var n=BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:e.NAME,style:"height:"+i+"px"},html:e.VALUE});return n},createInput:function t(e){var i=this.parent.settings.get("classEditorText");var n={value:e.VALUE!==undefined&&e.VALUE!==null?BX.util.htmlspecialcharsback(e.VALUE):"",name:e.NAME!==undefined&&e.NAME!==null?e.NAME:""};if(e.TYPE===this.types.CHECKBOX){i=this.parent.settings.get("classEditorCheckbox");n.type="checkbox";n.checked=n.value=="Y"}if(e.TYPE===this.types.DATE){i=[i,this.parent.settings.get("classEditorDate")].join(" ")}if(e.TYPE===this.types.NUMBER){i=[i,this.parent.settings.get("classEditorNumber")].join(" ");n.type="number"}if(e.TYPE===this.types.RANGE){i=[i,this.parent.settings.get("classEditorRange")].join(" ");n.type="range";if(BX.type.isPlainObject(e.DATA)){n.min=e.DATA.MIN||"0";n.max=e.DATA.MAX||99999;n.step=e.DATA.STEP||""}}if(BX.type.isNotEmptyString(e.PLACEHOLDER)){n.placeholder=BX.util.htmlspecialchars(e.PLACEHOLDER)}if(e.DISABLED){n.disabled=true}i=[this.parent.settings.get("classEditor"),i].join(" ");return BX.create("input",{props:{className:i,id:e.NAME+"_control"},attrs:n})},createCustom:function t(e){var i=this.parent.settings.get("classEditorCustom");i=[this.parent.settings.get("classEditor"),i].join(" ");return BX.create("div",{props:{className:i},attrs:{"data-name":e.NAME},html:e.VALUE||""})},createMoney:function t(e){var i=e.VALUE;var n=[];var s=i.PRICE||{};s.PLACEHOLDER=e.PLACEHOLDER||"";n.push(this.createMoneyPrice(s));if(BX.type.isArray(e.CURRENCY_LIST)&&e.CURRENCY_LIST.length>0){var a=i.CURRENCY||{};a.DATA={ITEMS:e.CURRENCY_LIST};a.HTML_ENTITY=e.HTML_ENTITY||false;n.push(this.createMoneyCurrency(a))}if(BX.type.isNotEmptyObject(i.HIDDEN)){for(var r in i.HIDDEN){if(i.HIDDEN.hasOwnProperty(r)&&BX.type.isNotEmptyString(r)){var o=this.createInput({NAME:r,VALUE:i["HIDDEN"][r],TYPE:this.types.TEXT});o.type="hidden";n.push(o)}}}var l=this.parent.settings.get("classEditorMoney");l=[this.parent.settings.get("classEditor"),l].join(" ");var d=i.ATTRIBUTES||{};d["data-name"]=e.NAME;return BX.create("div",{props:{className:l},attrs:d,children:n})},createMoneyPrice:function t(e){e.TYPE=this.types.NUMBER;var i=this.createInput(e);i.classList.add("main-grid-editor-money-price");main_core.Event.bind(i,"change",function(t){var e=t.target.parentNode;var i=e.querySelector(".main-grid-editor-money-currency");var n={field:e,values:{price:t.target.value||"",currency:i.dataset.value||""}};main_core_events.EventEmitter.emit("Grid.MoneyField::change",n)});return i},createMoneyCurrency:function t(e){var i=this.createDropdown(e);i.dataset.menuOffsetLeft=15;i.dataset.menuMaxHeight=200;i.classList.add("main-grid-editor-money-currency");if(e.DISABLED===true){i.classList.remove("main-dropdown");i.dataset.disabled=true}if(!this.isDropdownChangeEventSubscribed){this.isDropdownChangeEventSubscribed=true;main_core_events.EventEmitter.subscribe("Dropdown::change",function(t){var e=t.getData(),i=babelHelpers.slicedToArray(e,1),n=i[0];if(!BX.type.isNotEmptyString(n)){return}var s=BX.Main.dropdownManager.getById(n);if(s.dropdown&&s.dropdown.classList.contains("main-grid-editor-money-currency")){var a=s.dropdown.parentNode;var r=a.querySelector(".main-grid-editor-money-price");var o={field:a,values:{price:r.value||"",currency:s.dropdown.dataset.value||""}};main_core_events.EventEmitter.emit("Grid.MoneyField::change",o)}})}return i},createOutput:function t(e){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{for:e.NAME+"_control"},text:e.VALUE||""})},getDropdownValueItemByValue:function t(e,i){var n=e.filter(function(t){return t.VALUE===i});return n.length>0?n[0]:e[0]},createDropdown:function t(e){var i=this.getDropdownValueItemByValue(e.DATA.ITEMS,e.VALUE);var n="HTML_ENTITY"in e&&e.HTML_ENTITY===true;return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:e.NAME+"_control"},attrs:{name:e.NAME,tabindex:"0","data-items":JSON.stringify(e.DATA.ITEMS),"data-value":i.VALUE,"data-html-entity":e.HTML_ENTITY},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:n?i.NAME:null,text:n?null:i.NAME})]})},createMultiselect:function t(e){var i=this;var n=[];var s=function(){if(BX.Type.isArrayFilled(e.VALUE)){return e.VALUE.map(function(t){var s;var a=i.getDropdownValueItemByValue(e.DATA.ITEMS,t);n.push(a);var r=(s=a.HTML)!==null&&s!==void 0?s:BX.util.htmlspecialchars(a.NAME);var o=BX.Tag.render(_templateObject(),r);BX.Dom.attr(o,"data-item",a);return o})}return[]}();var a=BX.Tag.render(_templateObject2(),BX.Text.encode(e.NAME),"".concat(BX.Text.encode(e.NAME),"_control"),s);BX.Dom.attr(a,{"data-params":{isMulti:true},"data-items":e.DATA.ITEMS,"data-value":n});return a},validateEditObject:function t(e){return BX.type.isPlainObject(e)&&"TYPE"in e&&"NAME"in e&&"VALUE"in e&&(!("items"in e)||BX.type.isArray(e.items)&&e.items.length)},initCalendar:function t(e){BX.calendar({node:e.target,field:e.target})},bindOnRangeChange:function t(e,i){function n(t,e){BX.html(e,t.value);var i=parseFloat(t.value);var n=parseFloat(t.getAttribute("max"));var s=parseFloat(t.getAttribute("min"));var a=16;var r=n-s;var o=(i-s)/r*100;var l=Math.round(a*o/100)-a/2;e.style.left=o+"%";e.style.marginLeft=-l+"px"}setTimeout(function(){n(e,i)},0);BX.bind(e,"input",function(){n(e,i)})},createImageEditor:function t(e){return new BX.Grid.ImageField(this.parent,e).getLayout()},getEditor:function t(e,i){var n,s;var a=this.createContainer();if(this.validateEditObject(e)){e.VALUE=e.VALUE===null?"":e.VALUE;switch(e.TYPE){case this.types.TEXT:{n=this.createInput(e);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DATE:{n=this.createInput(e);BX.bind(n,"click",this.initCalendar);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.NUMBER:{n=this.createInput(e);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.RANGE:{n=this.createInput(e);s=this.createOutput(e);this.bindOnRangeChange(n,s);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CHECKBOX:{n=this.createInput(e);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.TEXTAREA:{n=this.createTextarea(e,i);BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DROPDOWN:{n=this.createDropdown(e);break}case this.types.MULTISELECT:{n=this.createMultiselect(e);break}case this.types.IMAGE:{n=this.createImageEditor(e);break}case this.types.MONEY:{n=this.createMoney(e);BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CUSTOM:{n=this.createCustom(e);requestAnimationFrame(function(){var t=e.HTML||e.VALUE||null;if(t){var i=BX.processHTML(t);i.SCRIPT.forEach(function(t){if(t.isInternal&&t.JS){BX.evalGlobal(t.JS)}})}});BX.bind(n,"click",function(t){t.stopPropagation()});BX.bind(n,"keydown",BX.delegate(this._onControlKeydown,this));break}default:{break}}}if(BX.type.isDomNode(s)){a.appendChild(s)}if(BX.type.isDomNode(n)){a.appendChild(n)}return a},_onControlKeydown:function t(e){if(e.code==="Enter"){e.preventDefault();var i=BX.Grid.Utils.getBySelector(this.parent.getContainer(),"#grid_save_button > button",true);if(i){BX.fireEvent(i,"click")}}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Loader=function(t){this.parent=null;this.container=null;this.windowHeight=null;this.tbodyPos=null;this.headerPos=null;this.lastPosTop=null;this.lastBottomPos=null;this.table=null;this.loader=null;this.adjustLoaderOffset=this.adjustLoaderOffset.bind(this);this.init(t)};BX.Grid.Loader.prototype={init:function t(e){this.parent=e;this.table=this.parent.getTable();this.loader=new BX.Loader({target:this.getContainer()})},adjustLoaderOffset:function t(){this.windowHeight=BX.height(window);this.tbodyPos=BX.pos(this.table.tBodies[0]);this.headerPos=BX.pos(this.table.tHead);var e=window.scrollY;if(this.parent.isIE()){e=document.documentElement.scrollTop}var i=e+this.windowHeight-this.tbodyPos.top;var n=e-this.tbodyPos.top;if(i>this.tbodyPos.bottom-this.tbodyPos.top){i=this.tbodyPos.bottom-this.tbodyPos.top}if(n<this.headerPos.height){n=this.headerPos.height}else{i-=n;i+=this.headerPos.height}requestAnimationFrame(function(){if(n!==this.lastPosTop){this.getContainer().style.transform="translate3d(0px, "+n+"px, 0)"}if(i!==this.lastBottomPos){this.getContainer().style.height=i+"px"}this.lastPosTop=n;this.lastBottomPos=i}.bind(this))},getContainer:function t(){if(!this.container){this.container=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classLoader"),true)}return this.container},show:function t(){if(!this.loader.isShown()){this.adjustLoaderOffset();this.getContainer().style.display="block";this.getContainer().style.opacity="1";this.getContainer().style.visibility="visible";var e=this.parent.getRows().getCountDisplayed();if(e>0&&e<=2){this.loader.setOptions({size:60});this.loader.show()}else{this.loader.setOptions({size:110});this.loader.show()}}},hide:function t(){if(this.loader.isShown()){this.adjustLoaderOffset();this.loader.hide().then(function(){this.getContainer().style.display="none"}.bind(this))}}}})();(function(){BX.namespace("BX.Main");if(BX.Main.gridManager){return}BX.Main.gridManager={data:[],push:function t(e,i){if(BX.type.isNotEmptyString(e)&&i){var n={id:e,instance:i,old:null};if(this.getById(e)===null){this.data.push(n)}else{this.data[0]=n}}},getById:function t(e){var i=this.data.filter(function(t){return t.id===e||t.id.replace("main_grid_","")===e});return i.length===1?i[0]:null},getInstanceById:function t(e){var i=this.getById(e);return BX.type.isPlainObject(i)?i["instance"]:null},reload:function t(e,i){var n=this.getInstanceById(e);if(n){n.reload(i)}},getDataIndex:function t(e){var i=null;this.data.forEach(function(t,n){if(t.id===e){i=n}});return i},destroy:function t(e){if(BX.type.isNotEmptyString(e)){var i=this.getInstanceById(e);if(i instanceof BX.Main.grid){i.destroy();var n=this.getDataIndex(e);if(n!==null){delete this.data[n]}}}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Message=function(t,e){this.parent=null;this.types=null;this.messages=null;this.popup=null;this.init(t,e)};BX.Grid.Message.prototype={init:function t(e,i){this.parent=e;this.types=i;this.show();BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onUpdated,this))},onUpdated:function t(){this.show()},getData:function t(){return this.parent.arParams.MESSAGES},isNeedShow:function t(){return this.getData().length>0},show:function t(){if(this.isNeedShow()){this.getPopup().setContent(this.getContent());this.getPopup().show()}},getContent:function t(){var e=this.getData();var i=null;if(BX.type.isArray(e)&&e.length){var n={block:"main-grid-messages",content:[]};e.forEach(function(t){var e={block:"main-grid-message",mix:"main-grid-message-"+t.TYPE.toLowerCase(),content:[]};if(BX.type.isNotEmptyString(t.TITLE)){e.content.push({block:"main-grid-message-title",content:BX.create("div",{html:t.TITLE}).innerText})}if(BX.type.isNotEmptyString(t.TEXT)){e.content.push({block:"main-grid-message-text",content:BX.create("div",{html:t.TEXT}).innerText})}n.content.push(e)});i=BX.decl(n)}return i},getPopup:function t(){if(this.popup===null){this.popup=new BX.PopupWindow(this.getPopupId(),null,{autoHide:true,overlay:.3,width:400,contentNoPaddings:true,closeByEsc:true,buttons:[new BX.PopupWindowButton({text:this.parent.getParam("CLOSE"),className:"webform-small-button-blue webform-small-button",events:{click:function t(){this.popupWindow.close()}}})]})}return this.popup},getPopupId:function t(){return this.parent.getContainerId()+"-main-grid-message"}}})();(function(){BX.namespace("BX.Grid");BX.Grid.observer={handlers:[],add:function t(e,i,n,s){BX.bind(e,i,s?BX.proxy(n,s):n)}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Pagesize=function(t){this.parent=null;this.init(t)};BX.Grid.Pagesize.prototype={init:function t(e){this.parent=e;BX.addCustomEvent("Dropdown::change",BX.delegate(this.onChange,this))},onChange:function t(e,i,n,s,a){var r=this;if(e===this.parent.getContainerId()+"_"+this.parent.settings.get("pageSizeId")){if(a>=0){this.parent.tableFade();this.parent.getUserOptions().setPageSize(a,function(){r.parent.reloadTable();BX.onCustomEvent(r.parent.getContainer(),"Grid::pageSizeChanged",[r.parent])})}}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Pagination=function(t){this.parent=null;this.container=null;this.links=null;this.init(t)};BX.Grid.Pagination.prototype={init:function t(e){this.parent=e},getParent:function t(){return this.parent},getContainer:function t(){if(!this.container){this.container=BX.Grid.Utils.getByClass(this.getParent().getContainer(),this.getParent().settings.get("classPagination"),true)}return this.container},getLinks:function t(){var e=this;var i=BX.Grid.Utils.getByTag(this.getContainer(),"a");this.links=[];if(i){this.links=i.map(function(t){return new BX.Grid.Element(t,e.getParent())})}return this.links},getLink:function t(e){var i=null;var n;if(BX.type.isDomNode(e)){n=this.getLinks().filter(function(t){return e===t.getNode()});if(n.length){i=n[0]}}return i}}})();(function(){BX.namespace("BX.Grid");BX.Grid.PinHeader=function(t){this.parent=null;this.table=null;this.header=null;this.container=null;this.parentNodeResizeObserver=null;var e=this.getAdminPanel();if(e){this.mo=new MutationObserver(this.onAdminPanelMutation.bind(this));this.mo.observe(document.documentElement,{attributes:true})}this.init(t)};BX.Grid.PinHeader.prototype={init:function t(e){this.parent=e;this.rect=BX.pos(this.parent.getHead());this.gridRect=BX.pos(this.parent.getTable());var i=BX.Grid.Utils.getBySelector(document,"#workarea-content",true);if(!i){i=this.parent.getContainer().parentNode;i=!!i?i.parentNode:i}if(!!i){this.parentNodeResizeObserver=new BX.ResizeObserver(BX.proxy(this.refreshRect,this));this.parentNodeResizeObserver.observe(i)}this.create(true);document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}));document.addEventListener("resize",BX.proxy(this._onResize,this),BX.Grid.Utils.listenerParams({passive:true}));BX.addCustomEvent("Grid::updated",BX.proxy(this._onGridUpdate,this));BX.addCustomEvent("Grid::resize",BX.proxy(this._onGridUpdate,this));BX.bind(window,"resize",BX.proxy(this._onGridUpdate,this))},refreshRect:function t(){this.gridRect=BX.pos(this.parent.getTable());this.rect=BX.pos(this.parent.getHead())},_onGridUpdate:function t(){var e=this.isPinned();BX.remove(this.getContainer());this.create();e&&this.pin();this.table=null;this.refreshRect();this._onScroll();BX.onCustomEvent(window,"Grid::headerUpdated",[])},create:function t(e){var i=BX.Grid.Utils.getByTag(this.parent.getHead(),"th");var n=BX.clone(this.parent.getHead());var s=BX.Grid.Utils.getByTag(n,"th");var a=function t(){i.forEach(function(t,e){var n=BX.width(t);if(e>0){n-=parseInt(BX.style(t,"border-left-width"));n-=parseInt(BX.style(t,"border-right-width"))}s[e].firstElementChild&&(s[e].firstElementChild.style.width=n+"px");if(i.length-1>e){s[e].style.width=n+"px"}})};e?setTimeout(a,0):a();this.container=BX.decl({block:"main-grid-fixed-bar",mix:"main-grid-fixed-top",attrs:{style:"width: "+BX.width(this.parent.getContainer())+"px"},content:{block:"main-grid-table",tag:"table",content:n}});this.container.hidden=true;this.parent.getWrapper().appendChild(this.container)},getContainer:function t(){return this.container},getFixedTable:function t(){return this.table||(this.table=BX.Grid.Utils.getByTag(this.getContainer(),"table",true))},getAdminPanel:function t(){if(!this.adminPanel){this.adminPanel=document.querySelector(".adm-header")}return this.adminPanel},isAdminPanelPinned:function t(){return BX.hasClass(document.documentElement,"adm-header-fixed")},getPinOffset:function t(){var e=this.getAdminPanel();if(e&&this.isAdminPanelPinned()){return BX.Text.toNumber(BX.style(e,"height"))}return 0},pin:function t(){var e=this.getContainer();if(e){e.hidden=false}BX.onCustomEvent(window,"Grid::headerPinned",[])},unpin:function t(){var e=this.getContainer();if(e){e.hidden=true}BX.onCustomEvent(window,"Grid::headerUnpinned",[])},stopPin:function t(){BX.Grid.Utils.styleForEach([this.getContainer()],{position:"absolute",top:this.gridRect.bottom-this.rect.height-this.gridRect.top+"px","box-shadow":"none"})},startPin:function t(){BX.Grid.Utils.styleForEach([this.getContainer()],{position:"fixed",top:this.getPinOffset()+"px","box-shadow":""})},isPinned:function t(){return!this.getContainer().hidden},_onScroll:function t(){var e=0;if(this.scrollRect){e=this.scrollRect.scrollTop}else{if(document.scrollingElement){this.scrollRect=document.scrollingElement}else{if(document.documentElement.scrollTop>0){this.scrollRect=document.documentElement}else if(document.body.scrollTop>0){this.scrollRect=document.body}}}if(this.gridRect.bottom>e+this.rect.height){this.startPin();var i=this.getPinOffset();if(this.rect.top-i<=e){!this.isPinned()&&this.pin()}else{this.isPinned()&&this.unpin()}}else{this.stopPin()}},onAdminPanelMutation:function t(){this._onScroll()},_onResize:function t(){this.rect=BX.pos(this.parent.getHead())}}})();(function(){BX.namespace("BX.Grid");BX.Grid.PinPanel=function(t){this.parent=null;this.panel=null;this.isSelected=null;this.offset=null;this.animationDuration=null;this.pinned=false;this.init(t)};BX.Grid.PinPanel.prototype={init:function t(e){this.parent=e;this.offset=10;this.animationDuration=200;this.panel=this.getPanel();this.bindOnRowsEvents()},bindOnRowsEvents:function t(){BX.addCustomEvent("Grid::thereSelectedRows",BX.delegate(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::allRowsSelected",BX.delegate(this._onThereSelectedRows,this));BX.addCustomEvent("Grid::noSelectedRows",BX.delegate(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::allRowsUnselected",BX.delegate(this._onNoSelectedRows,this));BX.addCustomEvent("Grid::updated",BX.delegate(this._onNoSelectedRows,this))},bindOnWindowEvents:function t(){BX.bind(window,"resize",BX.proxy(this._onResize,this));document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}))},unbindOnWindowEvents:function t(){BX.unbind(window,"resize",BX.proxy(this._onResize,this));document.removeEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:true}))},getPanel:function t(){this.panel=this.panel||this.parent.getActionsPanel().getPanel();return this.panel},getScrollBottom:function t(){return BX.scrollTop(window)+this.getWindowHeight()},getPanelRect:function t(){if(!BX.type.isPlainObject(this.panelRect)){this.panelRect=BX.pos(this.getPanel())}return this.panelRect},getPanelPrevBottom:function t(){var e=BX.previousSibling(this.getPanel());return BX.pos(e).bottom+parseFloat(BX.style(e,"margin-bottom"))},getWindowHeight:function t(){this.windowHeight=this.windowHeight||BX.height(window);return this.windowHeight},pinPanel:function t(e){var i=this.getPanel();var n=BX.width(this.getPanel().parentNode);var s=BX.height(this.getPanel().parentNode);var a=BX.pos(this.parent.getBody());var r=this.getStartDiffPanelPosition();i.parentNode.style.setProperty("height",s+"px");i.style.setProperty("transform","translateY("+r+"px)");i.classList.add("main-grid-fixed-bottom");i.style.setProperty("width",n+"px");i.style.removeProperty("position");i.style.removeProperty("top");requestAnimationFrame(function(){if(e!==false){i.style.setProperty("transition","transform 200ms ease")}i.style.setProperty("transform","translateY(0)")});if(this.isNeedPinAbsolute()&&!this.absolutePin){this.absolutePin=true;i.style.removeProperty("transition");i.style.setProperty("position","absolute");i.style.setProperty("top",a.top+"px")}if(!this.isNeedPinAbsolute()&&this.absolutePin){this.absolutePin=false}this.adjustPanelPosition();this.pinned=true},unpinPanel:function t(e){var i=this.getPanel();var n=BX.pos(i);var s=BX.pos(i.parentNode);var a=Math.abs(n.bottom-s.bottom);if(e!==false){i.style.setProperty("transition","transform 200ms ease")}var r=a<n.height?a+"px":"100%";i.style.setProperty("transform","translateY("+r+")");var o=function t(i,n){if(e!==false){return setTimeout(i,n)}i()};o(function(){i.parentNode.style.removeProperty("height");i.classList.remove("main-grid-fixed-bottom");i.style.removeProperty("transition");i.style.removeProperty("transform");i.style.removeProperty("width");i.style.removeProperty("position");i.style.removeProperty("top")},e!==false?200:0);this.pinned=false},isSelectedRows:function t(){return this.isSelected},isNeedPinAbsolute:function t(){return BX.pos(this.parent.getBody()).top+this.getPanelRect().height>=this.getScrollBottom()},isNeedPin:function t(){return this.getScrollBottom()-this.getPanelRect().height<=this.getPanelPrevBottom()},adjustPanelPosition:function t(){var e=window.pageXOffset;this.lastScrollX=this.lastScrollX!==null?this.lastScrollX:e;BX.Grid.Utils.requestAnimationFrame(BX.proxy(function(){if(e!==this.lastScrollX){var t=this.getPanelRect();BX.style(this.getPanel(),"left",t.left-e+"px")}},this));this.lastScrollX=e},pinController:function t(e){if(this.getPanel()){if(!this.isPinned()&&this.isNeedPin()&&this.isSelectedRows()){return this.pinPanel(e)}if(this.isPinned()&&!this.isNeedPin()||!this.isSelectedRows()){this.unpinPanel(e)}}},getEndDiffPanelPosition:function t(){var e=BX.pos(this.getPanel());var i=BX.pos(BX.previousSibling(this.getPanel()));var n=BX.scrollTop(window);var s=n+BX.height(window);var a=e.height+this.offset;var r=i.bottom+parseFloat(BX.style(this.getPanel(),"margin-top"));if(r<s&&r+e.height>s){a=Math.abs(s-(r+e.height))}return a},getStartDiffPanelPosition:function t(){var e=BX.pos(this.getPanel());var i=BX.scrollTop(window);var n=i+BX.height(window);var s=e.height;if(e.bottom>n&&e.top<n){s=e.bottom-n}return s},isPinned:function t(){return this.pinned},_onThereSelectedRows:function t(){this.bindOnWindowEvents();this.isSelected=true;if(this.lastIsSelected){this.pinController()}else{this.lastIsSelected=true;this.pinController()}},_onNoSelectedRows:function t(){this.unbindOnWindowEvents();this.isSelected=false;this.pinController();this.lastIsSelected=false},_onScroll:function t(){this.pinController(false)},_onResize:function t(){this.windowHeight=BX.height(window);this.panel=this.parent.getActionsPanel().getPanel();this.panelRect=this.getPanel().getBoundingClientRect();this.pinController(false)}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Resize=function(t){this.parent=null;this.lastRegisterButtons=null;this.init(t)};BX.Grid.Resize.prototype={init:function t(e){this.parent=e;BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this));BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this));this.registerTableButtons();this.registerPinnedTableButtons()},destroy:function t(){BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this));BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this));BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.forEach(jsDD.unregisterObject);(this.getButtons()||[]).forEach(jsDD.unregisterObject)},registerTableButtons:function t(){(this.getButtons()||[]).forEach(this.register,this);this.registerPinnedTableButtons()},register:function t(e){if(BX.type.isDomNode(e)){e.onbxdragstart=BX.delegate(this._onDragStart,this);e.onbxdragstop=BX.delegate(this._onDragEnd,this);e.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(e)}},registerPinnedTableButtons:function t(){if(this.parent.getParam("ALLOW_PIN_HEADER")){var e=this.getPinnedTableButtons();if(BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.length){this.lastRegisterButtons.forEach(jsDD.unregisterObject)}this.lastRegisterButtons=e;(this.getPinnedTableButtons()||[]).forEach(this.register,this)}},getButtons:function t(){return BX.Grid.Utils.getByClass(this.parent.getRows().getHeadFirstChild().getNode(),this.parent.settings.get("classResizeButton"))},getPinnedTableButtons:function t(){return BX.Grid.Utils.getByClass(this.parent.getPinHeader().getFixedTable(),this.parent.settings.get("classResizeButton"))},_onDragStart:function t(){var e=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")});var i=this.parent.getRows().getHeadFirstChild().getCells();var n=Object.keys(i);var s;this.__overlay=BX.create("div",{props:{className:"main-grid-cell-overlay"}});BX.append(this.__overlay,e);this.__resizeCell=e.cellIndex;n.forEach(function(t){if(!BX.hasClass(i[t],"main-grid-special-empty")){var e=BX.width(i[t]);if(t>0){e-=parseInt(BX.style(i[t],"border-left-width"));e-=parseInt(BX.style(i[t],"border-right-width"))}BX.width(i[t],e);s=BX.firstChild(i[t]);BX.width(s,e)}})},_onDrag:function t(e){var i=this.parent.getTable();var n=this.parent.getParam("ALLOW_PIN_HEADER")?this.parent.getPinHeader().getFixedTable():null;var s=i.rows[0].cells[this.__resizeCell];var a,r;var o=BX.pos(s);var l=parseFloat(s.style.width);var d;e-=o.left;d=e;if(o.width>l){e=o.width}e=d>e?d:e;e=Math.max(e,80);if(e!==o.width){var c=this.parent.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length;var h=this.parent.getColumnByIndex(this.__resizeCell-c);h.forEach(function(t){t.style.width=e+"px";t.style.minWidth=e+"px";t.style.maxWidth=e+"px";BX.Dom.style(t.firstElementChild,"width",e+"px")});if(h[0].classList.contains("main-grid-fixed-column")){h=this.parent.getColumnByIndex(this.__resizeCell-c+1);h.forEach(function(t){t.style.width=e+"px";t.style.minWidth=e+"px";t.style.maxWidth=e+"px"})}this.parent.adjustFixedColumnsPosition();this.parent.adjustFadePosition(this.parent.getFadeOffset());if(BX.type.isDomNode(n)&&BX.type.isDomNode(n.rows[0])){a=n.rows[0].cells[this.__resizeCell];r=BX.firstChild(a);r.style.width=e+"px";r.style.minWidth=e+"px";a.style.width=e+"px";a.style.minWidth=e+"px"}}BX.onCustomEvent(window,"Grid::columnResize",[])},_onDragEnd:function t(){this.saveSizes();var e=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")});var i=e.querySelector(".main-grid-cell-overlay");if(i){BX.Dom.remove(i)}},getColumnSizes:function t(){var e=this.parent.getRows().getHeadFirstChild().getCells();var i={};var n;[].forEach.call(e,function(t){n=BX.data(t,"name");if(BX.type.isNotEmptyString(n)){i[n]=BX.width(t)}},this);return i},saveSizes:function t(){this.parent.getUserOptions().setColumnSizes(this.getColumnSizes(),1)}}})();function _templateObject15(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-counter-inner"></span>\n\t\t\t\t\t\t\t']);_templateObject15=function e(){return t};return t}function _templateObject14(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-counter"></span>\n\t\t\t\t\t\t\t']);_templateObject14=function e(){return t};return t}function _templateObject13(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="main-grid-cell-counter"></span>\n\t\t\t\t\t\t\t']);_templateObject13=function e(){return t};return t}function _templateObject12(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t<span class="main-grid-cell-content-action ','"></span>\n\t\t\t\t\t\t\t\t']);_templateObject12=function e(){return t};return t}function _templateObject11(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div class="main-grid-cell-content-actions"></div>\n\t\t\t\t\t\t\t']);_templateObject11=function e(){return t};return t}function _templateObject10(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="main-grid-tag-add"></span>\n\t\t\t\t\t\t']);_templateObject10=function e(){return t};return t}function _templateObject9(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="main-grid-tags">',"</span>\n\t\t\t\t\t\t"]);_templateObject9=function e(){return t};return t}function _templateObject8(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t<span class="main-grid-tag-remove"></span>\n\t\t\t\t\t\t\t\t']);_templateObject8=function e(){return t};return t}function _templateObject7(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="main-grid-tag-inner">',"</span>\n\t\t\t\t\t\t\t"]);_templateObject7=function e(){return t};return t}function _templateObject6(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="main-grid-tag"></span>\n\t\t\t\t\t\t\t']);_templateObject6=function e(){return t};return t}function _templateObject5(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="main-grid-labels">',"</div>\n\t\t\t\t\t\t"]);_templateObject5=function e(){return t};return t}function _templateObject4(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t<span class="main-grid-label-remove-button ','"></span>\t\n\t\t\t\t\t\t\t\t\t']);_templateObject4=function e(){return t};return t}function _templateObject3(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t\t<span class="ui-label-icon"></span>\t\n\t\t\t\t\t\t\t\t\t\t']);_templateObject3=function e(){return t};return t}function _templateObject2$1(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t\t\t\t"]);_templateObject2$1=function e(){return t};return t}function _templateObject$1(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-label ','"></span>\n\t\t\t\t\t\t\t']);_templateObject$1=function e(){return t};return t}(function(){BX.namespace("BX.Grid");BX.Grid.Row=function(t,e){this.node=null;this.checkbox=null;this.sort=null;this.actions=null;this.settings=null;this.index=null;this.actionsButton=null;this.parent=null;this.depth=null;this.parentId=null;this.editData=null;this.custom=null;this.onElementClick=this.onElementClick.bind(this);this.init(t,e);this.initElementsEvents()};BX.Grid.Row.prototype={init:function t(e,i){if(BX.type.isDomNode(i)){this.node=i;this.parent=e;this.settings=new BX.Grid.Settings;this.bindNodes=[];if(this.isBodyChild()){this.bindNodes=[].slice.call(this.node.parentNode.querySelectorAll('tr[data-bind="'+this.getId()+'"]'));if(this.bindNodes.length){this.node.addEventListener("mouseover",this.onMouseOver.bind(this));this.node.addEventListener("mouseleave",this.onMouseLeave.bind(this));this.bindNodes.forEach(function(t){t.addEventListener("mouseover",this.onMouseOver.bind(this));t.addEventListener("mouseleave",this.onMouseLeave.bind(this));t.addEventListener("click",function(){if(this.isSelected()){this.unselect()}else{this.select()}}.bind(this))},this)}}if(this.parent.getParam("ALLOW_CONTEXT_MENU")){BX.bind(this.getNode(),"contextmenu",BX.delegate(this._onRightClick,this))}}},onMouseOver:function t(){this.node.classList.add("main-grid-row-over");this.bindNodes.forEach(function(t){t.classList.add("main-grid-row-over")})},onMouseLeave:function t(){this.node.classList.remove("main-grid-row-over");this.bindNodes.forEach(function(t){t.classList.remove("main-grid-row-over")})},isCustom:function t(){if(this.custom===null){this.custom=BX.hasClass(this.getNode(),this.parent.settings.get("classRowCustom"))}return this.custom},_onRightClick:function t(e){e.preventDefault();this.showActionsMenu(e)},getDefaultAction:function t(){return BX.data(this.getNode(),"default-action")},getEditorValue:function t(){var e=this;var i=this.getCells();var n={};var s;[].forEach.call(i,function(t){s=e.getCellEditorValue(t);if(BX.type.isArray(s)){s.forEach(function(t){n[t.NAME]=t.VALUE!==undefined?t.VALUE:"";if(t.hasOwnProperty("RAW_NAME")&&t.hasOwnProperty("RAW_VALUE")){n[t.NAME+"_custom"]=n[t.NAME+"_custom"]||{};n[t.NAME+"_custom"][t.RAW_NAME]=n[t.NAME+"_custom"][t.RAW_NAME]||t.RAW_VALUE}})}else if(s){n[s.NAME]=s.VALUE!==undefined?s.VALUE:""}});return n},editGetValues:function t(){return this.getEditorValue()},getCellEditorValue:function t(e){var i=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classEditor"),true);var n=null;if(BX.type.isDomNode(i)){if(BX.hasClass(i,"main-grid-editor-checkbox")){n={NAME:i.getAttribute("name"),VALUE:i.checked?"Y":"N"}}else if(BX.hasClass(i,"main-grid-editor-custom")){n=this.getCustomValue(i)}else if(BX.hasClass(i,"main-grid-editor-money")){n=this.getMoneyValue(i)}else if(BX.hasClass(i,"main-ui-multi-select")){n=this.getMultiSelectValues(i)}else{n=this.getImageValue(i)}}return n},isEdit:function t(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},hide:function t(){BX.addClass(this.getNode(),this.parent.settings.get("classHide"))},show:function t(){BX.Dom.attr(this.getNode(),"hidden",null);BX.removeClass(this.getNode(),this.parent.settings.get("classHide"))},isShown:function t(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classHide"))},isNotCount:function t(){return BX.hasClass(this.getNode(),this.parent.settings.get("classNotCount"))},getContentContainer:function t(e){if(BX.Type.isDomNode(e)){var i=e.closest(".main-grid-cell");if(BX.Type.isDomNode(i)){return i.querySelector(".main-grid-cell-content")}}return e},getContent:function t(e){var i=this.getContentContainer(e);var n;if(BX.type.isDomNode(i)){n=BX.html(i)}return n},getMoneyValue:function t(e){var i=[];var n={PRICE:{},CURRENCY:{},HIDDEN:{}};var s=e.getAttribute("data-name");var a=[].slice.call(e.querySelectorAll("input"));a.forEach(function(t){i.push({NAME:s,RAW_NAME:t.name,RAW_VALUE:t.value||"",VALUE:t.value||""});if(t.classList.contains("main-grid-editor-money-price")){n.PRICE={NAME:t.name,VALUE:t.value}}else if(t.type===" hidden"){n.HIDDEN[t.name]=t.value}});var r=e.querySelector(".main-grid-editor-dropdown");if(r){var o=r.getAttribute("name");if(BX.type.isNotEmptyString(o)){i.push({NAME:s,RAW_NAME:o,RAW_VALUE:r.dataset.value||"",VALUE:r.dataset.value||""});n.CURRENCY={NAME:o,VALUE:r.dataset.value}}}i.push({NAME:s,VALUE:n});return i},getCustomValue:function t(e){var i=new Map,n=e.getAttribute("data-name");var s=[].slice.call(e.querySelectorAll("input, select, checkbox, textarea"));s.forEach(function(t){var e={NAME:n,RAW_NAME:t.name,RAW_VALUE:t.value,VALUE:t.value};switch(t.tagName){case"SELECT":if(t.multiple){var s=[];t.querySelectorAll("option").forEach(function(t){if(t.selected){s.push(t.value)}});e["RAW_VALUE"]=s;e["VALUE"]=s;i.set(t.name,e)}else{i.set(t.name,e)}break;case"INPUT":switch(t.type.toUpperCase()){case"RADIO":if(t.checked){e["RAW_VALUE"]=t.value;e["VALUE"]=t.value;i.set(t.name,e)}break;case"CHECKBOX":e["RAW_VALUE"]=t.checked?t.value:"";e["VALUE"]=t.checked?t.value:"";i.set(t.name,e);break;case"FILE":e["RAW_VALUE"]=t.files[0];e["VALUE"]=t.files[0];i.set(t.name,e);break;default:i.set(t.name,e)}break;default:i.set(t.name,e)}});var a=[];i.forEach(function(t){a.push(t)});return a},getImageValue:function t(e){var i=null;if(BX.hasClass(e,"main-grid-image-editor")){var n=e.querySelector(".main-grid-image-editor-file-input");if(n){i={NAME:n.name,VALUE:n.files[0]}}else{var s=e.querySelector(".main-grid-image-editor-fake-file-input");if(s){i={NAME:s.name,VALUE:s.value}}}}else if(e.value){i={NAME:e.getAttribute("name"),VALUE:e.value}}else{i={NAME:e.getAttribute("name"),VALUE:BX.data(e,"value")}}return i},getMultiSelectValues:function t(e){var i=JSON.parse(BX.data(e,"value"));return{NAME:e.getAttribute("name"),VALUE:main_core.Type.isArrayFilled(i)?i:""}},getEditorContainer:function t(e){return BX.Grid.Utils.getByClass(e,this.parent.settings.get("classEditorContainer"),true)},getCollapseButton:function t(){if(!this.collapseButton){this.collapseButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classCollapseButton"),true)}return this.collapseButton},stateLoad:function t(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateUnload:function t(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateExpand:function t(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},stateCollapse:function t(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},getParentId:function t(){if(this.parentId===null){this.parentId=BX.data(this.getNode(),"parent-id");if(typeof this.parentId!=="undefined"&&this.parentId!==null){this.parentId=this.parentId.toString()}}return this.parentId},getDataset:function t(){return this.getNode().dataset},getDepth:function t(){if(this.depth===null){this.depth=BX.data(this.getNode(),"depth")}return this.depth},setDepth:function t(e){e=parseInt(e);if(BX.type.isNumber(e)){var i=e-parseInt(this.getDepth());var n=this.parent.getRows();this.getDataset().depth=e;this.getShiftCells().forEach(function(t){BX.data(t,"depth",e);BX.style(t,"padding-left",e*20+"px")},this);n.getRowsByParentId(this.getId(),true).forEach(function(t){var e=parseInt(i)+parseInt(t.getDepth());t.getDataset().depth=e;t.getShiftCells().forEach(function(t){BX.data(t,"depth",e);BX.style(t,"padding-left",e*20+"px")})})}},setParentId:function t(e){this.getDataset()["parentId"]=e},getShiftCells:function t(){return BX.Grid.Utils.getBySelector(this.getNode(),'td[data-shift="true"]')},showChildRows:function t(){var e=this.getChildren();var i=this.isCustom();e.forEach(function(t){t.show();if(!i&&t.isExpand()){t.showChildRows()}});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},getChildren:function t(){var e=this.isCustom()?"getRowsByGroupId":"getRowsByParentId";var i=this.isCustom()?this.getGroupId():this.getId();return this.parent.getRows()[e](i,true)},hideChildRows:function t(){var e=this.getChildren();e.forEach(function(t){t.hide()});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},isChildsLoaded:function t(){if(!BX.type.isBoolean(this.childsLoaded)){this.childsLoaded=this.isCustom()||BX.data(this.getNode(),"child-loaded")==="true"}return this.childsLoaded},expand:function t(){var e=this;this.stateExpand();if(this.isChildsLoaded()){this.showChildRows()}else{this.stateLoad();this.loadChildRows(function(t){t.reverse().forEach(function(t){BX.insertAfter(t,e.getNode())});e.parent.getRows().reset();e.parent.bindOnRowEvents();if(e.parent.getParam("ALLOW_ROWS_SORT")){e.parent.getRowsSortable().reinit()}if(e.parent.getParam("ALLOW_COLUMNS_SORT")){e.parent.getColsSortable().reinit()}e.stateUnload();BX.data(e.getNode(),"child-loaded","true");e.parent.updateCounterDisplayed();e.parent.updateCounterSelected();e.parent.adjustCheckAllCheckboxes()})}},collapse:function t(){this.stateCollapse();this.hideChildRows()},isExpand:function t(){return BX.hasClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},toggleChildRows:function t(){if(!this.isExpand()){this.expand()}else{this.collapse()}},loadChildRows:function t(e){if(BX.type.isFunction(e)){var i=this;var n=parseInt(this.getDepth());var s=this.parent.getUserOptions().getAction("GRID_GET_CHILD_ROWS");n=BX.type.isNumber(n)?n+1:1;this.parent.getData().request("","POST",{action:s,parent_id:this.getId(),depth:n},null,function(){var t=this.getRowsByParentId(i.getId());e.apply(null,[t])})}},update:function t(e,i,n){e=!!e?e:"";var s=this.parent.getUserOptions().getAction("GRID_UPDATE_ROW");var a=this.getDepth();var r=this.getId();var o=this.getParentId();var l={id:r,parentId:o,action:s,depth:a,data:e};var d=this;this.stateLoad();this.parent.getData().request(i,"POST",l,null,function(){var t=this.getBodyRows();d.parent.getUpdater().updateBodyRows(t);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(t);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowUpdated",[{id:r,data:e,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[d.parent]);if(BX.type.isFunction(n)){n({id:r,data:e,grid:d.parent,response:this})}})},remove:function t(e,i,n){e=!!e?e:"";var s=this.parent.getUserOptions().getAction("GRID_DELETE_ROW");var a=this.getDepth();var r=this.getId();var o=this.getParentId();var l={id:r,parentId:o,action:s,depth:a,data:e};var d=this;this.stateLoad();this.parent.getData().request(i,"POST",l,null,function(){var t=this.getBodyRows();d.parent.getUpdater().updateBodyRows(t);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(t);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowRemoved",[{id:r,data:e,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[d.parent]);if(BX.type.isFunction(n)){n({id:r,data:e,grid:d.parent,response:this})}})},editCancel:function t(){var e=this.getCells();var i=this;var n;[].forEach.call(e,function(t){n=i.getEditorContainer(t);if(BX.type.isDomNode(n)){BX.remove(i.getEditorContainer(t));BX.show(i.getContentContainer(t))}});BX.removeClass(this.getNode(),"main-grid-row-edit")},getCellByIndex:function t(e){return this.getCells()[e]},getEditDataByCellIndex:function getEditDataByCellIndex(index){return eval(BX.data(this.getCellByIndex(index),"edit"))},getCellNameByCellIndex:function t(e){return BX.data(this.getCellByIndex(e),"name")},resetEditData:function t(){this.editData=null},setEditData:function t(e){this.editData=e},getEditData:function t(){if(this.editData===null){var e=this.parent.getParam("EDITABLE_DATA");var i=this.getId();if(BX.type.isPlainObject(e)&&i in e){this.editData=e[i]}else{this.editData={}}}return this.editData},getCellEditDataByCellIndex:function t(e){var i=this.getEditData();var n=null;e=parseInt(e);if(BX.type.isNumber(e)&&BX.type.isPlainObject(i)){var s=this.parent.getRows().getHeadFirstChild().getEditDataByCellIndex(e);if(BX.type.isPlainObject(s)){n=s;n.VALUE=i[s.NAME]}}return n},edit:function t(){var e=this.getCells();var i=this;var n,s,a,r;[].forEach.call(e,function(t,e){if(t.dataset.editable==="true"){try{n=i.getCellEditDataByCellIndex(e)}catch(t){throw new Error(t)}if(i.parent.getEditor().validateEditObject(n)){r=i.getContentContainer(t);a=BX.height(r);s=i.parent.getEditor().getEditor(n,a);if(!i.getEditorContainer(t)&&BX.type.isDomNode(s)){t.appendChild(s);BX.hide(r)}}}});BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable:function t(e){if(!e){BX.addClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().unregister(this.getNode())}else{BX.removeClass(this.getNode(),this.parent.settings.get("classDisableDrag"));this.parent.getRowsSortable().register(this.getNode())}},isDraggable:function t(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classDisableDrag"))},getNode:function t(){return this.node},getIndex:function t(){return this.getNode().rowIndex},getId:function t(){return String(BX.data(this.getNode(),"id"))},getGroupId:function t(){return BX.data(this.getNode(),"group-id").toString()},getObserver:function t(){return BX.Grid.observer},getCheckbox:function t(){if(!this.checkbox){this.checkbox=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowCheckbox"),true)}return this.checkbox},getActionsMenu:function t(){if(!this.actionsMenu){var e=this.getActionsButton().getBoundingClientRect();this.actionsMenu=BX.PopupMenu.create("main-grid-actions-menu-"+this.getId(),this.getActionsButton(),this.getMenuItems(),{autoHide:true,offsetTop:-(e.height/2+26),offsetLeft:30,angle:{position:"left",offset:e.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:BX.delegate(this._onPopupShow,this)}});BX.addCustomEvent("Grid::updated",function(){if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}}.bind(this));BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",BX.delegate(function(t){var e=this.getActionsMenu();if(e){var i=BX.getEventTarget(t);var n=BX.findParent(i,{className:"menu-popup-item"},10);if(!n||!n.dataset.preventCloseContextMenu){e.close()}}},this))}return this.actionsMenu},_onCloseMenu:function t(){},_onPopupShow:function t(e){e.setBindElement(this.getActionsButton())},actionsMenuIsShown:function t(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu:function t(e){BX.fireEvent(document.body,"click");this.getActionsMenu().popupWindow.show();if(e){this.getActionsMenu().popupWindow.popupContainer.style.top=e.pageY-25+BX.PopupWindow.getOption("offsetTop")+"px";this.getActionsMenu().popupWindow.popupContainer.style.left=e.pageX+20+BX.PopupWindow.getOption("offsetLeft")+"px"}else{var i=this.actionsMenu.getPopupWindow();var n=BX.pos(this.getActionsButton());BX.style(i.getPopupContainer(),"top",n.top-20+"px");BX.style(i.getPopupContainer(),"left",n.left+25+"px")}},closeActionsMenu:function t(){if(this.actionsMenu){if(this.actionsMenu.popupWindow){this.actionsMenu.popupWindow.close()}}},getMenuItems:function t(){return this.getActions()||[]},getActions:function getActions(){try{this.actions=this.actions||eval(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch(t){this.actions=null}return this.actions},getActionsButton:function t(){if(!this.actionsButton){this.actionsButton=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowActionButton"),true)}return this.actionsButton},initSelect:function t(){if(this.isSelected()&&!BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"))}},getParentNode:function t(){var e;try{e=this.getNode().parentNode}catch(t){e=null}return e},getParentNodeName:function t(){var e;try{e=this.getParentNode().nodeName}catch(t){e=null}return e},select:function t(){var e;if(!this.isEdit()&&(this.parent.getParam("ADVANCED_EDIT_MODE")||!this.parent.getRows().hasEditable())){e=this.getCheckbox();if(e){if(!BX.data(e,"disabled")){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"));this.bindNodes.forEach(function(t){BX.addClass(t,this.settings.get("classCheckedRow"))},this);e.checked=true}}}},unselect:function t(){if(!this.isEdit()){BX.removeClass(this.getNode(),this.settings.get("classCheckedRow"));this.bindNodes.forEach(function(t){BX.removeClass(t,this.settings.get("classCheckedRow"))},this);if(this.getCheckbox()){this.getCheckbox().checked=false}}},getCells:function t(){return this.getNode().cells},isSelected:function t(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild:function t(){return this.getParentNodeName()==="THEAD"&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild:function t(){return BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))&&!BX.hasClass(this.getNode(),this.settings.get("classEmptyRows"))},isFootChild:function t(){return this.getParentNodeName()==="TFOOT"&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))},prependTo:function t(e){BX.Dom.prepend(this.getNode(),e)},appendTo:function t(e){BX.Dom.append(this.getNode(),e)},setId:function t(e){BX.Dom.attr(this.getNode(),"data-id",e)},setActions:function t(e){var i=this.getNode().querySelector(".main-grid-cell-action");if(i){var n=i.querySelector(".main-grid-row-action-button");if(!n){n=BX.Dom.create({tag:"div",props:{className:"main-grid-row-action-button"}});var s=this.getContentContainer(i);BX.Dom.append(n,s)}BX.Dom.attr(n,{href:"#","data-actions":e});this.actions=e;if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}}},makeCountable:function t(){BX.Dom.removeClass(this.getNode(),"main-grid-not-count")},makeNotCountable:function t(){BX.Dom.addClass(this.getNode(),"main-grid-not-count")},getColumnOptions:function t(e){var i=this.parent.getParam("COLUMNS_ALL");if(BX.Type.isPlainObject(i)&&Reflect.has(i,e)){return i[e]}return null},setCellsContent:function t(e){var i=this;var n=this.parent.getRows().getHeadFirstChild();babelHelpers.toConsumableArray(this.getCells()).forEach(function(t,s){var a=n.getCellNameByCellIndex(s);if(Reflect.has(e,a)){var r=i.getColumnOptions(a);var o=i.getContentContainer(t);var l=e[a];if(r.type==="labels"&&BX.Type.isArray(l)){var d=l.map(function(t){var e=BX.Tag.render(_templateObject$1(),t.color);if(t.light!==true){BX.Dom.addClass(e,"ui-label-fill")}if(BX.Type.isPlainObject(t.events)){if(Reflect.has(t.events,"click")){BX.Dom.addClass(e,"ui-label-link")}i.bindOnEvents(e,t.events)}var n=function(){if(BX.Type.isStringFilled(t.html)){return t.html}return t.text}();var s=BX.Tag.render(_templateObject2$1(),n);BX.Dom.append(s,e);if(BX.Type.isPlainObject(t.removeButton)){var a=function(){if(t.removeButton.type===BX.Grid.Label.RemoveButtonType.INSIDE){return BX.Tag.render(_templateObject3())}return BX.Tag.render(_templateObject4(),t.removeButton.type)}();if(BX.Type.isPlainObject(t.removeButton.events)){i.bindOnEvents(a,t.removeButton.events)}BX.Dom.append(a,e)}return e});var c=BX.Tag.render(_templateObject5(),d);var h=o.querySelector(".main-grid-labels");if(BX.Type.isDomNode(h)){BX.Dom.replace(h,c)}else{BX.Dom.append(c,o)}}else if(r.type==="tags"&&BX.Type.isPlainObject(l)){var u=l.items.map(function(t){var e=BX.Tag.render(_templateObject6());i.bindOnEvents(e,t.events);if(t.active===true){BX.Dom.addClass(e,"main-grid-tag-active")}var n=function(){if(BX.Type.isStringFilled(t.html)){return t.html}return BX.Text.encode(t.text)}();var s=BX.Tag.render(_templateObject7(),n);BX.Dom.append(s,e);if(t.active===true){var a=BX.Tag.render(_templateObject8());BX.Dom.append(a,e);if(BX.Type.isPlainObject(t.removeButton)){i.bindOnEvents(a,t.removeButton.events)}}return e});var g=BX.Tag.render(_templateObject9(),u);var p=BX.Tag.render(_templateObject10());if(BX.Type.isPlainObject(l.addButton)){i.bindOnEvents(p,l.addButton.events)}BX.Dom.append(p,g);var f=o.querySelector(".main-grid-tags");if(BX.Type.isDomNode(f)){BX.Dom.replace(f,g)}else{BX.Dom.append(g,o)}}else{BX.Runtime.html(o,l)}}})},getCellById:function t(e){var i=this.parent.getRows().getHeadFirstChild();return babelHelpers.toConsumableArray(this.getCells()).find(function(t,n){return i.getCellNameByCellIndex(n)===e})},isTemplate:function t(){return this.isBodyChild()&&/^template_[0-9]$/.test(this.getId())},enableAbsolutePosition:function t(){var e=babelHelpers.toConsumableArray(this.parent.getRows().getHeadFirstChild().getCells());var i=e.map(function(t){return BX.Dom.style(t,"width")});var n=this.getCells();i.forEach(function(t,e){BX.Dom.style(n[e],"width",t)});BX.Dom.style(this.getNode(),"position","absolute")},disableAbsolutePosition:function t(){BX.Dom.style(this.getNode(),"position",null)},getHeight:function t(){return BX.Text.toNumber(BX.Dom.style(this.getNode(),"height"))},setCellActions:function t(e){var i=this;Object.entries(e).forEach(function(t){var e=babelHelpers.slicedToArray(t,2),n=e[0],s=e[1];var a=i.getCellById(n);if(a){var r=a.querySelector(".main-grid-cell-inner");if(r){var o=function(){var t=r.querySelector(".main-grid-cell-content-actions");if(t){BX.Dom.clean(t);return t}var e=BX.Tag.render(_templateObject11());BX.Dom.append(e,r);return e}();if(BX.Type.isArrayFilled(s)){s.forEach(function(t){var e=function(){if(BX.Type.isArrayFilled(t.class)){return t.class.join(" ")}return t.class}();var n=BX.Tag.render(_templateObject12(),e);if(BX.Type.isPlainObject(t.events)){i.bindOnEvents(n,t.events)}if(BX.Type.isPlainObject(t.attributes)){BX.Dom.attr(n,t.attributes)}BX.Dom.append(n,o)})}}}})},initElementsEvents:function initElementsEvents(){var _this3=this;var buttons=babelHelpers.toConsumableArray(this.getNode().querySelectorAll(".main-grid-cell [data-events]"));if(BX.Type.isArrayFilled(buttons)){buttons.forEach(function(button){var events=eval(BX.Dom.attr(button,"data-events"));if(BX.Type.isPlainObject(events)){BX.Dom.attr(button,"data-events",null);_this3.bindOnEvents(button,events)}})}},onElementClick:function t(e){e.stopPropagation()},bindOnEvents:function bindOnEvents(button,events){if(BX.Type.isDomNode(button)&&BX.Type.isPlainObject(events)){BX.Event.bind(button,"click",this.onElementClick.bind(this));var target=function(){var t=BX.Dom.attr(button,"data-target");if(t){return button.closest(t)}return button}();var event=new BX.Event.BaseEvent({data:{button:button,target:target,row:this}});event.setTarget(target);Object.entries(events).forEach(function(_ref3){var _ref4=babelHelpers.slicedToArray(_ref3,2),eventName=_ref4[0],handler=_ref4[1];var preparedHandler=eval(handler);BX.Event.bind(button,eventName,preparedHandler.bind(null,event))})}},setCounters:function t(e){var i=this;if(BX.Type.isPlainObject(e)){Object.entries(e).forEach(function(t){var e=babelHelpers.slicedToArray(t,2),n=e[0],s=e[1];var a=i.getCellById(n);if(BX.Type.isDomNode(a)){var r=a.querySelector(".main-grid-cell-inner");var o=function(){var t=a.querySelector(".main-grid-cell-counter");if(BX.Type.isDomNode(t)){return t}return BX.Tag.render(_templateObject13())}();var l=function(){var t=o.querySelector(".ui-counter");if(BX.Type.isDomNode(t)){return t}var e=BX.Tag.render(_templateObject14());BX.Dom.append(e,o);return e}();if(BX.Type.isPlainObject(s.events)){i.bindOnEvents(l,s.events)}var d=function(){var t=l.querySelector(".ui-counter-inner");if(BX.Type.isDomNode(t)){return t}var e=BX.Tag.render(_templateObject15());BX.Dom.append(e,l);return e}();if(BX.Type.isStringFilled(s.type)){Object.values(BX.Grid.Counters.Type).forEach(function(t){BX.Dom.removeClass(o,"main-grid-cell-counter-".concat(t))});BX.Dom.addClass(o,"main-grid-cell-counter-".concat(s.type))}if(BX.Type.isStringFilled(s.color)){Object.values(BX.Grid.Counters.Color).forEach(function(t){BX.Dom.removeClass(l,t)});BX.Dom.addClass(l,s.color)}if(BX.Type.isStringFilled(s.size)){Object.values(BX.Grid.Counters.Size).forEach(function(t){BX.Dom.removeClass(l,t)});BX.Dom.addClass(l,s.size)}if(BX.Type.isStringFilled(s.class)){BX.Dom.addClass(l,s.class)}if(BX.Type.isStringFilled(s.value)||BX.Type.isNumber(s.value)){var c=BX.Text.toNumber(d.innerText);var h=BX.Text.toNumber(s.value);if(h>0){if(h<100){d.innerText=s.value}else{d.innerText="99+"}if(s.animation!==false){if(h!==c){if(h>c){BX.Dom.addClass(d,"ui-counter-plus")}else{BX.Dom.addClass(d,"ui-counter-minus")}}BX.Event.bindOnce(d,"animationend",function(t){if(t.animationName==="uiCounterPlus"||t.animationName==="uiCounterMinus"){BX.Dom.removeClass(d,["ui-counter-plus","ui-counter-minus"])}})}}}if(BX.Text.toNumber(s.value)>0){var u=s.type===BX.Grid.Counters.Type.RIGHT?"right":"left";if(u==="left"){BX.Dom.prepend(o,r)}else if(u==="right"){BX.Dom.append(o,r)}}else{var g="main-grid-cell-counter-".concat(BX.Grid.Counters.Type.LEFT_ALIGNED);if(BX.Dom.hasClass(o,g)){BX.remove(l)}else{BX.remove(o)}}}})}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Rows=function(t){this.parent=null;this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null;this.init(t)};BX.Grid.Rows.prototype={init:function t(e){this.parent=e},reset:function t(){this.rows=null;this.headChild=null;this.bodyChild=null;this.footChild=null},enableDragAndDrop:function t(){this.parent.arParams["ALLOW_ROWS_SORT"]=true;if(!(this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable)){this.parent.rowsSortable=new BX.Grid.RowsSortable(this.parent)}},disableDragAndDrop:function t(){this.parent.arParams["ALLOW_ROWS_SORT"]=false;if(this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable){this.parent.getRowsSortable().destroy();this.parent.rowsSortable=null}},getFootLastChild:function t(){return this.getLast(this.getFootChild())},getFootFirstChild:function t(){return this.getFirst(this.getFootChild())},getBodyLastChild:function t(){return this.getLast(this.getBodyChild())},getBodyFirstChild:function t(){return this.getFirst(this.getBodyChild())},getHeadLastChild:function t(){return this.getLast(this.getHeadChild())},getHeadFirstChild:function t(){return this.getFirst(this.getHeadChild())},getEditSelectedValues:function t(e){var i=this.getSelected(e);var n={};i.forEach(function(t){n[t.getId()]=t.editGetValues()});return n},getSelectedIds:function t(e){return this.getSelected(e).map(function(t){return t.getId()})},initSelected:function t(){var e=this.getSelected();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){t.initSelect()});this.parent.enableActionsPanel()}},editSelected:function t(){this.getSelected().forEach(function(t){t.edit()});BX.onCustomEvent(window,"Grid::thereEditedRows",[])},editSelectedCancel:function t(e){this.getSelected(e).forEach(function(t){t.editCancel()});BX.onCustomEvent(window,"Grid::noEditedRows",[])},isSelected:function t(){return this.getBodyChild().some(function(t){return t.isShown()&&t.isSelected()})},isAllSelected:function t(){return!this.getBodyChild().filter(function(t){return!!t.getCheckbox()}).some(function(t){return!t.isSelected()})},getParent:function t(){return this.parent},getCountSelected:function t(){var e;try{e=this.getSelected().filter(function(t){return!t.isNotCount()&&t.isShown()}).length}catch(t){e=0}return e},getCountDisplayed:function t(){var e;try{e=this.getBodyChild().filter(function(t){return t.isShown()&&!t.isNotCount()}).length}catch(t){e=0}return e},addRows:function t(e){var i=BX.findChild(this.getParent().getTable(),{tag:"TBODY"},true,false);e.forEach(function(t){i.appendChild(t)})},getRows:function t(){var e;var i=this;if(!this.rows){e=[].slice.call(this.getParent().getTable().querySelectorAll("tr[data-id], thead > tr"));this.rows=e.map(function(t){return new BX.Grid.Row(i.parent,t)})}return this.rows},getSelected:function t(e){return this.getBodyChild(e).filter(function(t){return t.isShown()&&t.isSelected()})},normalizeNode:function t(e){if(!BX.hasClass(e,this.getParent().settings.get("classBodyRow"))){e=BX.findParent(e,{className:this.getParent().settings.get("classBodyRow")},true,false)}return e},getById:function t(e){return this.getBodyChild().find(function(t){return String(t.getId())===String(e)})||null},get:function t(e){if(BX.Type.isDomNode(e)){var i=e.closest(".main-grid-row");if(BX.Type.isDomNode(i)){var n=this.getRows().find(function(t){return t.getNode()===i});if(n){return n}}}return null},getLast:function t(e){var i;try{i=e[e.length-1]}catch(t){i=null}return i},getFirst:function t(e){var i;try{i=e[0]}catch(t){i=null}return i},getHeadChild:function t(){this.headChild=this.headChild||this.getRows().filter(function(t){return t.isHeadChild()});return this.headChild},getBodyChild:function t(e){return this.getRows().filter(function(t){return t.isBodyChild()&&(!t.isTemplate()||e)})},getFootChild:function t(){this.footChild=this.footChild||this.getRows().filter(function(t){return t.isFootChild()});return this.footChild},selectAll:function t(){this.getRows().map(function(t){t.isShown()&&t.select()})},unselectAll:function t(){this.getRows().map(function(t){t.unselect()})},getByIndex:function t(e){var i=this.getBodyChild().filter(function(t){return t}).filter(function(t){return t.getNode().rowIndex===e});return i.length?i[0]:null},getRowsByParentId:function t(e,i){var n=[];var s=this;if(!e){return n}e=e.toString();function a(t){s.getBodyChild().forEach(function(e){if(e.getParentId()===t){n.push(e);i&&a(e.getId())}},s)}a(e);return n},getRowsByGroupId:function t(e){var i=[];var n=this;if(!e){return i}e=e.toString();function s(t){n.getBodyChild().forEach(function(e){if(e.getGroupId()===t&&!e.isCustom()){i.push(e)}},n)}s(e);return i},getExpandedRows:function t(){return this.getRows().filter(function(t){return t.isShown()&&t.isExpand()})},getIdsExpandedRows:function t(){return this.getExpandedRows().map(function(t){return t.getId()})},getIdsCollapsedGroups:function t(){return this.getRows().filter(function(t){return t.isCustom()&&!t.isExpand()}).map(function(t){return t.getId()})},getSourceRows:function t(){return BX.Grid.Utils.getBySelector(this.getParent().getTable(),[".main-grid-header > tr",".main-grid-header + tbody > tr"].join(", "))},getSourceBodyChild:function t(){return this.getSourceRows().filter(function(t){return BX.Grid.Utils.closestParent(t).nodeName==="TBODY"})},getSourceHeadChild:function t(){return this.getSourceRows().filter(function(t){return BX.Grid.Utils.closestParent(t).nodeName==="THEAD"})},getSourceFootChild:function t(){return this.getSourceRows().filter(function(t){return BX.Grid.Utils.closestParent(t).nodeName==="TFOOT"})},hasEditable:function t(){return this.getBodyChild().some(function(t){return t.isEdit()})},insertAfter:function t(e,i){var n=this.getById(e);var s=this.getById(i);if(n&&s){BX.Dom.insertAfter(n.getNode(),s.getNode());this.reset()}},insertBefore:function t(e,i){var n=this.getById(e);var s=this.getById(i);if(n&&s){BX.Dom.insertBefore(n.getNode(),s.getNode());this.reset()}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.RowDragEvent=function(t){this.allowMoveRow=true;this.allowInsertBeforeTarget=true;this.dragItem=null;this.targetItem=null;this.eventName=!!t?t:"";this.errorMessage=""};BX.Grid.RowDragEvent.prototype={allowMove:function t(){this.allowMoveRow=true;this.errorMessage=""},allowInsertBefore:function t(){this.allowInsertBeforeTarget=true},disallowMove:function t(e){this.allowMoveRow=false;this.errorMessage=e||""},disallowInsertBefore:function t(){this.allowInsertBeforeTarget=false},getDragItem:function t(){return this.dragItem},getTargetItem:function t(){return this.targetItem},getEventName:function t(){return this.eventName},setDragItem:function t(e){return this.dragItem=e},setTargetItem:function t(e){return this.targetItem=e},setEventName:function t(e){return this.eventName=e},isAllowedMove:function t(){return this.allowMoveRow},isAllowedInsertBefore:function t(){return this.allowInsertBeforeTarget},getErrorMessage:function t(){return this.errorMessage}};BX.Grid.RowsSortable=function(t){this.parent=null;this.list=null;this.setDefaultProps();this.init(t)};BX.Grid.RowsSortable.prototype={init:function t(e){this.parent=e;this.list=this.getList();this.prepareListItems();jsDD.Enable();if(!this.inited){this.inited=true;this.onscrollDebounceHandler=BX.debounce(this._onWindowScroll,300,this);if(!this.parent.getParam("ALLOW_ROWS_SORT_IN_EDIT_MODE",false)){BX.addCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.addCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))}document.addEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:true}))}},destroy:function t(){if(!this.parent.getParam("ALLOW_ROWS_SORT_IN_EDIT_MODE",false)){BX.removeCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.removeCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))}document.removeEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:true}));this.unregisterObjects()},_onWindowScroll:function t(){this.windowScrollTop=BX.scrollTop(window);this.rowsRectList=null},disable:function t(){this.unregisterObjects()},enable:function t(){this.reinit()},reinit:function t(){this.unregisterObjects();this.setDefaultProps();this.init(this.parent)},getList:function t(){return this.parent.getRows().getSourceBodyChild()},unregisterObjects:function t(){this.list.forEach(this.unregister,this)},prepareListItems:function t(){this.list.forEach(this.register,this)},register:function t(e){var i=this.parent.getRows();var n=i.get(e);if(n&&n.isDraggable()){e.onbxdragstart=BX.delegate(this._onDragStart,this);e.onbxdrag=BX.delegate(this._onDrag,this);e.onbxdragstop=BX.delegate(this._onDragEnd,this);jsDD.registerObject(e)}},unregister:function t(e){jsDD.unregisterObject(e)},getIndex:function t(e){return BX.Grid.Utils.getIndex(this.list,e)},calcOffset:function t(){var e=this.dragRect.height;if(this.additionalDragItems.length){this.additionalDragItems.forEach(function(t){e+=t.clientHeight})}return e},getTheadCells:function t(e){return[].map.call(e,function(t,i){return{block:"",tag:"th",attrs:{style:"width: "+BX.width(e[i])+"px;"}}})},createFake:function t(){var e=[];this.cloneDragItem=BX.clone(this.dragItem);this.cloneDragAdditionalDragItems=[];this.cloneDragAdditionalDragItemRows=[];var i=this.getTheadCells(this.dragItem.cells);e.push(this.cloneDragItem);this.additionalDragItems.forEach(function(t){var i=BX.clone(t);e.push(i);this.cloneDragAdditionalDragItems.push(i);this.cloneDragAdditionalDragItemRows.push(new BX.Grid.Row(this.parent,i))},this);var n=BX.width(this.parent.getTable());this.fake=BX.decl({block:"main-grid-fake-container",attrs:{style:"position: absolute; top: "+this.getDragStartRect().top+"px; width: "+n+"px"},content:{block:"main-grid-table",mix:"main-grid-table-fake",tag:"table",attrs:{style:"width: "+n+"px"},content:[{block:"main-grid-header",tag:"thead",content:{block:"main-grid-row-head",tag:"tr",content:i}},{block:"",tag:"tbody",content:e}]}});BX.insertAfter(this.fake,this.parent.getTable());this.cloneDragItem=new BX.Grid.Row(this.parent,this.cloneDragItem);return this.fake},getDragStartRect:function t(){return BX.pos(this.dragItem,this.parent.getTable())},_onDragStart:function t(){this.moved=false;this.dragItem=jsDD.current_node;this.targetItem=this.dragItem;this.additionalDragItems=this.getAdditionalDragItems(this.dragItem);this.dragIndex=this.getIndex(this.dragItem);this.dragRect=this.getRowRect(this.dragItem,this.dragIndex);this.offset=this.calcOffset();this.dragStartOffset=jsDD.start_y-this.dragRect.top;this.dragEvent=new BX.Grid.RowDragEvent;this.dragEvent.setEventName("BX.Main.grid:rowDragStart");this.dragEvent.setDragItem(this.dragItem);this.dragEvent.setTargetItem(this.targetItem);this.dragEvent.allowInsertBefore();var e=this.parent.getRows().get(this.dragItem);this.startDragDepth=e.getDepth();this.startDragParentId=e.getParentId();this.createFake();BX.addClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.addClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.onCustomEvent(window,"BX.Main.grid:rowDragStart",[this.dragEvent,this.parent])},getAdditionalDragItems:function t(e){var i=this.parent.getRows();return i.getRowsByParentId(i.get(e).getId(),true).map(function(t){return t.getNode()})},moveRow:function t(e,i,n){if(!!e){var s=BX.type.isNumber(n)?n:300;e.style.transition=s+"ms";e.style.transform="translate3d(0px, "+i+"px, 0px)"}},getDragOffset:function t(){return jsDD.y-this.dragRect.top-this.dragStartOffset},getWindowScrollTop:function t(){if(this.windowScrollTop===null){this.windowScrollTop=BX.scrollTop(window)}return this.windowScrollTop},getSortOffset:function t(){return jsDD.y},getRowRect:function t(e,i){if(!this.rowsRectList){this.rowsRectList={};this.list.forEach(function(t,e){this.rowsRectList[e]=t.getBoundingClientRect()},this)}return this.rowsRectList[i]},getRowCenter:function t(e,i){var n=this.getRowRect(e,i);return n.top+this.getWindowScrollTop()+n.height/2},isDragToBottom:function t(e,i){var n=this.getRowCenter(e,i);var s=this.getSortOffset();return i>this.dragIndex&&n<s},isMovedToBottom:function t(e){return e.style.transform==="translate3d(0px, "+-this.offset+"px, 0px)"},isDragToTop:function t(e,i){var n=this.getRowCenter(e,i);var s=this.getSortOffset();return i<this.dragIndex&&n>s},isMovedToTop:function t(e){return e.style.transform==="translate3d(0px, "+this.offset+"px, 0px)"},isDragToBack:function t(e,i){var n=this.getRowCenter(e,i);var s=this.dragIndex;var a=jsDD.y;return i>s&&a<n||i<s&&a>n},isMoved:function t(e){return e.style.transform!=="translate3d(0px, 0px, 0px)"&&e.style.transform!==""},_onDrag:function t(){var e=0;var i=0;this.moveRow(this.dragItem,this.getDragOffset(),e);this.moveRow(this.fake,this.getDragOffset(),e);BX.Grid.Utils.styleForEach(this.additionalDragItems,{transition:e+"ms",transform:"translate3d(0px, "+this.getDragOffset()+"px, 0px)"});this.list.forEach(function(t,e){if(!!t&&t!==this.dragItem&&this.additionalDragItems.indexOf(t)===-1){if(this.isDragToTop(t,e)&&!this.isMovedToTop(t)){this.targetItem=t;this.moveRow(t,this.offset);this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem);this.isDragetToTop=true;this.moved=true}if(this.isDragToBottom(t,e)&&!this.isMovedToBottom(t)){this.targetItem=this.findNextVisible(this.list,e);this.moveRow(t,-this.offset);this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem);this.isDragetToTop=false;if(this.targetItem){this.moved=true}}if(this.isDragToBack(t,e)&&this.isMoved(t)){this.moveRow(t,i);this.targetItem=t;if(this.isDragetToTop){this.targetItem=this.findNextVisible(this.list,e)}this.moved=true;this.dragEvent.setEventName("BX.Main.grid:rowDragMove");this.dragEvent.setTargetItem(this.targetItem);BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]);this.checkError(this.dragEvent);this.updateProperties(this.dragItem,this.targetItem)}}},this)},createError:function t(e,i){var n=BX.decl({block:"main-grid-error",content:!!i?i:""});!!e&&e.appendChild(n);setTimeout(function(){BX.addClass(n,"main-grid-error-show")},0);return n},checkError:function t(e){if(!e.isAllowedMove()&&!this.error){this.error=this.createError(this.fake,e.getErrorMessage())}if(e.isAllowedMove()&&this.error){BX.remove(this.error);this.error=null}},findNextVisible:function t(e,i){var n=null;var s=this.parent.getRows();e.forEach(function(t,e){if(!n&&e>i){var a=s.get(t);if(a&&a.isShown()){n=t}}});return n},updateProperties:function t(e,i){var n=this.parent.getRows();var s=n.get(e);var a=0;var r=0;if(!!i){var o=n.get(i);a=o.getDepth();r=o.getParentId()}s.setDepth(a);s.setParentId(r);this.cloneDragItem.setDepth(a);this.cloneDragAdditionalDragItemRows.forEach(function(t,e){t.setDepth(BX.data(this.additionalDragItems[e],"depth"))},this)},resetDragProperties:function t(){var e=this.parent.getRows().get(this.dragItem);e.setDepth(this.startDragDepth);e.setParentId(this.startDragParentId)},_onDragOver:function t(){},_onDragLeave:function t(){},_onDragEnd:function t(){BX.onCustomEvent(window,"BX.Main.grid:rowDragEnd",[this.dragEvent,this.parent]);BX.removeClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.removeClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.Grid.Utils.styleForEach(this.list,{transition:"",transform:""});if(this.dragEvent.isAllowedMove()){this.sortRows(this.dragItem,this.targetItem);this.sortAdditionalDragItems(this.dragItem,this.additionalDragItems);this.list=this.getList();this.parent.getRows().reset();var e=this.parent.getRows().get(this.dragItem);var i=this.parent.getRows().getBodyChild().map(function(t){return t.getId()});if(this.parent.getParam("ALLOW_ROWS_SORT_INSTANT_SAVE",true)){this.saveRowsSort(i)}BX.onCustomEvent(window,"Grid::rowMoved",[i,e,this.parent])}else{this.resetDragProperties()}BX.remove(this.fake);this.setDefaultProps()},sortAdditionalDragItems:function t(e,i){i.reduce(function(t,e){!!e&&BX.insertAfter(e,t);return e},e)},sortRows:function t(e,i){if(!!i){i.parentNode.insertBefore(e,i)}else if(this.moved){e.parentNode.appendChild(e)}},saveRowsSort:function t(e){var i={ids:e,action:this.parent.getUserOptions().getAction("GRID_SAVE_ROWS_SORT")};this.parent.getData().request(null,"POST",i)},setDefaultProps:function t(){this.moved=false;this.dragItem=null;this.targetItem=null;this.dragRect=null;this.dragIndex=null;this.offset=null;this.realX=null;this.realY=null;this.dragStartOffset=null;this.windowScrollTop=null;this.rowsRectList=null;this.error=false}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Settings=function(){this.settings={};this.defaultSettings={classContainer:"main-grid",classWrapper:"main-grid-wrapper",classTable:"main-grid-table",classScrollContainer:"main-grid-container",classFadeContainer:"main-grid-fade",classFadeContainerRight:"main-grid-fade-right",classFadeContainerLeft:"main-grid-fade-left",classNavPanel:"main-grid-nav-panel",classActionPanel:"main-grid-action-panel",classCursor:"main-grid-cursor",classRowCustom:"main-grid-row-custom",classMoreButton:"main-grid-more-btn",classRow:"main-grid-row",classHeadRow:"main-grid-row-head",classBodyRow:"main-grid-row-body",classFootRow:"main-grid-row-foot",classDataRows:"main-grid-row-data",classPanels:"main-grid-bottom-panels",classCellHeadContainer:"main-grid-cell-head-container",classCellHeadOndrag:"main-grid-cell-head-ondrag",classEmptyRows:"main-grid-row-empty",classEmptyBlock:"main-grid-empty-block",classCheckAllCheckboxes:"main-grid-check-all",classCheckedRow:"main-grid-row-checked",classRowCheckbox:"main-grid-row-checkbox",classPagination:"main-grid-panel-cell-pagination",classActionCol:"main-grid-cell-action",classCounterDisplayed:"main-grid-counter-displayed",classCounterSelected:"main-grid-counter-selected",classCounterTotal:"main-grid-panel-total",classTableFade:"main-grid-table-fade",classDragActive:"main-grid-on-row-drag",classResizeButton:"main-grid-resize-button",classOnDrag:"main-grid-ondrag",classDisableDrag:"main-grid-row-drag-disabled",classPanelCellContent:"main-grid-panel-content",classCollapseButton:"main-grid-plus-button",classRowStateLoad:"main-grid-load-row",classRowStateExpand:"main-grid-row-expand",classHeaderSortable:"main-grid-col-sortable",classHeaderNoSortable:"main-grid-col-no-sortable",classCellStatic:"main-grid-cell-static",classHeadCell:"main-grid-cell-head",classPageSize:"main-grid-panel-select-pagesize",classGroupEditButton:"main-grid-control-panel-action-edit",classGroupDeleteButton:"main-grid-control-panel-action-remove",classGroupActionsDisabled:"main-grid-control-panel-action-icon-disable",classPanelButton:"main-grid-buttons",classPanelApplyButton:"main-grid-control-panel-apply-button",classPanelCheckbox:"main-grid-panel-checkbox",classEditor:"main-grid-editor",classEditorContainer:"main-grid-editor-container",classEditorText:"main-grid-editor-text",classEditorDate:"main-grid-editor-date",classEditorNumber:"main-grid-editor-number",classEditorRange:"main-grid-editor-range",classEditorCheckbox:"main-grid-editor-checkbox",classEditorTextarea:"main-grid-editor-textarea",classEditorCustom:"main-grid-editor-custom",classEditorMoney:"main-grid-editor-money",classCellContainer:"main-grid-cell-content",classEditorOutput:"main-grid-editor-output",classSettingsWindow:"main-grid-settings-window",classSettingsWindowColumn:"main-grid-settings-window-list-item",classSettingsWindowColumnLabel:"main-grid-settings-window-list-item-label",classSettingsWindowColumnEditState:"main-grid-settings-window-list-item-edit",classSettingsWindowColumnEditInput:"main-grid-settings-window-list-item-edit-input",classSettingsWindowColumnEditButton:"main-grid-settings-window-list-item-edit-button",classSettingsWindowColumnCheckbox:"main-grid-settings-window-list-item-checkbox",classSettingsWindowShow:"main-grid-settings-window-show",classSettingsWindowSelectAll:"main-grid-settings-window-select-all",classSettingsWindowUnselectAll:"main-grid-settings-window-unselect-all",classSettingsButton:"main-grid-interface-settings-icon",classSettingsButtonActive:"main-grid-interface-settings-icon-active",classSettingsWindowClose:"main-grid-settings-window-actions-item-close",classSettingsWindowReset:"main-grid-settings-window-actions-item-reset",classSettingsWindowColumnChecked:"main-grid-settings-window-list-item-checked",classShowAnimation:"main-grid-show-popup-animation",classCloseAnimation:"main-grid-close-popup-animation",classLoader:"main-grid-loader-container",classLoaderShow:"main-grid-show-loader",classLoaderHide:"main-grid-hide-loader",classRowError:"main-grid-error",loaderHideAnimationName:"hideLoader",classHide:"main-grid-hide",classEar:"main-grid-ear",classEarLeft:"main-grid-ear-left",classEarRight:"main-grid-ear-right",classNotCount:"main-grid-not-count",classCounter:"main-grid-panel-counter",classForAllCounterEnabled:"main-grid-panel-counter-for-all-enable",classLoad:"load",classRowActionButton:"main-grid-row-action-button",classDropdown:"main-dropdown",classPanelControl:"main-grid-panel-control",classPanelControlContainer:"main-grid-panel-control-container",classForAllCheckbox:"main-grid-for-all-checkbox",classDisable:"main-grid-disable",dataActionsKey:"actions",updateActionMore:"more",classShow:"show",classGridShow:"main-grid-show",updateActionPagination:"pagination",updateActionSort:"sort",ajaxIdDataProp:"ajaxid",pageSizeId:"grid_page_size",sortableRows:true,sortableColumns:true,animationDuration:300};this.prepare()};BX.Grid.Settings.prototype={prepare:function t(){this.settings=this.defaultSettings},getDefault:function t(){return this.defaultSettings},get:function t(e){var i;try{i=this.getDefault()[e]}catch(t){i=null}return i},getList:function t(){return this.getDefault()}}})();(function(){BX.namespace("BX.Grid");BX.Grid.SettingsWindow=function(t){this.parent=null;this.popupItems=null;this.items=null;this.popup=null;this.sourceContent=null;this.applyButton=null;this.resetButton=null;this.cancelButton=null;this.init(t);BX.onCustomEvent(window,"BX.Grid.SettingsWindow:init",[this])};BX.Grid.SettingsWindow.prototype={init:function t(e){this.parent=e;BX.bind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this));BX.addCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this))},destroy:function t(){BX.unbind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this));BX.removeCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this));this.getPopup().close()},getSelectAllButton:function t(){if(!this.selectAllButton){this.selectAllButton=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowSelectAll"),true)}return this.selectAllButton},getUnselectAllButton:function t(){if(!this.unselectAllButton){this.unselectAllButton=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowUnselectAll"),true)}return this.unselectAllButton},reset:function t(){this.popupItems=null;this.allColumns=null;this.items=null},_onContainerClick:function t(e){if(BX.hasClass(e.target,this.parent.settings.get("classSettingsButton"))){this._onSettingsButtonClick(e)}},_onSettingsButtonClick:function t(){BX.onCustomEvent(window,"BX.Grid.SettingsWindow:show",[this]);this.getPopup().show()},fetchColumns:function t(){var e=new BX.Promise;BX.ajax({url:this.parent.getParam("LAZY_LOAD")["GET_LIST"],method:"GET",dataType:"json",onsuccess:e.fulfill.bind(e)});return e},prepareColumnOptions:function t(e){var i=this.parent.getUserOptions().getCurrentOptions().custom_names;if(BX.type.isPlainObject(e)){if(BX.type.isPlainObject(i)){if(e.id in i){e.name=i[e.id]}}if(this.parent.getColumnHeaderCellByName(e.id)){e.selected=true}}return e},createColumnElement:function t(e){var i='<div data-name="'+e.id+'" class="main-grid-settings-window-list-item">'+'<input id="'+e.id+'-checkbox" type="checkbox" class="main-grid-settings-window-list-item-checkbox"'+(e.selected?" checked":"")+">"+'<label for="'+e.id+'-checkbox" class="main-grid-settings-window-list-item-label">'+e.name+"</label>"+'<span class="main-grid-settings-window-list-item-edit-button"></span>'+"</div>";return BX.create("div",{html:i}).firstElementChild},useLazyLoadColumns:function t(){return!!this.parent.getParam("LAZY_LOAD")},getSourceContent:function t(){if(!this.sourceContent){this.sourceContent=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classSettingsWindow"),true);if(this.useLazyLoadColumns()){this.contentList=this.sourceContent.querySelector(".main-grid-settings-window-list");this.contentList.innerHTML="";var e=new BX.Loader({target:this.contentList});e.show();this.fetchColumns().then(function(t){t.forEach(function(t){t=this.prepareColumnOptions(t);this.contentList.appendChild(this.createColumnElement(t))},this);e.hide().then(function(){e.destroy()});this.reset();this.getItems().forEach(function(t){BX.bind(t.getNode(),"click",BX.delegate(this.onItemClick,this))},this);this.fixedFooter=BX.create("div",{props:{className:"main-grid-popup-window-buttons-wrapper"},children:[this.sourceContent.querySelector(".popup-window-buttons")]});requestAnimationFrame(function(){this.popup.popupContainer.appendChild(this.fixedFooter);this.fixedFooter.style.width=this.popup.popupContainer.clientWidth+"px"}.bind(this))}.bind(this))}}return this.sourceContent},getPopupItems:function t(){var e;if(!this.popupItems){e=this.getPopup().contentContainer;this.popupItems=BX.Grid.Utils.getByClass(e,this.parent.settings.get("classSettingsWindowColumn"))}return this.popupItems},getSelectedColumns:function t(){var e=[];this.getItems().forEach(function(t){t.isSelected()&&e.push(t.getId())});return e},restoreColumns:function t(){this.getItems().forEach(function(t){t.restore()});this.sortItems();this.reset()},restoreLastColumns:function t(){this.getItems().forEach(function(t){t.restoreState()})},updateColumnsState:function t(){this.getItems().forEach(function(t){t.updateState()})},getStickedColumns:function t(){return this.getItems().reduce(function(t,e){if(e.isSticked()){t.push(e.getId())}return t},[])},saveColumns:function t(e,i){var n=this.parent.getUserOptions();var s=this.getColumnNames();var a=this.getStickedColumns();var r=[];r.push({action:n.getAction("GRID_SET_COLUMNS"),columns:e.join(",")});r.push({action:n.getAction("SET_CUSTOM_NAMES"),custom_names:s});r.push({action:n.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:a});if(this.isForAll()){r.push({action:n.getAction("GRID_SAVE_SETTINGS"),view_id:"default",set_default_settings:"Y",delete_user_settings:"Y"})}n.batch(r,BX.delegate(function(){this.parent.reloadTable(null,null,i)},this));this.updateColumnsState()},disableAllColumnslabelEdit:function t(){this.getItems().forEach(function(t){t.disableEdit()})},getAllColumns:function t(){if(!this.allColumns){this.allColumns=this.getItems().map(function(t){return t.getId()})}return this.allColumns},isShowedColumn:function t(e){return this.getSelectedColumns().some(function(t){return t===e})},getShowedColumns:function t(){var e=[];var i=this.parent.getRows().getHeadFirstChild().getCells();[].slice.call(i).forEach(function(t){if("name"in t.dataset){e.push(t.dataset.name)}});return e},sortItems:function t(){var e=this.getShowedColumns();var i={};this.getAllColumns().forEach(function(t){i[t]=t},this);var n=0;Object.keys(i).forEach(function(t){if(this.isShowedColumn(t)){i[t]=e[n];n++}var s=this.getColumnByName(i[t]);s&&s.parentNode.appendChild(s)},this)},getColumnNames:function t(){var e={};this.getItems().map(function(t){if(t.isEdited()){e[t.getId()]=t.getTitle()}});return e},getColumnByName:function t(e){return BX.Grid.Utils.getBySelector(this.getPopup().popupContainer,"."+this.parent.settings.get("classSettingsWindowColumn")+'[data-name="'+e+'"]',true)},_onColumnMoved:function t(){this.sortItems();this.reset()},onResetButtonClick:function t(){this.parent.confirmDialog({CONFIRM:true,CONFIRM_MESSAGE:this.parent.arParams.CONFIRM_RESET_MESSAGE},BX.delegate(function(){this.enableWait(this.getApplyButton());this.parent.getUserOptions().reset(this.isForAll(),BX.delegate(function(){this.parent.reloadTable(null,null,BX.delegate(function(){this.restoreColumns();this.disableWait(this.getApplyButton());this.getPopup().close()},this))},this))},this))},getResetButtonId:function t(){return this.parent.getContainerId()+"-grid-settings-reset-button"},onApplyButtonClick:function t(){this.parent.confirmDialog({CONFIRM:this.isForAll(),CONFIRM_MESSAGE:this.parent.getParam("SETTINGS_FOR_ALL_CONFIRM_MESSAGE")},BX.delegate(function(){this.enableWait(this.getApplyButton());this.saveColumns(this.getSelectedColumns(),BX.delegate(function(){this.getPopup().close();this.disableWait(this.getApplyButton());this.unselectForAllCheckbox()},this));BX.onCustomEvent(window,"BX.Grid.SettingsWindow:save",[this])},this),BX.delegate(function(){this.unselectForAllCheckbox()},this))},getApplyButtonId:function t(){return this.parent.getContainerId()+"-grid-settings-apply-button"},getApplyButton:function t(){if(this.applyButton===null){this.applyButton=BX(this.getApplyButtonId())}return this.applyButton},getCancelButtonId:function t(){return this.parent.getContainerId()+"-grid-settings-cancel-button"},getCancelButton:function t(){if(this.cancelButton===null){this.cancelButton=BX(this.getCancelButtonId())}return this.cancelButton},unselectForAllCheckbox:function t(){var e=this.getForAllCheckbox();e&&(e.checked=null)},enableWait:function t(e){BX.addClass(e,"ui-btn-wait");BX.removeClass(e,"popup-window-button")},disableWait:function t(e){BX.removeClass(e,"ui-btn-wait");BX.addClass(e,"popup-window-button")},createTitle:function t(){var e=BX.create("div");var i=this.parent.getParam("SETTINGS_WINDOW_TITLE");if(i!==""){i="&laquo;"+i+"&raquo;";e.innerHTML="<span>"+this.parent.getParam("SETTINGS_TITLE")+" "+i+"</span>";return e.firstChild.innerText}var n=BX.Main.gridManager.data.length;if(n===1){var s=BX("pagetitle");var a=BX.Type.isDomNode(s)&&BX.Type.isStringFilled(s.innerText)?"&laquo;"+BX.Text.encode(s.innerText)+"&raquo;":"";e.innerHTML="<span>"+this.parent.getParam("SETTINGS_TITLE")+" "+a+"</span>";return e.firstChild.innerText}return this.parent.getParam("SETTINGS_TITLE")},getPopupId:function t(){return this.parent.getContainerId()+"-grid-settings-window"},createPopup:function t(){if(!this.popup){this.popup=new BX.PopupWindow(this.getPopupId(),null,{titleBar:this.createTitle(),autoHide:false,overlay:.6,width:1e3,closeIcon:true,closeByEsc:true,contentNoPaddings:true,content:this.getSourceContent(),events:{onPopupClose:BX.delegate(this.onPopupClose,this)}});this.getItems().forEach(function(t){BX.bind(t.getNode(),"click",BX.delegate(this.onItemClick,this))},this);BX.bind(this.getResetButton(),"click",BX.proxy(this.onResetButtonClick,this));BX.bind(this.getApplyButton(),"click",BX.proxy(this.onApplyButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.proxy(this.popup.close,this.popup));BX.bind(this.getSelectAllButton(),"click",BX.delegate(this.onSelectAll,this));BX.bind(this.getUnselectAllButton(),"click",BX.delegate(this.onUnselectAll,this))}return this.popup},onItemClick:function t(){this.adjustActionButtonsState()},getItems:function t(){if(this.items===null){this.items=this.getPopupItems().map(function(t){return new BX.Grid.SettingsWindowColumn(this.parent,t)},this)}return this.items},onPopupClose:function t(){BX.onCustomEvent(window,"BX.Grid.SettingsWindow:close",[this]);this.restoreLastColumns();this.disableAllColumnslabelEdit();this.adjustActionButtonsState()},getPopup:function t(){return!!this.popup?this.popup:this.popup=this.createPopup()},onSelectAll:function t(){this.selectAll();this.enableActions()},onUnselectAll:function t(){this.unselectAll();this.disableActions()},selectAll:function t(){this.getItems().forEach(function(t){t.select()})},unselectAll:function t(){this.getItems().forEach(function(t){t.unselect()})},isForAll:function t(){var e=this.getForAllCheckbox();return e&&!!e.checked},getForAllCheckbox:function t(){return BX.Grid.Utils.getByClass(this.getPopup().popupContainer,"main-grid-settings-window-for-all-checkbox",true)},getResetButton:function t(){if(this.resetButton===null){this.resetButton=BX(this.getResetButtonId())}return this.resetButton},disableActions:function t(){var e=this.getApplyButton();if(!!e){BX.addClass(e,this.parent.settings.get("classDisable"))}},enableActions:function t(){var e=this.getApplyButton();if(!!e){BX.removeClass(e,this.parent.settings.get("classDisable"))}},adjustActionButtonsState:function t(){if(this.getSelectedColumns().length){this.enableActions()}else{this.disableActions()}}}})();(function(){BX.namespace("BX.Grid");BX.Grid.SettingsWindowColumn=function(t,e){this.node=null;this.label=null;this.checkbox=null;this.editButton=null;this.settings=null;this.parent=null;this.default=null;this.defaultTitle=null;this.state=null;this.lastTitle=null;this.init(t,e)};BX.Grid.SettingsWindowColumn.inited={};BX.Grid.SettingsWindowColumn.prototype={init:function t(e,i){this.parent=e;this.node=i;try{this.lastTitle=i.querySelector("label").innerText.trim()}catch(t){}this.updateState();if(!BX.Grid.SettingsWindowColumn.inited[this.getId()]){BX.Grid.SettingsWindowColumn.inited[this.getId()]=true;BX.bind(this.getEditButton(),"click",BX.proxy(this.onEditButtonClick,this));BX.bind(this.getStickyButton(),"click",BX.proxy(this.onStickyButtonClick,this))}},getStickyButton:function t(){return this.node.querySelector(".main-grid-settings-window-list-item-sticky-button")},isSticked:function t(){return this.node.classList.contains("main-grid-settings-window-list-item-sticked")},onStickyButtonClick:function t(){if(this.isSticked()){this.unstick()}else{this.stick()}},stick:function t(){this.node.classList.add("main-grid-settings-window-list-item-sticked")},unstick:function t(){this.node.classList.remove("main-grid-settings-window-list-item-sticked")},onEditButtonClick:function t(e){e.stopPropagation();this.isEditEnabled()?this.disableEdit():this.enableEdit()},setState:function t(e){this.state=e},getState:function t(){return this.state},updateState:function t(){this.setState({selected:this.isSelected(),sticked:this.isSticked(),title:this.getTitle()})},restoreState:function t(){var e=this.getState();e.selected?this.select():this.unselect();e.sticked?this.stick():this.unstick();this.setTitle(e.title)},getId:function t(){return this.getNode().dataset.name},getTitle:function t(){return this.getLabel().innerText},setTitle:function t(e){this.getLabel().innerText=!!e&&e!=="undefined"?e:this.getDefaultTitle()},isEdited:function t(){return this.getTitle()!==this.getDefaultTitle()},getSettings:function t(){if(this.settings===null){var e=this.parent.getParam("DEFAULT_COLUMNS");this.settings=this.getId()in e?e[this.getId()]:{}}return this.settings},isDefault:function t(){if(this.default===null){var e=this.getSettings();this.default="default"in e?e.default:false}return this.default},restore:function t(){this.isDefault()?this.select():this.unselect();this.setTitle(this.getDefaultTitle());this.node.dataset.stickedDefault==="true"?this.stick():this.unstick();this.disableEdit();this.updateState()},getDefaultTitle:function t(){if(this.defaultTitle===null){var e=this.getSettings();this.defaultTitle="name"in e?e.name:this.lastTitle}return this.defaultTitle},getNode:function t(){return this.node},getLabel:function t(){if(this.label===null){this.label=BX.Grid.Utils.getByTag(this.getNode(),"label",true)}return this.label},getCheckbox:function t(){if(this.checkbox===null){this.checkbox=BX.Grid.Utils.getBySelector(this.getNode(),'input[type="checkbox"]',true)}return this.checkbox},getEditButton:function t(){if(this.editButton===null){this.editButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classSettingsWindowColumnEditButton"),true)}return this.editButton},enableEdit:function t(){this.getLabel().contentEditable=true;this.getCheckbox().disabled=true;this.adjustCaret()},disableEdit:function t(){this.getLabel().contentEditable=false;this.getCheckbox().disabled=false},isEditEnabled:function t(){return this.getLabel().isContentEditable},isSelected:function t(){return this.getCheckbox().checked},select:function t(){this.getCheckbox().checked=true},unselect:function t(){this.getCheckbox().checked=false},adjustCaret:function t(){var e=document.createRange();var i=window.getSelection();var n=this.getLabel().innerText.length;var s=this.getLabel().childNodes;var a=s[s.length-1];e.setStart(a,n);e.setEnd(a,n);e.collapse(true);i.removeAllRanges();i.addRange(e);BX.fireEvent(this.getNode(),"focus")}}})();(function(){BX.namespace("BX.Grid");BX.Grid.UserOptions=function(t,e,i,n){this.options=null;this.actions=null;this.parent=null;this.url=null;this.init(t,e,i,n)};BX.Grid.UserOptions.prototype={init:function init(parent,userOptions,userOptionsActions,url){this.url=url;this.parent=parent;try{this.options=eval(userOptions)}catch(t){console.warn("BX.Grid.UserOptions.init: Failed parse user options json string")}try{this.actions=eval(userOptionsActions)}catch(t){console.warn("BX.Grid.UserOptions.init: Failed parse user options actions json string")}},getCurrentViewName:function t(){var e=this.getOptions();return"current_view"in e?e.current_view:null},getViewsList:function t(){var e=this.getOptions();return"views"in e?e.views:{}},getCurrentOptions:function t(){var e=this.getCurrentViewName();var i=this.getViewsList();var n=null;if(e in i){n=i[e]}if(!BX.type.isPlainObject(n)){n={}}return n},getUrl:function t(e){return BX.util.add_url_param(this.url,{GRID_ID:this.parent.getContainerId(),bxajaxid:this.parent.getAjaxId(),action:e})},getOptions:function t(){return this.options||{}},getActions:function t(){return this.actions},getAction:function t(e){var i=null;try{i=this.getActions()[e]}catch(t){i=null}return i},update:function t(e){this.options=e},setColumns:function t(e,i){var n=this.getCurrentOptions();if(BX.type.isPlainObject(n)){n.columns=e.join(",");this.save(this.getAction("GRID_SET_COLUMNS"),{columns:n.columns},i)}return this},setColumnsNames:function t(e,i){var n={view_id:"default"};if(BX.type.isPlainObject(n)){n.custom_names=e;this.save(this.getAction("SET_CUSTOM_NAMES"),n,i)}return this},setColumnSizes:function t(e,i){this.save(this.getAction("GRID_SET_COLUMN_SIZES"),{sizes:e,expand:i})},reset:function t(e,i){var n={};if(!!e){n={view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()}}this.save(this.getAction("GRID_RESET"),n,i)},setSort:function t(e,i,n){if(e&&i){this.save(this.getAction("GRID_SET_SORT"),{by:e,order:i},n)}return this},setPageSize:function t(e,i){if(BX.type.isNumber(parseInt(e))){this.save(this.getAction("GRID_SET_PAGE_SIZE"),{pageSize:e},i)}},setExpandedRows:function t(e,i){BX.type.isArray(e)&&this.save(this.getAction("GRID_SET_EXPANDED_ROWS"),{ids:e},i)},setCollapsedGroups:function t(e,i){BX.type.isArray(e)&&this.save(this.getAction("GRID_SET_COLLAPSED_GROUPS"),{ids:e},i)},resetExpandedRows:function t(){this.save(this.getAction("GRID_RESET_EXPANDED_ROWS"),{})},saveForAll:function t(e){this.save(this.getAction("GRID_SAVE_SETTINGS"),{view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()},e)},batch:function t(e,i){this.save(this.getAction("GRID_SAVE_BATH"),{bath:e},i)},save:function t(e,i,n){var s=this;BX.ajax.post(this.getUrl(e),i,function(t){try{t=JSON.parse(t);if(!t.error){s.update(t);if(BX.type.isFunction(n)){n(t)}BX.onCustomEvent(s.parent.getContainer(),"Grid::optionsChanged",[s.parent])}}catch(t){}})}}})();(function(){BX.namespace("BX.Grid");BX.Grid.Utils={ajaxUrl:function t(e,i){return this.addUrlParams(e,{bxajaxid:i})},addUrlParams:function t(e,i){return BX.util.add_url_param(e,i)},arrayMove:function t(e,i,n){if(n>=e.length){var s=n-e.length;while(s--+1){e.push(undefined)}}e.splice(n,0,e.splice(i,1)[0]);return e},getIndex:function t(e,i){return[].indexOf.call(e||[],i)},getNext:function t(e){if(e){return e.nextElementSibling||null}},getPrev:function t(e){if(e){return e.previousElementSibling||null}},closestParent:function t(e,i){if(e){if(!i){return e.parentNode||null}else{return BX.findParent(e,{className:i})}}},closestChilds:function t(e){if(e){return e.children||null}},collectionSort:function t(e,i){var n,s,a,r,o;if(e&&i&&e!==i&&e.parentNode===i.parentNode){n=this.closestParent(i);s=this.closestChilds(n);a=s.length;r=this.getIndex(s,e);o=this.getIndex(s,i);if(a===o){n.appendChild(i)}if(r>o){n.insertBefore(e,i)}if(r<o&&a!==o){n.insertBefore(e,this.getNext(i))}}},getColumn:function t(e,i){var n=this.getIndex(this.closestChilds(this.closestParent(i)),i);var s=[];[].forEach.call(e.rows,function(t){s.push(t.cells[n])});return s},styleForEach:function t(e,i){i=BX.type.isPlainObject(i)?i:null;var n=Object.keys(i);[].forEach.call(e||[],function(t){n.forEach(function(e){BX.style(t,e,i[e])})})},requestAnimationFrame:function t(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};e.apply(window,arguments)},getByClass:function t(e,i,n){var s=[];if(i){s=e?e.getElementsByClassName(i):[];if(n){s=s.length?s[0]:null}else{s=[].slice.call(s)}}return s},getByTag:function t(e,i,n){var s=[];if(i){s=e?e.getElementsByTagName(i):[];if(n){s=s.length?s[0]:null}else{s=[].slice.call(s)}}return s},getBySelector:function t(e,i,n){var s=[];if(i){if(n){s=e?e.querySelector(i):null}else{s=e?e.querySelectorAll(i):[];s=[].slice.call(s)}}return s},listenerParams:function t(e){try{window.addEventListener("test",null,e)}catch(t){e=false}return e}}})();function _templateObject5$1(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="main-grid-empty-block">\n\t\t\t\t<div class="main-grid-empty-inner">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_templateObject5$1=function e(){return t};return t}function _templateObject4$1(){var t=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-empty-text">',"</div>"]);_templateObject4$1=function e(){return t};return t}function _templateObject3$1(){var t=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-empty-image"></div>']);_templateObject3$1=function e(){return t};return t}function _templateObject2$2(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="main-grid-empty-block-description">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"]);_templateObject2$2=function e(){return t};return t}function _templateObject$2(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="main-grid-empty-block-title">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"]);_templateObject$2=function e(){return t};return t}var Realtime=function(t){babelHelpers.inherits(e,t);function e(t){var i;babelHelpers.classCallCheck(this,e);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this));i.setEventNamespace("BX.Grid.Realtime");i.options=babelHelpers.objectSpread({},t);return i}babelHelpers.createClass(e,[{key:"addRow",value:function t(e){var i=this.options.grid;var n=i.getTemplateRow();n.makeCountable();i.hideEmptyStub();if(main_core.Type.isNumber(e.id)||main_core.Type.isStringFilled(e.id)){n.setId(e.id)}else{throw new ReferenceError("id is not number or string")}if(main_core.Type.isArrayFilled(e.actions)){n.setActions(e.actions)}if(main_core.Type.isPlainObject(e.columns)){n.setCellsContent(e.columns)}if(main_core.Type.isPlainObject(e.cellActions)){n.setCellActions(e.cellActions)}if(main_core.Type.isPlainObject(e.counters)){var s=Object.entries(e.counters).reduce(function(t,e){var i=babelHelpers.slicedToArray(e,2),n=i[0],s=i[1];if(main_core.Type.isPlainObject(s)){t[n]=babelHelpers.objectSpread({},s,{animation:main_core.Text.toBoolean(s.animation)})}return t},{});n.setCounters(s)}if(e.prepend===true){n.prependTo(i.getBody())}else if(e.append===true){n.appendTo(i.getBody())}else if(main_core.Type.isNumber(e.insertBefore)||main_core.Type.isStringFilled(e.insertBefore)){var a=i.getRows().getById(e.insertBefore);if(a){BX.Dom.insertBefore(n.getNode(),a.getNode())}}else if(main_core.Type.isNumber(e.insertAfter)||main_core.Type.isStringFilled(e.insertAfter)){var r=i.getRows().getById(e.insertAfter);if(r){BX.Dom.insertAfter(n.getNode(),r.getNode())}}else{throw new ReferenceError("prepend, append, insertBefore or insertAfter not filled")}n.show();if(e.animation!==false){n.enableAbsolutePosition();var o=i.getRows().getSourceBodyChild().filter(function(t){return t.rowIndex>n.getIndex()});var l=document.createElement("tr");main_core.Dom.style(l,{height:"0px",transition:"200ms height linear"});main_core.Dom.append(l,i.getBody());var d=n.getHeight();main_core.Dom.style(l,"height","".concat(d,"px"));o.forEach(function(t){main_core.Dom.style(t,{transition:"200ms transform linear",transform:"translateY(".concat(d,"px) translateZ(0)")})});main_core.Dom.addClass(n.getNode(),"main-ui-grid-show-new-row");main_core.Event.bind(n.getNode(),"animationend",function(t){if(t.animationName==="showNewRow"){o.forEach(function(t){main_core.Dom.style(t,{transition:null,transform:null})});main_core.Dom.remove(l);n.disableAbsolutePosition();main_core.Dom.removeClass(n.getNode(),"main-ui-grid-show-new-row")}})}i.getRows().reset();i.bindOnRowEvents();i.updateCounterDisplayed();i.updateCounterSelected();if(i.getParam("ALLOW_ROWS_SORT")){i.rowsSortable.reinit()}if(i.getParam("ALLOW_COLUMNS_SORT")){i.colsSortable.reinit()}}},{key:"showStub",value:function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=document.createElement("tr");main_core.Dom.addClass(n,"main-grid-row main-grid-row-empty main-grid-row-body");var s=document.createElement("td");main_core.Dom.addClass(s,"main-grid-cell main-grid-cell-center");var a=this.options.grid.getRows().getHeadFirstChild().getCells().length;main_core.Dom.attr(s,"colspan",a);var r=function(){if(main_core.Type.isPlainObject(i.content)){var t=[];if(main_core.Type.isStringFilled(i.content.title)){t.push(main_core.Tag.render(_templateObject$2(),i.content.title))}if(main_core.Type.isStringFilled(i.content.description)){t.push(main_core.Tag.render(_templateObject2$2(),i.content.description))}return t}if(main_core.Type.isStringFilled(i.content)||main_core.Type.isDomNode(i.content)){return i.content}return[main_core.Tag.render(_templateObject3$1()),main_core.Tag.render(_templateObject4$1(),e.options.grid.getParam("EMPTY_STUB_TEXT"))]}();var o=main_core.Tag.render(_templateObject5$1(),r);main_core.Dom.append(o,s);main_core.Dom.append(s,n);var l=this.options.grid.getBody().querySelector(".main-grid-row-empty");if(l){main_core.Dom.remove(l)}main_core.Dom.append(n,this.options.grid.getBody());this.options.grid.getRows().getBodyChild().forEach(function(t){t.hide()});this.options.grid.adjustEmptyTable(this.options.grid.getRows().getSourceBodyChild())}}]);return e}(main_core_events.EventEmitter);var namespace=main_core.Reflection.namespace("BX.Grid");namespace.Realtime=Realtime;var CellActions=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(CellActions,"PIN","main-grid-cell-content-action-pin");babelHelpers.defineProperty(CellActions,"MUTE","main-grid-cell-content-action-mute");var namespace$1=main_core.Reflection.namespace("BX.Grid");namespace$1.CellActions=CellActions;var CellActionState=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(CellActionState,"SHOW_BY_HOVER","main-grid-cell-content-action-by-hover");babelHelpers.defineProperty(CellActionState,"ACTIVE","main-grid-cell-content-action-active");var namespace$2=main_core.Reflection.namespace("BX.Grid");namespace$2.CellActionState=CellActionState;var Counters=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(Counters,"Type",{LEFT:"left",LEFT_ALIGNED:"left-aligned",RIGHT:"right"});babelHelpers.defineProperty(Counters,"Color",{DANGER:"ui-counter-danger",SUCCESS:"ui-counter-success",PRIMARY:"ui-counter-primary",GRAY:"ui-counter-gray",LIGHT:"ui-counter-light",DARK:"ui-counter-dark"});babelHelpers.defineProperty(Counters,"Size",{LARGE:"ui-counter-lg",MEDIUM:"ui-counter-md"});var namespace$3=main_core.Reflection.namespace("BX.Grid");namespace$3.Counters=Counters;var Label=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(Label,"Color",{DEFAULT:"ui-label-default",DANGER:"ui-label-danger",SUCCESS:"ui-label-success",WARNING:"ui-label-warning",PRIMARY:"ui-label-primary",SECONDARY:"ui-label-secondary",LIGHTGREEN:"ui-label-lightgreen",LIGHTBLUE:"ui-label-lightblue",LIGHT:"ui-label-light"});babelHelpers.defineProperty(Label,"RemoveButtonType",{INSIDE:"main-grid-tag-remove-inside",OUTSIDE:"main-grid-tag-remove-outside"});var namespace$4=main_core.Reflection.namespace("BX.Grid");namespace$4.Label=Label;(function(){BX.namespace("BX.Main");BX.Main.grid=function(t,e,i,n,s,a,r,o,l){BX.Event.EventEmitter.makeObservable(this,"BX.Main.Grid");this.settings=null;this.containerId="";this.container=null;this.wrapper=null;this.fadeContainer=null;this.scrollContainer=null;this.pagination=null;this.moreButton=null;this.table=null;this.rows=null;this.history=false;this.userOptions=null;this.checkAll=null;this.sortable=null;this.updater=null;this.data=null;this.fader=null;this.editor=null;this.isEditMode=null;this.pinHeader=null;this.pinPanel=null;this.arParams=null;this.resize=null;this.editableRows=[];this.init(t,e,i,n,s,a,r,o,l)};BX.Main.grid.isNeedResourcesReady=function(t){return BX.hasClass(t,"main-grid-load-animation")};BX.Main.grid.prototype={init:function t(e,i,n,s,a,r,o,l,d){this.baseUrl=window.location.pathname+window.location.search;this.container=BX(e);if(!BX.type.isNotEmptyString(e)){throw"BX.Main.grid.init: parameter containerId is empty"}if(BX.type.isPlainObject(i)){this.arParams=i}else{throw new Error("BX.Main.grid.init: arParams isn't object")}this.settings=new BX.Grid.Settings;this.containerId=e;this.userOptions=new BX.Grid.UserOptions(this,n,s,a);this.gridSettings=new BX.Grid.SettingsWindow(this);this.messages=new BX.Grid.Message(this,d);this.cache=new BX.Cache.MemoryCache;if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=new BX.Grid.PinHeader(this);BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.bindOnCheckAll,this))}this.bindOnCheckAll();if(this.getParam("ALLOW_HORIZONTAL_SCROLL")){this.fader=new BX.Grid.Fader(this)}this.pageSize=new BX.Grid.Pagesize(this);this.editor=new BX.Grid.InlineEditor(this,l);if(this.getParam("SHOW_ACTION_PANEL")){this.actionPanel=new BX.Grid.ActionPanel(this,r,o);this.pinPanel=new BX.Grid.PinPanel(this)}this.isEditMode=false;if(!BX.type.isDomNode(this.getContainer())){throw"BX.Main.grid.init: Failed to find container with id "+this.getContainerId()}if(!BX.type.isDomNode(this.getTable())){throw"BX.Main.grid.init: Failed to find table"}this.bindOnRowEvents();if(this.getParam("ALLOW_COLUMNS_RESIZE")){this.resize=new BX.Grid.Resize(this)}this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();if(this.getParam("ALLOW_ROWS_SORT")){this.initRowsDragAndDrop()}if(this.getParam("ALLOW_COLUMNS_SORT")){this.initColsDragAndDrop()}this.getRows().initSelected();this.adjustEmptyTable(this.getRows().getSourceBodyChild());BX.onCustomEvent(this.getContainer(),"Grid::ready",[this]);BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this));BX.addCustomEvent(window,"Grid::updated",BX.proxy(this._onGridUpdated,this));window.frames[this.getFrameId()].onresize=BX.throttle(this._onFrameResize,20,this);if(this.getParam("ALLOW_STICKED_COLUMNS")){this.initStickedColumns()}},destroy:function t(){BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this));BX.removeCustomEvent(window,"Grid::headerPinned",BX.proxy(this.bindOnCheckAll,this));this.getPinHeader()&&this.getPinHeader().destroy();this.getFader()&&this.getFader().destroy();this.getResize()&&this.getResize().destroy();this.getColsSortable()&&this.getColsSortable().destroy();this.getRowsSortable()&&this.getRowsSortable().destroy();this.getSettingsWindow()&&this.getSettingsWindow().destroy()},_onFrameResize:function t(){BX.onCustomEvent(window,"Grid::resize",[this])},_onGridUpdated:function t(){this.initStickedColumns();this.adjustFadePosition(this.getFadeOffset())},getFrameId:function t(){return"main-grid-tmp-frame-"+this.getContainerId()},enableActionsPanel:function t(){if(this.getParam("SHOW_ACTION_PANEL")){var e=this.getActionsPanel().getPanel();if(BX.type.isDomNode(e)){BX.removeClass(e,this.settings.get("classDisable"))}}},disableActionsPanel:function t(){if(this.getParam("SHOW_ACTION_PANEL")){var e=this.getActionsPanel().getPanel();if(BX.type.isDomNode(e)){BX.addClass(e,this.settings.get("classDisable"))}}},getSettingsWindow:function t(){return this.gridSettings},_onUnselectRows:function t(){var e=this.getActionsPanel();var i;if(e instanceof BX.Grid.ActionPanel){i=e.getForAllCheckbox();if(BX.type.isDomNode(i)){i.checked=null;this.disableForAllCounter()}}this.adjustCheckAllCheckboxes()},isIE:function t(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},isTouch:function t(){if(!BX.type.isBoolean(this.touch)){this.touch=BX.hasClass(document.documentElement,"bx-touch")}return this.touch},getParam:function t(e,i){if(i===undefined){i=null}return this.arParams.hasOwnProperty(e)?this.arParams[e]:i},getCounterTotal:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterTotal"),true)},getActionKey:function t(){return"action_button_"+this.getId()},getPinHeader:function t(){if(this.getParam("ALLOW_PIN_HEADER")){this.pinHeader=this.pinHeader||new BX.Grid.PinHeader(this)}return this.pinHeader},getResize:function t(){if(!(this.resize instanceof BX.Grid.Resize)&&this.getParam("ALLOW_COLUMNS_RESIZE")){this.resize=new BX.Grid.Resize(this)}return this.resize},confirmForAll:function t(e){var i;var n=this;if(BX.type.isDomNode(e)){i=BX.Grid.Utils.getByTag(e,"input",true)}if(i.checked){this.getActionsPanel().confirmDialog({CONFIRM:true,CONFIRM_MESSAGE:this.arParams.CONFIRM_FOR_ALL_MESSAGE},function(){if(BX.type.isDomNode(i)){i.checked=true}n.selectAllCheckAllCheckboxes();n.getRows().selectAll();n.enableForAllCounter();n.updateCounterDisplayed();n.updateCounterSelected();n.enableActionsPanel();n.adjustCheckAllCheckboxes();n.lastRowAction=null;BX.onCustomEvent(window,"Grid::allRowsSelected",[])},function(){if(BX.type.isDomNode(i)){i.checked=null;n.disableForAllCounter();n.updateCounterDisplayed();n.updateCounterSelected();n.adjustCheckAllCheckboxes();n.lastRowAction=null}})}else{this.unselectAllCheckAllCheckboxes();this.adjustCheckAllCheckboxes();this.getRows().unselectAll();this.disableForAllCounter();this.updateCounterDisplayed();this.updateCounterSelected();this.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}},disableCheckAllCheckboxes:function t(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().disabled=true})},enableCheckAllCheckboxes:function t(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().disabled=false})},indeterminateCheckAllCheckboxes:function t(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().indeterminate=true})},determinateCheckAllCheckboxes:function t(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().indeterminate=false})},editSelected:function t(){this.disableCheckAllCheckboxes();this.getRows().editSelected();if(this.getParam("ALLOW_PIN_HEADER")){this.getPinHeader()._onGridUpdate()}},editSelectedSave:function t(){var e={FIELDS:this.getRows().getEditSelectedValues(true)};if(this.getParam("ALLOW_VALIDATE")){this.tableFade();e[this.getActionKey()]="validate";this.getData().request("","POST",e,"validate",function(t){t=JSON.parse(t);if(t.messages.length){this.arParams["MESSAGES"]=t.messages;this.messages.show();var i=this.getActionsPanel().getButtons().find(function(t){return t.id==="grid_edit_button_control"});this.tableUnfade();BX.fireEvent(i,"click")}else{e[this.getActionKey()]="edit";this.reloadTable("POST",e)}}.bind(this));return}if(this.getParam("HANDLE_RESPONSE_ERRORS")){e[this.getActionKey()]="edit";var i=this;this.tableFade();this.getData().request("","POST",e,"",function(t){try{t=JSON.parse(t)}catch(e){t={messages:[]}}if(t.messages.length){i.arParams["MESSAGES"]=t.messages;i.messages.show();var e=i.getActionsPanel().getButtons().find(function(t){return t.id==="grid_edit_button_control"});i.tableUnfade();BX.fireEvent(e,"click");return}i.getRows().reset();var n=this.getBodyRows();i.getUpdater().updateHeadRows(this.getHeadRows());i.getUpdater().updateBodyRows(n);i.getUpdater().updateFootRows(this.getFootRows());i.getUpdater().updatePagination(this.getPagination());i.getUpdater().updateMoreButton(this.getMoreButton());i.getUpdater().updateCounterTotal(this.getCounterTotal());i.adjustEmptyTable(n);i.bindOnRowEvents();i.bindOnMoreButtonEvents();i.bindOnClickPaginationLinks();i.bindOnClickHeader();i.bindOnCheckAll();i.updateCounterDisplayed();i.updateCounterSelected();i.disableActionsPanel();i.disableForAllCounter();if(i.getParam("SHOW_ACTION_PANEL")){i.getUpdater().updateGroupActions(this.getActionPanel())}if(i.getParam("ALLOW_COLUMNS_SORT")){i.colsSortable.reinit()}if(i.getParam("ALLOW_ROWS_SORT")){i.rowsSortable.reinit()}i.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[i])},function(t){var e=i.getActionsPanel().getButtons().find(function(t){return t.id==="grid_edit_button_control"});i.tableUnfade();BX.fireEvent(e,"click")});return}e[this.getActionKey()]="edit";this.reloadTable("POST",e)},getForAllKey:function t(){return"action_all_rows_"+this.getId()},updateRow:function t(e,i,n,s){var a=this.getRows().getById(e);if(a instanceof BX.Grid.Row){a.update(i,n,s)}},removeRow:function t(e,i,n,s){var a=this.getRows().getById(e);if(a instanceof BX.Grid.Row){a.remove(i,n,s)}},addRow:function t(e,i,n){var s=this.getUserOptions().getAction("GRID_ADD_ROW");var a={action:s,data:e};var r=this;this.tableFade();this.getData().request(i,"POST",a,null,function(){var t=this.getBodyRows();r.getUpdater().updateBodyRows(t);r.tableUnfade();r.getRows().reset();r.getUpdater().updateFootRows(this.getFootRows());r.getUpdater().updatePagination(this.getPagination());r.getUpdater().updateMoreButton(this.getMoreButton());r.getUpdater().updateCounterTotal(this.getCounterTotal());r.bindOnRowEvents();r.adjustEmptyTable(t);r.bindOnMoreButtonEvents();r.bindOnClickPaginationLinks();r.updateCounterDisplayed();r.updateCounterSelected();if(r.getParam("ALLOW_COLUMNS_SORT")){r.colsSortable.reinit()}if(r.getParam("ALLOW_ROWS_SORT")){r.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowAdded",[{data:e,grid:r,response:this}]);BX.onCustomEvent(window,"Grid::updated",[r]);if(BX.type.isFunction(n)){n({data:e,grid:r,response:this})}})},editSelectedCancel:function t(){this.getRows().editSelectedCancel();if(this.getParam("ALLOW_PIN_HEADER")){this.getPinHeader()._onGridUpdate()}},removeSelected:function t(){var e={ID:this.getRows().getSelectedIds()};var i=this.getActionsPanel().getValues();e[this.getActionKey()]="delete";e[this.getForAllKey()]=this.getForAllKey()in i?i[this.getForAllKey()]:"N";this.reloadTable("POST",e)},sendSelected:function t(){var e=this.getActionsPanel().getValues();var i=this.getRows().getSelectedIds();var n={rows:i,controls:e};this.reloadTable("POST",n)},getActionsPanel:function t(){return this.actionPanel},getApplyButton:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanelButton"),true)},getEditor:function t(){return this.editor},reload:function t(e){this.reloadTable("GET",{},null,e)},getPanels:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanels"),true)},getEmptyBlock:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classEmptyBlock"),true)},adjustEmptyTable:function t(e){function i(t){var e=t.currentTarget;BX.style(l,"transform","translate3d("+BX.scrollLeft(e)+"px, 0px, 0")}var n=e.filter(function(t){return BX.Dom.attr(t,"data-id")!=="template_0"&&!BX.Dom.hasClass(t,"main-grid-hide")});if(!BX.hasClass(document.documentElement,"bx-ie")&&n.length===1&&BX.hasClass(n[0],this.settings.get("classEmptyRows"))){var s=BX.pos(this.getContainer());var a=BX.scrollTop(window)+BX.height(window);var r=s.bottom-a;var o=BX.height(this.getPanels());var l=this.getEmptyBlock();var d=BX.width(this.getContainer());if(d){BX.width(l,d)}BX.style(l,"transform","translate3d("+BX.scrollLeft(this.getScrollContainer())+"px, 0px, 0");BX.unbind(this.getScrollContainer(),"scroll",i);BX.bind(this.getScrollContainer(),"scroll",i);var c=this.getContainer();var h=0;while(c=c.parentElement){var u=parseFloat(BX.style(c,"padding-top"));var g=parseFloat(BX.style(c,"padding-bottom"));if(!isNaN(u)){h+=u}if(!isNaN(g)){h+=g}}if(r>0){BX.style(this.getTable(),"min-height",s.height-r-o-h+"px")}else{BX.style(this.getTable(),"min-height",s.height+Math.abs(r)-o-h+"px")}}else{BX.style(this.getTable(),"min-height","");BX.style(this.getTable(),"height","1px");requestAnimationFrame(function(){BX.style(this.getTable(),"height","1px")}.bind(this))}},reloadTable:function t(e,i,n,s){var a;if(!BX.type.isNotEmptyString(e)){e="GET"}if(!BX.type.isPlainObject(i)){i={}}var r=this;this.tableFade();if(!BX.type.isString(s)){s=""}this.getData().request(s,e,i,"",function(){BX.onCustomEvent(window,"BX.Main.Grid:onBeforeReload",[r]);r.getRows().reset();a=this.getBodyRows();r.getUpdater().updateHeadRows(this.getHeadRows());r.getUpdater().updateBodyRows(a);r.getUpdater().updateFootRows(this.getFootRows());r.getUpdater().updatePagination(this.getPagination());r.getUpdater().updateMoreButton(this.getMoreButton());r.getUpdater().updateCounterTotal(this.getCounterTotal());r.adjustEmptyTable(a);r.bindOnRowEvents();r.bindOnMoreButtonEvents();r.bindOnClickPaginationLinks();r.bindOnClickHeader();r.bindOnCheckAll();r.updateCounterDisplayed();r.updateCounterSelected();r.disableActionsPanel();r.disableForAllCounter();if(r.getParam("SHOW_ACTION_PANEL")){r.getUpdater().updateGroupActions(this.getActionPanel())}if(r.getParam("ALLOW_COLUMNS_SORT")){r.colsSortable.reinit()}if(r.getParam("ALLOW_ROWS_SORT")){r.rowsSortable.reinit()}r.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[r]);if(BX.type.isFunction(n)){n()}if(r.getParam("ALLOW_PIN_HEADER")){r.getPinHeader()._onGridUpdate()}})},getGroupEditButton:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupEditButton"),true)},getGroupDeleteButton:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupDeleteButton"),true)},enableGroupActions:function t(){var e=this.getGroupEditButton();var i=this.getGroupDeleteButton();if(BX.type.isDomNode(e)){BX.removeClass(e,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(i)){BX.removeClass(i,this.settings.get("classGroupActionsDisabled"))}},disableGroupActions:function t(){var e=this.getGroupEditButton();var i=this.getGroupDeleteButton();if(BX.type.isDomNode(e)){BX.addClass(e,this.settings.get("classGroupActionsDisabled"))}if(BX.type.isDomNode(i)){BX.addClass(i,this.settings.get("classGroupActionsDisabled"))}},closeActionsMenu:function t(){var e=this.getRows().getRows();for(var i=0,n=e.length;i<n;i++){e[i].closeActionsMenu()}},getPageSize:function t(){return this.pageSize},getFader:function t(){return this.fader},getData:function t(){this.data=this.data||new BX.Grid.Data(this);return this.data},getUpdater:function t(){this.updater=this.updater||new BX.Grid.Updater(this);return this.updater},isSortableHeader:function t(e){return BX.hasClass(e,this.settings.get("classHeaderSortable"))},isNoSortableHeader:function t(e){return BX.hasClass(e,this.settings.get("classHeaderNoSortable"))},bindOnClickHeader:function t(){var e=this;var i;BX.bind(this.getContainer(),"click",function(t){i=BX.findParent(t.target,{tag:"th"},true,false);if(i&&e.isSortableHeader(i)&&!e.preventSortableClick){e.preventSortableClick=false;e._clickOnSortableHeader(i,t)}})},enableEditMode:function t(){this.isEditMode=true},disableEditMode:function t(){this.isEditMode=false},isEditMode:function t(){return this.isEditMode},getColumnHeaderCellByName:function t(e){return BX.Grid.Utils.getBySelector(this.getContainer(),"#"+this.getId()+' th[data-name="'+e+'"]',true)},getColumnByName:function t(e){var i=this.getParam("DEFAULT_COLUMNS");return!!e&&e in i?i[e]:null},adjustIndex:function t(e){var i=this.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length;return e+i},getColumnByIndex:function t(e){e=this.adjustIndex(e);return this.getAllRows().reduce(function(t,i){if(!i.classList.contains("main-grid-row-custom")&&!i.classList.contains("main-grid-row-empty")){t.push(i.children[e])}return t},[])},getAllRows:function t(){var e=[].slice.call(this.getTable().rows);var i=this.getContainer().parentElement.querySelector(".main-grid-fixed-bar table");if(i){e.push(i.rows[0])}return e},initStickedColumns:function t(){[].slice.call(this.getAllRows()[0].children).forEach(function(t,e){if(t.classList.contains("main-grid-sticked-column")){this.stickyColumnByIndex(e)}},this);if(this.getParam("ALLOW_COLUMNS_RESIZE")){this.getResize().destroy();this.getResize().init(this)}},setStickedColumns:function t(e){if(BX.type.isArray(e)){var i=this.getUserOptions();var n=[{action:i.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:e}];i.batch(n,function(){this.reloadTable()}.bind(this))}},getStickedColumns:function t(){var e=[].slice.call(this.getHead().querySelectorAll(".main-grid-cell-head"));return e.reduce(function(t,e){if(BX.hasClass(e,"main-grid-fixed-column")&&!BX.hasClass(e,"main-grid-cell-checkbox")&&!BX.hasClass(e,"main-grid-cell-action")){t.push(e.dataset.name)}return t}.bind(this),[])},stickyColumnByIndex:function t(e){var i=this.getColumnByIndex(e);var n=i[0].clientWidth;var s=i.map(function(t){return BX.height(t)});i.forEach(function(t,e){t.style.minWidth=n+"px";t.style.width=n+"px";t.style.minHeight=s[e]+"px";var i=BX.clone(t);var a=this.getLastStickyCellFromRowByIndex(e);if(a){var r=parseInt(BX.style(a,"left"));var o=parseInt(BX.style(a,"width"));r=isNaN(r)?0:r;o=isNaN(o)?0:o;t.style.left=r+o+"px"}t.classList.add("main-grid-fixed-column");t.classList.add("main-grid-cell-static");i.classList.add("main-grid-cell-static");if(this.getColsSortable()){this.getColsSortable().unregister(t);this.getColsSortable().unregister(i)}BX.insertAfter(i,t)},this);this.adjustFadePosition(this.getFadeOffset())},adjustFixedColumnsPosition:function t(){var e=this.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length;var i=[].slice.call(this.getAllRows()[0].children).reduce(function(t,e,i,n){var s;var a;if(n[i-1]&&n[i-1].classList.contains("main-grid-fixed-column")){s=parseInt(BX.style(n[i-1],"left"));a=parseInt(BX.style(n[i-1],"width"));s=isNaN(s)?0:s;a=isNaN(a)?0:a;t.push({index:i+1,left:s+a})}return t},[]);i.forEach(function(t){var n=this.getColumnByIndex(t.index-e);n.forEach(function(e){if(t.index!==i[i.length-1].index){e.style.left=t.left+"px"}})},this);this.getAllRows().forEach(function(t){var e=BX.height(t);var i=[].slice.call(t.children);i.forEach(function(t){t.style.minHeight=e+"px"})})},getLastStickyCellFromRowByIndex:function t(e){return[].slice.call(this.getAllRows()[e].children).reduceRight(function(t,e){if(!t&&e.classList.contains("main-grid-fixed-column")){t=e}return t},null)},getFadeOffset:function t(){var e=0;var i=this.getLastStickyCellFromRowByIndex(0);if(i){var n=parseInt(BX.style(i,"left"));var s=i.offsetWidth;n=isNaN(n)?0:n;s=isNaN(s)?0:s;e=n+s}return e},adjustFadePosition:function t(e){var i=this.getFader().getEarLeft();var n=this.getFader().getShadowLeft();i.style.left=e+"px";n.style.left=e+"px"},sortByColumn:function t(e){var i=null;var n=null;if(!BX.type.isPlainObject(e)){i=this.getColumnHeaderCellByName(e);n=this.getColumnByName(e)}else{n=e;n.sort_url=this.prepareSortUrl(e)}if(n&&(!!i&&!BX.hasClass(i,this.settings.get("classLoad"))||!i)){!!i&&BX.addClass(i,this.settings.get("classLoad"));this.tableFade();var s=this;this.getUserOptions().setSort(n.sort_by,n.sort_order,function(){s.getData().request(n.sort_url,null,null,"sort",function(){s.rows=null;s.getUpdater().updateHeadRows(this.getHeadRows());s.getUpdater().updateBodyRows(this.getBodyRows());s.getUpdater().updatePagination(this.getPagination());s.getUpdater().updateMoreButton(this.getMoreButton());s.bindOnRowEvents();s.bindOnMoreButtonEvents();s.bindOnClickPaginationLinks();s.bindOnClickHeader();s.bindOnCheckAll();s.updateCounterDisplayed();s.updateCounterSelected();s.disableActionsPanel();s.disableForAllCounter();if(s.getParam("SHOW_ACTION_PANEL")){s.getActionsPanel().resetForAllCheckbox()}if(s.getParam("ALLOW_ROWS_SORT")){s.rowsSortable.reinit()}if(s.getParam("ALLOW_COLUMNS_SORT")){s.colsSortable.reinit()}BX.onCustomEvent(window,"BX.Main.grid:sort",[n,s]);BX.onCustomEvent(window,"Grid::updated",[s]);s.tableUnfade()})})}},prepareSortUrl:function t(e){var i=window.location.toString();if("sort_by"in e){i=BX.util.add_url_param(i,{by:e.sort_by})}if("sort_order"in e){i=BX.util.add_url_param(i,{order:e.sort_order})}return i},_clickOnSortableHeader:function t(e,i){i.preventDefault();this.sortByColumn(BX.data(e,"name"))},getObserver:function t(){return BX.Grid.observer},initRowsDragAndDrop:function t(){this.rowsSortable=new BX.Grid.RowsSortable(this)},initColsDragAndDrop:function t(){this.colsSortable=new BX.Grid.ColsSortable(this)},getRowsSortable:function t(){return this.rowsSortable},getColsSortable:function t(){return this.colsSortable},getUserOptionsHandlerUrl:function t(){return this.userOptionsHandlerUrl||""},getUserOptions:function t(){return this.userOptions},getCheckAllCheckboxes:function t(){var e=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCheckAllCheckboxes"));return e.map(function(t){return new BX.Grid.Element(t)})},selectAllCheckAllCheckboxes:function t(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().checked=true})},unselectAllCheckAllCheckboxes:function t(){this.getCheckAllCheckboxes().forEach(function(t){t.getNode().checked=false})},adjustCheckAllCheckboxes:function t(){var e=this.getRows().getBodyChild().filter(function(t){return t.isShown()&&!!t.getCheckbox()}).length;var i=this.getRows().getSelected().filter(function(t){return t.isShown()}).length;if(e>0&&i>0&&e===i){this.selectAllCheckAllCheckboxes()}else{this.unselectAllCheckAllCheckboxes()}if(i>0&&i<e){this.indeterminateCheckAllCheckboxes()}else{this.determinateCheckAllCheckboxes()}},bindOnCheckAll:function t(){var e=this;this.getCheckAllCheckboxes().forEach(function(t){t.getObserver().add(t.getNode(),"change",e._clickOnCheckAll,e)})},_clickOnCheckAll:function t(e){e.preventDefault();this.toggleSelectionAll();this.determinateCheckAllCheckboxes()},toggleSelectionAll:function t(){if(!this.getRows().isAllSelected()&&(this.lastRowAction==="select"||!this.lastRowAction)){this.getRows().selectAll();this.selectAllCheckAllCheckboxes();this.enableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsSelected",[this])}else{this.getRows().unselectAll();this.unselectAllCheckAllCheckboxes();this.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[this])}delete this.lastRowAction;this.updateCounterSelected()},bindOnClickPaginationLinks:function t(){var e=this;this.getPagination().getLinks().forEach(function(t){t.getObserver().add(t.getNode(),"click",e._clickOnPaginationLink,e)})},bindOnMoreButtonEvents:function t(){var e=this;this.getMoreButton().getObserver().add(this.getMoreButton().getNode(),"click",e._clickOnMoreButton,e)},bindOnRowEvents:function t(){var e=this.getObserver();var i=this.getParam("SHOW_ROW_CHECKBOXES");var n=this.getParam("ENABLE_COLLAPSIBLE_ROWS");this.getRows().getBodyChild().forEach(function(t){i&&e.add(t.getNode(),"click",this._onClickOnRow,this);t.getDefaultAction()&&e.add(t.getNode(),"dblclick",this._onRowDblclick,this);t.getActionsButton()&&e.add(t.getActionsButton(),"click",this._clickOnRowActionsButton,this);n&&t.getCollapseButton()&&e.add(t.getCollapseButton(),"click",this._onCollapseButtonClick,this)},this)},_onCollapseButtonClick:function t(e){e.preventDefault();e.stopPropagation();var i=this.getRows().get(e.currentTarget);i.toggleChildRows();if(i.isCustom()){this.getUserOptions().setCollapsedGroups(this.getRows().getIdsCollapsedGroups())}else{this.getUserOptions().setExpandedRows(this.getRows().getIdsExpandedRows())}BX.fireEvent(document.body,"click")},_clickOnRowActionsButton:function t(e){var i=this.getRows().get(e.target);e.preventDefault();if(!i.actionsMenuIsShown()){i.showActionsMenu()}else{i.closeActionsMenu()}},_onRowDblclick:function _onRowDblclick(event){event.preventDefault();var row=this.getRows().get(event.target);var defaultJs="";if(!row.isEdit()){clearTimeout(this.clickTimer);this.clickPrevent=true;try{defaultJs=row.getDefaultAction();eval(defaultJs)}catch(t){console.warn(t)}}},_onClickOnRow:function t(e){var i=50;var n=window.getSelection();if(e.target.nodeName==="LABEL"){e.preventDefault()}if(e.shiftKey||n.toString().length===0){if(e.shiftKey){n.removeAllRanges()}this.clickTimer=setTimeout(BX.delegate(function(){if(!this.clickPrevent){s.apply(this,[e])}this.clickPrevent=false},this),i)}function s(t){var e,i,n,s,a,r;var o=true;if(t.target.nodeName!=="A"&&t.target.nodeName!=="INPUT"){i=this.getRows().get(t.target);if(i){r=i.getContentContainer(t.target);if(BX.type.isDomNode(r)&&t.target.nodeName!=="TD"&&t.target!==r){o=BX.data(r,"prevent-default")==="true"}if(o){if(i.getCheckbox()){e=[];this.currentIndex=0;this.getRows().getRows().forEach(function(t,e){if(t===i){this.currentIndex=e}},this);this.lastIndex=this.lastIndex||this.currentIndex;if(!t.shiftKey){if(!i.isSelected()){this.lastRowAction="select";i.select();BX.onCustomEvent(window,"Grid::selectRow",[i,this])}else{this.lastRowAction="unselect";i.unselect();BX.onCustomEvent(window,"Grid::unselectRow",[i,this])}}else{s=Math.min(this.currentIndex,this.lastIndex);a=Math.max(this.currentIndex,this.lastIndex);while(s<=a){e.push(this.getRows().getRows()[s]);s++}n=e.some(function(t){return!t.isSelected()});if(n){e.forEach(function(t){t.select()});this.lastRowAction="select";BX.onCustomEvent(window,"Grid::selectRows",[e,this])}else{e.forEach(function(t){t.unselect()});this.lastRowAction="unselect";BX.onCustomEvent(window,"Grid::unselectRows",[e,this])}}this.updateCounterSelected();this.lastIndex=this.currentIndex}this.adjustRows();this.adjustCheckAllCheckboxes()}}}}},adjustRows:function t(){if(this.getRows().isSelected()){BX.onCustomEvent(window,"Grid::thereSelectedRows",[this]);this.enableActionsPanel()}else{BX.onCustomEvent(window,"Grid::noSelectedRows",[]);this.disableActionsPanel()}},getPagination:function t(){return new BX.Grid.Pagination(this)},getState:function t(){return window.history.state},tableFade:function t(){BX.addClass(this.getTable(),this.settings.get("classTableFade"));this.getLoader().show();BX.onCustomEvent("Grid::disabled",[this])},tableUnfade:function t(){BX.removeClass(this.getTable(),this.settings.get("classTableFade"));this.getLoader().hide();BX.onCustomEvent("Grid::enabled",[this])},_clickOnPaginationLink:function t(e){e.preventDefault();var i=this;var n=this.getPagination().getLink(e.target);if(!n.isLoad()){this.getUserOptions().resetExpandedRows();n.load();this.tableFade();this.getData().request(n.getLink(),null,null,"pagination",function(){i.rows=null;i.getUpdater().updateBodyRows(this.getBodyRows());i.getUpdater().updateHeadRows(this.getHeadRows());i.getUpdater().updateMoreButton(this.getMoreButton());i.getUpdater().updatePagination(this.getPagination());i.bindOnRowEvents();i.bindOnMoreButtonEvents();i.bindOnClickPaginationLinks();i.bindOnClickHeader();i.bindOnCheckAll();i.updateCounterDisplayed();i.updateCounterSelected();i.disableActionsPanel();i.disableForAllCounter();if(i.getParam("SHOW_ACTION_PANEL")){i.getActionsPanel().resetForAllCheckbox()}if(i.getParam("ALLOW_ROWS_SORT")){i.rowsSortable.reinit()}if(i.getParam("ALLOW_COLUMNS_SORT")){i.colsSortable.reinit()}n.unload();i.tableUnfade();BX.onCustomEvent(window,"Grid::updated",[i])})}},_clickOnMoreButton:function t(e){e.preventDefault();var i=this;var n=this.getMoreButton();n.load();this.getData().request(n.getLink(),null,null,"more",function(){i.getUpdater().appendBodyRows(this.getBodyRows());i.getUpdater().updateMoreButton(this.getMoreButton());i.getUpdater().updatePagination(this.getPagination());i.getRows().reset();i.bindOnRowEvents();i.bindOnMoreButtonEvents();i.bindOnClickPaginationLinks();i.bindOnClickHeader();i.bindOnCheckAll();i.updateCounterDisplayed();i.updateCounterSelected();if(i.getParam("ALLOW_PIN_HEADER")){i.getPinHeader()._onGridUpdate()}if(i.getParam("ALLOW_ROWS_SORT")){i.rowsSortable.reinit()}if(i.getParam("ALLOW_COLUMNS_SORT")){i.colsSortable.reinit()}i.unselectAllCheckAllCheckboxes()})},getAjaxId:function t(){return BX.data(this.getContainer(),this.settings.get("ajaxIdDataProp"))},update:function t(e,i){var n,s,a,r,o,l;if(!BX.type.isNotEmptyString(e)){return}r=BX.Grid.Utils.getByTag(this.getTable(),"tbody",true);o=BX.Grid.Utils.getByTag(this.getTable(),"thead",true);l=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classNavPanel"),true);e=BX.create("div",{html:e});s=BX.Grid.Utils.getByClass(e,this.settings.get("classHeadRow"));n=BX.Grid.Utils.getByClass(e,this.settings.get("classDataRows"));a=BX.Grid.Utils.getByClass(e,this.settings.get("classNavPanel"),true);if(i===this.settings.get("updateActionMore")){this.getRows().addRows(n);this.unselectAllCheckAllCheckboxes()}if(i===this.settings.get("updateActionPagination")){BX.cleanNode(r);this.getRows().addRows(n);this.unselectAllCheckAllCheckboxes()}if(i===this.settings.get("updateActionSort")){BX.cleanNode(o);BX.cleanNode(r);o.appendChild(s[0]);this.getRows().addRows(n)}l.innerHTML=a.innerHTML;this.bindOnRowEvents();this.bindOnMoreButtonEvents();this.bindOnClickPaginationLinks();this.bindOnClickHeader();this.bindOnCheckAll();this.updateCounterDisplayed();this.updateCounterSelected();this.sortable.reinit()},getCounterDisplayed:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterDisplayed"))},getCounterSelected:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterSelected"))},updateCounterDisplayed:function t(){var e=this.getCounterDisplayed();var i;if(BX.type.isArray(e)){i=this.getRows();e.forEach(function(t){if(BX.type.isDomNode(t)){t.innerText=i.getCountDisplayed()}},this)}},updateCounterSelected:function t(){var e=this.getCounterSelected();var i;if(BX.type.isArray(e)){i=this.getRows();e.forEach(function(t){if(BX.type.isDomNode(t)){t.innerText=i.getCountSelected()}},this)}},getContainerId:function t(){return this.containerId},getId:function t(){return this.containerId},getContainer:function t(){return BX(this.getContainerId())},getCounter:function t(){if(!this.counter){this.counter=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounter"))}return this.counter},enableForAllCounter:function t(){var e=this.getCounter();if(BX.type.isArray(e)){e.forEach(function(t){BX.addClass(t,this.settings.get("classForAllCounterEnabled"))},this)}},disableForAllCounter:function t(){var e=this.getCounter();if(BX.type.isArray(e)){e.forEach(function(t){BX.removeClass(t,this.settings.get("classForAllCounterEnabled"))},this)}},getScrollContainer:function t(){if(!this.scrollContainer){this.scrollContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classScrollContainer"),true)}return this.scrollContainer},getWrapper:function t(){if(!this.wrapper){this.wrapper=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classWrapper"),true)}return this.wrapper},getFadeContainer:function t(){if(!this.fadeContainer){this.fadeContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classFadeContainer"),true)}return this.fadeContainer},getTable:function t(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classTable"),true)},getHeaders:function t(){return BX.Grid.Utils.getBySelector(this.getWrapper(),'.main-grid-header[data-relative="'+this.getContainerId()+'"]')},getHead:function t(){return BX.Grid.Utils.getByTag(this.getContainer(),"thead",true)},getBody:function t(){return BX.Grid.Utils.getByTag(this.getContainer(),"tbody",true)},getFoot:function t(){return BX.Grid.Utils.getByTag(this.getContainer(),"tfoot",true)},getRows:function t(){if(!(this.rows instanceof BX.Grid.Rows)){this.rows=new BX.Grid.Rows(this)}return this.rows},getMoreButton:function t(){var e=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classMoreButton"),true);return new BX.Grid.Element(e,this)},getLoader:function t(){if(!(this.loader instanceof BX.Grid.Loader)){this.loader=new BX.Grid.Loader(this)}return this.loader},blockSorting:function t(){var e=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classHeadCell"));e.forEach(function(t){if(this.isSortableHeader(t)){BX.removeClass(t,this.settings.get("classHeaderSortable"));BX.addClass(t,this.settings.get("classHeaderNoSortable"))}},this)},unblockSorting:function t(){var e=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classHeadCell"));e.forEach(function(t){if(this.isNoSortableHeader(t)&&t.dataset.sortBy){BX.addClass(t,this.settings.get("classHeaderSortable"));BX.removeClass(t,this.settings.get("classHeaderNoSortable"))}},this)},confirmDialog:function t(e,i,n){var s,a,r,o;if("CONFIRM"in e&&e.CONFIRM){e.CONFIRM_MESSAGE=e.CONFIRM_MESSAGE||this.arParams.CONFIRM_MESSAGE;e.CONFIRM_APPLY_BUTTON=e.CONFIRM_APPLY_BUTTON||this.arParams.CONFIRM_APPLY;e.CONFIRM_CANCEL_BUTTON=e.CONFIRM_CANCEL_BUTTON||this.arParams.CONFIRM_CANCEL;s=new BX.PopupWindow(this.getContainerId()+"-confirm-dialog",null,{content:'<div class="main-grid-confirm-content">'+e.CONFIRM_MESSAGE+"</div>",titleBar:"CONFIRM_TITLE"in e?e.CONFIRM_TITLE:"",autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,events:{onClose:function t(){BX.unbind(window,"keydown",l)}},buttons:[new BX.PopupWindowButton({text:e.CONFIRM_APPLY_BUTTON,id:this.getContainerId()+"-confirm-dialog-apply-button",events:{click:function t(){BX.type.isFunction(i)?i():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogApply",[this]);BX.unbind(window,"keydown",l)}}}),new BX.PopupWindowButtonLink({text:e.CONFIRM_CANCEL_BUTTON,id:this.getContainerId()+"-confirm-dialog-cancel-button",events:{click:function t(){BX.type.isFunction(n)?n():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogCancel",[this]);BX.unbind(window,"keydown",l)}}})]});if(!s.isShown()){s.show();a=s.popupContainer;BX.removeClass(a,this.settings.get("classCloseAnimation"));BX.addClass(a,this.settings.get("classShowAnimation"));r=BX(this.getContainerId()+"-confirm-dialog-apply-button");o=BX(this.getContainerId()+"-confirm-dialog-cancel-button");BX.bind(window,"keydown",l)}}else{BX.type.isFunction(i)?i():null}function l(t){if(t.code==="Enter"){t.preventDefault();t.stopPropagation();BX.fireEvent(r,"click")}if(t.code==="Escape"){t.preventDefault();t.stopPropagation();BX.fireEvent(o,"click")}}},getEmptyStub:function t(){return this.getTable().querySelector(".main-grid-row-empty")},showEmptyStub:function t(){var e=this.getEmptyStub();if(e){BX.Dom.attr(e,"hidden",null)}},hideEmptyStub:function t(){var e=this.getEmptyStub();if(e){BX.Dom.attr(e,"hidden",true);BX.Dom.style(this.getTable(),"min-height",null)}},getTemplateRow:function t(){var e=BX.Runtime.clone(this.getRows().getBodyChild(true).find(function(t){return t.getId()==="template_0"}));var i=BX.Runtime.clone(e.getNode());BX.Dom.prepend(i,this.getBody());var n=i.querySelector('[type="checkbox"]');if(n){BX.Dom.attr(n,"disabled",null);BX.Dom.attr(n,"data-disabled",null)}return new BX.Grid.Row(this,i)},getRowEditorValue:function t(e){this.rows=null;return this.getRows().getSelected(e).map(function(t){return t.getEditorValue()})},getRowEditorActionPanel:function t(){if(!this.rowEditorActionPanel){this.rowEditorActionPanel=BX.Dom.create({tag:"div",props:{className:"main-ui-grid-row-editor-actions-panel"},children:[BX.Dom.create({tag:"span",props:{className:"ui-btn ui-btn-success"},text:this.arParams.SAVE_BUTTON_LABEL,events:{click:this.saveRows.bind(this)}}),BX.Dom.create({tag:"span",props:{className:"ui-btn ui-btn-link"},text:this.arParams.CANCEL_BUTTON_LABEL,events:{click:this.hideRowsEditor.bind(this)}})]})}return this.rowEditorActionPanel},showRowEditorActionsPanel:function t(){var e=this.getRowEditorActionPanel();BX.Dom.append(e,this.actionPanel.getPanel())},hideRowEditorActionsPanel:function t(){BX.Dom.remove(this.getRowEditorActionPanel())},prependRowEditor:function t(){return this.addRowEditor("prepend")},appendRowEditor:function t(){return this.addRowEditor("append")},addRowEditor:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"prepend";BX.Dom.style(this.getTable(),"min-height",null);var i=this.getTemplateRow();this.editableRows.push(i);if(e==="prepend"){i.prependTo(this.getBody())}else{i.appendTo(this.getBody())}i.show();i.select();i.edit();this.getRows().reset();if(this.getParam("ALLOW_ROWS_SORT")){this.rowsSortable.reinit()}if(this.getParam("ALLOW_COLUMNS_SORT")){this.colsSortable.reinit()}this.hideEmptyStub();return i},hideRowsEditor:function t(){this.editableRows.forEach(function(t){BX.Dom.remove(t.getNode())});this.editableRows=[]},saveRows:function t(){var e=this;var i=this.getRowEditorValue(true);this.emitAsync("onAddRowsAsync",{rows:i}).then(function(t){t.forEach(function(t,i){var n=e.editableRows[i];if(n){n.editCancel();n.unselect();n.makeCountable();n.setId(t.id);n.setActions(t.actions);n.setCellsContent(t.columns)}});e.bindOnRowEvents();e.updateCounterDisplayed();e.updateCounterSelected();e.editableRows=[]})},getRealtime:function t(){var e=this;return this.cache.remember("realtime",function(){return new BX.Grid.Realtime({grid:e})})}}})()})(this.window=this.window||{},BX.Event,BX,BX);
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.admin.set/templates/.default/script.js?16548423932527*/
; /* /bitrix/components/bitrix/app.placement/templates/menu/script.min.js?1654842249580*/
; /* /bitrix/components/bitrix/tasks.task.list/templates/.default/script.min.js?165484247031714*/
; /* /bitrix/components/bitrix/tasks.interface.header/templates/.default/script.min.js?16548424641711*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/script.min.js?165484246460*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?165484154145567*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1654841541575*/
; /* /bitrix/components/bitrix/tasks.interface.topmenu/templates/.default/logic.min.js?16548424642911*/
; /* /bitrix/components/bitrix/tasks.interface.filter/templates/.default/script.min.js?16548424645577*/
; /* /bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?165484154813312*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?1654841546154696*/
; /* /bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/script.min.js?16548424641339*/
; /* /bitrix/components/bitrix/tasks.interface.counters/templates/.default/script.min.js?165484246317136*/
; /* /bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?16548420241622*/
; /* /bitrix/components/bitrix/tasks.interface.toolbar/templates/.default/logic.min.js?16548424644483*/
; /* /bitrix/components/bitrix/tasks.interface.quick.form/templates/.default/script.min.js?165484246415089*/
; /* /bitrix/components/bitrix/main.ui.grid/templates/.default/script.min.js?1654841547186327*/

//# sourceMappingURL=page_0844a253cbc7482dab9f0c3f4b3eb836.map.js