
; /* Start:"a:4:{s:4:"full";s:76:"/local/js/im/lib/localstorage/dist/localstorage.bundle.min.js?16547598172914";s:6:"source";s:57:"/local/js/im/lib/localstorage/dist/localstorage.bundle.js";s:3:"min";s:61:"/local/js/im/lib/localstorage/dist/localstorage.bundle.min.js";s:3:"map";s:61:"/local/js/im/lib/localstorage/dist/localstorage.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var t=function(){function e(){babelHelpers.classCallCheck(this,e);this.enabled=null;this.expireList=null;this.expireInterval=null}babelHelpers.createClass(e,[{key:"isEnabled",value:function e(){if(this.enabled!==null){return this.enabled}this.enabled=false;if(typeof window.localStorage!=="undefined"){try{window.localStorage.setItem("__bx_test_ls_feature__","ok");if(window.localStorage.getItem("__bx_test_ls_feature__")==="ok"){window.localStorage.removeItem("__bx_test_ls_feature__");this.enabled=true}}catch(e){}}if(this.enabled&&!this.expireInterval){try{var t=window.localStorage.getItem("bx-messenger-localstorage-expire");if(t){this.expireList=JSON.parse(t)}}catch(e){}clearInterval(this.expireInterval);this.expireInterval=setInterval(this._checkExpireInterval.bind(this),6e4)}return this.enabled}},{key:"set",value:function e(t,i,r,s){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;if(!this.isEnabled()){return false}var l=null;if(n){l=new Date((new Date).getTime()+n*1e3)}var a=JSON.stringify({value:s,expire:l});if(window.localStorage.getItem(this._getKey(t,i,r))!==a){window.localStorage.setItem(this._getKey(t,i,r),a)}if(n){if(!this.expireList){this.expireList={}}this.expireList[this._getKey(t,i,r)]=l;window.localStorage.setItem("bx-messenger-localstorage-expire",JSON.stringify(this.expireList))}return true}},{key:"get",value:function e(t,i,r,s){if(!this.isEnabled()){return typeof s!=="undefined"?s:null}var n=window.localStorage.getItem(this._getKey(t,i,r));if(n===null){return typeof s!=="undefined"?s:null}try{n=JSON.parse(n);if(n&&typeof n.value!=="undefined"){if(!n.expire||new Date(n.expire)>new Date){n=n.value}else{window.localStorage.removeItem(this._getKey(t,i,r));if(this.expireList){delete this.expireList[this._getKey(t,i,r)]}return typeof s!=="undefined"?s:null}}else{return typeof s!=="undefined"?s:null}}catch(e){return typeof s!=="undefined"?s:null}return n}},{key:"remove",value:function e(t,i,r){if(!this.isEnabled()){return false}if(this.expireList){delete this.expireList[this._getKey(t,i,r)]}return window.localStorage.removeItem(this._getKey(t,i,r))}},{key:"_getKey",value:function e(t,i,r){return"bx-messenger-"+t+"-"+i+"-"+r}},{key:"_checkExpireInterval",value:function e(){if(!this.expireList)return true;var t=new Date;var i=0;for(var r in this.expireList){if(!this.expireList.hasOwnProperty(r)){continue}if(new Date(this.expireList[r])<=t){window.localStorage.removeItem(r);delete this.expireList[r]}else{i++}}if(i){window.localStorage.setItem("bx-messenger-localstorage-expire",JSON.stringify(this.expireList))}else{this.expireList=null;window.localStorage.removeItem("bx-messenger-localstorage-expire")}return true}}]);return e}();var i=new t;e.LocalStorage=i})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:64:"/local/js/im/lib/logger/dist/logger.bundle.min.js?16547598174491";s:6:"source";s:45:"/local/js/im/lib/logger/dist/logger.bundle.js";s:3:"min";s:49:"/local/js/im/lib/logger/dist/logger.bundle.min.js";s:3:"map";s:49:"/local/js/im/lib/logger/dist/logger.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var t=new WeakMap;var a=new WeakMap;var l=new WeakMap;var r=function(){function e(){babelHelpers.classCallCheck(this,e);t.set(this,{writable:true,value:{}});a.set(this,{writable:true,value:{}});l.set(this,{writable:true,value:{}});babelHelpers.classPrivateFieldSet(this,t,{desktop:true,log:false,info:false,warn:false,error:true,trace:true});babelHelpers.classPrivateFieldSet(this,a,babelHelpers.classPrivateFieldGet(this,t));this.__load()}babelHelpers.createClass(e,[{key:"setConfig",value:function e(l){for(var r in l){if(l.hasOwnProperty(r)&&typeof babelHelpers.classPrivateFieldGet(this,t)[r]!=="undefined"){babelHelpers.classPrivateFieldGet(this,t)[r]=!!l[r];babelHelpers.classPrivateFieldGet(this,a)[r]=!!l[r]}}this.__load()}},{key:"enable",value:function e(a){if(typeof babelHelpers.classPrivateFieldGet(this,t)[a]==="undefined"){return false}babelHelpers.classPrivateFieldGet(this,t)[a]=true;babelHelpers.classPrivateFieldGet(this,l)[a]=true;this.__save();return true}},{key:"disable",value:function e(a){if(typeof babelHelpers.classPrivateFieldGet(this,t)[a]==="undefined"){return false}babelHelpers.classPrivateFieldGet(this,t)[a]=false;babelHelpers.classPrivateFieldGet(this,l)[a]=false;this.__save();return true}},{key:"isEnabled",value:function e(a){return babelHelpers.classPrivateFieldGet(this,t)[a]===true}},{key:"desktop",value:function e(){if(this.isEnabled("desktop")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).log.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("desktop")),l))}}},{key:"log",value:function e(){if(this.isEnabled("log")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).log.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("log")),l))}}},{key:"info",value:function e(){if(this.isEnabled("info")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).info.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("info")),l))}}},{key:"warn",value:function e(){if(this.isEnabled("warn")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).warn.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("warn")),l))}}},{key:"error",value:function e(){if(this.isEnabled("error")){var t;for(var a=arguments.length,l=new Array(a),r=0;r<a;r++){l[r]=arguments[r]}(t=console).error.apply(t,[].concat(babelHelpers.toConsumableArray(this.__getStyles("error")),l))}}},{key:"trace",value:function e(){if(this.isEnabled("trace")){var t;(t=console).trace.apply(t,arguments)}}},{key:"__save",value:function e(){if(typeof window.localStorage!=="undefined"){try{var t={};for(var r in babelHelpers.classPrivateFieldGet(this,l)){if(babelHelpers.classPrivateFieldGet(this,l).hasOwnProperty(r)&&babelHelpers.classPrivateFieldGet(this,a)[r]!==babelHelpers.classPrivateFieldGet(this,l)[r]){t[r]=!!babelHelpers.classPrivateFieldGet(this,l)[r]}}console.warn(JSON.stringify(t));window.localStorage.setItem("bx-messenger-logger",JSON.stringify(t))}catch(e){}}}},{key:"__load",value:function e(){if(typeof window.localStorage!=="undefined"){try{var a=window.localStorage.getItem("bx-messenger-logger");if(typeof a==="string"){babelHelpers.classPrivateFieldSet(this,l,JSON.parse(a));babelHelpers.classPrivateFieldSet(this,t,babelHelpers.objectSpread({},babelHelpers.classPrivateFieldGet(this,t),babelHelpers.classPrivateFieldGet(this,l)))}}catch(e){}}}},{key:"__getStyles",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"all";var a={desktop:["%cDESKTOP","color: white; font-style: italic; background-color: #29619b; padding: 0 6px"],log:["%cLOG","color: #2a323b; font-style: italic; background-color: #ccc; padding: 0 6px"],info:["%cINFO","color: #fff; font-style: italic; background-color: #6b7f96; padding: 0 6px"],warn:["%cWARNING","color: white; font-style: italic; padding: 0 6px; border: 1px solid #f0a74f"],error:["%cERROR","color: white; font-style: italic; padding: 0 6px; border: 1px solid #8a3232"]};if(t==="all"){return a}if(a[t]){return a[t]}return[]}},{key:"__getRemoveString",value:function e(){var t=this.__getStyles();var a=[];for(var l in t){if(t.hasOwnProperty(l)){a.push(t[l][1])}}return a}}]);return e}();var s=new r;e.Logger=s})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:61:"/local/js/im/const/dist/registry.bundle.min.js?16547598176519";s:6:"source";s:42:"/local/js/im/const/dist/registry.bundle.js";s:3:"min";s:46:"/local/js/im/const/dist/registry.bundle.min.js";s:3:"map";s:46:"/local/js/im/const/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var i=Object.freeze({groupTitle:"groupTitle",message:"message",recentTitle:"recentTitle",recentLinesTitle:"recentLinesTitle",readedTitle:"readedTitle",default:"default",vacationTitle:"vacationTitle"});var t=Object.freeze({mobile:"mobile",desktop:"desktop"});var a=Object.freeze({horizontal:"horizontal",portrait:"portrait"});var s=Object.freeze({none:"none",add:"delete",update:"update",delete:"delete",set:"set",setAfter:"after",setBefore:"before"});var r=Object.freeze({dialogues:50,messages:100});var o=Object.freeze({imMessageAdd:"im.message.add",imMessageUpdate:"im.message.update",imMessageDelete:"im.message.delete",imMessageLike:"im.message.like",imMessageCommand:"im.message.command",imMessageShare:"im.message.share",imChatGet:"im.chat.get",imChatLeave:"im.chat.leave",imChatMute:"im.chat.mute",imChatParentJoin:"im.chat.parent.join",imDialogGet:"im.dialog.get",imDialogMessagesGet:"im.dialog.messages.get",imDialogRead:"im.dialog.read",imDialogUnread:"im.dialog.unread",imDialogWriting:"im.dialog.writing",imUserGet:"im.user.get",imUserListGet:"im.user.list.get",imDiskFolderGet:"im.disk.folder.get",imDiskFileUpload:"disk.folder.uploadfile",imDiskFileCommit:"im.disk.file.commit",mobileBrowserConstGet:"mobile.browser.const.get",imRecentGet:"im.recent.get",imRecentList:"im.recent.list",imCallGetCallLimits:"im.call.getCallLimits",imNotifyGet:"im.notify.get",imNotifySchemaGet:"im.notify.schema.get"});var l=Object.freeze({imChatGet:"im.chat.get",imMessageAdd:"im.message.add",imDialogRead:"im.dialog.read",imDialogMessagesGet:"im.dialog.messages.get",imDialogMessagesGetInit:"im.dialog.messages.get.init",imDialogMessagesGetUnread:"im.dialog.messages.get.unread",imDiskFolderGet:"im.disk.folder.get",imDiskFileUpload:"disk.folder.uploadfile",imDiskFileCommit:"im.disk.file.commit",imUserGet:"im.user.get",imUserListGet:"im.user.list.get",mobileBrowserConstGet:"mobile.browser.const.get",imRecentGet:"im.recent.get",imRecentList:"im.recent.list",imCallGetCallLimits:"im.call.getCallLimits",imNotifyGet:"im.notify.get",imNotifySchemaGet:"im.notify.schema.get"});var n=Object.freeze({dialog:{newMessage:"EventType.dialog.newMessage",scrollOnStart:"IM.Dialog:scrollOnStart",scrollToBottom:"IM.Dialog:scrollToBottom",readVisibleMessages:"IM.Dialog.readVisibleMessages",requestUnread:"IM.Dialog.requestUnread",readMessage:"IM.Dialog:readMessage",quoteMessage:"IM.Dialog:quoteMessage",clickOnCommand:"IM.Dialog:clickOnCommand",clickOnMention:"IM.Dialog:clickOnMention",clickOnUserName:"IM.Dialog:clickOnUserName",clickOnMessageMenu:"IM.Dialog:clickOnMessageMenu",clickOnMessageRetry:"IM.Dialog:clickOnMessageRetry",clickOnUploadCancel:"IM.Dialog:clickOnUploadCancel",clickOnReadList:"IM.Dialog:clickOnReadList",setMessageReaction:"IM.Dialog:setMessageReaction",openMessageReactionList:"IM.Dialog:openMessageReactionList",clickOnKeyboardButton:"IM.Dialog:clickOnKeyboardButton",clickOnChatTeaser:"IM.Dialog:clickOnChatTeaser",clickOnDialog:"IM.Dialog:clickOnDialog",quotePanelClose:"IM.Dialog:quotePanelClose",beforeMobileKeyboard:"IM.Dialog:beforeMobileKeyboard",messagesSet:"IM.Dialog:messagesSet"},textarea:{focus:"IM.Textarea:focus",setFocus:"IM.Textarea:setFocus",blur:"IM.Textarea:blur",setBlur:"IM.Textarea:setBlur",keyUp:"IM.Textarea:keyUp",edit:"IM.Textarea:edit",insertText:"IM.Textarea:insertText",sendMessage:"IM.Textarea:sendMessage",fileSelected:"IM.Textarea:fileSelected",startWriting:"IM.Textarea:startWriting",appButtonClick:"IM.Textarea:appButtonClick"},conference:{setPasswordFocus:"IM.Conference:setPasswordFocus",hideSmiles:"IM.Conference:hideSmiles",requestPermissions:"IM.Conference:requestPermissions",waitForStart:"IM.Conference:waitForStart",userRenameFocus:"IM.Conference:userRenameFocus",userRenameBlur:"IM.Conference:userRenameBlur"},notification:{updateState:"IM.Notifications:restoreConnection"}});var c=Object.freeze({private:"private",chat:"chat",open:"open",call:"call",crm:"crm"});var m=Object.freeze({lead:"lead",company:"company",contact:"contact",deal:"deal",none:"none"});var d=Object.freeze({listBody:"bx-im-dialog-list",listItem:"bx-im-dialog-list-item-reference",listItemName:"bx-im-dialog-list-item-name-reference",listItemBody:"bx-im-dialog-list-item-content-reference",listUnreadLoader:"bx-im-dialog-list-unread-loader-reference"});var g=Object.freeze({message:"message",delimiter:"delimiter",group:"group",historyLoader:"historyLoader",unreadLoader:"unreadLoader",button:"button",placeholder:"placeholder"});var M=Object.freeze({loading:"loading",empty:"empty",show:"show"});var f=Object.freeze({upload:"upload",wait:"wait",done:"done",error:"error"});var u=Object.freeze({image:"image",video:"video",audio:"audio",file:"file"});var p=Object.freeze({self:"self",opponent:"opponent",system:"system"});var C=Object.freeze({view:"view",edit:"edit",create:"create"});var h=Object.freeze({preparation:"preparation",call:"call"});var b=Object.freeze({userLimitReached:"userLimitReached",detectIntranetUser:"detectIntranetUser",bitrix24only:"bitrix24only",kickedFromCall:"kickedFromCall",unsupportedBrowser:"unsupportedBrowser",missingMicrophone:"missingMicrophone",unsafeConnection:"unsafeConnection",wrongAlias:"wrongAlias",notStarted:"notStarted",finished:"finished",userLeftCall:"userLeftCall",noSignalFromCamera:"noSignalFromCamera"});var D=Object.freeze({hidden:"hidden",chat:"chat",users:"users",split:"split"});var I=Object.freeze({Idle:"Idle",Busy:"Busy",Calling:"Calling",Unavailable:"Unavailable",Declined:"Declined",Ready:"Ready",Connecting:"Connecting",Connected:"Connected",Failed:"Failed"});var v={chat:"chat",open:"open",user:"user",notification:"notification"};var y={item:"item",placeholder:"placeholder"};var O={general:"general",pinned:"pinned"};var k={received:"received",delivered:"delivered",error:"error"};var T=Object.freeze({confirm:1,simple:3,placeholder:5});e.DateFormat=i;e.DeviceType=t;e.DeviceOrientation=a;e.MutationType=s;e.StorageLimit=r;e.RestMethod=o;e.RestMethodHandler=l;e.EventType=n;e.DialogType=c;e.DialogCrmType=m;e.DialogReferenceClassName=d;e.DialogTemplateType=g;e.DialogState=M;e.FileStatus=f;e.FileType=u;e.MessageType=p;e.ConferenceFieldState=C;e.ConferenceStateType=h;e.ConferenceErrorCode=b;e.ConferenceRightPanelMode=D;e.ConferenceUserState=I;e.ChatTypes=v;e.TemplateTypes=y;e.RecentSection=O;e.MessageStatus=k;e.NotificationTypesCodes=T})(this.BX.Messenger.Const=this.BX.Messenger.Const||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:63:"/local/js/im/lib/utils/dist/utils.bundle.min.js?165475981718118";s:6:"source";s:43:"/local/js/im/lib/utils/dist/utils.bundle.js";s:3:"min";s:47:"/local/js/im/lib/utils/dist/utils.bundle.min.js";s:3:"map";s:47:"/local/js/im/lib/utils/dist/utils.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t){"use strict";var i={browser:{isSafari:function e(){if(this.isChrome()){return false}if(!navigator.userAgent.toLowerCase().includes("safari")){return false}return!this.isSafariBased()},isSafariBased:function e(){if(!navigator.userAgent.toLowerCase().includes("applewebkit")){return false}return navigator.userAgent.toLowerCase().includes("yabrowser")||navigator.userAgent.toLowerCase().includes("yaapp_ios_browser")||navigator.userAgent.toLowerCase().includes("crios")},isChrome:function e(){return navigator.userAgent.toLowerCase().includes("chrome")},isFirefox:function e(){return navigator.userAgent.toLowerCase().includes("firefox")},isIe:function e(){return navigator.userAgent.match(/(Trident\/|MSIE\/)/)!==null},findParent:function e(t,i){var n=i instanceof HTMLElement;if(!i||typeof i!=="string"&&!n){return null}for(;t&&t!==document;t=t.parentNode){if(typeof i==="string"){if(t.classList.contains(i)){return t}}else if(n){if(t===i){return t}}}return null}},platform:{isMac:function e(){return navigator.userAgent.toLowerCase().includes("macintosh")},isLinux:function e(){return navigator.userAgent.toLowerCase().includes("linux")},isWindows:function e(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isBitrixMobile:function e(){return navigator.userAgent.toLowerCase().includes("bitrixmobile")},isBitrixDesktop:function e(){return navigator.userAgent.toLowerCase().includes("bitrixdesktop")},getDesktopVersion:function e(){if(typeof this.getDesktopVersionStatic!=="undefined"){return this.getDesktopVersionStatic}if(typeof BXDesktopSystem==="undefined"){return 0}var t=BXDesktopSystem.GetProperty("versionParts");this.getDesktopVersionStatic=t[3];return this.getDesktopVersionStatic},isMobile:function e(){return this.isAndroid()||this.isIos()||this.isBitrixMobile()},isIos:function e(){return navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")},getIosVersion:function e(){if(!this.isIos()){return null}var t=navigator.userAgent.toLowerCase().match(/(iphone|ipad)(.+)(OS\s([0-9]+)([_.]([0-9]+))?)/i);if(!t||!t[4]){return null}return parseFloat(t[4]+"."+(t[6]?t[6]:0))},isAndroid:function e(){return navigator.userAgent.toLowerCase().includes("android")},openNewPage:function e(t){if(!t){return false}if(this.isBitrixMobile()){if(typeof BX.MobileTools!=="undefined"){var i=BX.MobileTools.resolveOpenFunction(t);if(i){i();return true}}app.openNewPage(t)}else{window.open(t,"_blank")}return true}},device:{isDesktop:function e(){return!this.isMobile()},isMobile:function e(){if(typeof this.isMobileStatic!=="undefined"){return this.isMobileStatic}this.isMobileStatic=navigator.userAgent.toLowerCase().includes("android")||navigator.userAgent.toLowerCase().includes("webos")||navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")||navigator.userAgent.toLowerCase().includes("ipod")||navigator.userAgent.toLowerCase().includes("blackberry")||navigator.userAgent.toLowerCase().includes("windows phone");return this.isMobileStatic},orientationHorizontal:"horizontal",orientationPortrait:"portrait",getOrientation:function e(){if(!this.isMobile()){return this.orientationHorizontal}return Math.abs(window.orientation)===0?this.orientationPortrait:this.orientationHorizontal}},types:{isString:function e(t){return t===""?true:t?typeof t=="string"||t instanceof String:false},isArray:function e(t){return t&&Object.prototype.toString.call(t)=="[object Array]"},isFunction:function e(t){return t===null?false:typeof t=="function"||t instanceof Function},isDomNode:function e(t){return t&&babelHelpers.typeof(t)=="object"&&"nodeType"in t},isDate:function e(t){return t&&Object.prototype.toString.call(t)=="[object Date]"},isPlainObject:function e(t){if(!t||babelHelpers.typeof(t)!=="object"||t.nodeType){return false}var i=Object.prototype.hasOwnProperty;try{if(t.constructor&&!i.call(t,"constructor")&&!i.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var n;return typeof n==="undefined"||i.call(t,n)}},dialog:{getChatIdByDialogId:function e(t){if(!this.isChatId(t)){return 0}return parseInt(t.toString().substr(4))},isChatId:function e(t){return t.toString().startsWith("chat")},isEmptyDialogId:function e(t){if(!t){return true}if(typeof t==="string"){if(t==="chat0"||t==="0"){return true}}return false}},text:{quote:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,function(e,t,i){return i});t=t.replace(/\[CHAT=(imol\|)?([0-9]{1,})](.*?)[\/CHAT]/gi,function(e,t,i,n){return n});t=t.replace(/\[CALL(?:=(.+?))?](.+?)?\[\/CALL]/gi,function(e,t,i){return i?i:t});t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "});t=t.replace(/\[RATING=([1-5]{1})]/gi,function(e,t){return"["+r.IM_F_RATING+"] "});t=t.replace(/&nbsp;/gi," ");t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"]");t=t.replace(/^(>>(.*)\n)/gi,"["+r["IM_UTILS_TEXT_QUOTE"]+"]\n");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var a=[];i.FILE_ID.forEach(function(e){if(n[e].type==="image"){a.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){a.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){a.push(r["IM_UTILS_TEXT_VIDEO"])}else{a.push(n[e].name)}});if(a.length<=0){a.push(r["IM_UTILS_TEXT_FILE"])}t=a.join("\n")+t}else if(i&&i.ATTACH&&i.ATTACH.length>0){t="["+r["IM_UTILS_TEXT_ATTACH"]+"]\n"+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.trim()},purify:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(typeof t!=="string"){return t.toString()}if(!r){r=BX.message}t=t.trim();if(t.startsWith("/me")){t=t.substr(4)}else if(t.startsWith("/loud")){t=t.substr(6)}t=t.replace(/<br><br \/>/gi,"<br />");t=t.replace(/<br \/><br>/gi,"<br />");var a=[];t=t.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,function(e,t){var i=a.length;a.push(t);return"####REPLACEMENT_CODE_"+i+"####"});t=t.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,function(e,t,i){return i?i:t})});t=t.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,function(e,t,i){return i?i:t})});t=t.replace(/\[[buis]](.*?)\[\/[buis]]/gi,"$1");t=t.replace(/\[url](.*?)\[\/url]/gi,"$1");t=t.replace(/\[RATING=([1-5]{1})]/gi,function(){return"["+r["IM_UTILS_TEXT_RATING"]+"] "});t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,function(){return"["+r["IM_UTILS_TEXT_ATTACH"]+"] "});t=t.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,"$2");t=t.replace(/\[CHAT=([0-9]{1,})](.*?)\[\/CHAT]/gi,"$2");t=t.replace(/\[SEND(?:=(?:.+?))?\](.+?)?\[\/SEND]/gi,"$1");t=t.replace(/\[PUT(?:=(?:.+?))?\](.+?)?\[\/PUT]/gi,"$1");t=t.replace(/\[CALL=([0-9]{1,})](.*?)\[\/CALL]/gi,"$2");t=t.replace(/\[PCH=([0-9]{1,})](.*?)\[\/PCH]/gi,"$2");t=t.replace(/<img.*?data-code="([^"]*)".*?>/gi,"$1");t=t.replace(/<span.*?title="([^"]*)".*?>.*?<\/span>/gi,"($1)");t=t.replace(/<img.*?title="([^"]*)".*?>/gi,"($1)");t=t.replace(/\[ATTACH=([0-9]{1,})]/gi,function(e,t,i){return t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "});t=t.replace(/<s>([^"]*)<\/s>/gi," ");t=t.replace(/\[s]([^"]*)\[\/s]/gi," ");t=t.replace(/\[icon=([^\]]*)]/gi,function(e){var t=e.match(/title=(.*[^\s\]])/i);if(t&&t[1]){t=t[1];if(t.indexOf("width=")>-1){t=t.substr(0,t.indexOf("width="))}if(t.indexOf("height=")>-1){t=t.substr(0,t.indexOf("height="))}if(t.indexOf("size=")>-1){t=t.substr(0,t.indexOf("size="))}if(t){t="("+t.trim()+")"}}else{t="("+r["IM_UTILS_TEXT_ICON"]+")"}return t});a.forEach(function(e,i){t=t.replace("####REPLACEMENT_CODE_"+i+"####",e)});t=t.replace(/\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D([\s\S]*?)\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D\x2D/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/^(>>(.*)(\n)?)/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");t=t.replace(/<\/?[^>]+>/gi,"");if(i&&i.FILE_ID&&i.FILE_ID.length>0){var s=[];if(babelHelpers.typeof(n)==="object"){i.FILE_ID.forEach(function(e){if(typeof n[e]==="undefined");else if(n[e].type==="image"){s.push(r["IM_UTILS_TEXT_IMAGE"])}else if(n[e].type==="audio"){s.push(r["IM_UTILS_TEXT_AUDIO"])}else if(n[e].type==="video"){s.push(r["IM_UTILS_TEXT_VIDEO"])}else{s.push(n[e].name)}})}if(s.length<=0){s.push(r["IM_UTILS_TEXT_FILE"])}t=s.join(" ")+t}else if(i&&(i.WITH_ATTACH||i.ATTACH&&i.ATTACH.length>0)){t="["+r["IM_UTILS_TEXT_ATTACH"]+"] "+t}else if(i&&i.WITH_FILE){t="["+r["IM_UTILS_TEXT_FILE"]+"] "+t}if(t.length<=0){t=r["IM_UTILS_TEXT_DELETED"]}return t.replace("\n"," ").trim()},htmlspecialchars:function e(t){if(typeof t!=="string"){return t}return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlspecialcharsback:function e(t){if(typeof t!=="string"){return t}return t.replace(/\&quot;/g,'"').replace(/&#039;/g,"'").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&").replace(/\&nbsp;/g," ")},getLocalizeForNumber:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"en";var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!r){r=BX.message}var a=1;i=parseInt(i);if(i<0){i=i*-1}if(n){switch(n){case"de":case"en":a=i!==1?1:0;break;case"ru":case"ua":a=i%10===1&&i%100!==11?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2;break}}return r[t+"_PLURAL_"+a]}},date:{getFormatType:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:t.DateFormat.default;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){n=BX.message}var r=[];if(i===t.DateFormat.groupTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE"]]]}else if(i===t.DateFormat.message){r=[["",n["IM_UTILS_FORMAT_TIME"]]]}else if(i===t.DateFormat.recentTitle){r=[["tommorow","today"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(i===t.DateFormat.recentLinesTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",n["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(i===t.DateFormat.readedTitle){r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_READED"]]]}else if(i===t.DateFormat.vacationTitle){r=[["",n["IM_UTILS_FORMAT_DATE_SHORT"]]]}else{r=[["tommorow","tommorow, "+n["IM_UTILS_FORMAT_TIME"]],["today","today, "+n["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+n["IM_UTILS_FORMAT_TIME"]],["",n["IM_UTILS_FORMAT_DATE_TIME"]]]}return r},getDateFunction:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(BX.Main.Date);if(t){this.dateFormatFunction._getMessage=function(e){return t[e]}}return this.dateFormatFunction},format:function e(i){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!e){e=this.getFormatType(t.DateFormat.default,n)}return this.getDateFunction(n).format(e,i)},cast:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Date;var n=i;if(t instanceof Date){n=t}else if(typeof t==="string"){n=new Date(t)}else if(typeof t==="number"){n=new Date(t*1e3)}if(n instanceof Date&&Number.isNaN(n.getTime())){n=i}return n}},object:{countKeys:function e(t){var i=0;for(var n in t){if(t.hasOwnProperty(n)){i++}}return i}},user:{getLastDateText:function e(n){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!n){return""}var a=i.date.getDateFunction(r);if(!r){r=BX.message||{}}var s="";var o={};if(n.bot||n.network){s=""}else if(n.absent&&!this.isMobileActive(n,r)){o=this.getOnlineStatus(n,r);s=r["IM_STATUS_VACATION_TITLE"].replace("#DATE#",a.format(i.date.getFormatType(t.DateFormat.vacationTitle,r),n.absent.getTime()/1e3));if(o.isOnline&&n.idle){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(n,r))+". "+s}else if(o.isOnline&&!o.lastSeenText){s=o.statusText+". "+s}else if(o.lastSeenText){if(!i.platform.isMobile()){s=s+". "+r["IM_LAST_SEEN_"+(n.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}else if(n.lastActivityDate){o=this.getOnlineStatus(n,r);if(o.isOnline&&n.idle&&!this.isMobileActive(n,r)){s=r["IM_STATUS_AWAY_TITLE"].replace("#TIME#",this.getIdleText(n,r))}else if(o.isOnline&&!o.lastSeenText){if(i.platform.isMobile()&&this.isMobileActive(n,r)){s=r["IM_STATUS_MOBILE"]}else{s=o.statusText}}else if(o.lastSeenText){if(i.platform.isMobile()){s=r["IM_LAST_SEEN_SHORT_"+(n.gender==="F"?"F":"M")].replace("#LAST_SEEN#",o.lastSeenText)}else{s=r["IM_LAST_SEEN_"+(n.gender==="F"?"F":"M")].replace("#POSITION#",s).replace("#LAST_SEEN#",o.lastSeenText)}}}return s},getIdleText:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return""}if(!t.idle){return""}return i.date.getDateFunction(n).format([["s60","sdiff"],["i60","idiff"],["H24","Hdiff"],["","ddiff"]],t.idle)},getOnlineStatus:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r={isOnline:false,status:"offline",statusText:n?n.IM_STATUS_OFFLINE:"offline",lastSeen:t.lastActivityDate,lastSeenText:""};if(!t.lastActivityDate||t.lastActivityDate.getTime()===0){return r}var a=new Date;r.isOnline=a.getTime()-t.lastActivityDate.getTime()<=this.getOnlineLimit(n)*1e3;r.status=r.isOnline?t.status:"offline";r.statusText=n&&n["IM_STATUS_"+r.status.toUpperCase()]?n["IM_STATUS_"+r.status.toUpperCase()]:r.status;if(n&&t.lastActivityDate.getTime()>0&&a.getTime()-t.lastActivityDate.getTime()>300*1e3){r.lastSeenText=i.date.getDateFunction(n).formatLastActivityDate(t.lastActivityDate)}return r},isMobileActive:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!t){return false}if(!i){i=BX.message||{}}return t.mobileLastDate&&new Date-t.mobileLastDate<this.getOnlineLimit(i)*1e3&&t.lastActivityDate-t.mobileLastDate<300*1e3},getOnlineLimit:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!t){t=BX.message||{}}return t.LIMIT_ONLINE?parseInt(t.LIMIT_ONLINE):15*60}},isDarkColor:function e(t){if(!t||!t.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){return false}if(t.length===4){t=t.replace(/#([A-Fa-f0-9])/gi,"$1$1")}else{t=t.replace(/#([A-Fa-f0-9])/gi,"$1")}t=t.toLowerCase();var i=["#17a3ea","#00aeef","#00c4fb","#47d1e2","#75d900","#ffab00","#ff5752","#468ee5","#1eae43"];if(i.includes("#"+t)){return true}var n=parseInt(t,16);var r=n>>16&255;var a=n>>8&255;var s=n&255;var o=(r*299+a*587+s*114)/1e3;return o<128},hashCode:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=0;if(babelHelpers.typeof(t)==="object"&&t){t=JSON.stringify(t)}else if(typeof t!=="string"){t=t.toString()}if(typeof t!=="string"){return i}for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);i=(i<<5)-i+r;i=i&i}return i},versionCompare:function e(t,i){var n=/^([\d+\.]+)$/;if(!n.test(t)||!n.test(i)){return NaN}t=t.toString().split(".");i=i.toString().split(".");if(t.length<i.length){while(t.length<i.length){t.push(0)}}else if(i.length<t.length){while(i.length<t.length){i.push(0)}}for(var r=0;r<t.length;r++){if(t[r]>i[r]){return 1}else if(t[r]<i[r]){return-1}}return 0},throttle:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a);r=null};return function(){if(!r){a=arguments;r=setTimeout(s,i)}}},debounce:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this;var r=null;var a=null;var s=function e(){t.apply(n,a)};return function(){a=arguments;clearTimeout(r);r=setTimeout(s,i)}},getLogTrackingParams:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=[];var n=t.name,r=n===void 0?"tracking":n,a=t.data,s=a===void 0?[]:a,o=t.dialog,l=o===void 0?null:o,u=t.message,f=u===void 0?null:u,D=t.files,c=D===void 0?null:D;r=encodeURIComponent(r);if(s&&!(s instanceof Array)&&babelHelpers.typeof(s)==="object"){var x=[];for(var T in s){if(s.hasOwnProperty(T)){x.push(encodeURIComponent(T)+"="+encodeURIComponent(s[T]))}}s=x}else if(!s instanceof Array){s=[]}if(l){i.push("timType="+l.type);if(l.type==="lines"){i.push("timLinesType="+l.entityId.split("|")[0])}}if(c){var g="file";if(c instanceof Array&&c[0]){g=c[0].type}else{g=c.type}i.push("timMessageType="+g)}else if(f){i.push("timMessageType=text")}if(this.platform.isBitrixMobile()){i.push("timDevice=bitrixMobile")}else if(this.platform.isBitrixDesktop()){i.push("timDevice=bitrixDesktop")}else if(this.platform.isIos()||this.platform.isAndroid()){i.push("timDevice=mobile")}else{i.push("timDevice=web")}return r+(s.length?"&"+s.join("&"):"")+(i.length?"&"+i.join("&"):"")}};e.Utils=i})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{},BX.Messenger.Const);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:62:"/local/js/im/model/dist/registry.bundle.min.js?165475981797207";s:6:"source";s:42:"/local/js/im/model/dist/registry.bundle.js";s:3:"min";s:46:"/local/js/im/model/dist/registry.bundle.min.js";s:3:"map";s:46:"/local/js/im/model/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t,i,n,a,r,o,s){"use strict";var l=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"application"}},{key:"getState",value:function e(){return{common:{host:this.getVariable("common.host",location.protocol+"//"+location.host),siteId:this.getVariable("common.siteId","default"),userId:this.getVariable("common.userId",0),languageId:this.getVariable("common.languageId","en")},dialog:{dialogId:this.getVariable("dialog.dialogId","0"),chatId:this.getVariable("dialog.chatId",0),diskFolderId:this.getVariable("dialog.diskFolderId",0),messageLimit:this.getVariable("dialog.messageLimit",20),enableReadMessages:this.getVariable("dialog.enableReadMessages",true),messageExtraCount:0},disk:{enabled:false,maxFileSize:5242880},call:{serverEnabled:false,maxParticipants:24},mobile:{keyboardShow:false},device:{type:this.getVariable("device.type",s.DeviceType.desktop),orientation:this.getVariable("device.orientation",s.DeviceOrientation.portrait)},options:{quoteEnable:this.getVariable("options.quoteEnable",true),quoteFromRight:this.getVariable("options.quoteFromRight",true),autoplayVideo:this.getVariable("options.autoplayVideo",true),darkBackground:this.getVariable("options.darkBackground",false),showSmiles:false},error:{active:false,code:"",description:""}}}},{key:"getStateSaveException",value:function e(){return Object.assign({common:this.getVariable("saveException.common",null),dialog:this.getVariable("saveException.dialog",null),mobile:this.getVariable("saveException.mobile",null),device:this.getVariable("saveException.device",null),error:this.getVariable("saveException.error",null)})}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){i.commit("set",t.validate(n))},showSmiles:function e(t,i){t.commit("showSmiles")},hideSmiles:function e(t,i){t.commit("hideSmiles")}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){var a=false;for(var r in n){if(!n.hasOwnProperty(r)){continue}for(var o in n[r]){if(!n[r].hasOwnProperty(o)){continue}i[r][o]=n[r][o];a=true}}if(a&&t.isSaveNeeded(n)){t.saveState(i)}},increaseDialogExtraCount:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.count,a=n===void 0?1:n;t.dialog.messageExtraCount+=a},decreaseDialogExtraCount:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.count,a=n===void 0?1:n;var r=t.dialog.messageExtraCount-a;if(r<=0){r=0}t.dialog.messageExtraCount=r},clearDialogExtraCount:function e(t){t.dialog.messageExtraCount=0},showSmiles:function e(t){t.options.showSmiles=true},hideSmiles:function e(t){t.options.showSmiles=false}}}},{key:"validate",value:function e(t){var i={};if(babelHelpers.typeof(t.common)==="object"&&t.common){i.common={};if(typeof t.common.userId==="number"){i.common.userId=t.common.userId}if(typeof t.common.languageId==="string"){i.common.languageId=t.common.languageId}}if(babelHelpers.typeof(t.dialog)==="object"&&t.dialog){i.dialog={};if(typeof t.dialog.dialogId==="number"){i.dialog.dialogId=t.dialog.dialogId.toString();i.dialog.chatId=0}else if(typeof t.dialog.dialogId==="string"){i.dialog.dialogId=t.dialog.dialogId;if(typeof t.dialog.chatId!=="number"){var n=t.dialog.dialogId;if(n.startsWith("chat")){n=t.dialog.dialogId.substr(4)}n=parseInt(n);i.dialog.chatId=!isNaN(n)?n:0;t.dialog.chatId=i.dialog.chatId}}if(typeof t.dialog.chatId==="number"){i.dialog.chatId=t.dialog.chatId}if(typeof t.dialog.diskFolderId==="number"){i.dialog.diskFolderId=t.dialog.diskFolderId}if(typeof t.dialog.messageLimit==="number"){i.dialog.messageLimit=t.dialog.messageLimit}if(typeof t.dialog.messageExtraCount==="number"){i.dialog.messageExtraCount=t.dialog.messageExtraCount}if(typeof t.dialog.enableReadMessages==="boolean"){i.dialog.enableReadMessages=t.dialog.enableReadMessages}}if(babelHelpers.typeof(t.disk)==="object"&&t.disk){i.disk={};if(typeof t.disk.enabled==="boolean"){i.disk.enabled=t.disk.enabled}if(typeof t.disk.maxFileSize==="number"){i.disk.maxFileSize=t.disk.maxFileSize}}if(babelHelpers.typeof(t.call)==="object"&&t.call){i.call={};if(typeof t.call.serverEnabled==="boolean"){i.call.serverEnabled=t.call.serverEnabled}if(typeof t.call.maxParticipants==="number"){i.call.maxParticipants=t.call.maxParticipants}}if(babelHelpers.typeof(t.mobile)==="object"&&t.mobile){i.mobile={};if(typeof t.mobile.keyboardShow==="boolean"){i.mobile.keyboardShow=t.mobile.keyboardShow}}if(babelHelpers.typeof(t.device)==="object"&&t.device){i.device={};if(typeof t.device.type==="string"&&typeof s.DeviceType[t.device.type]!=="undefined"){i.device.type=t.device.type}if(typeof t.device.orientation==="string"&&typeof s.DeviceOrientation[t.device.orientation]!=="undefined"){i.device.orientation=t.device.orientation}}if(babelHelpers.typeof(t.error)==="object"&&t.error){if(typeof t.error.active==="boolean"){i.error={active:t.error.active,code:t.error.code.toString()||"",description:t.error.description.toString()||""}}}return i}}]);return t}(r.VuexBuilderModel);var c=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"conference"}},{key:"getState",value:function e(){return{common:{inited:false,passChecked:true,showChat:false,userCount:0,messageCount:0,userInCallCount:0,state:s.ConferenceStateType.preparation,callEnded:false,showSmiles:false,error:"",conferenceTitle:"",alias:"",permissionsRequested:false,conferenceStarted:null,conferenceStartDate:null,joinWithVideo:null,userReadyToJoin:false,isBroadcast:false,users:[],usersInCall:[],presenters:[],rightPanelMode:s.ConferenceRightPanelMode.hidden},user:{id:-1,hash:""}}}},{key:"getActions",value:function e(){return{showChat:function e(t,i){if(typeof i.newState!=="boolean"){return false}t.commit("showChat",i)},changeRightPanelMode:function e(t,i){if(!s.ConferenceRightPanelMode[i.mode]){return false}t.commit("changeRightPanelMode",i)},setPermissionsRequested:function e(t,i){if(typeof i.status!=="boolean"){return false}t.commit("setPermissionsRequested",i)},setPresenters:function e(t,i){if(!Array.isArray(i.presenters)){i.presenters=[i.presenters]}t.commit("setPresenters",i)},setUsers:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("setUsers",i)},removeUsers:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("removeUsers",i)},setUsersInCall:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("setUsersInCall",i)},removeUsersInCall:function e(t,i){if(!Array.isArray(i.users)){i.users=[i.users]}t.commit("removeUsersInCall",i)},setConferenceTitle:function e(t,i){if(typeof i.conferenceTitle!=="string"){return false}t.commit("setConferenceTitle",i)},setBroadcastMode:function e(t,i){if(typeof i.broadcastMode!=="boolean"){return false}t.commit("setBroadcastMode",i)}}}},{key:"getMutations",value:function e(){var t=this;return{common:function e(t,i){if(typeof i.inited==="boolean"){t.common.inited=i.inited}if(typeof i.passChecked==="boolean"){t.common.passChecked=i.passChecked}if(typeof i.userCount==="number"||typeof i.userCount==="string"){t.common.userCount=parseInt(i.userCount)}if(typeof i.messageCount==="number"||typeof i.messageCount==="string"){t.common.messageCount=parseInt(i.messageCount)}if(typeof i.userInCallCount==="number"||typeof i.userInCallCount==="string"){t.common.userInCallCount=parseInt(i.userInCallCount)}if(typeof i.componentError==="string"){t.common.componentError=i.componentError}if(typeof i.isBroadcast==="boolean"){t.common.isBroadcast=i.isBroadcast}if(Array.isArray(i.presenters)){t.common.presenters=i.presenters}},user:function e(i,n){if(typeof n.id==="number"){i.user.id=n.id}if(typeof n.hash==="string"&&n.hash!==i.user.hash){i.user.hash=n.hash}if(t.isSaveNeeded({user:n})){t.saveState(i)}},showChat:function e(t,i){var n=i.newState;t.common.showChat=n},changeRightPanelMode:function e(t,i){var n=i.mode;t.common.rightPanelMode=n},setPermissionsRequested:function e(t,i){t.common.permissionsRequested=i.status},startCall:function e(t,i){t.common.state=s.ConferenceStateType.call;t.common.callEnded=false},endCall:function e(t,i){t.common.state=s.ConferenceStateType.preparation;t.common.callEnded=true},returnToPreparation:function e(t,i){t.common.state=s.ConferenceStateType.preparation},toggleSmiles:function e(t,i){t.common.showSmiles=!t.common.showSmiles},setError:function e(t,i){if(typeof i.errorCode==="string"){t.common.error=i.errorCode}},setConferenceTitle:function e(t,i){t.common.conferenceTitle=i.conferenceTitle},setBroadcastMode:function e(t,i){t.common.isBroadcast=i.broadcastMode},setAlias:function e(t,i){if(typeof i.alias==="string"){t.common.alias=i.alias}},setJoinType:function e(t,i){if(typeof i.joinWithVideo==="boolean"){t.common.joinWithVideo=i.joinWithVideo}},setConferenceStatus:function e(t,i){if(typeof i.conferenceStarted==="boolean"){t.common.conferenceStarted=i.conferenceStarted}},setConferenceStartDate:function e(t,i){if(i.conferenceStartDate instanceof Date){t.common.conferenceStartDate=i.conferenceStartDate}},setUserReadyToJoin:function e(t,i){t.common.userReadyToJoin=true},setPresenters:function e(t,i){if(i.replace){t.common.presenters=i.presenters}else{i.presenters.forEach(function(e){e=parseInt(e);if(!t.common.presenters.includes(e)){t.common.presenters.push(e)}})}},setUsers:function e(t,i){i.users.forEach(function(e){e=parseInt(e);if(!t.common.users.includes(e)){t.common.users.push(e)}})},removeUsers:function e(t,i){t.common.users=t.common.users.filter(function(e){return!i.users.includes(parseInt(e))})},setUsersInCall:function e(t,i){i.users.forEach(function(e){e=parseInt(e);if(!t.common.usersInCall.includes(e)){t.common.usersInCall.push(e)}})},removeUsersInCall:function e(t,i){t.common.usersInCall=t.common.usersInCall.filter(function(e){return!i.users.includes(parseInt(e))})}}}},{key:"getStateSaveException",value:function e(){return{common:{inited:null,state:null,showSmiles:null,userCount:null,messageCount:null,userInCallCount:null,error:null,conferenceTitle:null,alias:null,conferenceStarted:null,conferenceStartDate:null,joinWithVideo:null,userReadyToJoin:null,rightPanelMode:null,presenters:null,users:null}}}}]);return t}(r.VuexBuilderModel);function u(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=d(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function d(e,t){if(!e)return;if(typeof e==="string")return f(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return f(e,t)}function f(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var p={empty:"empty",equal:"equal",none:"none",found:"found",foundReverse:"foundReverse"};var h=function(e){babelHelpers.inherits(r,e);function r(){babelHelpers.classCallCheck(this,r);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).apply(this,arguments))}babelHelpers.createClass(r,[{key:"getName",value:function e(){return"messages"}},{key:"getState",value:function e(){return{created:0,collection:{},mutationType:{},saveMessageList:{},saveFileList:{},saveUserList:{},host:this.getVariable("host",location.protocol+"//"+location.host)}}},{key:"getElementState",value:function e(){return{templateId:0,templateType:"message",placeholderType:0,id:0,chatId:0,authorId:0,date:new Date,text:"",textConverted:"",params:{TYPE:"default",COMPONENT_ID:"bx-im-view-message"},push:false,unread:false,sending:false,error:false,retry:false,blink:false}}},{key:"getGetters",value:function e(){var t=this;return{getMutationType:function e(t){return function(e){if(!t.mutationType[e]){return{initialType:s.MutationType.none,appliedType:s.MutationType.none}}return t.mutationType[e]}},getLastId:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return null}var i=0;for(var n=0;n<t.collection[e].length;n++){var a=t.collection[e][n];if(a.push||a.sending||a.id.toString().startsWith("temporary")){continue}if(i<a.id){i=a.id}}return i?i:null}},getMessage:function e(t){return function(e,i){if(!t.collection[e]||t.collection[e].length<=0){return null}for(var n=t.collection[e].length-1;n>=0;n--){if(t.collection[e][n].id===i){return t.collection[e][n]}}return null}},get:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return[]}return t.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState()}},getSaveFileList:function e(t){return function(e){return t.saveFileList}},getSaveUserList:function e(t){return function(e){return t.saveUserList}}}}},{key:"getActions",value:function e(){var t=this;return{add:function e(i,n){var a=t.validate(Object.assign({},n));a.params=Object.assign({},t.getElementState().params,a.params);a.id="temporary"+(new Date).getTime()+i.state.created;a.templateId=a.id;a.unread=false;i.commit("add",Object.assign({},t.getElementState(),a));if(n.sending!==false){i.dispatch("actionStart",{id:a.id,chatId:a.chatId})}return a.id},actionStart:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}i.chatId=parseInt(i.chatId);a.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:true}})})},actionError:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}i.chatId=parseInt(i.chatId);a.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:false,error:true,retry:i.retry!==false}})})},actionFinish:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}i.chatId=parseInt(i.chatId);a.Vue.nextTick(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{sending:false,error:false,retry:false}})})},set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return t.prepareMessage(e,{host:i.state.host})})}else{var a=t.prepareMessage(n,{host:i.state.host});(n=[]).push(a)}i.commit("set",{insertType:s.MutationType.set,data:n});return"set is done"},addPlaceholders:function e(i,n){if(n.placeholders instanceof Array){n.placeholders=n.placeholders.map(function(e){return t.prepareMessage(e,{host:i.state.host})})}else{return false}var a=n.requestMode==="history"?s.MutationType.setBefore:s.MutationType.setAfter;if(a===s.MutationType.setBefore){n.placeholders=n.placeholders.reverse()}i.commit("set",{insertType:a,data:n.placeholders});return n.placeholders[0].id},clearPlaceholders:function e(t,i){t.commit("clearPlaceholders",i)},updatePlaceholders:function e(i,n){if(n.data instanceof Array){n.data=n.data.map(function(e){return t.prepareMessage(e,{host:i.state.host})})}else{return false}i.commit("updatePlaceholders",n);return true},setAfter:function e(i,n){if(n instanceof Array){n=n.map(function(e){return t.prepareMessage(e)})}else{var a=t.prepareMessage(n);(n=[]).push(a)}i.commit("set",{insertType:s.MutationType.setAfter,data:n})},setBefore:function e(i,n){if(n instanceof Array){n=n.map(function(e){return t.prepareMessage(e)})}else{var a=t.prepareMessage(n);(n=[]).push(a)}i.commit("set",{insertType:s.MutationType.setBefore,data:n})},update:function e(i,n){if(/^\d+$/.test(n.id)){n.id=parseInt(n.id)}if(/^\d+$/.test(n.chatId)){n.chatId=parseInt(n.chatId)}i.commit("initCollection",{chatId:n.chatId});if(!i.state.collection[n.chatId]){return false}var a=i.state.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(a<0){return false}var r=t.validate(Object.assign({},n.fields));if(r.params){r.params=Object.assign({},t.getElementState().params,i.state.collection[n.chatId][a].params,r.params)}i.commit("update",{id:n.id,chatId:n.chatId,index:a,fields:r});if(n.fields.blink){setTimeout(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){if(!(i.id instanceof Array)){i.id=[i.id]}i.id=i.id.map(function(e){if(/^\d+$/.test(e)){e=parseInt(e)}return e});t.commit("delete",{chatId:i.chatId,elements:i.id});return true},clear:function e(t,i){i.chatId=parseInt(i.chatId);if(i.keepPlaceholders){t.commit("clearMessages",{chatId:i.chatId})}else{t.commit("clear",{chatId:i.chatId})}return true},applyMutationType:function e(t,i){i.chatId=parseInt(i.chatId);t.commit("applyMutationType",{chatId:i.chatId});return true},readMessages:function e(t,i){i.readId=parseInt(i.readId)||0;i.chatId=parseInt(i.chatId);if(typeof t.state.collection[i.chatId]==="undefined"){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var r=t.state.collection[i.chatId][a];if(!r.unread)continue;if(i.readId===0||r.id<=i.readId){n++}}t.commit("readMessages",{chatId:i.chatId,readId:i.readId});return{count:n}},unreadMessages:function e(t,i){i.unreadId=parseInt(i.unreadId)||0;i.chatId=parseInt(i.chatId);if(typeof t.state.collection[i.chatId]==="undefined"||!i.unreadId){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var r=t.state.collection[i.chatId][a];if(r.unread)continue;if(r.id>=i.unreadId){n++}}t.commit("unreadMessages",{chatId:i.chatId,unreadId:i.unreadId});return{count:n}}}}},{key:"getMutations",value:function e(){var n=this;return{initCollection:function e(t,i){return n.initCollection(t,i)},add:function e(i,a){n.initCollection(i,{chatId:a.chatId});i.collection[a.chatId].push(a);i.saveMessageList[a.chatId].push(a.id);i.created+=1;i.collection[a.chatId].sort(function(e,t){return e.id-t.id});n.saveState(i,a.chatId);t.Logger.warn("Messages model: saving state after add")},clearPlaceholders:function e(t,i){if(!t.collection[i.chatId]){return false}t.collection[i.chatId]=t.collection[i.chatId].filter(function(e){return!e.id.toString().startsWith("placeholder")})},updatePlaceholders:function e(i,a){var r="placeholder".concat(a.firstMessage);var o=i.collection[a.chatId].findIndex(function(e){return e.id===r});if(o>=0){var s;i.collection[a.chatId].splice(o,a.amount);(s=i.collection[a.chatId]).splice.apply(s,[o,0].concat(babelHelpers.toConsumableArray(a.data)))}i.collection[a.chatId].sort(function(e,t){return e.id-t.id});t.Logger.warn("Messages model: saving state after updating placeholders");n.saveState(i,a.chatId)},set:function e(a,r){t.Logger.warn("Messages model: set mutation",r);var o=[];var l=[];var c=false;var d=r.insertType;if(r.insertType===s.MutationType.set){(function(){r.insertType=s.MutationType.setAfter;var e={};r.data.forEach(function(t){if(!e[t.chatId]){e[t.chatId]=[]}e[t.chatId].push(t.id)});var i=function i(o){if(!e.hasOwnProperty(o))return"continue";n.initCollection(a,{chatId:o});t.Logger.warn("Messages model: messages before adding from request - ",a.collection[o].length);if(a.saveMessageList[o].length>e[o].length||e[o].length<s.StorageLimit.messages){a.collection[o]=a.collection[o].filter(function(t){return e[o].includes(t.id)});a.saveMessageList[o]=a.saveMessageList[o].filter(function(t){return e[o].includes(t)})}t.Logger.warn("Messages model: cache length",a.saveMessageList[o].length);var l=n.manageCacheBeforeSet(babelHelpers.toConsumableArray(a.saveMessageList[o].reverse()),e[o]);t.Logger.warn("Messages model: set intersection with cache",l);if(l.type===p.none){if(l.foundElements.length>0){a.collection[o]=a.collection[o].filter(function(e){return!l.foundElements.includes(e.id)});a.saveMessageList[o]=a.saveMessageList[o].filter(function(e){return!l.foundElements.includes(e)})}t.Logger.warn("Messages model: no intersection - removing cache");n.removeIntersectionCacheElements=a.collection[o].map(function(e){return e.id});a.collection[o]=a.collection[o].filter(function(e){return!n.removeIntersectionCacheElements.includes(e.id)});a.saveMessageList[o]=a.saveMessageList[o].filter(function(e){return!n.removeIntersectionCacheElements.includes(e)});n.removeIntersectionCacheElements=[]}else if(l.type===p.foundReverse){t.Logger.warn("Messages model: found reverse intersection");r.insertType=s.MutationType.setBefore;r.data=r.data.reverse()}};for(var o in e){var l=i(o);if(l==="continue")continue}})()}t.Logger.warn("Messages model: adding messages to model",r.data);var f=u(r.data),h;try{var m=function e(){var t=h.value;n.initCollection(a,{chatId:t.chatId});var i=a.collection[t.chatId].findIndex(function(e){return e.id===t.id});if(i>-1){delete t.templateId;a.collection[t.chatId][i]=Object.assign(a.collection[t.chatId][i],t)}else if(r.insertType===s.MutationType.setBefore){a.collection[t.chatId].unshift(t)}else if(r.insertType===s.MutationType.setAfter){a.collection[t.chatId].push(t)}o.push(t.chatId);if(n.store.getters["dialogues/canSaveChat"]&&n.store.getters["dialogues/canSaveChat"](t.chatId)){l.push(t.chatId)}};for(f.s();!(h=f.n()).done;){m()}}catch(e){f.e(e)}finally{f.f()}o=babelHelpers.toConsumableArray(new Set(o));l=babelHelpers.toConsumableArray(new Set(l));c=r.data.every(function(e){return e.push===true});t.Logger.warn("Is it fake push message?",c);o.forEach(function(e){a.collection[e].sort(function(e,t){return e.id-t.id});if(!c){t.Logger.warn("setting messagesSet = true for chatId = ",e);setTimeout(function(){i.EventEmitter.emit(s.EventType.dialog.messagesSet,{chatId:e});i.EventEmitter.emit(s.EventType.dialog.readVisibleMessages,{chatId:e})},100)}});if(d!==s.MutationType.setBefore){l.forEach(function(e){t.Logger.warn("Messages model: saving state after set");n.saveState(a,e)})}},update:function e(i,a){n.initCollection(i,{chatId:a.chatId});var r=-1;if(typeof a.index!=="undefined"&&i.collection[a.chatId][a.index]){r=a.index}else{r=i.collection[a.chatId].findIndex(function(e){return e.id===a.id})}if(r>=0){var o=i.saveMessageList[a.chatId].includes(i.collection[a.chatId][r].id)||a.fields.id&&!a.fields.id.toString().startsWith("temporary")&&i.collection[a.chatId][r].id.toString().startsWith("temporary");delete a.fields.templateId;i.collection[a.chatId][r]=Object.assign(i.collection[a.chatId][r],a.fields);if(o){t.Logger.warn("Messages model: saving state after update");n.saveState(i,a.chatId)}}},delete:function e(i,a){n.initCollection(i,{chatId:a.chatId});i.collection[a.chatId]=i.collection[a.chatId].filter(function(e){return!a.elements.includes(e.id)});if(i.saveMessageList[a.chatId].length>0){var r=u(a.elements),o;try{for(r.s();!(o=r.n()).done;){var s=o.value;if(i.saveMessageList[a.chatId].includes(s)){t.Logger.warn("Messages model: saving state after delete");n.saveState(i,a.chatId);break}}}catch(e){r.e(e)}finally{r.f()}}},clear:function e(t,i){n.initCollection(t,{chatId:i.chatId});t.collection[i.chatId]=[];t.saveMessageList[i.chatId]=[]},clearMessages:function e(t,i){n.initCollection(t,{chatId:i.chatId});t.collection[i.chatId]=t.collection[i.chatId].filter(function(e){return e.id.toString().startsWith("placeholder")});t.saveMessageList[i.chatId]=[]},applyMutationType:function e(t,i){if(typeof t.mutationType[i.chatId]==="undefined"){a.Vue.set(t.mutationType,i.chatId,{applied:false,initialType:s.MutationType.none,appliedType:s.MutationType.none,scrollStickToTop:0,scrollMessageId:0})}t.mutationType[i.chatId].applied=true},readMessages:function e(i,a){n.initCollection(i,{chatId:a.chatId});var r=false;for(var o=i.collection[a.chatId].length-1;o>=0;o--){var s=i.collection[a.chatId][o];if(!s.unread)continue;if(a.readId===0||s.id<=a.readId){i.collection[a.chatId][o]=Object.assign(i.collection[a.chatId][o],{unread:false});r=true}}if(r){t.Logger.warn("Messages model: saving state after reading");n.saveState(i,a.chatId)}},unreadMessages:function e(i,a){n.initCollection(i,{chatId:a.chatId});var r=false;for(var o=i.collection[a.chatId].length-1;o>=0;o--){var s=i.collection[a.chatId][o];if(s.unread)continue;if(s.id>=a.unreadId){i.collection[a.chatId][o]=Object.assign(i.collection[a.chatId][o],{unread:true});r=true}}if(r){t.Logger.warn("Messages model: saving state after unreading");n.saveState(i,a.chatId);n.updateSubordinateStates()}}}}},{key:"initCollection",value:function e(t,i){if(typeof i.chatId==="undefined"){return false}if(typeof i.chatId==="undefined"||typeof t.collection[i.chatId]!=="undefined"){return true}a.Vue.set(t.collection,i.chatId,i.messages?[].concat(i.messages):[]);a.Vue.set(t.saveMessageList,i.chatId,[]);a.Vue.set(t.saveFileList,i.chatId,[]);a.Vue.set(t.saveUserList,i.chatId,[]);return true}},{key:"prepareMessage",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t),i);n.params=Object.assign({},this.getElementState().params,n.params);n.templateId=n.id;return Object.assign({},this.getElementState(),n)}},{key:"manageCacheBeforeSet",value:function e(i,n){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;t.Logger.warn("manageCacheBeforeSet",i,n);var r={type:p.empty,foundElements:[],noneElements:[]};if(!i||i.length<=0){return r}var o=u(n),s;try{for(o.s();!(s=o.n()).done;){var l=s.value;if(i.includes(l)){if(r.type===p.empty){r.type=p.found}r.foundElements.push(l)}else{if(r.type===p.empty){r.type=p.none}r.noneElements.push(l)}}}catch(e){o.e(e)}finally{o.f()}if(r.type===p.found&&i.length===n.length&&r.foundElements.length===n.length){r.type=p.equal}else if(r.type===p.none&&!a&&r.foundElements.length>0){var c=this.manageCacheBeforeSet(i.reverse(),n.reverse(),true);if(c.type===p.found){c.type=p.foundReverse;return c}}return r}},{key:"updateSaveLists",value:function e(t,i){if(!this.isSaveAvailable()){return true}if(!i||!this.store.getters["dialogues/canSaveChat"]||!this.store.getters["dialogues/canSaveChat"](i)){return false}this.initCollection(t,{chatId:i});var n=0;var a=[];var r=[];var o=[];var l=this.store.getters["dialogues/getByChatId"](i);if(l&&l.type==="private"){o.push(parseInt(l.dialogId))}var c=0;for(var u=t.collection[i].length-1;u>=0;u--){if(t.collection[i][u].id.toString().startsWith("temporary")){continue}if(!t.collection[i][u].unread){c++}if(n>=s.StorageLimit.messages&&c>=50){break}a.unshift(t.collection[i][u].id);n++}a=a.slice(0,s.StorageLimit.messages);t.collection[i].filter(function(e){return a.includes(e.id)}).forEach(function(e){if(e.authorId>0){o.push(e.authorId)}if(e.params.FILE_ID instanceof Array){r=e.params.FILE_ID.concat(r)}});t.saveMessageList[i]=a;t.saveFileList[i]=babelHelpers.toConsumableArray(new Set(r));t.saveUserList[i]=babelHelpers.toConsumableArray(new Set(o));return true}},{key:"getSaveTimeout",value:function e(){return 150}},{key:"saveState",value:function e(i,n){if(!this.updateSaveLists(i,n)){return false}babelHelpers.get(babelHelpers.getPrototypeOf(r.prototype),"saveState",this).call(this,function(){var e={collection:{},saveMessageList:{},saveUserList:{},saveFileList:{}};var n=function n(a){if(!i.saveMessageList.hasOwnProperty(a)){return"continue"}if(!i.collection[a]){return"continue"}if(!e.collection[a]){e.collection[a]=[]}i.collection[a].filter(function(e){return i.saveMessageList[a].includes(e.id)}).forEach(function(t){if(t.templateType!=="placeholder"){e.collection[a].push(t)}});t.Logger.warn("Cache after updating",e.collection[a]);e.saveMessageList[a]=i.saveMessageList[a];e.saveFileList[a]=i.saveFileList[a];e.saveUserList[a]=i.saveUserList[a]};for(var a in i.saveMessageList){var r=n(a);if(r==="continue")continue}return e})}},{key:"updateSubordinateStates",value:function e(){this.store.dispatch("users/saveState");this.store.dispatch("files/saveState")}},{key:"validate",value:function e(t,i){var a={};if(typeof t.id==="number"){a.id=t.id}else if(typeof t.id==="string"){if(t.id.startsWith("temporary")||t.id.startsWith("placeholder")){a.id=t.id}else{a.id=parseInt(t.id)}}if(typeof t.templateId==="number"){a.templateId=t.templateId}else if(typeof t.templateId==="string"){if(t.templateId.startsWith("temporary")){a.templateId=t.templateId}else{a.templateId=parseInt(t.templateId)}}if(typeof t.templateType==="string"){a.templateType=t.templateType}if(typeof t.placeholderType==="number"){a.placeholderType=t.placeholderType}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){a.chatId=parseInt(t.chatId)}if(typeof t.date!=="undefined"){a.date=n.Utils.date.cast(t.date)}if(typeof t.textOriginal==="string"||typeof t.textOriginal==="number"){a.text=t.textOriginal.toString();if(typeof t.text==="string"||typeof t.text==="number"){a.textConverted=this.convertToHtml({text:t.text.toString(),isConverted:true})}}else{if(typeof t.text_converted!=="undefined"){t.textConverted=t.text_converted}if(typeof t.textConverted==="string"||typeof t.textConverted==="number"){a.textConverted=t.textConverted.toString()}if(typeof t.text==="string"||typeof t.text==="number"){a.text=t.text.toString();var r=typeof a.textConverted!=="undefined";a.textConverted=this.convertToHtml({text:r?a.textConverted:a.text,isConverted:r})}}if(typeof t.senderId!=="undefined"){t.authorId=t.senderId}else if(typeof t.author_id!=="undefined"){t.authorId=t.author_id}if(typeof t.authorId==="number"||typeof t.authorId==="string"){if(t.system===true||t.system==="Y"){a.authorId=0}else{a.authorId=parseInt(t.authorId)}}if(babelHelpers.typeof(t.params)==="object"&&t.params!==null){var o=this.validateParams(t.params,i);if(o){a.params=o}}if(typeof t.push==="boolean"){a.push=t.push}if(typeof t.sending==="boolean"){a.sending=t.sending}if(typeof t.unread==="boolean"){a.unread=t.unread}if(typeof t.blink==="boolean"){a.blink=t.blink}if(typeof t.error==="boolean"||typeof t.error==="string"){a.error=t.error}if(typeof t.retry==="boolean"){a.retry=t.retry}return a}},{key:"validateParams",value:function e(t,i){var a={};try{for(var r in t){if(!t.hasOwnProperty(r)){continue}if(r==="COMPONENT_ID"){if(typeof t[r]==="string"&&BX.Vue.isComponent(t[r])){a[r]=t[r]}}else if(r==="LIKE"){if(t[r]instanceof Array){a["REACTION"]={like:t[r].map(function(e){return parseInt(e)})}}}else if(r==="CHAT_LAST_DATE"){a[r]=n.Utils.date.cast(t[r])}else if(r==="AVATAR"){if(t[r]){a[r]=t[r].startsWith("http")?t[r]:i.host+t[r]}}else if(r==="NAME"){if(t[r]){a[r]=t[r]}}else if(r==="ATTACH"){a[r]=this.decodeAttach(t[r])}else{a[r]=t[r]}}}catch(e){}var o=false;for(var s in a){if(!a.hasOwnProperty(s)){continue}o=true;break}return o?a:null}},{key:"convertToHtml",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.quote,n=i===void 0?true:i,a=t.image,r=a===void 0?true:a,o=t.text,s=o===void 0?"":o,l=t.isConverted,c=l===void 0?false:l,u=t.enableBigSmile,d=u===void 0?true:u;s=s.trim();if(!c){s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}if(s.startsWith("/me")){s="<i>".concat(s.substr(4),"</i>")}else if(s.startsWith("/loud")){s="<b>".concat(s.substr(6),"</b>")}var f="&gt;&gt;";if(n&&s.indexOf(f)>=0){var p=s.split(c?"<br />":"\n");for(var h=0;h<p.length;h++){if(p[h].startsWith(f)){p[h]=p[h].replace(f,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++h<p.length&&p[h].startsWith(f)){p[h]=p[h].replace(f,"")}p[h-1]+="</div></div><br>"}}s=p.join("<br />")}s=s.replace(/\n/gi,"<br />");s=s.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");s=this.decodeBbCode(s,false,d);if(n){s=s.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\]<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a,r){return(r>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name"><span class="bx-im-message-content-quote-name-text">'+t+'</span><span class="bx-im-message-content-quote-name-time">'+i+"</span></div>"+n+"</div></div><br />"});s=s.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a){return(a>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"})}if(r){var m=false;s=s.replace(/<a(.*?)>(http[s]{0,1}:\/\/.*?)<\/a>/gi,function(e,t,i,n){if(!i.match(/(\.(jpg|jpeg|png|gif|webp)\?|\.(jpg|jpeg|png|gif|webp)$)/i)||i.indexOf("/docs/pub/")>0||i.indexOf("logout=yes")>0){return e}else{m=true;return(n>0?"<br />":"")+"<a"+t+' target="_blank" class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="BX.Messenger.Model.MessagesModel.hideErrorImage(this)"></a></span>'}});if(m){s=s.replace(/<\/span>(\n?)<br(\s\/?)>/gi,"</span>").replace(/<br(\s\/?)>(\n?)<br(\s\/?)>(\n?)<span/gi,"<br /><span")}}if(d){s=s.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,function e(t,i,n,a,r,o){return i+parseInt(n,10)*1.7+a+parseInt(r,10)*1.7+o})}if(s.substr(-6)=="<br />"){s=s.substr(0,s.length-6)}s=s.replace(/<br><br \/>/gi,"<br />");s=s.replace(/<br \/><br>/gi,"<br />");return s}},{key:"decodeBbCode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return r.decodeBbCode({text:t,textOnly:i,enableBigSmile:n})}},{key:"decodeAttach",value:function e(t){var i=this;if(Array.isArray(t)){t.forEach(function(e){e=i.decodeAttach(e)})}else if(babelHelpers.typeof(t)==="object"&&t!==null){for(var a in t){if(t.hasOwnProperty(a)){t[a]=this.decodeAttach(t[a])}}}else{if(typeof t==="string"){t=n.Utils.text.htmlspecialcharsback(t)}}return t}}],[{key:"decodeBbCode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.text,a=t.textOnly,r=a===void 0?false:a,o=t.enableBigSmile,s=o===void 0?true:o;var l=[];i=i.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,function(e){var t=l.length;l.push(e);return"####REPLACEMENT_PUT_"+t+"####"});var c=[];i=i.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,function(e){var t=c.length;c.push(e);return"####REPLACEMENT_SEND_"+t+"####"});var u=[];i=i.replace(/\[CODE\]\n?([\s\S]*?)\[\/CODE\]/gi,function(e,t){var i=u.length;u.push(t);return"####REPLACEMENT_CODE_"+i+"####"});i=i.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,function(e,t,i){var a=document.createElement("a");a.href=n.Utils.text.htmlspecialcharsback(t);a.target="_blank";a.text=n.Utils.text.htmlspecialcharsback(i);var r=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(r.indexOf(a.protocol)<=-1){return e}return a.outerHTML});i=i.replace(/\[url\]([^\]]+)\[\/url\]/gi,function(e,t){t=n.Utils.text.htmlspecialcharsback(t);var i=document.createElement("a");i.href=t;i.target="_blank";i.text=t;var a=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(a.indexOf(i.protocol)<=-1){return e}return i.outerHTML});i=i.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');i=i.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');i=i.replace(/\[BR\]/gi,"<br/>");i=i.replace(/\[([buis])\](.*?)\[(\/[buis])\]/gi,function(e,t,i,n){return"<"+t+">"+i+"<"+n+">"});i=i.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,n){return t?n:'<span class="bx-im-mention" data-type="CHAT" data-value="chat'+i+'">'+n+"</span>"});i=i.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,function(e,t,i){return'<span class="bx-im-mention" data-type="CALL" data-value="'+n.Utils.text.htmlspecialchars(t)+'">'+i+"</span>"});i=i.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});var d=0;if(s){d=i.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}i=i.replace(/\[icon\=([^\]]*)\]/gi,function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var i={src:t,border:0};var a=e.match(/size\=(\d+)/i);if(a&&a[1]){i["width"]=a[1];i["height"]=a[1]}else{var r=e.match(/width\=(\d+)/i);if(r&&r[1]){i["width"]=r[1]}var o=e.match(/height\=(\d+)/i);if(o&&o[1]){i["height"]=o[1]}if(i["width"]&&!i["height"]){i["height"]=i["width"]}else if(i["height"]&&!i["width"]){i["width"]=i["height"]}else if(i["height"]&&i["width"]);else{i["width"]=20;i["height"]=20}}i["width"]=i["width"]>100?100:i["width"];i["height"]=i["height"]>100?100:i["height"];if(s&&d===0&&i["width"]===i["height"]&&i["width"]===20){i["width"]=40;i["height"]=40}var l=e.match(/title\=(.*[^\s\]])/i);if(l&&l[1]){l=l[1];if(l.indexOf("width=")>-1){l=l.substr(0,l.indexOf("width="))}if(l.indexOf("height=")>-1){l=l.substr(0,l.indexOf("height="))}if(l.indexOf("size=")>-1){l=l.substr(0,l.indexOf("size="))}if(l){i["title"]=n.Utils.text.htmlspecialchars(l).trim();i["alt"]=i["title"]}}var c="";for(var u in i){if(i.hasOwnProperty(u)){c+=u+'="'+i[u]+'" '}}return'<img class="bx-smile bx-icon" '+c+">"});c.forEach(function(e,t){i=i.replace("####REPLACEMENT_SEND_"+t+"####",e)});i=i.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(!r&&i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);t=t.split("####REPLACEMENT_PUT_").join("####REPLACEMENT_SP_");n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="send">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n})});l.forEach(function(e,t){i=i.replace("####REPLACEMENT_PUT_"+t+"####",e)});i=i.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(!r&&i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);n="\x3c!--IM_COMMAND_START--\x3e"+'<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="put">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"+"\x3c!--IM_COMMAND_END--\x3e"}else{n=i}return n})});u.forEach(function(e,t){i=i.replace("####REPLACEMENT_CODE_"+t+"####",!r?'<div class="bx-im-message-content-code">'+e+"</div>":e)});if(c.length>0){do{c.forEach(function(e,t){i=i.replace("####REPLACEMENT_SEND_"+t+"####",e)})}while(i.includes("####REPLACEMENT_SEND_"))}i=i.split("####REPLACEMENT_SP_").join("####REPLACEMENT_PUT_");if(l.length>0){do{l.forEach(function(e,t){i=i.replace("####REPLACEMENT_PUT_"+t+"####",e)})}while(i.includes("####REPLACEMENT_PUT_"))}return i}},{key:"hideErrorImage",value:function e(t){if(t.parentNode&&t.parentNode){t.parentNode.innerHTML='<a href="'+t.src+'" target="_blank">'+t.src+"</a>"}return true}}]);return r}(r.VuexBuilderModel);function m(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=g(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function g(e,t){if(!e)return;if(typeof e==="string")return y(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return y(e,t)}function y(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var v=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"dialogues"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},saveDialogList:[],saveChatList:[]}}},{key:"getStateSaveException",value:function e(){return{host:null}}},{key:"getElementStateSaveException",value:function e(){return{writingList:null,quoteId:null}}},{key:"getElementState",value:function e(){return{dialogId:"0",chatId:0,counter:0,userCounter:0,messageCount:0,unreadId:0,lastMessageId:0,managerList:[],readedList:[],writingList:[],muteList:[],textareaMessage:"",quoteId:0,editId:0,init:false,name:"",owner:0,extranet:false,avatar:"",color:"#17A3EA",type:"chat",entityType:"",entityId:"",entityData1:"",entityData2:"",entityData3:"",dateCreate:new Date,restrictions:{avatar:true,extend:true,leave:true,leaveOwner:true,rename:true},public:{code:"",link:""}}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e){if(!t.collection[e]){return null}return t.collection[e]}},getByChatId:function e(t){return function(e){e=parseInt(e);for(var i in t.collection){if(!t.collection.hasOwnProperty(i)){continue}if(t.collection[i].chatId===e){return t.collection[i]}}return null}},getBlank:function e(i){return function(e){return t.getElementState()}},getQuoteId:function e(t){return function(e){if(!t.collection[e]){return 0}return t.collection[e].quoteId}},getEditId:function e(t){return function(e){if(!t.collection[e]){return 0}return t.collection[e].editId}},canSaveChat:function e(t){return function(e){if(/^\d+$/.test(e)){e=parseInt(e)}return t.saveChatList.includes(parseInt(e))}},canSaveDialog:function e(t){return function(e){return t.saveDialogList.includes(e.toString())}},isPrivateDialog:function e(t){return function(e){e=e.toString();return t.collection[e.toString()]&&t.collection[e].type==="private"}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}i.commit("update",{dialogId:n.dialogId,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.dialogId);return true},updateWriting:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}var a=i.state.collection[n.dialogId].writingList.findIndex(function(e){return e.userId===n.userId});if(n.action){if(a>=0){return true}else{var r=[].concat(i.state.collection[n.dialogId].writingList);r.unshift({userId:n.userId,userName:n.userName});i.commit("update",{actionName:"updateWriting/1",dialogId:n.dialogId,fields:t.validate({writingList:r},{host:i.state.host})})}}else{if(a>=0){var o=i.state.collection[n.dialogId].writingList.filter(function(e){return e.userId!==n.userId});i.commit("update",{actionName:"updateWriting/2",dialogId:n.dialogId,fields:t.validate({writingList:o},{host:i.state.host})});return true}else{return true}}return false},updateReaded:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}var a=i.state.collection[n.dialogId].readedList.filter(function(e){return e.userId!==n.userId});if(n.action){a.push({userId:n.userId,userName:n.userName||"",messageId:n.messageId,date:n.date||new Date})}i.commit("update",{actionName:"updateReaded",dialogId:n.dialogId,fields:t.validate({readedList:a},{host:i.state.host})});return false},increaseCounter:function e(t,i){var n;if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var a=t.state.collection[i.dialogId].counter;if(a===100){return true}var r=a+i.count;if(r>100){r=100}var o=(n=t.rootState.application)===null||n===void 0?void 0:n.common.userId;var s=o&&t.state.collection[i.dialogId].muteList.includes(o);t.commit("update",{actionName:"increaseCounter",dialogId:i.dialogId,dialogMuted:s,fields:{counter:r,previousCounter:a}});return false},decreaseCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].counter;if(n===100){return true}var a=n-i.count;if(a<0){a=0}var r=i.unreadId>t.state.collection[i.dialogId].unreadId?i.unreadId:t.state.collection[i.dialogId].unreadId;if(t.state.collection[i.dialogId].unreadId!==r||t.state.collection[i.dialogId].counter!==a){var o;var s=t.state.collection[i.dialogId].counter;if(a===0){r=0}var l=(o=t.rootState.application)===null||o===void 0?void 0:o.common.userId;var c=l&&t.state.collection[i.dialogId].muteList.includes(l);t.commit("update",{actionName:"decreaseCounter",dialogId:i.dialogId,dialogMuted:c,fields:{counter:a,previousCounter:s,unreadId:r}})}return false},increaseMessageCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].messageCount;t.commit("update",{actionName:"increaseMessageCount",dialogId:i.dialogId,fields:{messageCount:n+i.count}})},saveDialog:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}t.commit("saveDialog",{dialogId:i.dialogId,chatId:i.chatId});return false}}}},{key:"getMutations",value:function e(){var t=this;return{initCollection:function e(i,n){t.initCollection(i,n)},saveDialog:function e(i,n){if(!(n.chatId>0&&n.dialogId.length>0)){return false}var a=i.saveDialogList.filter(function(e){return e!==n.dialogId});a.unshift(n.dialogId);a=a.slice(0,s.StorageLimit.dialogues);if(i.saveDialogList.join(",")===a.join(",")){return true}i.saveDialogList=a;var r=i.saveChatList.filter(function(e){return e!==n.chatId});r.unshift(n.chatId);i.saveChatList=r.slice(0,s.StorageLimit.dialogues);t.saveState(i)},set:function e(i,n){var a=m(n),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;t.initCollection(i,{dialogId:o.dialogId});i.collection[o.dialogId]=Object.assign(t.getElementState(),i.collection[o.dialogId],o)}}catch(e){a.e(e)}finally{a.f()}t.saveState(i)},update:function e(i,n){t.initCollection(i,n);i.collection[n.dialogId]=Object.assign(i.collection[n.dialogId],n.fields);t.saveState(i)},delete:function e(i,n){delete i.collection[n.dialogId];t.saveState(i)}}}},{key:"initCollection",value:function e(t,i){if(typeof t.collection[i.dialogId]!=="undefined"){return true}a.Vue.set(t.collection,i.dialogId,this.getElementState());if(i.fields){t.collection[i.dialogId]=Object.assign(t.collection[i.dialogId],this.validate(Object.assign({},i.fields),{host:t.host}))}return true}},{key:"getSaveTimeout",value:function e(){return 100}},{key:"saveState",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.isSaveAvailable()){return true}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"saveState",this).call(this,function(){var e={collection:{},saveDialogList:[].concat(n.saveDialogList),saveChatList:[].concat(n.saveChatList)};n.saveDialogList.forEach(function(t){if(!n.collection[t])return false;e.collection[t]=Object.assign(i.getElementState(),i.cloneState(n.collection[t],i.getElementStateSaveException()))});return e})}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};i.host=i.host||this.getState().host;if(typeof t.dialog_id!=="undefined"){t.dialogId=t.dialog_id}if(typeof t.dialogId==="number"||typeof t.dialogId==="string"){a.dialogId=t.dialogId.toString()}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}else if(typeof t.id!=="undefined"){t.chatId=t.id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){a.chatId=parseInt(t.chatId)}if(typeof t.quoteId==="number"){a.quoteId=parseInt(t.quoteId)}if(typeof t.editId==="number"){a.editId=parseInt(t.editId)}if(typeof t.counter==="number"||typeof t.counter==="string"){a.counter=parseInt(t.counter)}if(typeof t.user_counter==="number"||typeof t.user_counter==="string"){a.userCounter=parseInt(t.user_counter)}if(typeof t.userCounter==="number"||typeof t.userCounter==="string"){a.userCounter=parseInt(t.userCounter)}if(typeof t.message_count==="number"||typeof t.message_count==="string"){a.messageCount=parseInt(t.message_count)}if(typeof t.messageCount==="number"||typeof t.messageCount==="string"){a.messageCount=parseInt(t.messageCount)}if(typeof t.unread_id!=="undefined"){t.unreadId=t.unread_id}if(typeof t.unreadId==="number"||typeof t.unreadId==="string"){a.unreadId=parseInt(t.unreadId)}if(typeof t.last_message_id!=="undefined"){t.lastMessageId=t.last_message_id}if(typeof t.lastMessageId==="number"||typeof t.lastMessageId==="string"){a.lastMessageId=parseInt(t.lastMessageId)}if(typeof t.readed_list!=="undefined"){t.readedList=t.readed_list}if(typeof t.readedList!=="undefined"){a.readedList=[];if(t.readedList instanceof Array){t.readedList.forEach(function(e){var t={};if(typeof e.user_id!=="undefined"){e.userId=e.user_id}if(typeof e.user_name!=="undefined"){e.userName=e.user_name}if(typeof e.message_id!=="undefined"){e.messageId=e.message_id}if(!e.userId||!e.userName||!e.messageId){return false}t.userId=parseInt(e.userId);t.userName=e.userName.toString();t.messageId=parseInt(e.messageId);t.date=n.Utils.date.cast(e.date);a.readedList.push(t)})}}if(typeof t.writing_list!=="undefined"){t.writingList=t.writing_list}if(typeof t.writingList!=="undefined"){a.writingList=[];if(t.writingList instanceof Array){t.writingList.forEach(function(e){var t={};if(!e.userId){return false}t.userId=parseInt(e.userId);t.userName=n.Utils.text.htmlspecialcharsback(e.userName);a.writingList.push(t)})}}if(typeof t.manager_list!=="undefined"){t.managerList=t.manager_list}if(typeof t.managerList!=="undefined"){a.managerList=[];if(t.managerList instanceof Array){t.managerList.forEach(function(e){e=parseInt(e);if(e>0){a.managerList.push(e)}})}}if(typeof t.mute_list!=="undefined"){t.muteList=t.mute_list}if(typeof t.muteList!=="undefined"){a.muteList=[];if(t.muteList instanceof Array){t.muteList.forEach(function(e){e=parseInt(e);if(e>0){a.muteList.push(e)}})}else if(babelHelpers.typeof(t.muteList)==="object"){Object.entries(t.muteList).forEach(function(e){if(e[1]===true){var t=parseInt(e[0]);if(t>0){a.muteList.push(t)}}})}}if(typeof t.textareaMessage!=="undefined"){a.textareaMessage=t.textareaMessage.toString()}if(typeof t.title!=="undefined"){t.name=t.title}if(typeof t.name==="string"||typeof t.name==="number"){a.name=n.Utils.text.htmlspecialcharsback(t.name.toString())}if(typeof t.owner!=="undefined"){t.ownerId=t.owner}if(typeof t.ownerId==="number"||typeof t.ownerId==="string"){a.ownerId=parseInt(t.ownerId)}if(typeof t.extranet==="boolean"){a.extranet=t.extranet}if(typeof t.avatar==="string"){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(typeof t.color==="string"){a.color=t.color.toString()}if(typeof t.type==="string"){a.type=t.type.toString()}if(typeof t.entity_type!=="undefined"){t.entityType=t.entity_type}if(typeof t.entityType==="string"){a.entityType=t.entityType.toString()}if(typeof t.entity_id!=="undefined"){t.entityId=t.entity_id}if(typeof t.entityId==="string"||typeof t.entityId==="number"){a.entityId=t.entityId.toString()}if(typeof t.entity_data_1!=="undefined"){t.entityData1=t.entity_data_1}if(typeof t.entityData1==="string"){a.entityData1=t.entityData1.toString()}if(typeof t.entity_data_2!=="undefined"){t.entityData2=t.entity_data_2}if(typeof t.entityData2==="string"){a.entityData2=t.entityData2.toString()}if(typeof t.entity_data_3!=="undefined"){t.entityData3=t.entity_data_3}if(typeof t.entityData3==="string"){a.entityData3=t.entityData3.toString()}if(typeof t.date_create!=="undefined"){t.dateCreate=t.date_create}if(typeof t.dateCreate!=="undefined"){a.dateCreate=n.Utils.date.cast(t.dateCreate)}if(typeof t.dateLastOpen!=="undefined"){a.dateLastOpen=n.Utils.date.cast(t.dateLastOpen)}if(babelHelpers.typeof(t.restrictions)==="object"&&t.restrictions){a.restrictions={};if(typeof t.restrictions.AVATAR==="boolean"){a.restrictions.avatar=t.restrictions.AVATAR}if(typeof t.restrictions.EXTEND==="boolean"){a.restrictions.extend=t.restrictions.EXTEND}if(typeof t.restrictions.LEAVE==="boolean"){a.restrictions.leave=t.restrictions.LEAVE}if(typeof t.restrictions.LEAVE_OWNER==="boolean"){a.restrictions.leaveOwner=t.restrictions.LEAVE_OWNER}if(typeof t.restrictions.RENAME==="boolean"){a.restrictions.rename=t.restrictions.RENAME}}if(babelHelpers.typeof(t.public)==="object"&&t.public){a.public={};if(typeof t.public.code==="string"){a.public.code=t.public.code}if(typeof t.public.link==="string"){a.public.link=t.public.link}}return a}}]);return t}(r.VuexBuilderModel);function b(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=I(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function I(e,t){if(!e)return;if(typeof e==="string")return S(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(e,t)}function S(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var C=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"users"}},{key:"getState",value:function e(){this.startOnlineCheckInterval();return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},onlineList:[],mobileOnlineList:[],absentList:[]}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.id,n=i===void 0?0:i,a=t.name,r=a===void 0?this.getVariable("default.name",""):a,o=t.firstName,s=o===void 0?this.getVariable("default.name",""):o,l=t.lastName,c=l===void 0?"":l;return{id:n,name:r,firstName:s,lastName:c,workPosition:"",color:"#048bd0",avatar:"",gender:"M",birthday:false,isBirthday:false,extranet:false,network:false,bot:false,connector:false,externalAuthId:"default",status:"online",idle:false,lastActivityDate:false,mobileLastDate:false,isOnline:false,isMobileOnline:false,absent:false,isAbsent:false,departments:[],phones:{workPhone:"",personalMobile:"",personalPhone:"",innerPhone:""},init:false}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(i){return function(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;e=parseInt(e);if(e<=0){if(n){e=0}else{return null}}if(!n&&(!i.collection[e]||!i.collection[e].init)){return null}if(!i.collection[e]){return t.getElementState({id:e})}return i.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState(e)}},getList:function e(i){return function(e){var n=[];if(!Array.isArray(e)){return null}e.forEach(function(e){if(i.collection[e]){n.push(i.collection[e])}else{n.push(t.getElementState({id:e}))}});return n}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.getElementState(),t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.getElementState(),t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){n.id=parseInt(n.id);if(typeof i.state.collection[n.id]==="undefined"||i.state.collection[n.id].init===false){return true}i.commit("update",{id:n.id,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.id);return true},saveState:function e(t,i){t.commit("saveState",{});return true}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,a){var r=b(a),o;try{var s=function e(){var a=o.value;t.initCollection(i,{id:a.id});i.collection[a.id]=Object.assign(i.collection[a.id],a);var r=n.Utils.user.getOnlineStatus(a);if(r.isOnline){i.collection[a.id].isOnline=true;t.addToOnlineList(i,a.id)}var s=n.Utils.user.isMobileActive(a);if(s){i.collection[a.id].isMobileOnline=true;t.addToMobileOnlineList(i,a.id)}if(a.birthday){var l=n.Utils.date.format(new Date,"d-m");if(a.birthday===l){i.collection[a.id].isBirthday=true;var c=t.getTimeToNextMidnight();setTimeout(function(){i.collection[a.id].isBirthday=false},c)}}if(a.absent){a.isAbsent=true;if(!i.absentList.includes(a.id)){t.addToAbsentList(i,a.id);var u=t.getTimeToNextMidnight();var d=1e3*60*60*24;setTimeout(function(){setInterval(function(){return t.startAbsentCheckInterval(i)},d)},u)}}t.saveState(i)};for(r.s();!(o=r.n()).done;){s()}}catch(e){r.e(e)}finally{r.f()}},update:function e(i,a){t.initCollection(i,a);if(typeof a.fields.lastActivityDate!=="undefined"&&i.collection[a.id].lastActivityDate){var r=i.collection[a.id].lastActivityDate.getTime();var o=a.fields.lastActivityDate.getTime();if(o>r){var s=n.Utils.user.getOnlineStatus(a.fields);if(s.isOnline){i.collection[a.id].isOnline=true;t.addToOnlineList(i,a.fields.id)}}}if(typeof a.fields.mobileLastDate!=="undefined"&&i.collection[a.id].mobileLastDate!==a.fields.mobileLastDate){var l=n.Utils.user.isMobileActive(a.fields);if(l){i.collection[a.id].isMobileOnline=true;t.addToMobileOnlineList(i,a.fields.id)}}i.collection[a.id]=Object.assign(i.collection[a.id],a.fields);t.saveState(i)},delete:function e(i,n){delete i.collection[n.id];t.saveState(i)},saveState:function e(i,n){t.saveState(i)}}}},{key:"initCollection",value:function e(t,i){if(typeof t.collection[i.id]!=="undefined"){return true}a.Vue.set(t.collection,i.id,this.getElementState());return true}},{key:"getSaveUserList",value:function e(){if(!this.db){return[]}if(!this.store.getters["messages/getSaveUserList"]){return[]}var t=this.store.getters["messages/getSaveUserList"]();if(!t){return[]}return t}},{key:"getSaveTimeout",value:function e(){return 250}},{key:"saveState",value:function e(i){var n=this;if(!this.isSaveAvailable()){return false}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"saveState",this).call(this,function(){var e=n.getSaveUserList();if(!e){return false}var t={collection:{}};var a={absent:true,idle:true,mobileLastDate:true,lastActivityDate:true};for(var r in e){if(!e.hasOwnProperty(r)){continue}e[r].forEach(function(e){if(!i.collection[e]){return false}t.collection[e]=n.cloneState(i.collection[e],a)})}return t})}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};i.host=i.host||this.getState().host;if(typeof t.id==="number"||typeof t.id==="string"){a.id=parseInt(t.id)}if(typeof t.first_name!=="undefined"){t.firstName=n.Utils.text.htmlspecialcharsback(t.first_name)}if(typeof t.last_name!=="undefined"){t.lastName=n.Utils.text.htmlspecialcharsback(t.last_name)}if(typeof t.name==="string"||typeof t.name==="number"){t.name=n.Utils.text.htmlspecialcharsback(t.name.toString());a.name=t.name}if(typeof t.firstName==="string"||typeof t.firstName==="number"){a.firstName=n.Utils.text.htmlspecialcharsback(t.firstName.toString())}if(typeof t.lastName==="string"||typeof t.lastName==="number"){a.lastName=n.Utils.text.htmlspecialcharsback(t.lastName.toString())}if(typeof t.work_position!=="undefined"){t.workPosition=t.work_position}if(typeof t.workPosition==="string"||typeof t.workPosition==="number"){a.workPosition=t.workPosition.toString()}if(typeof t.color==="string"){a.color=t.color}if(typeof t.avatar==="string"){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(typeof t.gender!=="undefined"){a.gender=t.gender==="F"?"F":"M"}if(typeof t.birthday==="string"){a.birthday=t.birthday}if(typeof t.extranet==="boolean"){a.extranet=t.extranet}if(typeof t.network==="boolean"){a.network=t.network}if(typeof t.bot==="boolean"){a.bot=t.bot}if(typeof t.connector==="boolean"){a.connector=t.connector}if(typeof t.external_auth_id!=="undefined"){t.externalAuthId=t.external_auth_id}if(typeof t.externalAuthId==="string"&&t.externalAuthId){a.externalAuthId=t.externalAuthId}if(typeof t.status==="string"){a.status=t.status}if(typeof t.idle!=="undefined"){a.idle=n.Utils.date.cast(t.idle,false)}if(typeof t.last_activity_date!=="undefined"){t.lastActivityDate=t.last_activity_date}if(typeof t.lastActivityDate!=="undefined"){a.lastActivityDate=n.Utils.date.cast(t.lastActivityDate,false)}if(typeof t.mobile_last_date!=="undefined"){t.mobileLastDate=t.mobile_last_date}if(typeof t.mobileLastDate!=="undefined"){a.mobileLastDate=n.Utils.date.cast(t.mobileLastDate,false)}if(typeof t.absent!=="undefined"){a.absent=n.Utils.date.cast(t.absent,false)}if(typeof t.departments!=="undefined"){a.departments=[];if(t.departments instanceof Array){t.departments.forEach(function(e){e=parseInt(e);if(e>0){a.departments.push(e)}})}}if(babelHelpers.typeof(t.phones)==="object"&&t.phones){a.phones={};if(typeof t.phones.work_phone!=="undefined"){t.phones.workPhone=t.phones.work_phone}if(typeof t.phones.workPhone==="string"||typeof t.phones.workPhone==="number"){a.phones.workPhone=t.phones.workPhone.toString()}if(typeof t.phones.personal_mobile!=="undefined"){t.phones.personalMobile=t.phones.personal_mobile}if(typeof t.phones.personalMobile==="string"||typeof t.phones.personalMobile==="number"){a.phones.personalMobile=t.phones.personalMobile.toString()}if(typeof t.phones.personal_phone!=="undefined"){t.phones.personalPhone=t.phones.personal_phone}if(typeof t.phones.personalPhone==="string"||typeof t.phones.personalPhone==="number"){a.phones.personalPhone=t.phones.personalPhone.toString()}if(typeof t.phones.inner_phone!=="undefined"){t.phones.innerPhone=t.phones.inner_phone}if(typeof t.phones.innerPhone==="string"||typeof t.phones.innerPhone==="number"){a.phones.innerPhone=t.phones.innerPhone.toString()}}return a}},{key:"addToOnlineList",value:function e(t,i){if(!t.onlineList.includes(i)){t.onlineList.push(i)}}},{key:"addToMobileOnlineList",value:function e(t,i){if(!t.mobileOnlineList.includes(i)){t.mobileOnlineList.push(i)}}},{key:"addToAbsentList",value:function e(t,i){if(!t.absentList.includes(i)){t.absentList.push(i)}}},{key:"getTimeToNextMidnight",value:function e(){var t=new Date((new Date).setHours(24,0,0)).getTime();return t-new Date}},{key:"startAbsentCheckInterval",value:function e(t){var i=b(t.absentList),n;try{var a=function e(){var i=n.value;var a=t.collection[i];if(!a){return"continue"}var r=(new Date).getTime();var o=new Date(t.collection[i].absent).getTime();if(o<=r){t.absentList=t.absentList.filter(function(e){return e!==i});a.isAbsent=false}};for(i.s();!(n=i.n()).done;){var r=a();if(r==="continue")continue}}catch(e){i.e(e)}finally{i.f()}}},{key:"startOnlineCheckInterval",value:function e(){var t=this;var i=6e4;setInterval(function(){var e=b(t.store.state.users.onlineList),i;try{var a=function e(){var a=i.value;var r=t.store.state.users.collection[a];if(!r){return"continue"}var o=n.Utils.user.getOnlineStatus(r);if(o.isOnline){r.isOnline=true}else{r.isOnline=false;t.store.state.users.onlineList=t.store.state.users.onlineList.filter(function(e){return e!==a})}};for(e.s();!(i=e.n()).done;){var r=a();if(r==="continue")continue}}catch(t){e.e(t)}finally{e.f()}var o=b(t.store.state.users.mobileOnlineList),s;try{var l=function e(){var i=s.value;var a=t.store.state.users.collection[i];if(!a){return"continue"}var r=n.Utils.user.isMobileActive(a);if(r){a.isMobileOnline=true}else{a.isMobileOnline=false;t.store.state.users.mobileOnlineList=t.store.state.users.mobileOnlineList.filter(function(e){return e!==i})}};for(o.s();!(s=o.n()).done;){var c=l();if(c==="continue")continue}}catch(e){o.e(e)}finally{o.f()}},i)}}]);return t}(r.VuexBuilderModel);function x(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=T(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function T(e,t){if(!e)return;if(typeof e==="string")return k(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(e,t)}function k(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var E=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"files"}},{key:"getState",value:function e(){return{created:0,host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},index:{}}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.id,n=i===void 0?0:i,a=t.chatId,r=a===void 0?0:a,o=t.name,l=o===void 0?this.getVariable("default.name",""):o;return{id:n,chatId:r,name:l,templateId:n,date:new Date,type:"file",extension:"",icon:"empty",size:0,image:false,status:s.FileStatus.done,progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:"",init:false,viewerAttrs:{}}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!e||!i){return null}if(!t.index[e]||!t.index[e][i]){return null}if(!n&&!t.index[e][i].init){return null}return t.index[e][i]}},getList:function e(t){return function(e){if(!t.index[e]){return null}return t.index[e]}},getBlank:function e(i){return function(e){return t.getElementState(e)}}}}},{key:"getActions",value:function e(){var t=this;return{add:function e(i,n){var a=t.validate(Object.assign({},n),{host:i.state.host});a.id="temporary"+(new Date).getTime()+i.state.created;a.templateId=a.id;a.init=true;i.commit("add",Object.assign({},t.getElementState(),a));return a.id},set:function e(i,n){if(n instanceof Array){n=n.map(function(e){var n=t.validate(Object.assign({},e),{host:i.state.host});n.templateId=n.id;return Object.assign({},t.getElementState(),n,{init:true})})}else{var a=t.validate(Object.assign({},n),{host:i.state.host});a.templateId=a.id;n=[];n.push(Object.assign({},t.getElementState(),a,{init:true}))}i.commit("set",{insertType:s.MutationType.setAfter,data:n})},setBefore:function e(i,n){if(n instanceof Array){n=n.map(function(e){var n=t.validate(Object.assign({},e),{host:i.state.host});n.templateId=n.id;return Object.assign({},t.getElementState(),n,{init:true})})}else{var a=t.validate(Object.assign({},n),{host:i.state.host});a.templateId=a.id;n=[];n.push(Object.assign({},t.getElementState(),a,{init:true}))}i.commit("set",{actionName:"setBefore",insertType:s.MutationType.setBefore,data:n})},update:function e(i,n){var a=t.validate(Object.assign({},n.fields),{host:i.state.host});i.commit("initCollection",{chatId:n.chatId});var r=i.state.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(r<0){return false}i.commit("update",{id:n.id,chatId:n.chatId,index:r,fields:a});if(n.fields.blink){setTimeout(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){t.commit("delete",{id:i.id,chatId:i.chatId});return true},saveState:function e(t,i){t.commit("saveState",{});return true}}}},{key:"getMutations",value:function e(){var t=this;return{initCollection:function e(i,n){t.initCollection(i,n)},add:function e(i,n){t.initCollection(i,n);i.collection[n.chatId].push(n);i.index[n.chatId][n.id]=n;i.created+=1;t.saveState(i)},set:function e(i,n){var a=x(n.data),r;try{var o=function e(){var a=r.value;t.initCollection(i,{chatId:a.chatId});var o=i.collection[a.chatId].findIndex(function(e){return e.id===a.id});if(o>-1){delete a.templateId;i.collection[a.chatId][o]=Object.assign(i.collection[a.chatId][o],a)}else if(n.insertType===s.MutationType.setBefore){i.collection[a.chatId].unshift(a)}else{i.collection[a.chatId].push(a)}i.index[a.chatId][a.id]=a;t.saveState(i)};for(a.s();!(r=a.n()).done;){o()}}catch(e){a.e(e)}finally{a.f()}},update:function e(i,n){t.initCollection(i,n);var a=-1;if(typeof n.index!=="undefined"&&i.collection[n.chatId][n.index]){a=n.index}else{a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id})}if(a>=0){delete n.fields.templateId;var r=Object.assign(i.collection[n.chatId][a],n.fields);i.collection[n.chatId][a]=r;i.index[n.chatId][r.id]=r;t.saveState(i)}},delete:function e(i,n){t.initCollection(i,n);i.collection[n.chatId]=i.collection[n.chatId].filter(function(e){return e.id!==n.id});delete i.index[n.chatId][n.id];t.saveState(i)},saveState:function e(i,n){t.saveState(i)}}}},{key:"initCollection",value:function e(t,i){if(typeof t.collection[i.chatId]!=="undefined"){return true}a.Vue.set(t.collection,i.chatId,[]);a.Vue.set(t.index,i.chatId,{});return true}},{key:"getLoadedState",value:function e(t){if(!t||babelHelpers.typeof(t)!=="object"){return t}if(babelHelpers.typeof(t.collection)!=="object"){return t}t.index={};var i=function e(i){if(!t.collection.hasOwnProperty(i)){return"continue"}t.index[i]={};t.collection[i].filter(function(e){return e!=null}).forEach(function(e){t.index[i][e.id]=e})};for(var n in t.collection){var a=i(n);if(a==="continue")continue}return t}},{key:"getSaveFileList",value:function e(){if(!this.db){return[]}if(!this.store.getters["messages/getSaveFileList"]){return[]}var t=this.store.getters["messages/getSaveFileList"]();if(!t){return[]}return t}},{key:"getSaveTimeout",value:function e(){return 250}},{key:"saveState",value:function e(i){var n=this;if(!this.isSaveAvailable()){return false}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"saveState",this).call(this,function(){var e=n.getSaveFileList();if(!e){return false}var t={collection:{}};var a=function n(a){if(!e.hasOwnProperty(a)){return"continue"}e[a].forEach(function(e){if(!i.index[a]){return false}if(!i.index[a][e]){return false}if(!t.collection[a]){t.collection[a]=[]}t.collection[a].push(i.index[a][e])})};for(var r in e){var o=a(r);if(o==="continue")continue}return t})}},{key:"validate",value:function e(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r={};a.host=a.host||this.getState().host;if(typeof i.id==="number"){r.id=i.id}else if(typeof i.id==="string"){if(i.id.startsWith("temporary")){r.id=i.id}else{r.id=parseInt(i.id)}}if(typeof i.templateId==="number"){r.templateId=i.templateId}else if(typeof i.templateId==="string"){if(i.templateId.startsWith("temporary")){r.templateId=i.templateId}else{r.templateId=parseInt(i.templateId)}}if(typeof i.chatId==="number"||typeof i.chatId==="string"){r.chatId=parseInt(i.chatId)}if(typeof i.date!=="undefined"){r.date=n.Utils.date.cast(i.date)}if(typeof i.type==="string"){r.type=i.type}if(typeof i.extension==="string"){r.extension=i.extension.toString();if(r.type==="image"){r.icon="img"}else if(r.type==="video"){r.icon="mov"}else{r.icon=t.getIconType(r.extension)}}if(typeof i.name==="string"||typeof i.name==="number"){r.name=i.name.toString()}if(typeof i.size==="number"||typeof i.size==="string"){r.size=parseInt(i.size)}if(typeof i.image==="boolean"){r.image=false}else if(babelHelpers.typeof(i.image)==="object"&&i.image){r.image={width:0,height:0};if(typeof i.image.width==="string"||typeof i.image.width==="number"){r.image.width=parseInt(i.image.width)}if(typeof i.image.height==="string"||typeof i.image.height==="number"){r.image.height=parseInt(i.image.height)}if(r.image.width<=0||r.image.height<=0){r.image=false}}if(typeof i.status==="string"&&typeof s.FileStatus[i.status]!=="undefined"){r.status=i.status}if(typeof i.progress==="number"||typeof i.progress==="string"){r.progress=parseInt(i.progress)}if(typeof i.authorId==="number"||typeof i.authorId==="string"){r.authorId=parseInt(i.authorId)}if(typeof i.authorName==="string"||typeof i.authorName==="number"){r.authorName=i.authorName.toString()}if(typeof i.urlPreview==="string"){if(!i.urlPreview||i.urlPreview.startsWith("http")||i.urlPreview.startsWith("bx")||i.urlPreview.startsWith("file")||i.urlPreview.startsWith("blob")){r.urlPreview=i.urlPreview}else{r.urlPreview=a.host+i.urlPreview}}if(typeof i.urlDownload==="string"){if(!i.urlDownload||i.urlDownload.startsWith("http")||i.urlDownload.startsWith("bx")||i.urlPreview.startsWith("file")){r.urlDownload=i.urlDownload}else{r.urlDownload=a.host+i.urlDownload}}if(typeof i.urlShow==="string"){if(!i.urlShow||i.urlShow.startsWith("http")||i.urlShow.startsWith("bx")||i.urlShow.startsWith("file")){r.urlShow=i.urlShow}else{r.urlShow=a.host+i.urlShow}}if(babelHelpers.typeof(i.viewerAttrs)==="object"){if(r.type==="image"&&!n.Utils.platform.isBitrixMobile()){r.viewerAttrs=i.viewerAttrs}if(r.type==="video"&&!n.Utils.platform.isBitrixMobile()&&r.size>t.maxDiskFileSize){r.viewerAttrs=i.viewerAttrs}}return r}}],[{key:"getType",value:function e(t){t=t.toString().toLowerCase().split(".").splice(-1)[0];switch(t){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":return s.FileType.image;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":return s.FileType.video;case"mp3":return s.FileType.audio}return s.FileType.file}},{key:"getIconType",value:function e(t){var i="empty";switch(t.toString()){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":i="img";break;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":i="mov";break;case"txt":i="txt";break;case"doc":case"docx":i="doc";break;case"xls":case"xlsx":i="xls";break;case"php":i="php";break;case"pdf":i="pdf";break;case"ppt":case"pptx":i="ppt";break;case"rar":i="rar";break;case"zip":case"7z":case"tar":case"gz":case"gzip":i="zip";break;case"set":i="set";break;case"conf":case"ini":case"plist":i="set";break}return i}}]);return t}(r.VuexBuilderModel);babelHelpers.defineProperty(E,"maxDiskFileSize",5242880);var M=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"recent"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:[]}}},{key:"getElementState",value:function e(){return{id:0,templateId:"",template:s.TemplateTypes.item,chatType:s.ChatTypes.chat,sectionCode:s.RecentSection.general,avatar:"",color:"#048bd0",title:"",lines:{id:0,status:0},message:{id:0,text:"",date:new Date,senderId:0,status:s.MessageStatus.received},counter:0,pinned:false,chatId:0,userId:0}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(i){return function(e){if(o.Type.isNumber(e)){e=e.toString()}var i=t.findItem(e);if(i){return i}return false}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){var a=[];if(n instanceof Array){a=n.map(function(e){return t.prepareItem(e,{host:i.state.host})})}if(a.length===0){return false}a.forEach(function(e){var n=t.findItem(e.id);if(n){i.commit("update",{index:n.index,fields:e})}else{i.commit("add",{fields:e})}});i.state.collection.sort(t.sortListByMessageDate)},addPlaceholders:function e(t,i){i.forEach(function(e){t.commit("addPlaceholder",{fields:e})})},updatePlaceholders:function e(i,n){n.items=n.items.map(function(e){return t.prepareItem(e)});n.items.forEach(function(e,a){var r="placeholder"+(n.firstMessage+a);var o=t.findItem(r,"templateId");var s=t.findItem(e.id);if(s){i.commit("update",{index:s.index,fields:e});i.commit("delete",{index:o.index})}else{i.commit("update",{index:o.index,fields:e})}})},update:function e(i,n){if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(n.id);if(!a){return false}n.fields=t.validate(Object.assign({},n.fields));i.commit("update",{index:a.index,fields:n.fields});i.state.collection.sort(t.sortListByMessageDate)},pin:function e(i,n){if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(n.id);if(!a){return false}i.commit("update",{index:a.index,fields:Object.assign({},a.element,{pinned:n.action})});i.state.collection.sort(t.sortListByMessageDate)},clearPlaceholders:function e(t){t.commit("clearPlaceholders")},delete:function e(i,n){if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(n.id);if(!a){return false}i.commit("delete",{index:a.index});i.state.collection.sort(t.sortListByMessageDate)}}}},{key:"getMutations",value:function e(){var t=this;return{add:function e(i,n){i.collection.push(Object.assign({},t.getElementState(),n.fields))},update:function e(t,i){t.collection.splice(i.index,1,Object.assign({},t.collection[i.index],i.fields))},delete:function e(t,i){t.collection.splice(i.index,1)},addPlaceholder:function e(i,n){i.collection.push(Object.assign({},t.getElementState(),n.fields))},clearPlaceholders:function e(t){t.collection=t.collection.filter(function(e){return!e.id.toString().startsWith("placeholder")})}}}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};if(o.Type.isNumber(t.id)){a.id=t.id.toString()}if(o.Type.isStringFilled(t.id)){a.id=t.id}if(o.Type.isString(t.templateId)){a.templateId=t.templateId}if(o.Type.isString(t.template)){a.template=t.template}if(o.Type.isString(t.type)){if(t.type===s.ChatTypes.chat){if(t.chat.type===s.ChatTypes.open){a.chatType=s.ChatTypes.open}else if(t.chat.type===s.ChatTypes.chat){a.chatType=s.ChatTypes.chat}}else if(t.type===s.ChatTypes.user){a.chatType=s.ChatTypes.user}else if(t.type===s.ChatTypes.notification){a.chatType=s.ChatTypes.notification;t.title="Notifications"}else{a.chatType=s.ChatTypes.chat}}if(o.Type.isString(t.avatar)){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(o.Type.isString(t.color)){a.color=t.color}if(o.Type.isString(t.title)){a.title=t.title}if(o.Type.isPlainObject(t.message)){var l={};if(o.Type.isNumber(t.message.id)){l.id=t.message.id}if(o.Type.isString(t.message.text)){var c={};if(t.message.withAttach){c.WITH_ATTACH=true}else if(t.message.withFile){c.WITH_FILE=true}l.text=n.Utils.text.purify(t.message.text,c)}if(o.Type.isDate(t.message.date)||o.Type.isString(t.message.date)){l.date=t.message.date}if(o.Type.isNumber(t.message.author_id)){l.senderId=t.message.author_id}if(o.Type.isNumber(t.message.senderId)){l.senderId=t.message.senderId}if(o.Type.isStringFilled(t.message.status)){l.status=t.message.status}a.message=l}if(o.Type.isNumber(t.counter)){a.counter=t.counter}if(o.Type.isBoolean(t.pinned)){a.pinned=t.pinned}if(o.Type.isNumber(t.chatId)){a.chatId=t.chatId}if(o.Type.isNumber(t.userId)){a.userId=t.userId}return a}},{key:"sortListByMessageDate",value:function e(t,i){if(t.message&&i.message){var n=new Date(t.message.date).getTime();var a=new Date(i.message.date).getTime();return a-n}}},{key:"prepareItem",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t));return Object.assign({},this.getElementState(),n,i)}},{key:"findItem",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"id";var n={};if(i==="id"&&o.Type.isNumber(t)){t=t.toString()}var a=this.store.state.recent.collection.findIndex(function(e,n){return e[i]===t});if(a!==-1){n.index=a;n.element=this.store.state.recent.collection[a];return n}return false}}]);return t}(r.VuexBuilderModel);function w(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=L(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function L(e,t){if(!e)return;if(typeof e==="string")return A(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return A(e,t)}function A(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var O=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"notifications"}},{key:"getState",value:function e(){return{collection:[],searchCollection:[],chat_id:0,total:0,host:this.getVariable("host",location.protocol+"//"+location.host),unreadCounter:0,schema:{}}}},{key:"getElementState",value:function e(){return{id:0,authorId:0,date:new Date,text:"",sectionCode:s.NotificationTypesCodes.simple,textConverted:"",unread:false,display:true,settingName:"im|default"}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(){return t.collection}},getById:function e(i){return function(e){if(o.Type.isString(e)){e=parseInt(e)}var n=t.findItemInArr(i.collection,e);if(!n.element){return false}return n.element}},getSearchItemById:function e(i){return function(e){if(o.Type.isString(e)){e=parseInt(e)}var n=t.findItemInArr(i.searchCollection,e);if(!n.element){return false}return n.element}},getBlank:function e(i){return function(e){return t.getElementState()}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){var a={notification:[]};if(n.notification instanceof Array){a.notification=n.notification.map(function(e){return t.prepareNotification(e,{host:i.state.host})})}if(o.Type.isNumber(n.total)||o.Type.isString(n.total)){a.total=parseInt(n.total)}i.commit("set",a)},setSearchResults:function e(i,n){var a={notification:[]};if(!(n.notification instanceof Array)){return false}if(n.type==="local"){a.notification=n.notification}else{a.notification=n.notification.map(function(e){return t.prepareNotification(e,{host:i.state.host})})}i.commit("setSearchResults",{data:a})},deleteSearchResults:function e(t,i){t.commit("deleteSearchResults")},setCounter:function e(t,i){if(o.Type.isNumber(i.unreadTotal)||o.Type.isString(i.unreadTotal)){var n=parseInt(i.unreadTotal);t.commit("setCounter",n)}},setTotal:function e(t,i){if(o.Type.isNumber(i.total)||o.Type.isString(i.total)){t.commit("setTotal",i.total)}},add:function e(i,n){var a=t.prepareNotification(n.data,{host:i.state.host});a.unread=true;var r=t.findItemInArr(i.state.collection,a.id);if(!r.element){i.commit("add",{data:a});i.commit("setTotal",i.state.total+1)}else{i.commit("update",{index:r.index,fields:Object.assign({},n.fields)})}},updatePlaceholders:function e(i,n){if(n.items instanceof Array){n.items=n.items.map(function(e){return t.prepareNotification(e)})}else{return false}i.commit("updatePlaceholders",n);return true},clearPlaceholders:function e(t,i){t.commit("clearPlaceholders",i)},update:function e(i,n){var a=t.findItemInArr(i.state.collection,n.id);if(a.element){i.commit("update",{index:a.index,fields:Object.assign({},n.fields)})}if(n.searchMode){var r=t.findItemInArr(i.state.searchCollection,n.id);if(r.element){i.commit("update",{searchCollection:true,index:r.index,fields:Object.assign({},n.fields)})}}},read:function e(i,n){var a=w(n.ids),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;var s=t.findItemInArr(i.state.collection,o);if(!s.element){return false}i.commit("read",{index:s.index,action:!n.action})}}catch(e){a.e(e)}finally{a.f()}},readAll:function e(t,i){t.commit("readAll")},delete:function e(i,n){var a=t.findItemInArr(i.state.collection,n.id);if(a.element){i.commit("delete",{searchCollection:false,index:a.index});i.commit("setTotal",i.state.total-1)}if(n.searchMode){var r=t.findItemInArr(i.state.searchCollection,n.id);if(r.element){i.commit("delete",{searchCollection:true,index:r.index})}}},deleteAll:function e(t,i){t.commit("deleteAll")},setSchema:function e(t,i){t.commit("setSchema",{data:i.data})}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){i.total=n.hasOwnProperty("total")?n.total:i.total;if(!n.hasOwnProperty("notification")||!o.Type.isArray(n.notification)){return}var a=w(n.notification),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;var l=t.findItemInArr(i.collection,s.id);if(!l.element){i.collection.push(s)}else{if(s.unread!==i.collection[l.index].unread){s.unread=i.collection[l.index].unread;i.unreadCounter=s.unread===true?i.unreadCounter+1:i.unreadCounter-1}i.collection[l.index]=Object.assign(i.collection[l.index],s)}}}catch(e){a.e(e)}finally{a.f()}i.collection.sort(t.sortByType)},setSearchResults:function e(i,n){var a=w(n.data.notification),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;var s=t.findItemInArr(i.searchCollection,o.id);if(!s.element){i.searchCollection.push(o)}else{i.searchCollection[s.index]=Object.assign(i.searchCollection[s.index],o)}}}catch(e){a.e(e)}finally{a.f()}},deleteAll:function e(t,i){t.collection=[]},deleteSearchResults:function e(t,i){t.searchCollection=[]},add:function e(i,n){var a=null;if(n.data.sectionCode===s.NotificationTypesCodes.confirm){i.collection.unshift(n.data)}else{for(var r=0;i.collection.length>r;r++){if(i.collection[r].sectionCode===s.NotificationTypesCodes.simple){a=r;break}}if(a===null){i.collection.push(n.data)}else{i.collection.splice(a,0,n.data)}}i.collection.sort(t.sortByType)},update:function e(t,i){var n=i.searchCollection?"searchCollection":"collection";a.Vue.set(t[n],i.index,Object.assign({},t[n][i.index],i.fields))},delete:function e(t,i){var n=i.searchCollection?"searchCollection":"collection";t[n].splice(i.index,1)},read:function e(t,i){t.collection[i.index].unread=i.action},readAll:function e(t,i){for(var n=0;t.collection.length>n;n++){if(t.collection[n].sectionCode===s.NotificationTypesCodes.simple){t.collection[n].unread=false}}},updatePlaceholders:function e(i,n){var a=n.searchCollection?"searchCollection":"collection";n.items.forEach(function(e,t){var r="placeholder".concat(n.firstItem+t);var o=i[a].findIndex(function(e){return e.id===r});var s=i[a].findIndex(function(t){return t.id===e.id});if(s>=0){i[a][s]=Object.assign(i[a][s],e);i[a].splice(o,1)}else{i[a].splice(o,1,Object.assign({},e))}});i[a].sort(t.sortByType)},clearPlaceholders:function e(t,i){t.collection=t.collection.filter(function(e){return!e.id.toString().startsWith("placeholder")});t.searchCollection=t.searchCollection.filter(function(e){return!e.id.toString().startsWith("placeholder")})},setCounter:function e(t,i){t.unreadCounter=i},setTotal:function e(t,i){t.total=i},setSchema:function e(t,i){t.schema=i.data}}}},{key:"validate",value:function e(t,i){var a={};if(o.Type.isString(t.id)||o.Type.isNumber(t.id)){a.id=t.id}if(!o.Type.isNil(t.date)){a.date=n.Utils.date.cast(t.date)}if(o.Type.isString(t.textOriginal)||o.Type.isNumber(t.textOriginal)){a.text=t.textOriginal.toString();if(o.Type.isString(t.text)||o.Type.isNumber(t.text)){a.textConverted=this.convertToHtml({text:t.text.toString()})}}else{if(!o.Type.isNil(t.text_converted)){t.textConverted=t.text_converted}if(o.Type.isString(t.textConverted)||o.Type.isNumber(t.textConverted)){a.textConverted=t.textConverted.toString()}if(o.Type.isString(t.text)||o.Type.isNumber(t.text)){a.text=t.text.toString();var r=!o.Type.isNil(a.textConverted);a.textConverted=this.convertToHtml({text:r?a.textConverted:a.text})}}if(o.Type.isNumber(t.author_id)){if(t.system===true||t.system==="Y"){a.authorId=0}else{a.authorId=t.author_id}}if(o.Type.isNumber(t.userId)){a.authorId=t.userId}if(o.Type.isObjectLike(t.params)){var l=this.validateParams(t.params);if(l){a.params=l}}if(!o.Type.isNil(t.notify_buttons)){a.notifyButtons=JSON.parse(t.notify_buttons)}if(!o.Type.isNil(t.buttons)){a.notifyButtons=t.buttons.map(function(e){return{COMMAND:"notifyConfirm",COMMAND_PARAMS:"".concat(a.id,"|").concat(e.VALUE),TEXT:"".concat(e.TITLE),TYPE:"BUTTON",DISPLAY:"LINE",BG_COLOR:e.VALUE==="Y"?"#8bc84b":"#ef4b57",TEXT_COLOR:"#fff"}})}if(t.notify_type===s.NotificationTypesCodes.confirm||t.type===s.NotificationTypesCodes.confirm){a.sectionCode=s.NotificationTypesCodes.confirm}else if(t.type===s.NotificationTypesCodes.placeholder){a.sectionCode=s.NotificationTypesCodes.placeholder}if(!o.Type.isNil(t.notify_read)){a.unread=t.notify_read==="N"}if(!o.Type.isNil(t.read)){a.unread=t.read==="N"}if(o.Type.isString(t.setting_name)){a.settingName=t.setting_name}return a}},{key:"validateParams",value:function e(t){var i={};try{for(var a in t){if(!t.hasOwnProperty(a)){continue}if(a==="COMPONENT_ID"){if(o.Type.isString(t[a])&&BX.Vue.isComponent(t[a])){i[a]=t[a]}}else if(a==="LIKE"){if(t[a]instanceof Array){i["REACTION"]={like:t[a].map(function(e){return parseInt(e)})}}}else if(a==="CHAT_LAST_DATE"){i[a]=n.Utils.date.cast(t[a])}else if(a==="AVATAR"){if(t[a]){i[a]=t[a].startsWith("http")?t[a]:options.host+t[a]}}else if(a==="NAME"){if(t[a]){i[a]=t[a]}}else{i[a]=t[a]}}}catch(e){}var r=false;for(var s in i){if(!i.hasOwnProperty(s)){continue}r=true;break}return r?i:null}},{key:"prepareNotification",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t));return Object.assign({},this.getElementState(),n,i)}},{key:"findItemInArr",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"id";var a={};var r=t.findIndex(function(e,t){return e[n]===i});if(r!==-1){a.index=r;a.element=t[r]}return a}},{key:"sortByType",value:function e(t,i){if(t.sectionCode===s.NotificationTypesCodes.confirm&&i.sectionCode!==s.NotificationTypesCodes.confirm){return-1}else if(t.sectionCode!==s.NotificationTypesCodes.confirm&&i.sectionCode===s.NotificationTypesCodes.confirm){return 1}else{return i.id-t.id}}},{key:"convertToHtml",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var a=i.text,r=a===void 0?"":a;r=r.trim();r=r.replace(/\n/gi,"<br />");r=r.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");r=t.decodeBbCode({text:r});if(n.Utils.platform.isBitrixDesktop()){r=r.replace(/<a(.*?)>(.*?)<\/a>/gi,function(e,t,i){return"<a"+t.replace('target="_self"','target="_blank"')+' class="bx-im-notifications-item-link">'+i+"</a>"})}return r}}],[{key:"decodeBbCode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.text;i=i.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,function(e,t,i){var a=document.createElement("a");a.href=n.Utils.text.htmlspecialcharsback(t);a.target="_blank";a.text=n.Utils.text.htmlspecialcharsback(i);var r=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(r.indexOf(a.protocol)<=-1){return e}return a.outerHTML});i=i.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');i=i.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');i=i.replace(/\[RATING\=([1-5]{1})\]/gi,function(e,t){return BX.MessengerCommon.linesVoteHeadNodes(0,t,false).outerHTML});i=i.replace(/\[BR\]/gi,"<br/>");i=i.replace(/\[([buis])\](.*?)\[(\/[buis])\]/gi,function(e,t,i,n){return"<"+t+">"+i+"<"+n+">"});i=i.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,n){i=parseInt(i);if(i<=0){return n}if(t){return'<span class="bx-im-mention" data-type="OPENLINES" data-value="'+i+'">'+n+"</span>"}else{return'<span class="bx-im-mention" data-type="CHAT" data-value="'+i+'">'+n+"</span>"}});i=i.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(e,t,i){var n="";t=parseInt(t);if(t>0&&typeof BXIM!="undefined"){n='<span class="bx-im-mention '.concat(t===+BXIM.userId?"bx-messenger-ajax-self":"",'" data-type="USER" data-value="').concat(t,'">').concat(i,"</span>")}else{n=i}return n});i=i.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});return i}}]);return t}(r.VuexBuilderModel);var N=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"call"}},{key:"getState",value:function e(){return{users:{}}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{id:t.id?t.id:0,state:s.ConferenceUserState.Idle,talking:false,pinned:false,cameraState:false,microphoneState:false,screenState:false,floorRequestState:false}}},{key:"getGetters",value:function e(){var t=this;return{getUser:function e(i){return function(e){e=parseInt(e,10);if(!i.users[e]){return t.getElementState({id:e})}return i.users[e]}},getBlankUser:function e(i){return function(e){e=parseInt(e,10);return t.getElementState({id:e})}}}}},{key:"getActions",value:function e(){var t=this;return{updateUser:function e(i,n){n.id=parseInt(n.id,10);n.fields=Object.assign({},t.validate(n.fields));i.commit("updateUser",n)},unpinUser:function e(t,i){t.commit("unpinUser")}}}},{key:"getMutations",value:function e(){var t=this;return{updateUser:function e(i,n){if(!i.users[n.id]){a.Vue.set(i.users,n.id,Object.assign(t.getElementState(),n.fields,{id:n.id}))}else{i.users[n.id]=Object.assign(i.users[n.id],n.fields)}},unpinUser:function e(t,i){var n=Object.values(t.users).find(function(e){return e.pinned===true});if(n){t.users[n.id].pinned=false}}}}},{key:"validate",value:function e(t){var i={};if(o.Type.isNumber(t.id)||o.Type.isString(t.id)){i.id=parseInt(t.id,10)}if(s.ConferenceUserState[t.state]){i.state=t.state}if(o.Type.isBoolean(t.talking)){i.talking=t.talking}if(o.Type.isBoolean(t.pinned)){i.pinned=t.pinned}if(o.Type.isBoolean(t.cameraState)){i.cameraState=t.cameraState}if(o.Type.isBoolean(t.microphoneState)){i.microphoneState=t.microphoneState}if(o.Type.isBoolean(t.screenState)){i.screenState=t.screenState}if(o.Type.isBoolean(t.floorRequestState)){i.floorRequestState=t.floorRequestState}return i}},{key:"getStateSaveException",value:function e(){return{users:false}}}]);return t}(r.VuexBuilderModel);e.ApplicationModel=l;e.ConferenceModel=c;e.MessagesModel=h;e.DialoguesModel=v;e.UsersModel=C;e.FilesModel=E;e.RecentModel=M;e.NotificationsModel=O;e.CallModel=N})(this.BX.Messenger.Model=this.BX.Messenger.Model||{},BX.Messenger.Lib,BX.Event,BX.Messenger.Lib,BX,BX,BX,BX.Messenger.Const);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/local/js/im/provider/pull/dist/registry.bundle.min.js?165475981718727";s:6:"source";s:50:"/local/js/im/provider/pull/dist/registry.bundle.js";s:3:"min";s:54:"/local/js/im/provider/pull/dist/registry.bundle.min.js";s:3:"map";s:54:"/local/js/im/provider/pull/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.Provider=this.BX.Messenger.Provider||{};(function(e,t,s,a,i,n){"use strict";var r=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.controller)==="object"&&t.controller){this.controller=t.controller}if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}this.option=babelHelpers.typeof(t.store)==="object"&&t.store?t.store:{};if(!(babelHelpers.typeof(this.option.handlingDialog)==="object"&&this.option.handlingDialog&&this.option.handlingDialog.chatId&&this.option.handlingDialog.dialogId)){this.option.handlingDialog=false}}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}},{key:"getSubscriptionType",value:function e(){return n.PullClient.SubscriptionType.Server}},{key:"skipExecute",value:function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!s.optionImportant){if(this.option.skip){a.Logger.info("Pull: command skipped while loading messages",t);return true}if(!this.option.handlingDialog){return false}}if(typeof t.chatId!=="undefined"||typeof t.dialogId!=="undefined"){if(typeof t.chatId!=="undefined"&&parseInt(t.chatId)===parseInt(this.option.handlingDialog.chatId)){return false}if(typeof t.dialogId!=="undefined"&&t.dialogId.toString()===this.option.handlingDialog.dialogId.toString()){return false}return true}return false}},{key:"handleMessage",value:function e(t,s){this.handleMessageAdd(t,s)}},{key:"handleMessageChat",value:function e(t,s){this.handleMessageAdd(t,s)}},{key:"handleMessageAdd",value:function e(n,r){var o=this;a.Logger.warn("handleMessageAdd",n);if(this.skipExecute(n,r)){return false}var d=this.store.state.messages.collection[n.chatId];if(!d){d=[]}var l=d.find(function(e){if(n.message.templateId&&e.id===n.message.templateId){return true}return e.id===n.message.id});if(l&&n.message.push){return false}if(n.chat&&n.chat[n.chatId]){var c=this.store.getters["dialogues/getByChatId"](n.chatId);if(!c){var u=Object.assign({},n.chat[n.chatId],{dialogId:n.dialogId});this.store.dispatch("dialogues/set",u)}else{this.store.dispatch("dialogues/update",{dialogId:n.dialogId,fields:n.chat[n.chatId]})}}var h=this.store.getters["recent/get"](n.dialogId);if(!h){var f=this.prepareRecentItem(n);this.store.dispatch("recent/set",[f])}else{this.store.dispatch("recent/update",{id:n.dialogId,fields:{lines:n.lines||{id:0},message:{id:n.message.id,text:n.message.textOriginal,date:n.message.date,senderId:n.message.senderId,withFile:typeof n.message.params["FILE_ID"]!=="undefined",withAttach:typeof n.message.params["ATTACH"]!=="undefined"},counter:n.counter}})}if(n.users){this.store.dispatch("users/set",t.VuexBuilderModel.convertToArray(n.users))}if(n.files){var p=this.controller.application.prepareFilesBeforeSave(t.VuexBuilderModel.convertToArray(n.files));p.forEach(function(e){if(p.length===1&&n.message.templateFileId&&o.store.state.files.index[n.chatId]&&o.store.state.files.index[n.chatId][n.message.templateFileId]){o.store.dispatch("files/update",{id:n.message.templateFileId,chatId:n.chatId,fields:e}).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:n.chatId,cancelIfScrollChange:true})})}else{o.store.dispatch("files/set",e)}})}if(l){a.Logger.warn("New message pull handler: we already have this message",n.message);this.store.dispatch("messages/update",{id:l.id,chatId:l.chatId,fields:babelHelpers.objectSpread({},n.message,{sending:false,error:false})}).then(function(){if(!n.message.push){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:l.chatId,cancelIfScrollChange:n.message.senderId!==o.controller.application.getUserId()})}})}else if(this.controller.application.isUnreadMessagesLoaded()){a.Logger.warn("New message pull handler: we dont have this message",n.message);this.store.dispatch("messages/setAfter",babelHelpers.objectSpread({},n.message,{unread:true})).then(function(){if(!n.message.push){i.EventEmitter.emit(s.EventType.dialog.newMessage,{chatId:n.message.chatId,messageId:n.message.id})}})}this.controller.application.stopOpponentWriting({dialogId:n.dialogId,userId:n.message.senderId});if(n.message.senderId===this.controller.application.getUserId()&&this.controller.application.isUnreadMessagesLoaded()){if(this.store.state.dialogues.collection[n.dialogId]&&this.store.state.dialogues.collection[n.dialogId].counter!==0){this.controller.restClient.callMethod("im.dialog.read",{dialog_id:n.dialogId}).then(function(){o.store.dispatch("messages/readMessages",{chatId:n.chatId}).then(function(e){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:n.chatId,cancelIfScrollChange:false});o.store.dispatch("dialogues/update",{dialogId:n.dialogId,fields:{counter:0}})})})}}else if(n.message.senderId!==this.controller.application.getUserId()){this.store.dispatch("dialogues/increaseCounter",{dialogId:n.dialogId,count:1})}this.store.dispatch("dialogues/update",{dialogId:n.dialogId,fields:{lastMessageId:n.message.id}});this.store.dispatch("dialogues/increaseMessageCounter",{dialogId:n.dialogId,count:1})}},{key:"handleMessageUpdate",value:function e(t,s,a){this.execMessageUpdateOrDelete(t,s,a)}},{key:"handleMessageDelete",value:function e(t,s,a){this.execMessageUpdateOrDelete(t,s,a)}},{key:"execMessageUpdateOrDelete",value:function e(t,a,n){if(this.skipExecute(t,a)){return false}this.controller.application.stopOpponentWriting({dialogId:t.dialogId,userId:t.senderId});this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{text:n==="messageUpdate"?t.text:"",textOriginal:n==="messageUpdate"?t.textOriginal:"",params:t.params,blink:true}}).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:t.chatId,cancelIfScrollChange:true})});var r=this.store.getters["recent/get"](t.dialogId);if(n==="messageUpdate"&&r.element&&r.element.message.id===t.id){this.store.dispatch("recent/update",{id:t.dialogId,fields:{message:{id:t.id,text:t.text,date:r.element.message.date}}})}if(n==="messageDelete"&&r.element&&r.element.message.id===t.id){this.store.dispatch("recent/update",{id:t.dialogId,fields:{message:{id:t.id,text:"Message deleted",date:r.element.message.date}}})}}},{key:"handleMessageDeleteComplete",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("messages/delete",{id:t.id,chatId:t.chatId});this.controller.application.stopOpponentWriting({dialogId:t.dialogId,userId:t.senderId,action:false})}},{key:"handleMessageLike",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{params:{LIKE:t.users}}})}},{key:"handleChatOwner",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{ownerId:t.userId}})}},{key:"handleChatManagers",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{managerList:t.list}})}},{key:"handleChatUpdateParams",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:t.params})}},{key:"handleChatUserAdd",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{userCounter:t.userCount}})}},{key:"handleChatUserLeave",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{userCounter:t.userCount}})}},{key:"handleMessageParamsUpdate",value:function e(t,a){if(this.skipExecute(t,a)){return false}this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{params:t.params}}).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{chatId:t.chatId,cancelIfScrollChange:true})})}},{key:"handleStartWriting",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.controller.application.startOpponentWriting(t)}},{key:"handleReadMessage",value:function e(t,s){var a=this;if(this.skipExecute(t,s)){return false}this.store.dispatch("messages/readMessages",{chatId:t.chatId,readId:t.lastId}).then(function(e){a.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{counter:t.counter}})});this.store.dispatch("recent/update",{id:t.dialogId,fields:{counter:t.counter}})}},{key:"handleReadMessageChat",value:function e(t,s){this.handleReadMessage(t,s)}},{key:"handleReadMessageOpponent",value:function e(t,s){this.execReadMessageOpponent(t,s)}},{key:"handleReadMessageChatOpponent",value:function e(t,s){this.execReadMessageOpponent(t,s)}},{key:"execReadMessageOpponent",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/updateReaded",{dialogId:t.dialogId,userId:t.userId,userName:t.userName,messageId:t.lastId,date:t.date,action:true});var a=this.store.getters["recent/get"](t.dialogId);if(a){var i=a.element.message;this.store.dispatch("recent/update",{id:t.dialogId,fields:{counter:t.counter,message:babelHelpers.objectSpread({},i,{status:"delivered"})}})}}},{key:"handleUnreadMessageOpponent",value:function e(t,s){this.execUnreadMessageOpponent(t,s)}},{key:"handleUnreadMessageChatOpponent",value:function e(t,s){this.execUnreadMessageOpponent(t,s)}},{key:"execUnreadMessageOpponent",value:function e(t,s){if(this.skipExecute(t,s)){return false}this.store.dispatch("dialogues/updateReaded",{dialogId:t.dialogId,userId:t.userId,action:false})}},{key:"handleFileUpload",value:function e(a,n){if(this.skipExecute(a,n)){return false}this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(t.VuexBuilderModel.convertToArray({file:a.fileParams}))).then(function(){i.EventEmitter.emit(s.EventType.dialog.scrollToBottom,{cancelIfScrollChange:true})})}},{key:"handleChatPin",value:function e(t,s){this.store.dispatch("recent/pin",{id:t.dialogId,action:t.active})}},{key:"handleChatHide",value:function e(t,s){this.store.dispatch("recent/delete",{id:t.dialogId})}},{key:"handleChatMuteNotify",value:function e(t,s){var a=this.store.getters["dialogues/get"](t.dialogId);if(!a){return false}var i=a.muteList;var n=[];var r=this.store.state.application.common.userId;if(t.mute){n=[].concat(babelHelpers.toConsumableArray(i),[r])}else{n=i.filter(function(e){return e!==r})}this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{muteList:n}})}},{key:"handleReadNotifyList",value:function e(t,s){this.store.dispatch("recent/update",{id:"notify",fields:{counter:t.counter}})}},{key:"handleUserInvite",value:function e(t,s){if(!t.invited){this.store.dispatch("users/update",{id:t.userId,fields:t.user})}}},{key:"prepareRecentItem",value:function e(t){var s="user";if(t.dialogId.toString().startsWith("chat")){s="chat"}t.dialogId.toString().startsWith("chat");var a=s==="chat"?t.chat[t.chatId].name:t.users[t.dialogId].name;var i=t.chat[t.chatId]?t.chat[t.chatId]:{};if(!t.users){t.users={}}var n=t.users[t.dialogId]?t.users[t.dialogId]:{};var r=s==="user"?t.dialogId:0;return{id:t.dialogId,type:s,title:a,counter:t.counter,chatId:t.chatId,chat:i,user:n,userId:r,message:{id:t.message.id,text:t.message.textOriginal,date:t.message.date,senderId:t.message.senderId,withFile:typeof t.message.params["FILE_ID"]!=="undefined",withAttach:typeof t.message.params["ATTACH"]!=="undefined"}}}}]);return e}();var o=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.application)==="object"&&t.application){this.application=t.application}if(babelHelpers.typeof(t.controller)==="object"&&t.controller){this.controller=t.controller}if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}this.option=babelHelpers.typeof(t.store)==="object"&&t.store?t.store:{}}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}},{key:"getSubscriptionType",value:function e(){return n.PullClient.SubscriptionType.Server}},{key:"handleChatUserAdd",value:function e(t){var s=Object.values(t.users).map(function(e){return babelHelpers.objectSpread({},e,{lastActivityDate:new Date})});this.store.commit("conference/common",{userCount:t.userCount});this.store.dispatch("users/set",s);this.store.dispatch("conference/setUsers",{users:s.map(function(e){return e.id})})}},{key:"handleChatUserLeave",value:function e(t){if(t.userId===this.controller.getUserId()&&t.dialogId===this.store.state.application.dialog.dialogId){this.application.kickFromCall()}this.store.commit("conference/common",{userCount:t.userCount});this.store.dispatch("conference/removeUsers",{users:[t.userId]})}},{key:"handleCallUserNameUpdate",value:function e(t){var s=this.store.getters["users/get"](t.userId);if(!s){this.store.dispatch("users/set",{id:t.userId,lastActivityDate:new Date})}this.store.dispatch("users/update",{id:t.userId,fields:{name:t.name,lastActivityDate:new Date}})}},{key:"handleVideoconfShareUpdate",value:function e(t){if(t.dialogId===this.store.state.application.dialog.dialogId){this.store.dispatch("dialogues/update",{dialogId:t.dialogId,fields:{public:{code:t.newCode,link:t.newLink}}});this.application.changeVideoconfUrl(t.newLink)}}},{key:"handleMessageChat",value:function e(t){this.application.sendNewMessageNotify(t)}},{key:"handleChatRename",value:function e(t){if(t.chatId!==this.application.getChatId()){return false}this.store.dispatch("conference/setConferenceTitle",{conferenceTitle:t.name})}},{key:"handleConferenceUpdate",value:function e(t){if(t.chatId!==this.application.getChatId()){return false}if(t.isBroadcast!==""){this.store.dispatch("conference/setBroadcastMode",{broadcastMode:t.isBroadcast})}if(t.presenters.length>0){this.store.dispatch("conference/setPresenters",{presenters:t.presenters,replace:true})}}}]);return e}();function d(e,t){var s;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=l(e))||t&&e&&typeof e.length==="number"){if(s)e=s;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,r=false,o;return{s:function t(){s=e[Symbol.iterator]()},n:function e(){var t=s.next();n=t.done;return t},e:function e(t){r=true;o=t},f:function e(){try{if(!n&&s.return!=null)s.return()}finally{if(r)throw o}}}}function l(e,t){if(!e)return;if(typeof e==="string")return c(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return c(e,t)}function c(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}var u=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(t)}}]);function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(t.application)==="object"&&t.application){this.application=t.application}if(babelHelpers.typeof(t.controller)==="object"&&t.controller){this.controller=t.controller}if(babelHelpers.typeof(t.store)==="object"&&t.store){this.store=t.store}this.option=babelHelpers.typeof(t.store)==="object"&&t.store?t.store:{}}babelHelpers.createClass(e,[{key:"getModuleId",value:function e(){return"im"}},{key:"getSubscriptionType",value:function e(){return n.PullClient.SubscriptionType.Server}},{key:"handleNotifyAdd",value:function e(t,s){if(s.server_time_ago>30||t.onlyFlash===true){return false}var a=this.store.getters["users/get"](t.userId);if(!a){var i=[];i.push({id:t.userId,avatar:t.userAvatar,color:t.userColor,name:t.userName});this.store.dispatch("users/set",i)}this.store.dispatch("notifications/add",{data:t});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.store.dispatch("recent/update",{id:"notify",fields:{message:{id:t.id,text:t.text,date:t.date},counter:t.counter}})}},{key:"handleNotifyConfirm",value:function e(t,s){if(s.server_time_ago>30){return false}this.store.dispatch("notifications/delete",{id:t.id});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.updateRecentListOnDelete(t.counter)}},{key:"handleNotifyRead",value:function e(t,s){var a=this;if(s.server_time_ago>30){return false}t.list.forEach(function(e){a.store.dispatch("notifications/read",{ids:[e],action:true})});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.store.dispatch("recent/update",{id:"notify",fields:{counter:t.counter}})}},{key:"handleNotifyUnread",value:function e(t,s){var a=this;if(s.server_time_ago>30){return false}t.list.forEach(function(e){a.store.dispatch("notifications/read",{ids:[e],action:false})});this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter});this.store.dispatch("recent/update",{id:"notify",fields:{counter:t.counter}})}},{key:"handleNotifyDelete",value:function e(t,s){var a=this;if(s.server_time_ago>30){return false}var i=Object.keys(t.id).map(function(e){return parseInt(e,10)});i.forEach(function(e){a.store.dispatch("notifications/delete",{id:e})});this.updateRecentListOnDelete(t.counter);this.store.dispatch("notifications/setCounter",{unreadTotal:t.counter})}},{key:"updateRecentListOnDelete",value:function e(t){var s;var a=this.getLatest();if(a!==null){s={id:a.id,text:a.text,date:a.date}}else{var i=this.store.getters["recent/get"]("notify");if(i===false){return}s=i.element.message;s.text=this.controller.localize["IM_NOTIFICATIONS_DELETED_ITEM_STUB"]}this.store.dispatch("recent/update",{id:"notify",fields:{message:s,counter:t}})}},{key:"getLatest",value:function e(){var t={id:0};var s=d(this.store.state.notifications.collection),a;try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i.id>t.id){t=i}}}catch(e){s.e(e)}finally{s.f()}if(t.id===0){return null}return t}}]);return e}();e.ImBasePullHandler=r;e.ImCallPullHandler=o;e.ImNotificationsPullHandler=u})(this.BX.Messenger.Provider.Pull=this.BX.Messenger.Provider.Pull||{},BX,BX.Messenger.Const,BX.Messenger.Lib,BX.Event,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:69:"/local/js/im/provider/rest/dist/registry.bundle.min.js?16547598175400";s:6:"source";s:50:"/local/js/im/provider/rest/dist/registry.bundle.js";s:3:"min";s:54:"/local/js/im/provider/rest/dist/registry.bundle.min.js";s:3:"map";s:54:"/local/js/im/provider/rest/dist/registry.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.Provider=this.BX.Messenger.Provider||{};(function(e,s,t,i,a){"use strict";var r=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(s)}}]);function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(s.controller)==="object"&&s.controller){this.controller=s.controller}if(babelHelpers.typeof(s.store)==="object"&&s.store){this.store=s.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(s,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};s="handle"+s.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(t.error()){if(typeof this[s+"Error"]==="function"){return this[s+"Error"](t.error(),i)}}else{if(typeof this[s+"Success"]==="function"){return this[s+"Success"](t.data(),i)}}return typeof this[s]==="function"?this[s](t,i):null}}]);return e}();var l=function(e){babelHelpers.inherits(r,e);function r(){babelHelpers.classCallCheck(this,r);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).apply(this,arguments))}babelHelpers.createClass(r,[{key:"handleImUserListGetSuccess",value:function e(t){this.store.dispatch("users/set",s.VuexBuilderModel.convertToArray(t))}},{key:"handleImUserGetSuccess",value:function e(s){this.store.dispatch("users/set",[s])}},{key:"handleImChatGetSuccess",value:function e(s){this.store.dispatch("dialogues/set",s)}},{key:"handleImDialogMessagesGetSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/setBefore",this.controller.application.prepareFilesBeforeSave(s.files))}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files));if(s.messages.length===0&&s.chat_id){i.Logger.warn("setting messagesSet for empty chat",s.chat_id);setTimeout(function(){a.EventEmitter.emit(t.EventType.dialog.messagesSet,{chatId:s.chat_id})},100)}else{this.store.dispatch("messages/set",s.messages.reverse())}}},{key:"handleImDialogMessagesGetUnreadSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files))}},{key:"handleImDiskFolderGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{diskFolderId:s.ID}})}},{key:"handleImMessageAddSuccess",value:function e(s,t){var i=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s,sending:false,error:false}}).then(function(){i.store.dispatch("messages/actionFinish",{id:s,chatId:t.chatId})})}},{key:"handleImMessageAddError",value:function e(s,t){this.store.dispatch("messages/actionError",{id:t.id,chatId:t.chatId})}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){var i=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s["MESSAGE_ID"],sending:false,error:false}}).then(function(){i.store.dispatch("messages/actionFinish",{id:s["MESSAGE_ID"],chatId:t.chatId})})}},{key:"handleImDiskFileCommitError",value:function e(s,i){this.store.dispatch("files/update",{chatId:i.chatId,id:i.file.id,fields:{status:t.FileStatus.error,progress:0}});this.store.dispatch("messages/actionError",{id:i.id,chatId:i.chatId,retry:false})}},{key:"handleImRecentListSuccess",value:function e(s,t){i.Logger.warn("Provider.Rest.handleImRecentGetSuccess",s);var a=[];var r=[];var l=[];s.items.forEach(function(e){var s=0;var t=0;if(e.user&&e.user.id>0){s=e.user.id;a.push(e.user)}if(e.chat){t=e.chat.id;r.push(Object.assign(e.chat,{dialogId:e.id}))}else{r.push(Object.assign({},{dialogId:e.id}))}l.push(babelHelpers.objectSpread({},e,{avatar:e.avatar.url,color:e.avatar.color,userId:s,chatId:t}))});this.store.dispatch("users/set",a);this.store.dispatch("dialogues/set",r);this.store.dispatch("recent/set",l)}}]);return r}(r);var n=function(e){babelHelpers.inherits(s,e);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,e));t.application=e.application;return t}babelHelpers.createClass(s,[{key:"handleImChatGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{chatId:s.id,dialogId:s.dialog_id,diskFolderId:s.disk_folder_id}})}},{key:"handleImCallGetCallLimitsSuccess",value:function e(s){this.store.commit("application/set",{call:{serverEnabled:s.callServerEnabled,maxParticipants:s.maxParticipants}})}},{key:"handleImChatGetError",value:function e(s){if(s.ex.error==="ACCESS_ERROR"){i.Logger.error("MobileRestAnswerHandler.handleImChatGetError: ACCESS_ERROR")}}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){}},{key:"handleImMessageAddSuccess",value:function e(s,t){console.warn("im.message.add success in dialog handler")}},{key:"handleImMessageAddError",value:function e(s,t){}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){}}]);return s}(r);e.BaseRestHandler=r;e.CoreRestHandler=l;e.DialogRestHandler=n})(this.BX.Messenger.Provider.Rest=this.BX.Messenger.Provider.Rest||{},BX,BX.Messenger.Const,BX.Messenger.Lib,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:62:"/local/js/im/lib/timer/dist/timer.bundle.min.js?16547598172172";s:6:"source";s:43:"/local/js/im/lib/timer/dist/timer.bundle.js";s:3:"min";s:47:"/local/js/im/lib/timer/dist/timer.bundle.min.js";s:3:"map";s:47:"/local/js/im/lib/timer/dist/timer.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t){"use strict";var e=function(){function t(){babelHelpers.classCallCheck(this,t);this.list={};this.updateInterval=1e3;clearInterval(this.updateIntervalId);this.updateIntervalId=setInterval(this.worker.bind(this),this.updateInterval)}babelHelpers.createClass(t,[{key:"start",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var l=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};i=i==null?"default":i;n=parseFloat(n);if(isNaN(n)||n<=0){return false}n=n*1e3;if(typeof this.list[e]==="undefined"){this.list[e]={}}this.list[e][i]={dateStop:(new Date).getTime()+n,callback:typeof s==="function"?s:function(){},callbackParams:l};return true}},{key:"has",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";i=i==null?"default":i;if(i.toString().length<=0||typeof this.list[e]==="undefined"){return false}return!!this.list[e][i]}},{key:"stop",value:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";var n=arguments.length>2?arguments[2]:undefined;i=i==null?"default":i;if(i.toString().length<=0||typeof this.list[e]==="undefined"){return false}if(!this.list[e][i]){return true}if(n!==true){this.list[e][i]["callback"](i,this.list[e][i]["callbackParams"])}delete this.list[e][i];return true}},{key:"stopAll",value:function t(e){for(var i in this.list){if(this.list.hasOwnProperty(i)){for(var n in this.list[i]){if(this.list[i].hasOwnProperty(n)){this.stop(i,n,e)}}}}return true}},{key:"worker",value:function t(){for(var e in this.list){if(!this.list.hasOwnProperty(e)){continue}for(var i in this.list[e]){if(!this.list[e].hasOwnProperty(i)||this.list[e][i]["dateStop"]>new Date){continue}this.stop(e,i)}}return true}},{key:"clean",value:function t(){clearInterval(this.updateIntervalId);this.stopAll(true);return true}}]);return t}();t.Timer=e})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:69:"/local/js/im/controller/dist/controller.bundle.min.js?165475981720247";s:6:"source";s:49:"/local/js/im/controller/dist/controller.bundle.js";s:3:"min";s:53:"/local/js/im/controller/dist/controller.bundle.min.js";s:3:"map";s:53:"/local/js/im/controller/dist/controller.bundle.map.js";}"*/
this.BX=this.BX||{};(function(e,t,i,s,n,a,r,o,l,u,d,c){"use strict";var h=function(){function e(){babelHelpers.classCallCheck(this,e);this.controller=null;this.timer=new o.Timer;this._prepareFilesBeforeSave=function(e){return e};this.defaultMessageLimit=50;this.requestMessageLimit=this.getDefaultMessageLimit();this.messageLastReadId={};this.messageReadQueue={}}babelHelpers.createClass(e,[{key:"setCoreController",value:function e(t){this.controller=t}},{key:"getSiteId",value:function e(){return this.controller.getStore().state.application.common.siteId}},{key:"getUserId",value:function e(){return this.controller.getStore().state.application.common.userId}},{key:"getLanguageId",value:function e(){return this.controller.getStore().state.application.common.languageId}},{key:"getCurrentUser",value:function e(){return this.controller.getStore().getters["users/get"](this.controller.getStore().state.application.common.userId,true)}},{key:"getChatId",value:function e(){return this.controller.getStore().state.application.dialog.chatId}},{key:"getDialogId",value:function e(){return this.controller.getStore().state.application.dialog.dialogId}},{key:"getData",value:function e(){return this.controller.getStore().state.application}},{key:"getDialogData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();if(this.controller.getStore().state.dialogues.collection[t]){return this.controller.getStore().state.dialogues.collection[t]}return this.controller.getStore().getters["dialogues/getBlank"]()}},{key:"getDialogCrmData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();var i={enabled:false,entityType:l.DialogCrmType.none,entityId:0};var s=this.getDialogData(t);if(s.type===l.DialogType.call){if(s.entityData1&&typeof s.entityData1==="string"){var n=s.entityData1.split("|"),a=babelHelpers.slicedToArray(n,3),r=a[0],o=a[1],u=a[2];if(r){o=o?o.toString().toLowerCase():l.DialogCrmType.none;i={enabled:r,entityType:o,entityId:u}}}}else if(s.type===l.DialogType.crm){var d=s.entityId.split("|"),c=babelHelpers.slicedToArray(d,2),h=c[0],g=c[1];h=h?h.toString().toLowerCase():l.DialogCrmType.none;i={enabled:true,entityType:h,entityId:g}}return i}},{key:"getDialogIdByChatId",value:function e(t){if(this.getDialogId()==="chat"+t){return this.getDialogId()}var i=this.controller.getStore().getters["dialogues/getByChatId"](t);if(!i){return 0}return i.dialogId}},{key:"getDiskFolderId",value:function e(){return this.controller.getStore().state.application.dialog.diskFolderId}},{key:"getDefaultMessageLimit",value:function e(){return this.defaultMessageLimit}},{key:"getRequestMessageLimit",value:function e(){return this.requestMessageLimit}},{key:"muteDialog",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.getDialogId();if(u.Utils.dialog.isEmptyDialogId(s)){return false}if(i===null){i=!this.isDialogMuted()}this.timer.start("muteDialog",s,.3,function(e){t.controller.restClient.callMethod(l.RestMethod.imChatMute,{DIALOG_ID:s,ACTION:i?"Y":"N"})});var n=[];if(i){n=this.getDialogData().muteList;n.push(this.getUserId())}else{n=this.getDialogData().muteList.filter(function(e){return e!==t.getUserId()})}this.controller.getStore().dispatch("dialogues/update",{dialogId:s,fields:{muteList:n}});return true}},{key:"isDialogMuted",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();return this.getDialogData().muteList.includes(this.getUserId())}},{key:"isUnreadMessagesLoaded",value:function e(){var t=this.controller.getStore().state.dialogues.collection[this.getDialogId()];if(!t){return true}if(t.lastMessageId<=0){return true}var i=this.controller.getStore().state.messages.collection[this.getChatId()];if(!i||i.length<=0){return true}var s=0;for(var n=i.length-1;n>=0;n--){var a=i[n];if(typeof a.id==="number"){s=a.id;break}}return s>=t.lastMessageId}},{key:"prepareFilesBeforeSave",value:function e(t){return this._prepareFilesBeforeSave(t)}},{key:"setPrepareFilesBeforeSaveFunction",value:function e(t){this._prepareFilesBeforeSave=t.bind(this)}},{key:"showSmiles",value:function e(){this.store.dispatch("application/showSmiles")}},{key:"hideSmiles",value:function e(){this.store.dispatch("application/hideSmiles")}},{key:"startOpponentWriting",value:function e(t){var i=this;var s=t.dialogId,n=t.userId,a=t.userName;this.controller.getStore().dispatch("dialogues/updateWriting",{dialogId:s,userId:n,userName:a,action:true});this.timer.start("writingEnd",s+"|"+n,35,function(e,t){var s=t.dialogId,n=t.userId;i.controller.getStore().dispatch("dialogues/updateWriting",{dialogId:s,userId:n,action:false})},{dialogId:s,userId:n});return true}},{key:"stopOpponentWriting",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.dialogId,s=t.userId,n=t.userName;this.timer.stop("writingStart",i+"|"+s,true);this.timer.stop("writingEnd",i+"|"+s);return true}},{key:"startWriting",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();if(u.Utils.dialog.isEmptyDialogId(i)||this.timer.has("writes",i)){return false}this.timer.start("writes",i,28);this.timer.start("writesSend",i,5,function(e){t.controller.restClient.callMethod(l.RestMethod.imDialogWriting,{DIALOG_ID:i}).catch(function(){t.timer.stop("writes",i)})})}},{key:"stopWriting",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getDialogId();this.timer.stop("writes",t,true);this.timer.stop("writesSend",t,true)}},{key:"joinParentChat",value:function e(t,i){var s=this;return new Promise(function(e,n){if(!t||!i){return n()}if(typeof s.tempJoinChat==="undefined"){s.tempJoinChat={}}else if(s.tempJoinChat["wait"]){return n()}s.tempJoinChat["wait"]=true;s.controller.restClient.callMethod(l.RestMethod.imChatParentJoin,{DIALOG_ID:i,MESSAGE_ID:t}).then(function(){s.tempJoinChat["wait"]=false;s.tempJoinChat[i]=true;return e(i)}).catch(function(){s.tempJoinChat["wait"]=false;return n()})})}},{key:"setTextareaMessage",value:function e(t){var i=t.message,s=i===void 0?"":i,n=t.dialogId,a=n===void 0?this.getDialogId():n;this.controller.getStore().dispatch("dialogues/update",{dialogId:a,fields:{textareaMessage:s}})}},{key:"setSendingMessageFlag",value:function e(t){this.controller.getStore().dispatch("messages/actionStart",{id:t,chatId:this.getChatId()})}},{key:"reactMessage",value:function e(t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"auto";this.controller.restClient.callMethod(l.RestMethod.imMessageLike,{MESSAGE_ID:t,ACTION:i==="auto"?"auto":i==="set"?"plus":"minus"})}},{key:"readMessage",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var a=this.getChatId();if(typeof this.messageLastReadId[a]==="undefined"){this.messageLastReadId[a]=null}if(typeof this.messageReadQueue[a]==="undefined"){this.messageReadQueue[a]=[]}if(i){this.messageReadQueue[a].push(parseInt(i))}this.timer.stop("readMessage",a,true);this.timer.stop("readMessageServer",a,true);if(s){return this.readMessageExecute(a,n)}return new Promise(function(e,i){t.timer.start("readMessage",a,.1,function(i,s){return t.readMessageExecute(i,n).then(function(t){return e(t)})})})}},{key:"readMessageExecute",value:function e(t){var i=this;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise(function(e,n){if(i.messageReadQueue[t]){i.messageReadQueue[t]=i.messageReadQueue[t].filter(function(e){if(!i.messageLastReadId[t]){i.messageLastReadId[t]=e}else if(i.messageLastReadId[t]<e){i.messageLastReadId[t]=e}})}var a=i.getDialogIdByChatId(t);var r=i.messageLastReadId[t]||0;if(r<=0){e({dialogId:a,lastId:0});return true}i.controller.getStore().dispatch("messages/readMessages",{chatId:t,readId:r}).then(function(n){i.controller.getStore().dispatch("dialogues/decreaseCounter",{dialogId:a,count:n.count});if(i.getChatId()===t&&i.controller.getStore().getters["dialogues/canSaveChat"]){var o=i.controller.getStore().getters["dialogues/get"](a);if(o.counter<=0){i.controller.getStore().commit("application/clearDialogExtraCount")}}if(s){e({dialogId:a,lastId:r})}else{i.timer.start("readMessageServer",t,.5,function(){i.controller.restClient.callMethod(l.RestMethod.imDialogRead,{DIALOG_ID:a,MESSAGE_ID:r}).then(function(){return e({dialogId:a,lastId:r})}).catch(function(){return e({dialogId:a,lastId:r})})})}}).catch(function(){e()})})}},{key:"unreadMessage",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=this.getChatId();if(typeof this.messageLastReadId[n]==="undefined"){this.messageLastReadId[n]=null}if(typeof this.messageReadQueue[n]==="undefined"){this.messageReadQueue[n]=[]}if(i){this.messageReadQueue[n]=this.messageReadQueue[n].filter(function(e){return e<i})}this.timer.stop("readMessage",n,true);this.timer.stop("readMessageServer",n,true);this.messageLastReadId[n]=i;this.controller.getStore().dispatch("messages/unreadMessages",{chatId:n,unreadId:this.messageLastReadId[n]}).then(function(e){var a=t.getDialogIdByChatId(n);t.controller.getStore().dispatch("dialogues/update",{dialogId:a,fields:{unreadId:i}});t.controller.getStore().dispatch("dialogues/increaseCounter",{dialogId:a,count:e.count});if(!s){t.controller.restClient.callMethod(l.RestMethod.imDialogUnread,{DIALOG_ID:a,MESSAGE_ID:t.messageLastReadId[n]})}}).catch(function(){})}},{key:"shareMessage",value:function e(t,i){this.controller.restClient.callMethod(l.RestMethod.imMessageShare,{DIALOG_ID:this.getDialogId(),MESSAGE_ID:t,TYPE:i});return true}},{key:"replyToUser",value:function e(t,i){return true}},{key:"openMessageReactionList",value:function e(t,i){return true}},{key:"emit",value:function e(t){var i;for(var s=arguments.length,n=new Array(s>1?s-1:0),a=1;a<s;a++){n[a-1]=arguments[a]}(i=d.Vue.event).$emit.apply(i,[t].concat(n))}},{key:"listen",value:function e(t,i){d.Vue.event.$on(t,i)}}]);return e}();var g=function(){function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.inited=false;this.initPromise=new Promise(function(e,i){t.initPromiseResolver=e});this.offline=false;this.restAnswerHandler=[];this.vuexAdditionalModel=[];this.store=null;this.storeBuilder=null;this.init().then(function(){return t.prepareParams(i)}).then(function(){return t.initController()}).then(function(){return t.initLocalStorage()}).then(function(){return t.initStorage()}).then(function(){return t.initRestClient()}).then(function(){return t.initPullClient()}).then(function(){return t.initEnvironment()}).then(function(){return t.initComplete()}).catch(function(e){c.Logger.error("error initializing core controller",e)})}babelHelpers.createClass(e,[{key:"init",value:function e(){return Promise.resolve()}},{key:"prepareParams",value:function e(n){var a=this;if(typeof n.localize!=="undefined"){this.localize=n.localize}else{if(typeof BX!=="undefined"){this.localize=babelHelpers.objectSpread({},BX.message)}else{this.localize={}}}if(typeof n.host!=="undefined"){this.host=n.host}else{this.host=location.origin}if(typeof n.userId!=="undefined"){var r=parseInt(n.userId);if(!isNaN(r)){this.userId=r}else{this.userId=0}}else{var o=this.getLocalize("USER_ID");this.userId=o?parseInt(o):0}if(typeof n.siteId!=="undefined"){if(typeof n.siteId==="string"&&n.siteId!==""){this.siteId=n.siteId}else{this.siteId="s1"}}else{this.siteId=this.getLocalize("SITE_ID")||"s1"}if(typeof n.siteDir!=="undefined"){if(typeof n.siteDir==="string"&&n.siteDir!==""){this.siteDir=n.siteDir}else{this.siteDir="s1"}}else{this.siteDir=this.getLocalize("SITE_DIR")||"s1"}if(typeof n.languageId!=="undefined"){if(typeof n.languageId==="string"&&n.languageId!==""){this.languageId=n.languageId}else{this.languageId="en"}}else{this.languageId=this.getLocalize("LANGUAGE_ID")||"en"}this.pullInstance=t.PullClient;this.pullClient=t.PULL;if(typeof n.pull!=="undefined"){if(typeof n.pull.instance!=="undefined"){this.pullInstance=n.pull.instance}if(typeof n.pull.client!=="undefined"){this.pullClient=n.pull.client}}this.restInstance=i.RestClient;this.restClient=i.rest;if(typeof n.rest!=="undefined"){if(typeof n.rest.instance!=="undefined"){this.restInstance=n.rest.instance}if(typeof n.rest.client!=="undefined"){this.restClient=n.rest.client}}this.vuexBuilder={database:false,databaseName:"desktop/im",databaseType:s.VuexBuilder.DatabaseType.indexedDb};if(typeof n.vuexBuilder!=="undefined"){if(typeof n.vuexBuilder.database!=="undefined"){this.vuexBuilder.database=n.vuexBuilder.database}if(typeof n.vuexBuilder.databaseName!=="undefined"){this.vuexBuilder.databaseName=n.vuexBuilder.databaseName}if(typeof n.vuexBuilder.databaseType!=="undefined"){this.vuexBuilder.databaseType=n.vuexBuilder.databaseType}if(typeof n.vuexBuilder.models!=="undefined"){n.vuexBuilder.models.forEach(function(e){a.addVuexModel(e)})}}return Promise.resolve()}},{key:"initController",value:function e(){this.application=new h;this.application.setCoreController(this);return new Promise(function(e,t){return e()})}},{key:"initLocalStorage",value:function e(){return new Promise(function(e,t){return e()})}},{key:"initStorage",value:function e(){var t=this;var i={common:{host:this.getHost(),userId:this.getUserId(),siteId:this.getSiteId(),languageId:this.getLanguageId()},dialog:{messageLimit:this.application.getDefaultMessageLimit(),enableReadMessages:true},device:{type:u.Utils.device.isMobile()?l.DeviceType.mobile:l.DeviceType.desktop,orientation:u.Utils.device.getOrientation()}};var a=(new s.VuexBuilder).addModel(n.ApplicationModel.create().useDatabase(false).setVariables(i)).addModel(n.MessagesModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost()})).addModel(n.DialoguesModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost()})).addModel(n.FilesModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost(),default:{name:"File is deleted"}})).addModel(n.UsersModel.create().useDatabase(this.vuexBuilder.database).setVariables({host:this.getHost(),default:{name:"Anonymous"}})).addModel(n.RecentModel.create().useDatabase(false).setVariables({host:this.getHost()})).addModel(n.NotificationsModel.create().useDatabase(false).setVariables({host:this.getHost()}));this.vuexAdditionalModel.forEach(function(e){a.addModel(e)});a.setDatabaseConfig({name:this.vuexBuilder.databaseName,type:this.vuexBuilder.databaseType,siteId:this.getSiteId(),userId:this.getUserId()});return a.build().then(function(e){t.store=e.store;t.storeBuilder=e.builder;return new Promise(function(e,t){return e()})})}},{key:"initRestClient",value:function e(t){this.addRestAnswerHandler(r.CoreRestHandler.create({store:this.store,controller:this}));return new Promise(function(e,t){return e()})}},{key:"initPullClient",value:function e(){if(!this.pullClient){return false}this.pullClient.subscribe(this.pullBaseHandler=new a.ImBasePullHandler({store:this.store,controller:this}));this.pullClient.subscribe({type:this.pullInstance.SubscriptionType.Status,callback:this.eventStatusInteraction.bind(this)});this.pullClient.subscribe({type:this.pullInstance.SubscriptionType.Online,callback:this.eventOnlineInteraction.bind(this)});return new Promise(function(e,t){return e()})}},{key:"initEnvironment",value:function e(t){var i=this;window.addEventListener("orientationchange",function(){if(!i.store){return}i.store.commit("application/set",{device:{orientation:u.Utils.device.getOrientation()}});if(i.store.state.application.device.type===l.DeviceType.mobile&&i.store.state.application.device.orientation===l.DeviceOrientation.horizontal){document.activeElement.blur()}});return new Promise(function(e,t){return e()})}},{key:"initComplete",value:function e(){this.inited=true;this.initPromiseResolver(this)}},{key:"eventStatusInteraction",value:function e(t){if(t.status===this.pullInstance.PullStatus.Online){this.offline=false}else if(t.status===this.pullInstance.PullStatus.Offline){this.offline=true}}},{key:"eventOnlineInteraction",value:function e(t){if(t.command==="list"||t.command==="userStatus"){for(var i in t.params.users){if(!t.params.users.hasOwnProperty(i)){continue}this.store.dispatch("users/update",{id:t.params.users[i].id,fields:t.params.users[i]})}}}},{key:"executeRestAnswer",value:function e(t,i,s){c.Logger.warn("Core.controller.executeRestAnswer",t,i,s);this.restAnswerHandler.forEach(function(e){e.execute(t,i,s)})}},{key:"createVue",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var s=this;var n=function e(){};if(i.beforeCreate){n=i.beforeCreate}var a=function e(){};if(i.destroyed){a=i.destroyed}var r=function e(){};if(i.created){r=i.created}var o={store:this.store,beforeCreate:function e(){this.$bitrix.Data.set("controller",s);this.$bitrix.Application.set(t);this.$bitrix.Loc.setMessage(s.localize);if(s.restClient){this.$bitrix.RestClient.set(s.restClient)}if(s.pullClient){this.$bitrix.PullClient.set(s.pullClient)}n.bind(this)()},created:function e(){r.bind(this)()},destroyed:function e(){a.bind(this)()}};if(i.el){o.el=i.el}if(i.template){o.template=i.template}if(i.computed){o.computed=i.computed}if(i.data){o.data=i.data}var l=o.created;return new Promise(function(e,t){o.created=function(){l.bind(this)();e(this)};d.BitrixVue.createApp(o)})}},{key:"getHost",value:function e(){return this.host}},{key:"setHost",value:function e(t){this.host=t;this.store.commit("application/set",{common:{host:t}})}},{key:"getUserId",value:function e(){return this.userId}},{key:"setUserId",value:function e(t){var i=parseInt(t);if(!isNaN(i)){this.userId=i}else{this.userId=0}this.store.commit("application/set",{common:{userId:t}})}},{key:"getSiteId",value:function e(){return this.siteId}},{key:"setSiteId",value:function e(t){if(typeof t==="string"&&t!==""){this.siteId=t}else{this.siteId="s1"}this.store.commit("application/set",{common:{siteId:this.siteId}})}},{key:"getLanguageId",value:function e(){return this.languageId}},{key:"setLanguageId",value:function e(t){if(typeof t==="string"&&t!==""){this.languageId=t}else{this.languageId="en"}this.store.commit("application/set",{common:{languageId:this.languageId}})}},{key:"getStore",value:function e(){return this.store}},{key:"getStoreBuilder",value:function e(){return this.storeBuilder}},{key:"addRestAnswerHandler",value:function e(t){this.restAnswerHandler.push(t)}},{key:"addVuexModel",value:function e(t){this.vuexAdditionalModel.push(t)}},{key:"isOnline",value:function e(){return!this.offline}},{key:"ready",value:function e(){if(this.inited){return Promise.resolve(this)}return this.initPromise}},{key:"setError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";c.Logger.error("Messenger.Application.error: ".concat(t," (").concat(i,")"));var s="";if(t.endsWith("LOCALIZED")){s=i}this.store.commit("application/set",{error:{active:true,code:t,description:s}})}},{key:"clearError",value:function e(){this.store.commit("application/set",{error:{active:false,code:"",description:""}})}},{key:"addLocalize",value:function e(t){if(babelHelpers.typeof(t)!=="object"||!t){return false}for(var i in t){if(t.hasOwnProperty(i)){this.localize[i]=t[i]}}return true}},{key:"getLocalize",value:function e(t){var i="";if(typeof t==="undefined"){return this.localize}else if(typeof this.localize[t.toString()]==="undefined"){c.Logger.warn("Controller.Core.getLocalize: message with code '".concat(t.toString(),"' is undefined."))}else{i=this.localize[t]}return i}}]);return e}();e.Controller=g})(this.BX.Messenger=this.BX.Messenger||{},BX,BX,BX,BX.Messenger.Model,BX.Messenger.Provider.Pull,BX.Messenger.Provider.Rest,BX.Messenger.Lib,BX.Messenger.Const,BX.Messenger.Lib,BX,BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:72:"/local/js/im/application/launch/dist/launch.bundle.min.js?16547598171204";s:6:"source";s:53:"/local/js/im/application/launch/dist/launch.bundle.js";s:3:"min";s:57:"/local/js/im/application/launch/dist/launch.bundle.min.js";s:3:"map";s:57:"/local/js/im/application/launch/dist/launch.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,n){"use strict";var i=function e(i){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r="";var s="";if(babelHelpers.typeof(i)==="object"){s=i.name.toString();r=i.application.toString()}else{s=i.toString();r=i}r=r.substr(0,1).toUpperCase()+r.substr(1);if(r==="Launch"||r==="Core"||r.endsWith("Application")){n.Logger.error("BX.Messenger.Application.Launch: specified name is forbidden.");return new Promise(function(e,n){return n()})}var o=function e(){try{BX.Messenger.Application[s]=new BX.Messenger.Application[r+"Application"](t);return BX.Messenger.Application[s].ready()}catch(e){n.Logger.error('BX.Messenger.Application.Launch: application "'.concat(r,'" is not initialized.'));return false}};if(typeof BX.Messenger.Application[r+"Application"]==="undefined"&&typeof BX.Runtime!=="undefined"&&typeof BX.Runtime.loadExtension!=="undefined"){var a="im.application."+r.toString().toLowerCase();return BX.Runtime.loadExtension(a).then(function(){return o()})}return o()};e.Launch=i})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:67:"/local/js/im/application/core/dist/core.bundle.min.js?1654759817436";s:6:"source";s:49:"/local/js/im/application/core/dist/core.bundle.js";s:3:"min";s:53:"/local/js/im/application/core/dist/core.bundle.min.js";s:3:"map";s:53:"/local/js/im/application/core/dist/core.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,s){"use strict";var r=function(){function e(){babelHelpers.classCallCheck(this,e);this.controller=new s.Controller}babelHelpers.createClass(e,[{key:"ready",value:function e(){return this.controller.ready()}}]);return e}();var t=new r;e.Core=t})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/local/js/im/lib/animation/dist/animation.bundle.min.js?16547598171109";s:6:"source";s:51:"/local/js/im/lib/animation/dist/animation.bundle.js";s:3:"min";s:55:"/local/js/im/lib/animation/dist/animation.bundle.min.js";s:3:"map";s:55:"/local/js/im/lib/animation/dist/animation.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var n=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"start",value:function e(n){var i=n.start,e=i===void 0?0:i,t=n.end,r=t===void 0?0:t,a=n.increment,o=a===void 0?20:a,s=n.callback,u=s===void 0?function(){}:s,c=n.duration,l=c===void 0?500:c,m=n.element,f=n.elementProperty;var v=r-e;var w=0;var d=function e(n,i,t,r){n/=r/2;if(n<1){return t/2*n*n+i}n--;return-t/2*(n*(n-2)-1)+i};var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};var h=null;var A=function n(){w+=o;m[f]=d(w,e,v,l);if(w<l){h=b(n)}else{if(u&&typeof u==="function"){u()}}return h};return A()}},{key:"cancel",value:function e(n){var i=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)};i(n)}}]);return e}();n.frameIds={};e.Animation=n})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:74:"/local/js/im/view/element/attach/dist/attach.bundle.min.js?165475981717056";s:6:"source";s:54:"/local/js/im/view/element/attach/dist/attach.bundle.js";s:3:"min";s:58:"/local/js/im/view/element/attach/dist/attach.bundle.min.js";s:3:"map";s:58:"/local/js/im/view/element/attach/dist/attach.bundle.map.js";}"*/
(function(t,e,n,i,l,a){"use strict";var m={property:"DELIMITER",name:"bx-im-view-element-attach-delimiter",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},computed:{styles:function t(){return{width:this.config.DELIMITER.SIZE?this.config.DELIMITER.SIZE+"px":"",backgroundColor:this.config.DELIMITER.COLOR?this.config.DELIMITER.COLOR:this.color}}},template:'<div class="bx-im-element-attach-type-delimiter" :style="styles"></div>'}};var r={property:"FILE",name:"bx-im-element-attach-file",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{openLink:function t(e){l.Utils.platform.openNewPage(e.LINK)},file:function t(){return{name:this.config.FILE.NAME,extension:this.config.FILE.NAME.split(".").splice(-1)[0],size:this.config.FILE.SIZE}},fileName:function t(e){var n=70;if(!e.NAME||e.NAME.length<n){return e.NAME}var i=10;var l=e.NAME.split(".").splice(-1)[0];var a=e.NAME.substring(e.NAME.length-1-(l.length+1+i));var m=e.NAME.substring(0,n-a.length-3);return m.trim()+"..."+a.trim()},fileNameFull:function t(e){return e.NAME},fileSize:function t(e){var n=e.SIZE;if(n<=0){return""}var i=["BYTE","KB","MB","GB","TB"];var l=0;while(n>=1024&&l<4){n/=1024;l++}return Math.round(n)+" "+this.$Bitrix.Loc.getMessage("IM_MESSENGER_ATTACH_FILE_SIZE_"+i[l])},fileIcon:function t(e){return i.FilesModel.getIconType(e.NAME.split(".").splice(-1)[0])}},template:'\n\t\t\t<div class="bx-im-element-attach-type-file-element">\n\t\t\t\t<template v-for="(element, index) in config.FILE">\n\t\t\t\t\t<div class="bx-im-element-attach-type-file" @click="openLink(element)">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-icon">\n\t\t\t\t\t\t\t<div :class="[\'ui-icon\', \'ui-icon-file-\'+fileIcon(element)]"><i></i></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-block">\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-name" :title="fileNameFull(element)">\n\t\t\t\t\t\t\t\t{{fileName(element)}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-file-size">{{fileSize(element)}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var o={methods:{openLink:function t(e){var n=e.element;var i=e.event;if(!l.Utils.platform.isBitrixMobile()&&n.LINK){return}if(n.LINK&&i.target.tagName!=="A"){l.Utils.platform.openNewPage(n.LINK)}else if(!n.LINK){var a={id:null,type:null};if(n.hasOwnProperty("USER_ID")&&n.USER_ID>0){a.id=n.USER_ID;a.type="user"}if(n.hasOwnProperty("CHAT_ID")&&n.CHAT_ID>0){a.id=n.CHAT_ID;a.type="chat"}if(a.id&&a.type&&window.top["BXIM"]){var m=!BX.MessengerTheme.isDark();window.top["BXIM"].messenger.openPopupExternalData(i.target,a.type,m,{ID:a.id})}else if(navigator.userAgent.toLowerCase().includes("bitrixmobile")){var r="";if(a.type==="chat"){r="chat".concat(a.id)}else{r=a.id}if(r!==""){BXMobileApp.Events.postToComponent("onOpenDialog",[{dialogId:r},true],"im.recent")}}}}}};var c={property:"GRID",name:"bx-im-view-element-attach-grid",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},created:function t(){if(l.Utils.platform.isBitrixMobile()){this.maxCellWith=Math.floor(Math.min(screen.availWidth,screen.availHeight)/4)}else{this.maxCellWith=null}},methods:{getWidth:function t(e){if(e.DISPLAY!=="row"){return e.WIDTH?e.WIDTH+"px":""}if(!e.VALUE){return false}if(this.maxCellWith&&e.WIDTH>this.maxCellWith){return this.maxCellWith+"px"}return e.WIDTH?e.WIDTH+"px":""},getValue:function t(e){var n=this;if(!e.VALUE){return""}var a=l.Utils.text.htmlspecialchars(e.VALUE);a=a.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(t,e,i){var a=n.$store.getters["users/get"](e);i=a?l.Utils.text.htmlspecialchars(a.name):i;return'<span class="bx-im-mention" data-type="USER" data-value="'+e+'">'+i+"</span>"});return i.MessagesModel.decodeBbCode({text:a})}},template:'\n\t\t\t<div class="bx-im-element-attach-type-grid">\n\t\t\t\t<template v-for="(element, index) in config.GRID">\n\t\t\t\t\t<template v-if="element.DISPLAY.toLowerCase() === \'block\'">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-block" :style="{width: getWidth(element)}">\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-name">{{element.NAME}}</div>\n\t\t\t\t\t\t\t<template v-if="element.LINK">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a :href="element.LINK" target="_blank" @click="openLink({element: element, event: $event})" v-html="getValue(element)"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-value" v-html="getValue(element)"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="element.DISPLAY.toLowerCase() === \'line\'">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-card" :style="{width: getWidth(element)}">\n\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-name">{{element.NAME}}</div>\n\t\t\t\t\t\t\t<template v-if="element.LINK">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link"\n\t\t\t\t\t\t\t\t\t:style="{color: element.COLOR? element.COLOR: \'\'}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a :href="element.LINK" target="_blank" @click="openLink({element: element, event: $event})" v-html="getValue(element)"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-element-value" :style="{color: element.COLOR? element.COLOR: \'\'}" v-html="getValue(element)"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if="element.DISPLAY.toLowerCase() === \'row\'">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-column">\n\t\t\t\t\t\t\t<table class="bx-im-element-attach-type-display-column-table">\n\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<template v-if="element.NAME">\n\t\t\t\t\t\t\t\t\t\t\t<td class="bx-im-element-attach-type-grid-element-name" :colspan="element.VALUE? 1: 2" :style="{width: getWidth(element)}">{{element.NAME}}</td>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t<template v-if="element.VALUE">\n\t\t\t\t\t\t\t\t\t\t\t<template v-if="element.LINK">\n\t\t\t\t\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link"\n\t\t\t\t\t\t\t\t\t\t\t\t\t:colspan="element.NAME? 1: 2"\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style="{color: element.COLOR? element.COLOR: \'\'}"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a :href="element.LINK" target="_blank" @click="openLink({element: element, event: $event})" v-html="getValue(element)"></a>\n\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t<td class="bx-im-element-attach-type-grid-element-value" :colspan="element.NAME? 1: 2" :style="{color: element.COLOR? element.COLOR: \'\'}" v-html="getValue(element)"></td>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var s={property:"HTML",name:"bx-im-view-element-attach-html",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},template:'<div class="bx-im-element-attach-type-html" v-html="config.HTML"></div>'}};var p={property:"IMAGE",name:"bx-im-view-element-attach-image",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{open:function t(e){if(!e){return false}if(l.Utils.platform.isBitrixMobile()){BXMobileApp.UI.Photo.show({photos:[{url:e}],default_photo:e})}else{window.open(e,"_blank")}},getImageSize:function t(e,n,i){var l;if(e>i){l=i/e}else{l=1}return{width:e*l,height:n*l}},getElementSource:function t(e){return e.PREVIEW?e.PREVIEW:e.LINK},getElementTitle:function t(e){return l.Utils.text.htmlspecialcharsback(e.NAME)},lazyLoadCallback:function t(e){if(!e.element.style.width){e.element.style.width=e.element.offsetWidth+"px"}if(!e.element.style.height){e.element.style.height=e.element.offsetHeight+"px"}},styleFileSizes:function t(e){if(!(e.WIDTH&&e.HEIGHT)){return{maxHeight:"100%",backgroundSize:"contain"}}var n=this.getImageSize(e.WIDTH,e.HEIGHT,250);return{width:n.width+"px",height:n.height+"px",backgroundSize:n.width<100||n.height<100?"contain":"initial"}},styleBoxSizes:function t(e){if(!(e.WIDTH&&e.HEIGHT)){return{height:"150px"}}if(parseInt(this.styleFileSizes(e).height)<=250){return{}}return{height:"280px"}}},template:'\n\t\t\t<div class="bx-im-element-attach-type-image">\n\t\t\t\t<template v-for="(image, index) in config.IMAGE">\n\t\t\t\t\t<div class="bx-im-element-attach-type-image-block" @click="open(image.LINK)" :style="styleBoxSizes(image)" :key="index">\n\t\t\t\t\t\t<img v-bx-lazyload="{callback: lazyLoadCallback}"\n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-image-source"\n\t\t\t\t\t\t\t:data-lazyload-src="getElementSource(image)"\n\t\t\t\t\t\t\t:style="styleFileSizes(image)"\n\t\t\t\t\t\t\t:title="getElementTitle(image)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var d={property:"LINK",name:"bx-im-view-element-attach-link",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{getImageConfig:function t(e){return{IMAGE:[{NAME:e.NAME,PREVIEW:e.PREVIEW,WIDTH:e.WIDTH,HEIGHT:e.HEIGHT}]}},getLinkName:function t(e){return e.NAME?e.NAME:e.LINK}},computed:{imageComponentName:function t(){return p.name}},components:babelHelpers.defineProperty({},p.name,p.component),template:'\n\t\t\t<div class="bx-im-element-attach-type-link">\n\t\t\t\t<template v-for="(element, index) in config.LINK">\n\t\t\t\t\t<div class="bx-im-element-attach-type-link-element" :key="index">\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tv-if="element.LINK"\n\t\t\t\t\t\t\t:href="element.LINK"\n\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-link-name" \n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{getLinkName(element)}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-ajax-link"\n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{getLinkName(element)}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if="element.DESC" class="bx-im-element-attach-type-link-desc">{{element.DESC}}</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tv-if="element.PREVIEW" \n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-link-image"\n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is="imageComponentName" :config="getImageConfig(element)" :color="color"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var f={property:"MESSAGE",name:"bx-im-view-element-attach-message",component:{props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},computed:{message:function t(){var e=this;var n=l.Utils.text.htmlspecialchars(this.config.MESSAGE);n=n.replace(/\[USER=([0-9]{1,})\](.*?)\[\/USER\]/gi,function(t,n,i){var a=e.$store.getters["users/get"](n);i=a?l.Utils.text.htmlspecialchars(a.name):i;return'<span class="bx-im-mention" data-type="USER" data-value="'+n+'">'+i+"</span>"});return i.MessagesModel.decodeBbCode({text:n})}},template:'<div class="bx-im-element-attach-type-message" v-html="message"></div>'}};var v={property:"RICH_LINK",name:"bx-im-view-element-attach-rich",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{getImageConfig:function t(e){return{IMAGE:[{NAME:e.NAME,PREVIEW:e.PREVIEW,WIDTH:e.WIDTH,HEIGHT:e.HEIGHT}]}}},computed:{imageComponentName:function t(){return p.name}},components:babelHelpers.defineProperty({},p.name,p.component),template:'\n\t\t\t<div class="bx-im-element-attach-type-rich">\n\t\t\t\t<template v-for="(element, index) in config.RICH_LINK">\n\t\t\t\t\t<div class="bx-im-element-attach-type-rich-element" :key="index">\n\t\t\t\t\t\t<div v-if="element.PREVIEW" class="bx-im-element-attach-type-rich-image" @click="openLink({element: element, event: $event})">\n\t\t\t\t\t\t\t<component :is="imageComponentName" :config="getImageConfig(element)" :color="color"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-rich-name" @click="openLink({element: element, event: $event})">{{element.NAME}}</div>\n\t\t\t\t\t\t<div v-if="element.DESC" class="bx-im-element-attach-type-rich-desc">{{element.DESC}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};var h={property:"USER",name:"bx-im-view-element-attach-user",component:{mixins:[o],props:{config:{type:Object,default:{}},color:{type:String,default:"transparent"}},methods:{getAvatarType:function t(e){if(e.AVATAR){return""}var n="user";if(e.AVATAR_TYPE==="CHAT"){n="chat"}else if(e.AVATAR_TYPE==="BOT"){n="bot"}return"bx-im-element-attach-type-user-avatar-type-"+n}},template:'\n\t\t\t<div class="bx-im-element-attach-type-user">\n\t\t\t\t<template v-for="(element, index) in config.USER">\n\t\t\t\t\t<div class="bx-im-element-attach-type-user-body">\n\t\t\t\t\t\t<div class="bx-im-element-attach-type-user-avatar">\n\t\t\t\t\t\t\t<div :class="[\'bx-im-element-attach-type-user-avatar-type\', getAvatarType(element)]" :style="{backgroundColor: element.AVATAR? \'\': color}">\n\t\t\t\t\t\t\t\t<img v-if="element.AVATAR" \n\t\t\t\t\t\t\t\t\tv-bx-lazyload\n\t\t\t\t\t\t\t\t\tclass="bx-im-element-attach-type-user-avatar-source"\n\t\t\t\t\t\t\t\t\t:data-lazyload-src="element.AVATAR"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tv-if="element.LINK"\n\t\t\t\t\t\t\t:href="element.LINK" \n\t\t\t\t\t\t\tclass="bx-im-element-attach-type-user-name"\n\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t@click="openLink({element: element, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{element.NAME}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span v-else @click.prevent="openLink({element: element, event: $event})">\n\t\t\t\t\t\t\t{{element.NAME}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t'}};function u(t,e){var n;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(n=g(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var i=0;var l=function t(){};return{s:l,n:function e(){if(i>=t.length)return{done:true};return{done:false,value:t[i++]}},e:function t(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,m=false,r;return{s:function e(){n=t[Symbol.iterator]()},n:function t(){var e=n.next();a=e.done;return e},e:function t(e){m=true;r=e},f:function t(){try{if(!a&&n.return!=null)n.return()}finally{if(m)throw r}}}}function g(t,e){if(!t)return;if(typeof t==="string")return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}function y(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,i=new Array(e);n<e;n++){i[n]=t[n]}return i}var b=[m,r,c,s,p,d,f,v,h];var x={};b.forEach(function(t){x[t.name]=t.component});a.BitrixVue.component("bx-im-view-element-attach",{props:{config:{type:Object,default:{}},baseColor:{type:String,default:"#17a3ea"}},methods:{getComponentForBlock:function t(e){var n=u(b),i;try{for(n.s();!(i=n.n()).done;){var l=i.value;if(typeof e[l.property]!=="undefined"){return l.name}}}catch(t){n.e(t)}finally{n.f()}return""}},computed:{color:function t(){if(typeof this.config.COLOR==="undefined"||!this.config.COLOR){return this.baseColor}if(this.config.COLOR==="transparent"){return""}return this.config.COLOR}},components:x,template:'\n\t\t<div class="bx-im-element-attach">\n\t\t\t<div v-if="color" class="bx-im-element-attach-border" :style="{borderColor: color}"></div>\n\t\t\t<div class="bx-im-element-attach-content">\n\t\t\t\t<template v-for="(block, index) in config.BLOCKS">\n\t\t\t\t\t<component :is="getComponentForBlock(block)" :config="block" :color="color" :key="index" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.window=this.window||{},BX,window,BX.Messenger.Model,BX.Messenger.Lib,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:77:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.min.js?16547598173415";s:6:"source";s:58:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.js";s:3:"min";s:62:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.min.js";s:3:"map";s:62:"/local/js/im/view/element/keyboard/dist/keyboard.bundle.map.js";}"*/
(function(exports,ui_vue,im_lib_utils,im_lib_logger){"use strict";var _ButtonType=Object.freeze({newline:"NEWLINE",button:"BUTTON"});ui_vue.BitrixVue.component("bx-im-view-element-keyboard",{props:{buttons:{type:Array,default:function t(){return[]}},messageId:{default:0},userId:{default:0},dialogId:{default:0}},data:function t(){return{isMobile:im_lib_utils.Utils.platform.isMobile(),isBlocked:false,localButtons:[]}},created:function t(){this.localButtons=this.prepareButtons(this.buttons)},watch:{buttons:function t(){clearTimeout(this.recoverStateButton);this.isBlocked=false;this.localButtons=this.prepareButtons(this.buttons)}},methods:{click:function click(button){var _this=this;if(this.isBlocked){return false}if(button.DISABLED&&button.DISABLED==="Y"){return false}if(button.ACTION&&button.ACTION_VALUE.toString()){this.$emit("click",{action:"ACTION",params:{dialogId:this.dialogId,messageId:this.messageId,botId:button.BOT_ID,action:button.ACTION,value:button.ACTION_VALUE}})}else if(button.FUNCTION){var execFunction=button.FUNCTION.toString().replace("#MESSAGE_ID#",this.messageId).replace("#DIALOG_ID#",this.dialogId).replace("#USER_ID#",this.userId);eval(execFunction)}else if(button.APP_ID){im_lib_logger.Logger.warn("Messenger keyboard: open app is not implemented.")}else if(button.LINK){if(im_lib_utils.Utils.platform.isBitrixMobile()){app.openNewPage(button.LINK)}else{window.open(button.LINK,"_blank")}}else if(button.WAIT!=="Y"){if(button.BLOCK==="Y"){this.isBlocked=true}button.WAIT="Y";this.$emit("click",{action:"COMMAND",params:{dialogId:this.dialogId,messageId:this.messageId,botId:button.BOT_ID,command:button.COMMAND,params:button.COMMAND_PARAMS}});this.recoverStateButton=setTimeout(function(){_this.isBlocked=false;button.WAIT="N"},1e4)}return true},getStyles:function t(e){var i={};if(e.WIDTH){i["width"]=e.WIDTH+"px"}else if(e.DISPLAY==="BLOCK"){i["width"]="225px"}if(e.BG_COLOR){i["backgroundColor"]=e.BG_COLOR}if(e.TEXT_COLOR){i["color"]=e.TEXT_COLOR}return i},prepareButtons:function t(e){return e.filter(function(t){if(!t.CONTEXT){return true}if(im_lib_utils.Utils.platform.isBitrixMobile()&&t.CONTEXT==="DESKTOP"){return false}if(!im_lib_utils.Utils.platform.isBitrixMobile()&&t.CONTEXT==="MOBILE"){return false}if(!im_lib_utils.Utils.platform.isBitrixMobile()&&(t.ACTION==="DIALOG"||t.ACTION==="CALL")){return false}return true})}},computed:{ButtonType:function t(){return _ButtonType}},template:'\n\t\t<div :class="[\'bx-im-element-keyboard\', {\'bx-im-element-keyboard-mobile\': isMobile}]">\n\t\t\t<template v-for="(button, index) in localButtons">\n\t\t\t\t<div v-if="button.TYPE === ButtonType.newline" class="bx-im-element-keyboard-button-separator"></div>\n\t\t\t\t<span v-else-if="button.TYPE === ButtonType.button" :class="[\n\t\t\t\t\t\'bx-im-element-keyboard-button\', \n\t\t\t\t\t\'bx-im-element-keyboard-button-\'+button.DISPLAY.toLowerCase(), \n\t\t\t\t\t{\n\t\t\t\t\t\t\'bx-im-element-keyboard-button-disabled\': isBlocked || button.DISABLED === \'Y\',\n\t\t\t\t\t\t\'bx-im-element-keyboard-button-progress\': button.WAIT === \'Y\',\n\t\t\t\t\t}\n\t\t\t\t]" @click="click(button)">\n\t\t\t\t\t<span class="bx-im-element-keyboard-button-text" :style="getStyles(button)">{{button.TEXT}}</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t'})})(this.window=this.window||{},BX,BX.Messenger.Lib,BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:63:"/local/js/im/view/popup/dist/popup.bundle.min.js?16547598189787";s:6:"source";s:44:"/local/js/im/view/popup/dist/popup.bundle.js";s:3:"min";s:48:"/local/js/im/view/popup/dist/popup.bundle.min.js";s:3:"map";s:48:"/local/js/im/view/popup/dist/popup.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t,e,s){"use strict";var n={props:["value","popupInstance"],data:function t(){return{chat:{},hasError:false,requestFinished:false}},created:function t(){var e=this.getChat(this.value);if(e){this.chat=e;this.requestFinished=true}else{this.requestChatData(this.value)}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},methods:{getChat:function t(e){return this.$store.getters["dialogues/get"](e)},requestChatData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imChatGet,{dialog_id:e}).then(function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imChatGet,t);n.chat=n.getChat(n.value);n.requestFinished=true}).catch(function(t){n.hasError=true;console.error(t);n.requestFinished=true})},onOpenChat:function t(e){this.popupInstance.destroy();BXIM.openMessenger(this.value)},onOpenHistory:function t(e){this.popupInstance.destroy();BXIM.openHistory(this.value)}},computed:{avatarStyles:function t(){var e={};if(this.emptyAvatar){e.backgroundColor=this.chat.color}return e},chatAvatar:function t(){if(this.emptyAvatar){return"/bitrix/js/im/images/blank.gif"}else{return this.chat.avatar}},emptyAvatar:function t(){return this.chat.avatar===""||this.chat.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0}},template:'\n\t\t<div class="bx-messenger-external-data" style="width: 272px; max-width: 272px; height: 100px;">\n\t\t\t<div v-if="requestFinished && !hasError">\n\t\t\t\t<div class="bx-messenger-external-avatar">\n\t\t\t\t\t<div class="bx-messenger-panel-avatar bx-messenger-panel-avatar-chat">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t:src="chatAvatar"\n\t\t\t\t\t\t\t:alt="chat.name"\n\t\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t\t\t:class="[emptyAvatar ? \'bx-messenger-panel-avatar-img-default\' : \'\', \'bx-messenger-panel-avatar-img\']"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span v-if="chat.extranet" class="bx-messenger-panel-title"><div class="bx-messenger-user-extranet">{{ chat.name }}</div></span>\n\t\t\t\t\t<span v-else class="bx-messenger-panel-title">{{ chat.name }}</span>\n\t\t\t\t\t<span class="bx-messenger-panel-desc">{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_GROUP_CHAT\') }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-messenger-external-data-buttons">\n\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenChat">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_CHAT\') }}\n\t\t\t\t</span>\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenHistory">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_HISTORY\') }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var a={props:["value","popupInstance"],data:function t(){return{user:{},hasError:false,requestFinished:false}},created:function t(){var e=this.getUser(this.value);if(e){this.user=e;this.requestFinished=true}else{this.requestUserData(this.value)}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},methods:{getUser:function t(e){return this.$store.getters["users/get"](e)},requestUserData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imUserGet,{ID:e}).then(function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imUserGet,t);n.user=n.getUser(n.value);n.requestFinished=true}).catch(function(t){n.hasError=true;console.error(t);n.requestFinished=true})},onOpenChat:function t(e){this.popupInstance.destroy();BXIM.openMessenger(this.value)},onOpenHistory:function t(e){this.popupInstance.destroy();BXIM.openHistory(this.value)}},computed:{avatarStyles:function t(){var e={};if(this.emptyAvatar){e.backgroundColor=this.chat.color}return e},userAvatar:function t(){if(this.emptyAvatar){return"/bitrix/js/im/images/blank.gif"}else{return this.user.avatar}},emptyAvatar:function t(){return this.user.avatar===""||this.user.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0},botStyles:function t(){return"bx-messenger-user-bot"},userStatusText:function t(){return BX.MessengerCommon.getUserStatus(this.user.id,false).statusText},userStatusClass:function t(){return"bx-messenger-panel-avatar-status-"+BX.MessengerCommon.getUserStatus(this.user.id,true)},userPosition:function t(){return BX.MessengerCommon.getUserPosition(this.user.id)}},template:'\n\t\t<div class="bx-messenger-external-data" style="width: 272px; max-width: 272px; height: 100px;">\n\t\t\t<div v-if="requestFinished && !hasError">\n\t\t\t\t<div class="bx-messenger-external-avatar">\n\t\t\t\t\t<div :class="[userStatusClass, \'bx-messenger-panel-avatar\']">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t:src="userAvatar"\n\t\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t\t\t:class="[emptyAvatar ? \'bx-messenger-panel-avatar-img-default\' : \'\', \'bx-messenger-panel-avatar-img\']"\n\t\t\t\t\t\t\t:alt="user.name"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span :title="userStatusText" class="bx-messenger-panel-avatar-status"></span>\n\t\t\t\t\t</div>\n\t\n\t\t\t\t\t<span v-if="user.extranet" class="bx-messenger-panel-title"><div class="bx-messenger-user-extranet">{{ user.name }}</div></span>\n\t\t\t\t\t<span v-else-if="user.bot" class="bx-messenger-panel-title"><div :class="botStyles">{{ user.name }}</div></span>\n\t\t\t\t\t<span v-else class="bx-messenger-panel-title">{{ user.name }}</span>\n\t\n\t\t\t\t\t<span class="bx-messenger-panel-desc">{{ userPosition }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-messenger-external-data-buttons">\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenChat">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_USER_OPEN_CHAT\') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenHistory">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_HISTORY\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var r={props:["value","popupInstance"],data:function t(){return{users:{},hasError:false,requestFinished:false}},created:function t(){var e=this.isNeedUserRequest(this.value);if(e){this.requestUserData(this.value)}else{this.users=this.getUsersForPopup();this.requestFinished=true}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},computed:{popupHeight:function t(){var e=this.value.length*30;if(e>150){e=150}return e+"px"}},methods:{getUser:function t(e){return this.$store.getters["users/get"](e)},getUsersForPopup:function t(){var e=this;return this.value.map(function(t){return e.getUser(t)})},getUserAvatar:function t(e){if(this.isEmptyAvatar(e)){return"/bitrix/js/im/images/blank.gif"}else{return e.avatar}},isEmptyAvatar:function t(e){return e.avatar===""||e.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0},getAvatarStyles:function t(e){var s={};if(this.isEmptyAvatar(e)){s.backgroundColor=e.color}return s},getUserStatusClass:function t(e){return"bx-notifier-popup-avatar-status-".concat(e.status)},isNeedUserRequest:function t(e){for(var s=0;s<e.length;s++){if(!this.getUser(e[s])){return true}}return false},requestUserData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imUserListGet,{ID:e}).then(function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imUserListGet,t);n.users=n.getUsersForPopup();n.requestFinished=true}).catch(function(t){n.hasError=true;console.error(t);n.requestFinished=true})},onUserClick:function t(e){this.popupInstance.destroy();BXIM.openMessenger(e)}},template:'\n\t\t<div\n\t\t\tclass="bx-im-vue-popup-container" \n\t\t\t:style="{height: popupHeight, width: \'180px\', display: \'flex\', alignItems: \'center\', justifyContent: \'center\'}"\n\t\t>\n\t\t\t<span v-if="requestFinished && !hasError" class="bx-notifier-item-help-popup">\n\t\t\t\t<a \n\t\t\t\t\tv-for="user in users"\n\t\t\t\t\tclass="bx-notifier-item-help-popup-img"\n\t\t\t\t\t@click.prevent="onUserClick(user.id)"\n\t\t\t\t>\n\t\t\t\t\t<span :class="[getUserStatusClass(user), \'bx-notifier-popup-avatar\']">\n\t\t\t\t\t\t<img \n\t\t\t\t\t\t\t:src="getUserAvatar(user)"\n\t\t\t\t\t\t\t:class="[\'bx-notifier-popup-avatar-img\', isEmptyAvatar(user) ? \'bx-notifier-popup-avatar-img-default\' : \'\']"\n\t\t\t\t\t\t\t:style="getAvatarStyles(user)"\n\t\t\t\t\t\t\t:alt="user.name"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span \n\t\t\t\t\t\t:class="[\'bx-notifier-item-help-popup-name\', user.extranet ? \'bx-notifier-popup-avatar-extranet\' : \'\']"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var i={props:["type","value","popupInstance"],components:{Chat:n,User:a,Users:r},template:'\n\t\t<component :is="type" :value="value" :popupInstance="popupInstance"/>\n\t'};t.Popup=i})(this.BX.Messenger.View=this.BX.Messenger.View||{},BX,BX.Messenger.Const);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/local/js/im/component/notifications/dist/notifications.bundle.min.js?165475981747876";s:6:"source";s:65:"/local/js/im/component/notifications/dist/notifications.bundle.js";s:3:"min";s:69:"/local/js/im/component/notifications/dist/notifications.bundle.min.js";s:3:"map";s:69:"/local/js/im/component/notifications/dist/notifications.bundle.map.js";}"*/
this.BX=this.BX||{};(function(t,e,i,n,s,o,a,r,c,l,u,d,f,h,p,m){"use strict";var g={props:["listItem"],data:function t(){return{quickAnswerText:"",quickAnswerResultMessage:"",showQuickAnswer:false,isSendingQuickAnswer:false,successSentQuickAnswer:false}},methods:{toggleQuickAnswer:function t(){var e=this;if(this.successSentQuickAnswer){this.showQuickAnswer=true;this.successSentQuickAnswer=false;this.quickAnswerResultMessage=""}else{this.showQuickAnswer=!this.showQuickAnswer}if(this.showQuickAnswer){this.$nextTick(function(){e.$refs["input"].focus()})}},sendQuickAnswer:function t(e){var i=this;if(this.quickAnswerText.trim()===""){return}this.isSendingQuickAnswer=true;var n=e.item.id;this.$Bitrix.RestClient.get().callMethod("im.notify.answer",{notify_id:n,answer_text:this.quickAnswerText}).then(function(t){i.quickAnswerResultMessage=t.data().result_message[0];i.successSentQuickAnswer=true;i.quickAnswerText="";i.isSendingQuickAnswer=false}).catch(function(t){console.error(t);i.quickAnswerResultMessage=result.data().result_message[0];i.isSendingQuickAnswer=false})}},template:'\n\t\t<div class="bx-notifier-item-text-vue">\n\t\t\t<div class="bx-notifier-answer-link-vue">\n\t\t\t\t<span class="bx-notifier-answer-reply bx-messenger-ajax" @click="toggleQuickAnswer()" @dblclick.stop>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_QUICK_ANSWER_BUTTON\') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<transition name="quick-answer-slide">\n\t\t\t\t<div v-if="showQuickAnswer && !successSentQuickAnswer" class="bx-notifier-answer-box-vue">\n\t\t\t\t\t<span v-if="isSendingQuickAnswer" class="bx-notifier-answer-progress-vue bx-messenger-content-load-img"></span>\n\t\t\t\t\t<span class="bx-notifier-answer-input">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tref="input"\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\tclass="bx-messenger-input"\n\t\t\t\t\t\t\tv-model="quickAnswerText"\n\t\t\t\t\t\t\t:disabled="isSendingQuickAnswer"\n\t\t\t\t\t\t\t@keyup.enter="sendQuickAnswer({item: listItem, event: $event})"\n\t\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="bx-notifier-answer-button" @click="sendQuickAnswer({item: listItem, event: $event})"></div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t\t<div v-if="successSentQuickAnswer" class="bx-notifier-answer-text-vue">\n\t\t\t\t{{ quickAnswerResultMessage }}\n\t\t\t</div>\n\t\t</div>\n\t'};var v={props:["listItem"],computed:{moreUsers:function t(){var e=this.$Bitrix.Loc.getMessage("IM_NOTIFICATIONS_MORE_USERS").split("#COUNT#");return{start:e[0],end:this.listItem.params.USERS.length+e[1]}},isMoreUsers:function t(){return this.listItem.params.hasOwnProperty("USERS")&&this.listItem.params.USERS.length>0},isAbleToDelete:function t(){return this.listItem.sectionCode===h.NotificationTypesCodes.simple}},methods:{onDeleteClick:function t(e){if(e.item.sectionCode===h.NotificationTypesCodes.simple){this.$emit("deleteClick",e)}},onMoreUsersClick:function t(e){if(e.users){this.$emit("moreUsersClick",{event:e.event,content:{type:"USERS",value:e.users}})}},onUserTitleClick:function t(e){if(window.top["BXIM"]&&e.userId>0){window.top["BXIM"].openMessenger(e.userId)}}},template:'\n\t\t<div class="bx-im-notifications-item-content-header">\n\t\t\t<div v-if="listItem.title" class="bx-im-notifications-item-header-title">\n\t\t\t\t<span\n\t\t\t\t\tv-if="!listItem.systemType"\n\t\t\t\t\t@click.prevent="onUserTitleClick({userId: listItem.authorId, event: $event})"\n\t\t\t\t\tclass="bx-im-notifications-item-header-title-text"\n\t\t\t\t>\n\t\t\t\t\t{{ listItem.title.value }}\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if="listItem.systemType" class="bx-im-notifications-item-bottom-subtitle-text" v-html="listItem.subtitle.value"></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if="isMoreUsers && !listItem.systemType"\n\t\t\t\t\tclass="bx-im-notifications-item-header-more-users"\n\t\t\t\t>\n\t\t\t\t\t{{ moreUsers.start }}\n\t\t\t\t\t<span class="bx-messenger-ajax" @click="onMoreUsersClick({users: listItem.params.USERS, event: $event})">\n\t\t\t\t\t\t{{ moreUsers.end }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="bx-im-notifications-item-content-header-right">\n\t\t\t\t<div class="bx-im-notifications-item-header-date">\n\t\t\t\t\t{{ listItem.date.value }}\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if="isAbleToDelete"\n\t\t\t\t\tclass="bx-im-notifications-item-header-delete"\n\t\t\t\t\t@click="onDeleteClick({item: listItem, event: $event})">\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t'};var I={template:'\n\t\t<div style="display: flex; width: 100%;">\n\t\t\t<div class="bx-im-notifications-item-image-wrap">\n\t\t\t\t<div class="bx-im-notifications-item-image bx-im-notifications-item-placeholder-image"></div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-notifications-item-content bx-im-notifications-skeleton">\n\t\t\t\t<div class="bx-im-notifications-item-content-header">\n\t\t\t\t\t<div class="bx-im-notifications-item-placeholder-title"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-notifications-item-content-middle">\n\t\t\t\t\t<div class="bx-im-notifications-item-bottom-subtitle">\n\t\t\t\t\t\t<div class="bx-im-notifications-item-placeholder-subtitle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-notifications-item-content-bottom">\n\t\t\t\t\t<div class="bx-im-notifications-item-bottom-subtitle">\n\t\t\t\t\t\t<div class="bx-im-notifications-item-placeholder-subtitle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var T={components:{NotificationQuickAnswer:g,NotificationItemHeader:v,NotificationPlaceholder:I},props:["rawListItem","searchMode"],data:function t(){return{menuId:"popup-window-content-bx-messenger-popup-notify"}},computed:{NotificationTypesCodes:function t(){return h.NotificationTypesCodes},listItem:function t(){return{id:this.rawListItem.id,type:this.rawListItem.type,sectionCode:this.rawListItem.sectionCode,authorId:this.rawListItem.authorId,systemType:this.rawListItem.type===4||this.rawListItem.authorId===0&&this.avatar==="",title:{value:this.userTitle},subtitle:{value:this.rawListItem.textConverted},avatar:{url:this.avatar,color:this.defaultAvatarColor},params:this.rawListItem.params||{},notifyButtons:this.rawListItem.notifyButtons||undefined,unread:this.rawListItem.unread,settingName:this.rawListItem.settingName,date:{value:f.Utils.date.format(this.rawListItem.date,null,this.$Bitrix.Loc.getMessages())}}},isRealItem:function t(){return this.rawListItem.sectionCode!==h.NotificationTypesCodes.placeholder},isNeedQuickAnswer:function t(){return this.listItem.params.CAN_ANSWER&&this.listItem.params.CAN_ANSWER==="Y"},userTitle:function t(){if(this.isRealItem&&this.rawListItem.authorId>0){return this.userData.name}else if(this.isRealItem&&this.rawListItem.authorId===0){return""}else{return""}},avatar:function t(){var t="";if(this.isRealItem&&this.rawListItem.authorId>0){t=this.userData.avatar}else if(this.isRealItem&&this.rawListItem.authorId===0){return""}return t},defaultAvatarColor:function t(){if(this.rawListItem.authorId<=0){return""}return this.userData.color},userData:function t(){return this.$store.getters["users/get"](this.rawListItem.authorId,true)},avatarStyles:function t(){return{backgroundImage:'url("'+this.listItem.avatar.url+'")'}}},methods:{onDoubleClick:function t(e){if(!this.searchMode&&e.item.sectionCode===h.NotificationTypesCodes.simple){this.$emit("dblclick",e)}},onButtonsClick:function t(e){if(e.action==="COMMAND"){this.$emit("buttonsClick",e)}},onDeleteClick:function t(e){this.$emit("deleteClick",e)},onMoreUsersClick:function t(e){this.$emit("contentClick",e)},onContentClick:function t(e){if(o.Vue.testNode(e.target,{className:"bx-im-mention"})){this.$emit("contentClick",{event:e,content:{type:e.target.dataset.type,value:e.target.dataset.value}})}},onRightClick:function t(e){var i=this;if(f.Utils.platform.isBitrixDesktop()&&e.target.tagName==="A"&&(!e.target.href.startsWith("/desktop_app/")||e.target.href.startsWith("/desktop_app/show.file.php"))){var n=e.target.href;if(!n){return}if(this.menuPopup){this.menuPopup.destroy();this.menuPopup=null}var s=d.PopupManager.getPopupById(this.menuId);if(s){s.destroy()}var o=a.Dom.create("span",{attrs:{className:"bx-messenger-popup-menu-item-text bx-messenger-popup-menu-item"},events:{click:function t(e){BX.desktop.clipboardCopy(n);i.menuPopup.destroy();i.menuPopup=null}},text:this.$Bitrix.Loc.getMessage("IM_NOTIFICATIONS_CONTEXT_COPY_LINK")});this.menuPopup=d.PopupManager.create({id:this.menuId,targetContainer:document.body,className:BX.MessengerTheme.isDark()?"bx-im-notifications-popup-window-dark":"",darkMode:BX.MessengerTheme.isDark(),bindElement:e,offsetLeft:13,autoHide:true,closeByEsc:true,events:{onPopupClose:function t(){return i.menuPopup.destroy()},onPopupDestroy:function t(){return i.menuPopup=null}},content:o});if(!BX.MessengerTheme.isDark()){this.menuPopup.setAngle({})}this.menuPopup.show()}}},template:'\n\t\t<div \n\t\t\tclass="bx-im-notifications-item"\n\t\t\t:class="[listItem.unread && !searchMode ? \'bx-im-notifications-item-unread\' : \'\']"\n\t\t\t@dblclick="onDoubleClick({item: listItem, event: $event})"\n\t\t\t@contextmenu="onRightClick"\n\t\t>\n\t\t\t<template v-if="listItem.sectionCode !== NotificationTypesCodes.placeholder">\n\t\t\t\t<div v-if="listItem.avatar" class="bx-im-notifications-item-image-wrap">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if="listItem.avatar.url" \n\t\t\t\t\t\tclass="bx-im-notifications-item-image"\n\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div v-else-if="listItem.systemType" class="bx-im-notifications-item-image bx-im-notifications-image-system"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-else-if="!listItem.avatar.url" \n\t\t\t\t\t\tclass="bx-im-notifications-item-image bx-im-notifications-item-image-default"\n\t\t\t\t\t\t:style="{backgroundColor: listItem.avatar.color}"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-notifications-item-content" @click="onContentClick">\n\t\t\t\t\t<NotificationItemHeader \n\t\t\t\t\t\t:listItem="listItem"\n\t\t\t\t\t\t@deleteClick="onDeleteClick"\n\t\t\t\t\t\t@moreUsersClick="onMoreUsersClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if="listItem.subtitle.value.length > 0" class="bx-im-notifications-item-content-bottom">\n\t\t\t\t\t\t<div class="bx-im-notifications-item-bottom-subtitle">\n\t\t\t\t\t\t\t<span v-if="!listItem.systemType" class="bx-im-notifications-item-bottom-subtitle-text" v-html="listItem.subtitle.value"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NotificationQuickAnswer v-if="isNeedQuickAnswer" :listItem="listItem"/>\n\t\t\t\t\t<div v-if="listItem.params[\'ATTACH\']" class="bx-im-notifications-item-content-additional">\n\t\t\t\t\t\t<div v-for="attach in listItem.params[\'ATTACH\']">\n\t\t\t\t\t\t\t<bx-im-view-element-attach :config="attach"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="listItem.notifyButtons">\n\t\t\t\t\t\t<bx-im-view-element-keyboard @click="onButtonsClick" :buttons="listItem.notifyButtons"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<NotificationPlaceholder v-else-if="listItem.sectionCode === NotificationTypesCodes.placeholder"/>\n\t\t</div>\n\t'};var b={data:function t(){return{placeholderCount:0}},methods:{isReadyToLoadNewPage:function t(e){var i=e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight;return i<200},getLastItemId:function t(e){return e[e.length-1].id},generatePlaceholders:function t(e){var i=[];for(var n=0;n<e;n++){i.push({id:"placeholder".concat(this.placeholderCount),type:h.NotificationTypesCodes.placeholder});this.placeholderCount++}return i},getRestClient:function t(){return this.$Bitrix.RestClient.get()},onContentClick:function t(e){var i=this;this.contentPopupType=e.content.type.toLowerCase();this.contentPopupValue=e.content.value;if(this.popupInstance!=null){this.popupInstance.destroy();this.popupInstance=null}if(this.contentPopupType==="user"||this.contentPopupType==="chat"){var n=!this.isDarkTheme;BXIM.messenger.openPopupExternalData(e.event.target,this.contentPopupType,n,{ID:this.contentPopupValue})}else if(this.contentPopupType==="openlines"){BX.MessengerCommon.linesGetSessionHistory(this.contentPopupValue)}else{var s=d.PopupManager.create({id:"bx-messenger-popup-external-data",targetContainer:document.body,className:this.isDarkTheme?"bx-im-notifications-popup-window-dark":"",bindElement:e.event.target,lightShadow:true,offsetTop:0,offsetLeft:10,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function t(){return i.popupInstance.destroy()},onPopupDestroy:function t(){return i.popupInstance=null}}});if(!this.isDarkTheme){s.setAngle({})}this.popupIdSelector="#".concat(s.getContentContainer().id);this.$nextTick(function(){return i.popupInstance=s})}}},computed:{isDarkTheme:function t(){if(this.darkTheme===undefined){return BX.MessengerTheme.isDark()}return this.darkTheme}}};var y={components:{NotificationItem:T,MountingPortal:l.MountingPortal,Popup:u.Popup},mixins:[b],props:["searchQuery","searchType","searchDate"],data:function t(){return{pageLimit:50,lastId:0,initialDataReceived:false,isLoadingNewPage:false,contentPopupType:"",contentPopupValue:"",popupInstance:null,popupIdSelector:"",searchResultsTotal:0,searchPageLoaded:0,searchPagesRequested:0}},computed:babelHelpers.objectSpread({remainingPages:function t(){return Math.ceil((this.searchResultsTotal-this.searchResults.length)/this.pageLimit)}},r.Vuex.mapState({notification:function t(e){return e.notifications.collection},searchResults:function t(e){return e.notifications.searchCollection}})),watch:{searchQuery:function t(e){if(e.length>=3||e===""){this.search()}},searchType:function t(){this.search()},searchDate:function t(e){if(BX.parseDate(e)instanceof Date||e===""){this.search()}}},created:function t(){this.searchServerDelayed=f.Utils.debounce(this.getSearchResultsFromServer,1500,this);this.search()},beforeDestroy:function t(){this.$store.dispatch("notifications/deleteSearchResults")},methods:{search:function t(){var e=this;this.resetSearchState();var i=this.notification.filter(function(t){var i=false;if(e.searchQuery.length>=3){i=t.textConverted.toLowerCase().includes(e.searchQuery.toLowerCase());if(!i){return i}}if(e.searchType!==""){i=t.settingName===e.searchType;if(!i){return i}}if(e.searchDate!==""){var n=BX.parseDate(e.searchDate);if(n instanceof Date){var s=new Date(t.date.getTime()).setHours(0,0,0,0);var o=n.setHours(0,0,0,0);i=s===o}}return i});if(i.length>0){this.$store.dispatch("notifications/setSearchResults",{notification:i,type:"local"})}var n=this.pageLimit-i.length>0;if(n>0){this.drawPlaceholders(this.pageLimit).then(function(){e.searchServerDelayed()})}else{this.searchServerDelayed()}},getSearchResultsFromServer:function t(){var e=this;var i=this.getSearchRequestParams();this.getRestClient().callMethod("im.notify.history.search",i).then(function(t){c.Logger.warn("im.notify.history.search: first page results",t.data());e.processHistoryData(t.data());e.initialDataReceived=true;e.isLoadingNewPage=false;e.searchPageLoaded++}).catch(function(t){c.Logger.warn("History request error",t)})},processHistoryData:function t(e){this.$store.dispatch("notifications/clearPlaceholders");if(e.notifications.length<=0){return false}this.lastId=this.getLastItemId(e.notifications);this.searchResultsTotal=e.total_results;this.$store.dispatch("notifications/setSearchResults",{notification:e.notifications});this.$store.dispatch("users/set",e.users);this.isLoadingNewPage=false},loadNextPage:function t(){var e=this;c.Logger.warn("Loading more search results!");var i=this.getSearchRequestParams();this.getRestClient().callMethod("im.notify.history.search",i).then(function(t){c.Logger.warn("im.notify.history.search: new page results",t.data());var i=t.data().users;var n=t.data().notifications;if(!n||n.length===0){e.$store.dispatch("notifications/clearPlaceholders");e.searchResultsTotal=e.searchResults.length;return false}e.lastId=e.getLastItemId(n);e.$store.dispatch("users/set",i);return e.$store.dispatch("notifications/updatePlaceholders",{searchCollection:true,items:n,firstItem:e.searchPageLoaded*e.pageLimit})}).then(function(){e.searchPageLoaded++;return e.onAfterLoadNextPageRequest()}).catch(function(t){e.$store.dispatch("notifications/clearPlaceholders");c.Logger.warn("History request error",t)})},onAfterLoadNextPageRequest:function t(){c.Logger.warn("onAfterLoadNextPageRequest");if(this.searchPagesRequested>0){c.Logger.warn("We have delayed requests -",this.searchPagesRequested);this.searchPagesRequested--;return this.loadNextPage()}else{c.Logger.warn("No more delayed requests, clearing placeholders");this.$store.dispatch("notifications/clearPlaceholders");this.isLoadingNewPage=false;return true}},getSearchRequestParams:function t(){var e={SEARCH_TEXT:this.searchQuery,SEARCH_TYPE:this.searchType,LIMIT:this.pageLimit,CONVERT_TEXT:"Y"};if(BX.parseDate(this.searchDate)instanceof Date){e["SEARCH_DATE"]=BX.parseDate(this.searchDate).toISOString()}if(this.lastId>0){e["LAST_ID"]=this.lastId}return e},resetSearchState:function t(){this.$store.dispatch("notifications/deleteSearchResults");this.initialDataReceived=false;this.lastId=0;this.isLoadingNewPage=true;this.placeholderCount=0;this.searchPageLoaded=0},drawPlaceholders:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=this.generatePlaceholders(e);return this.$store.dispatch("notifications/setSearchResults",{notification:i})},onScroll:function t(e){var i=this;if(!this.isReadyToLoadNewPage(e)||!this.initialDataReceived||this.remainingPages<=0){return}if(this.isLoadingNewPage){this.drawPlaceholders(this.pageLimit).then(function(){i.searchPagesRequested++;c.Logger.warn("Already loading! Draw placeholders and add request, total - ",i.pagesRequested)})}else{c.Logger.warn("Starting new request");this.isLoadingNewPage=true;this.drawPlaceholders(this.pageLimit).then(function(){i.loadNextPage()})}},onButtonsClick:function t(e){var i=this;var n=this.getConfirmRequestParams(e);var s=+n.NOTIFY_ID;var o=this.$store.getters["notifications/getById"](s);this.getRestClient().callMethod("im.notify.confirm",n).then(function(){i.$store.dispatch("notifications/delete",{id:s});if(o.unread){i.$store.dispatch("notifications/setCounter",{unreadTotal:i.unreadCounter-1})}}).catch(function(){i.$store.dispatch("notifications/update",{id:s,fields:{display:true}})});this.$store.dispatch("notifications/update",{id:s,fields:{display:false}})},onDeleteClick:function t(e){var i=this;var n=+e.item.id;var s=this.$store.getters["notifications/getSearchItemById"](n);this.getRestClient().callMethod("im.notify.delete",{id:n}).then(function(){i.$store.dispatch("notifications/delete",{id:n,searchMode:true});if(!i.isLoadingNewPage&&i.remainingPages>0&&i.searchResults.length<15){i.isLoadingNewPage=true;i.drawPlaceholders(i.pageLimit).then(function(){i.loadNextPage()})}if(s.unread){i.$store.dispatch("notifications/setCounter",{unreadTotal:i.unreadCounter-1})}}).catch(function(t){console.error(t);i.$store.dispatch("notifications/update",{id:n,fields:{display:true},searchMode:true})});this.$store.dispatch("notifications/update",{id:n,fields:{display:false},searchMode:true})}},template:'\n\t\t<div class="bx-messenger-notifications-search-results-wrap" @scroll.passive="onScroll">\n\t\t\t<notification-item\n\t\t\t\tv-for="listItem in searchResults"\n\t\t\t\tv-if="listItem.display"\n\t\t\t\t:key="listItem.id"\n\t\t\t\t:data-id="listItem.id"\n\t\t\t\t:rawListItem="listItem"\n\t\t\t\tsearchMode="true"\n\t\t\t\t@buttonsClick="onButtonsClick"\n\t\t\t\t@contentClick="onContentClick"\n\t\t\t\t@deleteClick="onDeleteClick"\n\t\t\t/>\n\t\t\t<mounting-portal :mount-to="popupIdSelector" append v-if="popupInstance">\n\t\t\t\t<popup :type="contentPopupType" :value="contentPopupValue" :popupInstance="popupInstance"/>\n\t\t\t</mounting-portal>\n\t\t\t<div \n\t\t\t\tv-if="searchResults.length <= 0" \n\t\t\t\tstyle="padding-top: 210px; margin-bottom: 20px;"\n\t\t\t\tclass="bx-messenger-box-empty bx-notifier-content-empty" \n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_RESULTS_NOT_FOUND\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};function C(t,e){var i;if(typeof Symbol==="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(i=w(t))||e&&t&&typeof t.length==="number"){if(i)t=i;var n=0;var s=function t(){};return{s:s,n:function e(){if(n>=t.length)return{done:true};return{done:false,value:t[n++]}},e:function t(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,r;return{s:function e(){i=t[Symbol.iterator]()},n:function t(){var e=i.next();o=e.done;return e},e:function t(e){a=true;r=e},f:function t(){try{if(!o&&i.return!=null)i.return()}finally{if(a)throw r}}}}function w(t,e){if(!t)return;if(typeof t==="string")return N(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor)i=t.constructor.name;if(i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return N(t,e)}function N(t,e){if(e==null||e>t.length)e=t.length;for(var i=0,n=new Array(e);i<e;i++){n[i]=t[i]}return n}var x=Object.freeze({read:"read",none:"none"});o.BitrixVue.component("bx-im-component-notifications",{components:{NotificationItem:T,MountingPortal:l.MountingPortal,Popup:u.Popup,NotificationSearchResult:y},directives:{"bx-im-directive-notifications-observer":{inserted:function t(e,i,n){if(i.value===x.none){return false}if(!n.context.observers[i.value]){n.context.observers[i.value]=n.context.getObserver({type:i.value})}n.context.observers[i.value].observe(e);return true},unbind:function t(e,i,n){if(i.value===x.none){return true}if(n.context.observers[i.value]){n.context.observers[i.value].unobserve(e)}return true}}},mixins:[b],props:{darkTheme:{default:undefined}},data:function t(){return{initialDataReceived:false,perPage:50,isLoadingInitialData:false,isLoadingNewPage:false,pagesRequested:0,pagesLoaded:0,lastId:0,lastType:h.NotificationTypesCodes.confirm,ObserverType:x,notificationsOnScreen:[],notificationsToRead:[],notificationsToDelete:[],changeReadStatusBlockTimeout:{},firstUnreadNotificationOnInit:null,contentPopupType:"",contentPopupValue:"",popupInstance:null,popupIdSelector:"",contextPopupInstance:null,searchQuery:"",searchType:"",searchDate:"",showSearch:false,callViewState:false}},computed:babelHelpers.objectSpread({NotificationTypesCodes:function t(){return h.NotificationTypesCodes},remainingPages:function t(){return Math.ceil((this.total-this.notification.length)/this.perPage)},localize:function t(){return o.BitrixVue.getFilteredPhrases("IM_NOTIFICATIONS_",this)},visibleNotifications:function t(){return this.notification.filter(function(t){return t.display})},highestNotificationId:function t(){return this.notification.reduce(function(t,e){return e.id>t?e.id:t},0)},isNeedToReadAll:function t(){var e=this.notification.filter(function(t){return t.sectionCode===h.NotificationTypesCodes.confirm}).length;return e<this.unreadCounter},panelStyles:function t(){if(this.callViewState===BX.Call.Controller.ViewState.Folded&&!this.showSearch){return{paddingBottom:"60px"}}return{}},filterBoxStyles:function t(){if(this.callViewState===BX.Call.Controller.ViewState.Folded&&this.showSearch){return{paddingTop:"70px"}}return{}},firstUnreadNotification:function t(){var e=null;var i=this.notification.length-1;for(var n=0;n<=i;n++){if(this.notification[n].unread&&this.notification[n].sectionCode!==h.NotificationTypesCodes.placeholder){e=this.notification[n];break}}return e},firstUnreadNotificationBelowVisible:function t(){var e=Math.max.apply(Math,babelHelpers.toConsumableArray(this.notificationsOnScreen));var i=null;var n=this.notification.length-1;for(var s=0;s<=n;s++){if(this.notification[s].unread&&e>this.notification[s].id&&this.notification[s].sectionCode===h.NotificationTypesCodes.simple){i=this.notification[s].id;break}}return i},isUnreadNotificationVisible:function t(){var e=this;var i=Array.from(this.notificationsOnScreen).filter(function(t){var i=e.$store.getters["notifications/getById"](t);return i?i.unread:false});return i.length>0},showScrollButton:function t(){if(!this.initialDataReceived){return false}if(this.unreadCounter<=0||!BXIM.settings.notifyAutoRead){return false}if(this.notificationsOnScreen.length===0){return false}if(this.isUnreadNotificationVisible){return false}return true},hasUnreadBelowVisible:function t(){var e=0;for(var i=0;i<=this.notification.length-1;i++){if(this.notification[i].unread&&this.notification[i].sectionCode!==h.NotificationTypesCodes.placeholder){++e}if(this.notificationsOnScreen.includes(this.notification[i].id)&&this.unreadCounter===e){return false}}return true},arrowButtonClass:function t(){var e=!this.hasUnreadBelowVisible;return{"bx-im-notifications-scroll-button-arrow-down":!e,"bx-im-notifications-scroll-button-arrow-up":e,"bx-im-notifications-scroll-button-arrow":true}},filterTypes:function t(){var e=Object.assign({},this.schema);var i=["timeman","mail","disk","bizproc","voximplant","sender","blog","vote","socialnetwork","imopenlines","photogallery","intranet","forum"];i.forEach(function(t){if(e.hasOwnProperty(t)){delete e[t].LIST}});if(e.hasOwnProperty("calendar")){e["calendar"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_CALENDAR"]}if(e.hasOwnProperty("sender")){e["sender"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SENDER"]}if(e.hasOwnProperty("blog")){e["blog"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_BLOG"]}if(e.hasOwnProperty("socialnetwork")){e["socialnetwork"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_SOCIALNETWORK"]}if(e.hasOwnProperty("intranet")){e["intranet"].NAME=this.localize["IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_INTRANET"]}var n=["tasks","calendar","crm","timeman","mail","disk","bizproc","voximplant","sender","blog","vote","socialnetwork","imopenlines","photogallery","intranet","forum"];var s=[];n.forEach(function(t){if(e.hasOwnProperty(t)){s.push(e[t])}});return s}},r.Vuex.mapState({notification:function t(e){return e.notifications.collection},total:function t(e){return e.notifications.total},unreadCounter:function t(e){return e.notifications.unreadCounter},schema:function t(e){return e.notifications.schema}})),created:function t(){var e=this;this.drawPlaceholders().then(function(){e.getInitialData()});m.EventEmitter.subscribe(h.EventType.notification.updateState,this.onUpdateState);window.addEventListener("focus",this.onWindowFocus);window.addEventListener("blur",this.onWindowBlur);if(BXIM&&BX.Call){this.callViewState=BXIM.callController.callViewState;BXIM.callController.subscribe(BX.Call.Controller.Events.onViewStateChanged,this.onCallViewStateChange)}this.timer=new p.Timer;this.readNotificationsQueue=new Set;this.readNotificationsNodes={};this.observers={};this.readVisibleNotificationsDelayed=f.Utils.debounce(this.readVisibleNotifications,50,this)},mounted:function t(){this.windowFocused=document.hasFocus()},beforeDestroy:function t(){this.observers={};window.removeEventListener("focus",this.onWindowFocus);window.removeEventListener("blur",this.onWindowBlur);m.EventEmitter.unsubscribe(h.EventType.notification.updateState,this.onUpdateState);if(BXIM&&BX.Call){BXIM.callController.unsubscribe(BX.Call.Controller.Events.onViewStateChanged,this.onCallViewStateChange)}},methods:{getFirstUnreadNotificationOnInit:function t(){if(this.unreadCounter<=0){return null}var e=null;var i=this.notification.length-1;for(var n=0;n<=i;n++){if(this.notification[n].unread){e=this.notification[n].id;break}}return e},onCallViewStateChange:function t(e){var i=e.data;this.callViewState=i.callViewState},onUpdateState:function t(e){var i=e.data.lastId;if(!this.isLoadingInitialData&&this.highestNotificationId>0&&i!==this.highestNotificationId){this.getInitialData()}},readVisibleNotifications:function t(){var e=this;if(!this.windowFocused||!BXIM.settings.notifyAutoRead){c.Logger.warn("reading is disabled!");return false}this.readNotificationsQueue.forEach(function(t){if(e.readNotificationsNodes[t]){delete e.readNotificationsNodes[t]}e.readNotifications(parseInt(t,10))});this.readNotificationsQueue.clear()},getInitialData:function t(){var e,i=this;this.isLoadingInitialData=true;var n=(e={},babelHelpers.defineProperty(e,h.RestMethodHandler.imNotifyGet,[h.RestMethod.imNotifyGet,{LIMIT:this.perPage,CONVERT_TEXT:"Y"}]),babelHelpers.defineProperty(e,h.RestMethodHandler.imNotifySchemaGet,[h.RestMethod.imNotifySchemaGet,{}]),e);this.getRestClient().callBatch(n,function(t){c.Logger.warn("im.notify.get: initial result",t[h.RestMethodHandler.imNotifyGet].data());i.processInitialData(t[h.RestMethodHandler.imNotifyGet].data());i.processSchemaData(t[h.RestMethodHandler.imNotifySchemaGet].data());i.pagesLoaded++;i.isLoadingInitialData=false;i.firstUnreadNotificationOnInit=i.getFirstUnreadNotificationOnInit()},false,false)},processInitialData:function t(e){if(!e.notifications||e.notifications.length===0){this.$store.dispatch("notifications/clearPlaceholders");this.$store.dispatch("notifications/setTotal",{total:this.notification.length});return false}this.lastId=this.getLastItemId(e.notifications);this.lastType=this.getLastItemType(e.notifications);this.$store.dispatch("notifications/clearPlaceholders");this.$store.dispatch("notifications/setCounter",{unreadTotal:e.total_unread_count});this.$store.dispatch("notifications/set",{notification:e.notifications,total:e.total_count});this.$store.dispatch("users/set",e.users);this.updateRecentList(e.total_unread_count,true);this.initialDataReceived=true},processSchemaData:function t(e){this.$store.dispatch("notifications/setSchema",{data:e})},drawPlaceholders:function t(){var e=this.generatePlaceholders(this.perPage);return this.$store.dispatch("notifications/set",{notification:e})},loadNextPage:function t(){var e=this;c.Logger.warn("Loading more notifications!");var i={LIMIT:this.perPage,LAST_ID:this.lastId,LAST_TYPE:this.lastType,CONVERT_TEXT:"Y"};this.getRestClient().callMethod("im.notify.get",i).then(function(t){c.Logger.warn("im.notify.get: new page results",t.data());var i=t.data().users;var n=t.data().notifications;if(!n||n.length===0){e.$store.dispatch("notifications/clearPlaceholders");e.$store.dispatch("notifications/setTotal",{total:e.notification.length});return false}e.lastId=e.getLastItemId(n);e.lastType=e.getLastItemType(n);e.$store.dispatch("users/set",i);return e.$store.dispatch("notifications/updatePlaceholders",{items:n,firstItem:e.pagesLoaded*e.perPage})}).then(function(){e.pagesLoaded++;c.Logger.warn("Page loaded. Total loaded - ",e.pagesLoaded);return e.onAfterLoadNextPageRequest()}).catch(function(t){c.Logger.warn("Request history error",t)})},onAfterLoadNextPageRequest:function t(){c.Logger.warn("onAfterLoadNextPageRequest");if(this.pagesRequested>0){c.Logger.warn("We have delayed requests -",this.pagesRequested);this.pagesRequested--;return this.loadNextPage()}else{c.Logger.warn("No more delayed requests, clearing placeholders");this.$store.dispatch("notifications/clearPlaceholders");this.isLoadingNewPage=false;return true}},changeReadStatus:function t(e){var i=this;this.$store.dispatch("notifications/read",{ids:[e.id],action:e.unread});var n=this.unreadCounter;var s=e.unread?this.unreadCounter-1:this.unreadCounter+1;this.updateRecentList(s);this.$store.dispatch("notifications/setCounter",{unreadTotal:s});clearTimeout(this.changeReadStatusBlockTimeout[e.id]);this.changeReadStatusBlockTimeout[e.id]=setTimeout(function(){i.getRestClient().callMethod("im.notify.read",{id:e.id,action:e.unread?"Y":"N",only_current:"Y"}).then(function(){c.Logger.warn("Notification ".concat(e.id," unread status set to ").concat(!e.unread))}).catch(function(t){console.error(t);i.$store.dispatch("notifications/read",{ids:[e.id],action:!e.unread});i.updateRecentList(n);i.$store.dispatch("notifications/setCounter",{unreadTotal:n})})},1500)},delete:function t(e){var i=this;var n=+e.id;this.notificationsToDelete.push(n);var s=this.$store.getters["notifications/getById"](n);this.$store.dispatch("notifications/update",{id:n,fields:{display:false}});var o=this.unreadCounter;var a=s.unread?this.unreadCounter-1:this.unreadCounter;this.updateRecentList(a,true);this.$store.dispatch("notifications/setCounter",{unreadTotal:a});this.timer.stop("deleteNotificationServer","notifications",true);this.timer.start("deleteNotificationServer","notifications",.5,function(){var t=i.notificationsToDelete;i.notificationsToDelete=[];i.getRestClient().callMethod("im.notify.delete",{id:t}).then(function(){t.forEach(function(t){i.$store.dispatch("notifications/delete",{id:t})})}).catch(function(e){console.error(e);t.forEach(function(t){i.$store.dispatch("notifications/update",{id:t,fields:{display:true}})});i.updateRecentList(o,true);i.$store.dispatch("notifications/setCounter",{unreadTotal:o})})})},getObserver:function t(e){var i=this;if(typeof window.IntersectionObserver==="undefined"||e.type===x.none){return{observe:function t(){},unobserve:function t(){}}}var n=function t(e){e.forEach(function(t){var e=false;var n=parseInt(t.target.dataset.id,10);if(t.isIntersecting){if(t.intersectionRatio>=.99){e=true;i.notificationsOnScreen.push(n)}else if(t.intersectionRatio>0&&t.intersectionRect.height>t.rootBounds.height/2){e=true;i.notificationsOnScreen.push(n)}else{i.notificationsOnScreen=i.notificationsOnScreen.filter(function(t){return t!==n})}}else{i.notificationsOnScreen=i.notificationsOnScreen.filter(function(t){return t!==n})}if(e){i.readNotificationsQueue.add(n);i.readNotificationsNodes[n]=t.target}else{i.readNotificationsQueue.delete(n);delete i.readNotificationsNodes[n]}i.readVisibleNotificationsDelayed()})};var s={root:this.$refs["listNotifications"],threshold:new Array(101).fill(0).map(function(t,e){return e*.01})};return new IntersectionObserver(n,s)},onScroll:function t(e){var i=this;if(!this.isReadyToLoadNewPage(e)){return}if(this.remainingPages===0||!this.initialDataReceived){return}if(this.isLoadingNewPage){this.drawPlaceholders().then(function(){i.pagesRequested++;c.Logger.warn("Already loading! Draw placeholders and add request, total - ",i.pagesRequested)})}else{c.Logger.warn("Starting new request");this.isLoadingNewPage=true;this.drawPlaceholders().then(function(){i.loadNextPage()})}},onWindowFocus:function t(){this.windowFocused=true;this.readVisibleNotifications()},onWindowBlur:function t(){this.windowFocused=false},onDoubleClick:function t(e){this.changeReadStatus(e.item)},onButtonsClick:function t(e){var i=this;var n=this.getConfirmRequestParams(e);var s=+n.NOTIFY_ID;this.$store.dispatch("notifications/update",{id:s,fields:{display:false}});var o=this.unreadCounter;var a=this.unreadCounter-1;this.updateRecentList(a,true);this.$store.dispatch("notifications/setCounter",{unreadTotal:a});this.getRestClient().callMethod("im.notify.confirm",n).then(function(){i.$store.dispatch("notifications/delete",{id:s})}).catch(function(){i.$store.dispatch("notifications/update",{id:s,fields:{display:true}});i.updateRecentList(o,true);i.$store.dispatch("notifications/setCounter",{unreadTotal:o})})},onDeleteClick:function t(e){var i=this;this.delete(e.item);if(!this.isLoadingNewPage&&this.remainingPages>0&&this.notification.length===this.perPage-1){this.isLoadingNewPage=true;this.drawPlaceholders().then(function(){i.loadNextPage()})}},onRightClick:function t(e){var i=this;if(this.contextPopupInstance!==null){this.closeContextMenuPopup()}var n=this.getContextMenu(e.item);this.contextPopupInstance=d.MenuManager.create({id:"bx-messenger-context-popup-external-data",bindElement:e.event,items:n,events:{onPopupClose:function t(){return i.contextPopupInstance.destroy()},onPopupDestroy:function t(){return i.contextPopupInstance=null}}});this.contextPopupInstance.show()},onDateFilterClick:function t(e){var i=this;if(typeof BX!=="undefined"&&BX.calendar&&BX.calendar.get().popup){BX.calendar.get().popup.close()}BX.calendar({node:e.target,field:e.target,bTime:false,callback_after:function t(){i.searchDate=e.target.value}});return false},getContextMenu:function t(e){var i=this;var n=e.unread?this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_SET_READ"]:this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_SET_UNREAD"];var s=a.Type.isUndefined(BXIM.settingsNotifyBlocked[e.settingName])?this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_DONT_NOTIFY"]:this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_NOTIFY"];return[{text:n,onclick:function t(n,s){i.changeReadStatus(e);i.closeContextMenuPopup()}},{text:this.localize["IM_NOTIFICATIONS_CONTEXT_POPUP_DELETE_NOTIFICATION"],onclick:function t(n,s){i.delete(e);i.closeContextMenuPopup()}},{text:s,onclick:function t(n,s){console.log(e);i.closeContextMenuPopup()}}]},closeContextMenuPopup:function t(){this.contextPopupInstance.destroy();this.contextPopupInstance=null},getConfirmRequestParams:function t(e){if(e.params){var i=e.params.params.split("|");return{NOTIFY_ID:i[0],NOTIFY_VALUE:i[1]}}return null},readNotifications:function t(e){var i=this;var n=this.$store.getters["notifications/getById"](e);if(n.unread===false||n.sectionCode===h.NotificationTypesCodes.confirm){return false}this.notificationsToRead.push(e);this.$store.dispatch("notifications/read",{ids:[e],action:true});var s=this.unreadCounter;var o=this.unreadCounter-1;this.$store.dispatch("notifications/setCounter",{unreadTotal:o});this.updateRecentList(o);this.timer.stop("readNotificationServer","notifications",true);this.timer.start("readNotificationServer","notifications",.5,function(){var t=i.notificationsToRead;i.notificationsToRead=[];var e=false;if(i.firstUnreadNotificationOnInit!==null){e=Math.max.apply(Math,babelHelpers.toConsumableArray(t))<=i.firstUnreadNotificationOnInit}var n="im.notify.read.list";var o={ids:t,action:"Y"};if(e){var a=Math.min.apply(Math,babelHelpers.toConsumableArray(t));n="im.notify.read";o={id:a,action:"Y"}}i.getRestClient().callMethod(n,o).then(function(){c.Logger.warn("I have read the notifications",o)}).catch(function(){i.$store.dispatch("notifications/read",{ids:t,action:false});i.$store.dispatch("notifications/setCounter",{unreadTotal:s});i.updateRecentList(s)})})},getLastItemType:function t(e){return this.getItemType(e[e.length-1])},getItemType:function t(e){if(e.notify_type===h.NotificationTypesCodes.confirm){return h.NotificationTypesCodes.confirm}else{return h.NotificationTypesCodes.simple}},getLatest:function t(){var e={id:0};var i=C(this.notification),n;try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s.id>e.id){e=s}}}catch(t){i.e(t)}finally{i.f()}return e},showConfirmPopupOnReadAll:function t(){var e=this.readAll.bind(this);BXIM.openConfirm(this.localize["IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP"],[new BX.PopupWindowButton({text:this.localize["IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_YES"],className:"popup-window-button-accept",events:{click:function t(){e();this.popupWindow.close()}}}),new BX.PopupWindowButton({text:this.localize["IM_NOTIFICATIONS_READ_ALL_WARNING_POPUP_CANCEL"],className:"popup-window-button",events:{click:function t(){this.popupWindow.close()}}})])},readAll:function t(){var e=this;if(this.notification.lastId<=0){return}if(!this.isNeedToReadAll){return false}this.$store.dispatch("notifications/readAll");var i=this.notification.filter(function(t){return t.sectionCode===h.NotificationTypesCodes.confirm});this.$store.dispatch("notifications/setCounter",{unreadTotal:i.length});this.updateRecentList(i.length);this.getRestClient().callMethod("im.notify.read",{id:0,action:"Y"}).catch(function(t){e.getInitialData();console.error(t)})},updateRecentList:function t(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n={counter:e};if(i){var s=this.getLatest();n.message={id:s.id,text:s.text,date:s.date}}this.$store.dispatch("recent/update",{id:"notify",fields:n})},onScrollButtonClick:function t(e){if(this.isLoadingNewPage||!this.initialDataReceived){return false}var i=null;if(this.firstUnreadNotificationBelowVisible!==null){i=this.firstUnreadNotificationBelowVisible}else if(!this.hasUnreadBelowVisible){i=this.firstUnreadNotification.id}var n=null;if(i!==null){var s='.bx-im-notifications-item[data-id="'.concat(i,'"]');n=document.querySelector(s)}if(n){this.animatedScrollToPosition({start:this.$refs["listNotifications"].scrollTop,end:n.offsetTop})}else{var o=this.notification[this.notification.length-1];var a='.bx-im-notifications-item[data-id="'.concat(o.id,'"]');var r=document.querySelector(a);this.animatedScrollToPosition({start:this.$refs["listNotifications"].scrollTop,end:r.offsetTop})}},animatedScrollToPosition:function t(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.animateScrollId){e.Animation.cancel(this.animateScrollId);this.scrollAnimating=false}if(typeof n==="function"){n={callback:n}}var s=this.$refs.listNotifications;var o=n,a=o.start,r=a===void 0?s.scrollTop:a,c=o.end,l=c===void 0?s.scrollHeight-s.clientHeight:c,u=o.increment,d=u===void 0?20:u,f=o.callback,h=o.duration,p=h===void 0?500:h;if(s&&l-r>s.offsetHeight*3){r=l-s.offsetHeight*3}this.scrollAnimating=true;this.animateScrollId=e.Animation.start({start:r,end:l,increment:d,duration:p,element:s,elementProperty:"scrollTop",callback:function t(){i.animateScrollId=null;i.scrollAnimating=false;if(f&&typeof f==="function"){f()}}})}},template:'\n\t\t<div class="bx-messenger-next-notify">\n\t\t\t<div class="bx-messenger-panel-next-wrapper" :style="panelStyles">\n\t\t\t\t<div class="bx-messenger-panel-next">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass="bx-messenger-panel-avatar bx-im-notifications-image-system bx-im-notifications-header-image"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<span class="bx-messenger-panel-title bx-messenger-panel-title-middle" style="flex-shrink: 0;">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_HEADER\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="notification.length > 0" class="bx-im-notifications-header-buttons">\n\t\t\t\t\t\t<transition name="notifications-read-all-fade">\n\t\t\t\t\t\t\t<div v-if="isNeedToReadAll" class="bx-im-notifications-header-read-all">\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\'bx-messenger-panel-button bx-im-notifications-header-read-all-icon\'\n\t\t\t\t\t\t\t\t\t@click="showConfirmPopupOnReadAll"\n\t\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_READ_ALL_BUTTON\')"\n\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</transition>\n\t\t\t\t\t\t<div class="bx-im-notifications-header-filter">\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t:class="[\'bx-messenger-panel-button bx-messenger-panel-history bx-im-notifications-header-filter-icon\', (showSearch? \'bx-im-notifications-header-filter-active\': \'\')]"\n\t\t\t\t\t\t\t\t@click="showSearch = !showSearch"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_OPEN_BUTTON\')"\n\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="showSearch" class="bx-im-notifications-header-filter-box" :style="filterBoxStyles">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-xs ui-ctl-w25">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select class="ui-ctl-element" v-model="searchType">\n\t\t\t\t\t\t\t<option value="">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_TYPE_PLACEHOLDER\') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t<template v-for="group in filterTypes">\n\t\t\t\t\t\t\t\t<template v-if="group.LIST">\n\t\t\t\t\t\t\t\t\t<optgroup :label="group.NAME">\n\t\t\t\t\t\t\t\t\t\t<option v-for="option in group.LIST" :value="option.ID">\n\t\t\t\t\t\t\t\t\t\t\t{{ option.NAME }}\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>   \n\t\t\t\t\t\t\t\t\t<option :value="group.MODULE_ID">\n\t\t\t\t\t\t\t\t\t\t{{ group.NAME }}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-xs ui-ctl-w50"> \n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click.prevent="searchQuery=\'\'"></button>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element" \n\t\t\t\t\t\t\tv-model="searchQuery" \n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_TEXT_PLACEHOLDER\')"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-before-icon ui-ctl-xs ui-ctl-w25">\n\t\t\t\t\t\t<div class="ui-ctl-before ui-ctl-icon-calendar"></div>\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-textbox" \n\t\t\t\t\t\t\tv-model="searchDate"\n\t\t\t\t\t\t\t@focus.prevent.stop="onDateFilterClick"\n\t\t\t\t\t\t\t@click.prevent.stop="onDateFilterClick"\n\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_SEARCH_FILTER_DATE_PLACEHOLDER\')"\n\t\t\t\t\t\t\treadonly\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear" @click.prevent="searchDate=\'\'"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if="showSearch && (searchQuery.length >= 3 || searchType !== \'\' || searchDate !== \'\')" \n\t\t\t\tclass="bx-messenger-list-notifications-wrap"\n\t\t\t>\n\t\t\t\t<NotificationSearchResult :searchQuery="searchQuery" :searchType="searchType" :searchDate="searchDate"/>\n\t\t\t</div>\n\t\t\t<div v-else class="bx-messenger-list-notifications-wrap">\n\t\t\t\t<div :class="[ darkTheme ? \'bx-messenger-dark\' : \'\', \'bx-messenger-list-notifications\']" @scroll.passive="onScroll" ref="listNotifications">\n\t\t\t\t\t<notification-item\n\t\t\t\t\t\tv-for="listItem in visibleNotifications"\n\t\t\t\t\t\t:key="listItem.id"\n\t\t\t\t\t\t:data-id="listItem.id"\n\t\t\t\t\t\t:rawListItem="listItem"\n\t\t\t\t\t\t@dblclick="onDoubleClick"\n\t\t\t\t\t\t@buttonsClick="onButtonsClick"\n\t\t\t\t\t\t@deleteClick="onDeleteClick"\n\t\t\t\t\t\t@contentClick="onContentClick"\n\t\t\t\t\t\tv-bx-im-directive-notifications-observer="\n\t\t\t\t\t\t\tlistItem.sectionCode !== NotificationTypesCodes.placeholder\n\t\t\t\t\t\t\t? ObserverType.read \n\t\t\t\t\t\t\t: ObserverType.none\n\t\t\t\t\t\t"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="notification.length <= 0"\n\t\t\t\t\t\tstyle="padding-top: 210px; margin-bottom: 20px;"\n\t\t\t\t\t\tclass="bx-messenger-box-empty bx-notifier-content-empty"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_NOTIFICATIONS_NO_ITEMS\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Scroll button --\x3e\n\t\t\t\t<transition name="bx-im-notifications-scroll-button">\n\t\t\t\t\t<div v-show="showScrollButton" class="bx-im-notifications-scroll-button-box" @click="onScrollButtonClick">\n\t\t\t\t\t\t<div class="bx-im-notifications-scroll-button">\n\t\t\t\t\t\t\t<div class="bx-im-notifications-scroll-button-counter">\n\t\t\t\t\t\t\t\t<div class="bx-im-notifications-scroll-button-counter-digit">{{ unreadCounter }}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div :class="arrowButtonClass"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t\t\n\t\t\t\t<mounting-portal :mount-to="popupIdSelector" append v-if="popupInstance">\n\t\t\t\t\t<popup :type="contentPopupType" :value="contentPopupValue" :popupInstance="popupInstance"/>\n\t\t\t\t</mounting-portal>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.BX.Messenger=this.BX.Messenger||{},BX.Messenger.Lib,BX,window,window,BX,BX,BX,BX.Messenger.Lib,BX.Vue,BX.Messenger.View,BX.Main,BX.Messenger.Lib,BX.Messenger.Const,BX.Messenger.Lib,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:86:"/local/js/im/application/notifications/dist/notifications.bundle.min.js?16547598173079";s:6:"source";s:67:"/local/js/im/application/notifications/dist/notifications.bundle.js";s:3:"min";s:71:"/local/js/im/application/notifications/dist/notifications.bundle.min.js";s:3:"map";s:71:"/local/js/im/application/notifications/dist/notifications.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t,e,n,i,r){"use strict";var o=function(){function t(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);this.inited=false;this.initPromise=new BX.Promise;this.params=i;this.template=null;this.rootNode=this.params.node||document.createElement("div");this.legacyMode=this.params.mode==="legacy";this.initCounter=this.params.initCounter||null;this.templateTemp=null;this.eventBus=new n.VueVendorV2;this.initCore().then(function(){return e.initParams()}).then(function(){return e.initComponent(e.legacyMode)}).then(function(){return e.initPullClient()}).then(function(){return e.initPullHandlers()}).then(function(){return e.initComplete()})}babelHelpers.createClass(t,[{key:"initPullClient",value:function t(){this.pullClient=BX.PULL;return new Promise(function(t,e){return t()})}},{key:"initPullHandlers",value:function t(){this.pullClient.subscribe(new r.ImNotificationsPullHandler({store:this.controller.getStore(),application:this,controller:this.controller}));return new Promise(function(t,e){return t()})}},{key:"initCore",value:function t(){var n=this;return new Promise(function(t,i){e.Core.ready().then(function(e){n.controller=e;t()})})}},{key:"initParams",value:function t(){var e=this;if(this.initCounter){this.controller.getStore().dispatch("notifications/setCounter",{unreadTotal:this.initCounter})}this.controller.getStore().subscribe(function(t){return e.eventStoreInteraction(t)});return new Promise(function(t,e){return t()})}},{key:"initComponent",value:function t(e){var n=this;if(e){return new Promise(function(t,e){return t()})}var i;if(this.legacyMode){i="<bx-im-component-notifications/>"}else{i='<div style="height: 400px; border: 1px solid #ccc;">\n\t\t\t\t<bx-im-component-notifications/>\n\t\t\t</div>'}return this.controller.createVue(this,{el:this.rootNode,template:i}).then(function(t){n.template=t;n.template.$el.id=n.rootNode.substr(1);return new Promise(function(t,e){return t()})})}},{key:"initComplete",value:function t(){this.inited=true;this.initPromise.resolve(this)}},{key:"ready",value:function t(){if(this.inited){var e=new BX.Promise;e.resolve(this);return e}return this.initPromise}},{key:"emit",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.eventBus.$emit(e,n);return true}},{key:"listen",value:function t(e,n){if(typeof n!=="function"){return false}this.eventBus.$on(e,n);return true}},{key:"hasVueInstance",value:function t(){return this.template!==null}},{key:"destroyVueInstance",value:function t(){this.template.$destroy();this.template=null}},{key:"eventStoreInteraction",value:function t(e){if(e.type==="notifications/setCounter"){if(parseInt(e.payload)>=0){BXIM.notify.updateNotifyNextCount(parseInt(e.payload),true)}}}}]);return t}();t.NotificationsApplication=o})(this.BX.Messenger.Application=this.BX.Messenger.Application||{},BX.Messenger.Application,BX,BX.Messenger,BX.Messenger.Provider.Pull);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/local/js/im/lib/clipboard/dist/clipboard.bundle.min.js?16547598171010";s:6:"source";s:51:"/local/js/im/lib/clipboard/dist/clipboard.bundle.js";s:3:"min";s:55:"/local/js/im/lib/clipboard/dist/clipboard.bundle.min.js";s:3:"map";s:55:"/local/js/im/lib/clipboard/dist/clipboard.bundle.map.js";}"*/
this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e){"use strict";var t=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"copy",value:function t(){var o=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var r=e.getStore();if(o){r.focus();r.value=o;r.selectionStart=0;document.execCommand("copy")}else{document.execCommand("copy");r.focus();document.execCommand("paste");o=r.value}e.removeStore();return o}},{key:"getStore",value:function t(){if(e.store){return e.store}e.store=document.createElement("textarea");e.store.style="position: absolute; opacity: 0; top: -1000px; left: -1000px;";document.body.insertBefore(e.store,document.body.firstChild);return e.store}},{key:"removeStore",value:function t(){if(!e.store){return true}document.body.removeChild(e.store);e.store=null;return true}}]);return e}();t.store=null;e.Clipboard=t})(this.BX.Messenger.Lib=this.BX.Messenger.Lib||{});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/local/js/im/component/conference/conference-create/dist/conference-create.bundle.min.js?16547598179398";s:6:"source";s:84:"/local/js/im/component/conference/conference-create/dist/conference-create.bundle.js";s:3:"min";s:88:"/local/js/im/component/conference/conference-create/dist/conference-create.bundle.min.js";s:3:"map";s:88:"/local/js/im/component/conference/conference-create/dist/conference-create.bundle.map.js";}"*/
this.BX=this.BX||{};(function(t,e,n,i,r){"use strict";n.BitrixVue.component("bx-im-component-conference-create",{props:["userId","darkTheme","broadcastingEnabled"],data:function t(){return{title:"",defaultTitle:"",broadcastMode:false,linkGenerated:false,aliasData:null,userSelectorLoaded:false,userSelector:null,selectedUsers:[],selectedPresenters:[],chatId:null,errors:[]}},created:function t(){this.checkRequirements();this.selectedUsers.push(this.userId);this.selectedPresenters.push(this.userId);this.generateLink()},mounted:function t(){var e=this;this.initUserSelector().then(function(){e.userSelector.renderTo(e.$refs["userSelector"]);e.initPresenterSelector();e.presenterSelector.renderTo(e.$refs["presenterSelector"]);e.$nextTick(function(){e.$refs["titleInput"].focus()})})},computed:{conferenceLink:function t(){if(this.linkGenerated){return this.aliasData["LINK"]}return this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_LINK_LOADING"]},defaultTitlePlaceholder:function t(){if(this.linkGenerated){return this.defaultTitle}return this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_PLACEHOLDER_TITLE_2"]},containerClasses:function t(){var e=["bx-conference-quick-create-wrap"];if(this.darkTheme){e.push("bx-conference-quick-create-wrap-dark")}return e},startButtonClasses:function t(){var e=["ui-btn","ui-btn-primary","bx-conference-quick-create-button-start"];if(!this.userSelectorLoaded){e.push("ui-btn-disabled")}if(this.errors.length>0){e.push("ui-btn-disabled","ui-btn-icon-lock")}return e},localize:function t(){return BX.message}},methods:{generateLink:function t(){var n=this;e.ajax.runAction("im.conference.prepare",{json:{},analyticsLabel:{creationType:"chat"}}).then(function(t){n.aliasData=t.data["ALIAS_DATA"];n.defaultTitle=t.data["DEFAULT_TITLE"];n.linkGenerated=true}).catch(function(t){i.Logger.warn("error",t["errors"][0].message)})},copyLink:function t(){if(this.linkGenerated&&e.Reflection.getClass("BX.UI.Notification.Center")){r.Clipboard.copy(this.aliasData["LINK"]);top.BX.UI.Notification.Center.notify({content:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_COPY_CONFIRMATION"]})}},startConference:function t(){var n=this;if(this.linkGenerated){var i={};i["title"]=this.title;i["id"]=0;i["password_needed"]=false;i["users"]=this.selectedUsers;i["broadcast_mode"]=this.broadcastMode;i["presenters"]=this.selectedPresenters;this.clearErrors();e.ajax.runAction("im.conference.create",{json:{fields:i,aliasData:this.aliasData},analyticsLabel:{creationType:"chat"}}).then(function(t){n.onSuccessfulSubmit(t)}).catch(function(t){n.onFailedSubmit(t)})}},cancelCreation:function t(){if(BXIM&&BXIM.messenger){BXIM.messenger.extraClose()}},openChat:function t(){if(window.top["BXIM"]&&this.chatId){window.top["BXIM"].openMessenger("chat"+this.chatId)}},initUserSelector:function t(){var n=this;return e.Runtime.loadExtension("ui.entity-selector").then(function(t){n.TagSelector=t.TagSelector;n.userSelectorLoaded=true;n.userSelector=new n.TagSelector({id:"user-tag-selector",dialogOptions:{id:"user-tag-selector",preselectedItems:[["user",n.userId]],undeselectedItems:[["user",n.userId]],events:{"Item:onSelect":function t(e){n.onUserSelect(e)},"Item:onDeselect":function t(e){n.onUserDeselect(e)}},entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department"}],zIndex:4e3},addButtonCaption:n.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"],addButtonCaptionMore:n.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"]})})},initPresenterSelector:function t(){var e=this;this.presenterSelector=new this.TagSelector({id:"presenter-tag-selector",dialogOptions:{id:"presenter-tag-selector",preselectedItems:[["user",this.userId]],events:{"Item:onSelect":function t(n){e.onPresenterSelect(n)},"Item:onDeselect":function t(n){e.onPresenterDeselect(n)}},entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department"}],zIndex:4e3},addButtonCaption:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"],addButtonCaptionMore:this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_ADD_USERS"]})},checkRequirements:function t(){if(!BX.PULL.isPublishingEnabled()){this.addError(this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_PUSH_ERROR"])}if(!BX.Call.Util.isCallServerAllowed()){this.addError(this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_VOXIMPLANT_ERROR_WITH_LINK"])}},addError:function t(e){this.errors.push(e)},clearErrors:function t(){this.errors=[]},onUserSelect:function t(e){var n=this.selectedUsers.findIndex(function(t){return t===e.data.item.id});if(n===-1){this.selectedUsers.push(e.data.item.id)}},onUserDeselect:function t(e){var n=this.selectedUsers.findIndex(function(t){return t===e.data.item.id});if(n>-1){this.selectedUsers.splice(n,1)}},onPresenterSelect:function t(e){var n=this.selectedPresenters.findIndex(function(t){return t===e.data.item.id});if(n===-1){this.selectedPresenters.push(e.data.item.id)}},onPresenterDeselect:function t(e){var n=this.selectedPresenters.findIndex(function(t){return t===e.data.item.id});if(n>-1){this.selectedPresenters.splice(n,1)}},onSuccessfulSubmit:function t(e){this.chatId=e.data["CHAT_ID"];this.openChat();if(BXIM){BXIM.openVideoconf(this.aliasData["ALIAS"])}},onFailedSubmit:function t(e){var n=e["errors"][0].message;if(e["errors"][0].code==="NETWORK_ERROR"){n=this.localize["BX_IM_COMPONENT_CONFERENCE_CREATE_NETWORK_ERROR"]}this.addError(n)}},template:'\n\t\t<div :class="containerClasses">\n\t\t\t<div class="bx-conference-quick-create-content">\n\t\t\t\t\x3c!-- Title --\x3e\n\t\t\t\t<div class="bx-conference-quick-create-title">\n\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_HEADER_TITLE\'] }}\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Errors --\x3e\n\t\t\t\t<template v-if="errors.length > 0">\n\t\t\t\t\t<div class="ui-alert ui-alert-danger bx-conference-quick-create-error-wrap">\n\t\t\t\t\t\t<span v-for="error in errors" class="ui-alert-message" v-html="error"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t\x3c!-- Title field --\x3e\n\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_TITLE\'] }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-model="title"\n\t\t\t\t\t\t:placeholder="defaultTitlePlaceholder"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="bx-conference-quick-create-field-input"\n\t\t\t\t\t\tref="titleInput"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- User selector field --\x3e\n\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_USERS\'] }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<template v-if="userSelectorLoaded">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-selector-wrap" ref="userSelector"></div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<input type="text" class="bx-conference-quick-create-field-input" :placeholder="localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_USERS_LOADING\']" disabled>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Broadcast mode field --\x3e\n\t\t\t\t<template v-if="broadcastingEnabled">\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block-inline">\n\t\t\t\t\t\t<input type="checkbox" id="bx-conference-quick-create-field-broadcast-mode" v-model="broadcastMode">\n\t\t\t\t\t\t<label class="bx-conference-quick-create-field-label bx-conference-quick-create-broadcast-mode-label" for="bx-conference-quick-create-field-broadcast-mode">{{ localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BROADCAST_MODE\'] }}</label>\n\t\t\t\t\t\t<bx-hint :text="localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BROADCAST_MODE_HINT\']"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Presenter selector field --\x3e\n\t\t\t\t\t<div class="bx-conference-quick-create-field-block" v-show="broadcastMode">\n\t\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_PRESENTERS\'] }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-conference-quick-create-selector-wrap" ref="presenterSelector"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t\x3c!-- Link field --\x3e\n\t\t\t\t<div class="bx-conference-quick-create-field-block">\n\t\t\t\t\t<div class="bx-conference-quick-create-field-label">\n\t\t\t\t\t\t{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_LABEL_LINK\'] }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-conference-quick-create-link-wrap">\n\t\t\t\t\t\t<input type="text" class="bx-conference-quick-create-field-input" :placeholder="conferenceLink" disabled>\n\t\t\t\t\t\t<div @click="copyLink" class="bx-conference-quick-create-link-copy"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Create button --\x3e\n\t\t\t\t<div class="bx-conference-quick-create-button">\n\t\t\t\t\t<button @click="startConference" :class="startButtonClasses">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_START\'] }}</button>\n\t\t\t\t\t<button @click="cancelCreation" class="ui-btn ui-btn-link bx-conference-quick-create-button-cancel">{{ this.localize[\'BX_IM_COMPONENT_CONFERENCE_CREATE_BUTTON_CANCEL\'] }}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'})})(this.BX.Messenger=this.BX.Messenger||{},BX,BX,BX.Messenger.Lib,BX.Messenger.Lib);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?165484154145567";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),getSubmenu:BX.delegate(this.getSubmenu,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var i=this.getVisibleItems();var s=BX.type.isArray(i)&&i.length>0?i[0]:null;var n=BX.Buttons.Utils.getByTag(s,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame();var o=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));o.forEach(function(t){var e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;var i=e.closest(".main-buttons-item-child-button-cloned");if(i){this.clonedChildButton=i}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))},this)},calculateChildListWidth:function(){if(this.realChildButton){var t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");var e=10;return Array.from(t).reduce(function(t,e){var i=BX.Text.toNumber(BX.Dom.style(e,"width"));var s=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));var n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+i+s+n},e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}var e=this.realChildButton.querySelector(".main-buttons-item-child-list");var i=BX.Dom.attr(this.realChildButton,"data-child-items");var s=BX.Dom.attr(this.realChildButton,"data-is-opened");var n={};if(s){BX.Dom.attr(this.realChildButton,"data-is-opened",null);i.forEach(function(t){var e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}},this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);i.forEach(function(t){var e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}},this);setTimeout(function(){BX.Dom.style(e,"overflow","unset")}.bind(this),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout(function(){this._onResizeHandler()}.bind(this),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);var e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout(function(){BX.Dom.style(this.clonedChildButton,"transition",null)}.bind(this))},_onDocumentClick:function(t){var e=this.getItem(t);var i,s,n,a,o,r;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var u,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{u=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(u,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();r=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);s=this.isVisibleItem(s)?s:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&r>2){this.disableItem(n)}if(r===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[s,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");s=this.getItemById(a);n=this.getItemAlias(s);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(s,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){i=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(i)){t.preventDefault();this.execScript(i)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=t.concat(e);return i.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var i=e[BX.message("SITE_ID")];for(var s in i){if(i.hasOwnProperty(s)){this.updateCounter(s,i[s])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,i;var s=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){s=e}},this)}if(BX.type.isPlainObject(s)){i=BX(s.ID);if(BX.type.isDomNode(i)){s.NODE=i}else{s.NODE=null}}return s},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var i=[this.listContainer.id,"_edit_item"].join("");var s=BX.PopupMenu.getMenuById(i);if(s){BX.PopupMenu.destroy(i)}s=this.createItemEditMenu(t,i,e);s.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,i){var s;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var r=BX.pos(i);var u={menuId:e,anchor:i,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:r.width/2,zIndex:20,angle:{position:"top",offset:r.width/2}}};s=BX.PopupMenu.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in s&&BX.type.isArray(s.menuItems)){s.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[s,t,this]);this.editMenu=s;return s},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var i=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(i)){return}var s=i.getAttribute("href");if(s.charAt(0)==="?"){s=i.pathname+i.search}if(!this.lastHomeLink){this.lastHomeLink=s}if(this.lastHomeLink!==s){this.saveOptions("firstPageLink",s);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[s,e])}this.lastHomeLink=s},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();var e=8;BX.height(this.listContainer,t-e)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var i;if(BX.type.isNotEmptyString(t)){i=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+i)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var i=this.getItemCounterObject(t);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var i,s,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{s=JSON.parse(BX.data(e,"item"))}catch(t){s={}}if(BX.type.isPlainObject(s)&&"COUNTER_ID"in s&&s.COUNTER_ID===t){a=e}},this)}i=this.getItemCounterObject(a);if(BX.type.isDomNode(i)){a=this.getItem(i);i.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){i=this.getItemCounterObject(n);if(BX.type.isDomNode(i)){i.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var i=e!==null?parseFloat(e):null;var s,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(i!==null&&!BX.type.isNumber(i)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}s=this.getItemById(t);if(!BX.type.isDomNode(s)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(s);this.setCounterValue(s,i);this.setCounterValue(n,i)},getCounterValueByItemId:function(t){var e,i;var s=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);s=this.dataValue(e,"counter");s=parseFloat(s);if(!BX.type.isNumber(s)){i=this.getItemCounterObject(e);s=parseFloat(i.innerText)}}return s},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var i=t>99?"99+":t>0?t:"";i=parseInt(i);i=BX.type.isNumber(i)?i:"";e.innerText=i},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var i=[];if(t&&t.length){i=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return i},getHiddenItems:function(){var t=this.getAllItems();var e=[];var i=this;if(t&&t.length){e=t.filter(function(t){return!i.isVisibleItem(t)&&!i.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e&&t.parentNode===this.listContainer){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){var t="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getSubmenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");i=this.dataValue(t,"counter");s=e}return s},getChildMenuItemText:function(t){var e,i,s;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);i=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(i)&&BX.type.isDomNode(e)){i.dataset.counter=this.dataValue(t,"counter");s=e.outerHTML+i.outerHTML}else{e=this.dataValue(t,"text");s=e}return s},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var i=this.getDisabledItems();var s=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&i.indexOf(t)===-1){s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}if(this.isSettingsEnabled){s.push({html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!i.length){s.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(i.length){i.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}s.push({html:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" "),items:this.getChildMenuItems(t)})},this)}s.push({html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});s.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});s.push({html:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});s.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return s},getChildMenuItems:function(t){var e;try{e=JSON.parse(this.dataValue(t,"item"))}catch(t){e=null}if(!BX.type.isPlainObject(e)){return[]}if(!BX.type.isArray(this.listChildItems[t.id])){var i={};this.setListAllItems(i,e);var s=this.getListItems(i,"");if(s.length){this.listChildItems[t.id]=BX.type.isArray(s[0].items)?s[0].items:[]}}return this.listChildItems[t.id]},setListAllItems:function(t,e){var i=[];if(BX.type.isPlainObject(e)){i.push(e)}else{i=e}i.forEach(function(e){t[e["ID"].replace(this.containerId+"_","")]=e;if(BX.type.isArray(e["ITEMS"])){this.setListAllItems(t,e["ITEMS"])}},this)},getListItems:function(t,e){var i=[];for(var s in t){if(!t.hasOwnProperty(s)){continue}var n=t[s];if(n["PARENT_ID"]===e){var a={},o=[],r=n.hasOwnProperty("AJAX_OPTIONS");if(r){a=this._getEvents(n["AJAX_OPTIONS"]);o=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}var u,h={text:n["TEXT"],href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],events:a,items:o};if(r){h.cacheable=true}else{u=this.getListItems(t,s);if(u.length){h.items=u}}i.push(h);delete t[s]}}return i},_setAjaxMode:function(t){for(var e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){var e=this;return{onSubMenuShow:function(){if(this.subMenuLoaded){return}var i=this.getSubMenu();i.removeMenuItem("loading");var s=i.getMenuItem("loading");e.getSubItems(t).then(function(t){e._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()}.bind(this)).catch(function(t){if(s){s.getLayout().text.innerText=t}})}}},getSubItems:function(t){return new Promise(function(e,i){if(this.progress){i(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then(function(t){this.progress=false;e(t.data)}.bind(this))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then(function(t){this.progress=false;e(t.data)}.bind(this))}})},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var i=BX.pos(e);var s=this.getSubmenuItems();var n={autoHide:true,offsetLeft:i.width/2-80,angle:{position:"top",offset:100},zIndex:0,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,s,n]},getChildMenuArgs:function(t){var e=this.getChildMenuId();var i=this.getChildMenuItems(t);if(!i||BX.type.isArray(i)&&!i.length){return[]}var s={autoHide:true,angle:true,offsetLeft:t.getBoundingClientRect().width/2};return[e,t,i,s]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},createChildMenu:function(t){return BX.PopupMenu.create.apply(BX.PopupMenu,this.getChildMenuArgs(t))},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},showChildMenu:function(t){var e=BX.PopupMenu.getMenuById(this.getChildMenuId()),i=null;if(e&&e.bindElement){if(e.bindElement.id!==t.id){this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}else{e.popupWindow.show()}}else{this.destroyChildMenu(t);i=this.createChildMenu(t);i.popupWindow.show()}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},closeChildMenu:function(t){var e=this.getChildMenu(t);if(e===null){return}e.popupWindow.close()},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},getChildMenu:function(){return BX.PopupMenu.getMenuById(this.getChildMenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},destroyChildMenu:function(){BX.PopupMenu.destroy(this.getChildMenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,i){t[e.id]={sort:i,isDisabled:this.isDisabled(e)}},this);return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}var t={};this.optionsToSave.forEach(function(e){t[e.name]=e.value});this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(i){if(i){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(i)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var i=new BX.Promise;var s=i;for(var n=0;n<e.length;n++){i=i.then(e[n])}i.then(function(e){t(null,e)},function(e){t(e,null)});s.fulfill()},moveButtonAlias:function(t){var e,i;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);i=this.getItemAlias(t);if(this.isListItem(e)){if(!i){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,i)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var i=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==i){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var i=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){i=BX.Buttons.Utils.getByClass(t,e)}return i},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var i=this.getAllItems();var s=this.isSubmenuItem(t);var n=this.isListItem(t);if(!s&&!n){return e}if(s){i.forEach(function(i){BX.hasClass(t,this.getAliasLink(i))&&(e=i)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var i=this;var s=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}s=e.concat(t);a.forEach(function(t){o=[].some.call(s,function(e){return BX.hasClass(t.layout.item,i.dataValue(e,"link"))||i.isDisabled(t.layout.item)||i.isSeparator(t.layout.item)||i.isDropzone(t.layout.item)});if(o||(i.isSettings(t.layout.item)||i.isApplySettingsButton(t.layout.item)||i.isResetSettingsButton(t.layout.item)||i.isNotHiddenItem(t.layout.item)||i.isSeparator(t.layout.item)||t.layout.item===i.dragItem)&&!i.isMoreButton(t.layout.item)){i.showItem(t.layout.item)}else{i.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var i="";var s;if(BX.type.isDomNode(t)){s=BX.data(t,e);if(typeof s!=="undefined"){i=s}}return i},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var i=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(i===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var i,s;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}i=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));s=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(s)&&(BX.hasClass(s,this.classHiddenLabel)||this.isDisabled(s)&&this.isSubmenuItem(s))||(BX.type.isDomNode(i)&&BX.hasClass(i,this.classManage)||this.isDisabled(i)&&this.isSubmenuItem(i))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,i,s;t=this.getHiddenItems();s=this.getDisabledItems();t=t.concat(s);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){if(!BX.hasClass(e,this.classItemMore)){this.showChildMenu(e)}BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var i=this.overItem.getBoundingClientRect();var s=getComputedStyle(this.dragItem);var n=parseInt(s.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>i.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var i,s;if(!BX.type.isDomNode(e)){return false}i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1654841541575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:84:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.min.js?16548425236984";s:6:"source";s:65:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.js";s:3:"min";s:69:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.min.js";s:3:"map";s:69:"/bitrix/components/bitrix/ui.toolbar/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.UI");BX.UI.ToolbarManager={toolbars:{},create:function(t){var e=new BX.UI.Toolbar(t);if(this.get(e.getId())){throw new Error("The toolbar instance with the same 'id' already exists.")}this.toolbars[e.getId()]=e;return e},getDefaultToolbar:function(){return this.get("default-toolbar")},get:function(t){return t in this.toolbars?this.toolbars[t]:null}};BX.UI.Toolbar=function(t){t=BX.type.isPlainObject(t)?t:{};this.titleMinWidth=BX.type.isNumber(t.titleMinWidth)?t.titleMinWidth:158;this.titleMaxWidth=BX.type.isNumber(t.titleMaxWidth)?t.titleMaxWidth:"";this.filterMinWidth=BX.type.isNumber(t.filterMinWidth)?t.filterMinWidth:300;this.filterMaxWidth=BX.type.isNumber(t.filterMaxWidth)?t.filterMaxWidth:748;this.id=BX.Type.isStringFilled(t.id)?t.id:BX.Text.getRandom();this.toolbarContainer=t.target;if(!BX.Type.isDomNode(this.toolbarContainer)){throw new Error('BX.UI.Toolbar: "target" parameter is required.')}this.titleContainer=this.toolbarContainer.querySelector(".ui-toolbar-title-box");this.filterContainer=this.toolbarContainer.querySelector(".ui-toolbar-filter-box");this.filterButtons=this.toolbarContainer.querySelector(".ui-toolbar-filter-buttons");this.rightButtons=this.toolbarContainer.querySelector(".ui-toolbar-right-buttons");this.afterTitleButtons=this.toolbarContainer.querySelector(".ui-toolbar-after-title-buttons");if(!this.filterContainer){this.filterMinWidth=0;this.filterMaxWidth=0}this.buttons=Object.create(null);this.buttonIds=BX.Type.isArray(t.buttonIds)?t.buttonIds:[];if(!this.buttonIds.length){return}this.buttonIds.forEach(function(t){var e=BX.UI.ButtonManager.createByUniqId(t);if(e){e.getContainer().originalWidth=e.getContainer().offsetWidth;if(!e.getIcon()&&!BX.Type.isStringFilled(e.getDataSet()["toolbarCollapsedIcon"])){if(e.getColor()===BX.UI.ButtonColor.PRIMARY){e.setDataSet({toolbarCollapsedIcon:BX.UI.ButtonIcon.ADD})}else{console.warn('BX.UI.Toolbar: the button "'+e.getText()+'" '+"doesn't have an icon for collapsed mode. "+'Use the "data-toolbar-collapsed-icon" attribute.')}}this.buttons[t]=e}else{console.warn('BX.UI.Toolbar: the button "'+t+"\" wasn't initialized.")}},this);this.windowWidth=document.body.offsetWidth;this.reduceItemsWidth();window.addEventListener("resize",function(){if(this.isWindowIncreased()){this.increaseItemsWidth()}else{this.reduceItemsWidth()}}.bind(this))};BX.UI.Toolbar.prototype={getButtons:function(){return this.buttons},getButton:function(t){return t in this.buttons?this.buttons[t]:null},getId:function(){return this.id},isWindowIncreased:function(){var t=this.windowWidth;var e=document.body.offsetWidth;this.windowWidth=e;return e>t},getContainerSize:function(){return this.toolbarContainer.offsetWidth},getInnerTotalWidth:function(){return this.toolbarContainer.scrollWidth},reduceItemsWidth:function(){if(this.getInnerTotalWidth()<=this.getContainerSize()){return}var t=Object.values(this.getButtons());for(var e=t.length-1;e>=0;e--){var i=t[e];if(!i.getIcon()&&!BX.Type.isStringFilled(i.getDataSet()["toolbarCollapsedIcon"])){continue}if(i.isCollapsed()){continue}i.setCollapsed(true);if(!i.getIcon()){i.setIcon(i.getDataSet()["toolbarCollapsedIcon"])}if(this.getInnerTotalWidth()<=this.getContainerSize()){return}}},increaseItemsWidth:function(){var t=Object.values(this.getButtons());for(var e=0;e<t.length;e++){var i=t[e];var o=i.getContainer();if(!i.isCollapsed()){continue}var n=this.titleMinWidth+this.filterMinWidth+(this.afterTitleButtons?this.afterTitleButtons.offsetWidth:0)+(this.filterButtons?this.filterButtons.offsetWidth:0)+(this.rightButtons?this.rightButtons.offsetWidth:0)+(o.originalWidth-o.offsetWidth);if(n>this.getContainerSize()){break}i.setCollapsed(false);if(i.getIcon()===i.getDataSet()["toolbarCollapsedIcon"]){i.setIcon(null)}}}};BX.UI.Toolbar.Star=function(){this.initialized=false;this.currentPageInMenu=false;this.starContNode=null;BX.ready(function(){this.init()}.bind(this));BX.addCustomEvent("onFrameDataProcessed",function(){this.init()}.bind(this))};BX.UI.Toolbar.Star.prototype={init:function(){this.starContNode=document.getElementById("uiToolbarStar");if(!this.starContNode){return false}if(this.initialized){return false}this.initialized=true;var t=this.starContNode.getAttribute("data-bx-url");if(!BX.type.isNotEmptyString(t)){t=document.location.pathname+document.location.search}t=BX.Uri.removeParam(t,["IFRAME","IFRAME_TYPE"]);top.BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",function(t){this.processMenuItemData(t)}.bind(this));top.BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",function(t){this.onStandardItemChangedSuccess(t)}.bind(this));top.BX.onCustomEvent("UI.Toolbar:onRequestMenuItemData",[{currentFullPath:t,context:window}]);return true},processMenuItemData:function(t){if(t.context&&t.context!==window){return}this.currentPageInMenu=t.currentPageInMenu;if(BX.type.isNotEmptyObject(t.currentPageInMenu)){BX.addClass(this.starContNode,"ui-toolbar-star-active")}this.starContNode.title=BX.message(this.starContNode.classList.contains("ui-toolbar-star-active")?"UI_TOOLBAR_DELETE_PAGE_FROM_LEFT_MENU":"UI_TOOLBAR_ADD_PAGE_TO_LEFT_MENU");if(BX.type.isDomNode(this.currentPageInMenu)&&this.currentPageInMenu.getAttribute("data-type")==="default"){this.starContNode.title=BX.message("UI_TOOLBAR_STAR_TITLE_DEFAULT_PAGE");BX.bind(this.starContNode,"click",function(){this.showMessage(BX.message("UI_TOOLBAR_STAR_TITLE_DEFAULT_PAGE_DELETE_ERROR"))}.bind(this));return true}BX.bind(this.starContNode,"click",function(){var t=document.getElementById("pagetitle").innerText;var e=this.starContNode.getAttribute("data-bx-title-template");if(BX.type.isNotEmptyString(e)){t=e.replace(/#page_title#/i,t)}var i=this.starContNode.getAttribute("data-bx-url");if(!BX.type.isNotEmptyString(i)){i=document.location.pathname+document.location.search}i=BX.Uri.removeParam(i,["IFRAME","IFRAME_TYPE"]);top.BX.onCustomEvent("UI.Toolbar:onStarClick",[{isActive:BX.hasClass(this.starContNode,"ui-toolbar-star-active"),context:window,pageTitle:t,pageLink:i}])}.bind(this))},onStandardItemChangedSuccess:function(t){if(!BX.type.isBoolean(t.isActive)||!this.starContNode){return}if(t.context&&t.context!==window){return}if(t.isActive){this.showMessage(BX.message("UI_TOOLBAR_ITEM_WAS_ADDED_TO_LEFT"));this.starContNode.title=BX.message("UI_TOOLBAR_DELETE_PAGE_FROM_LEFT_MENU");BX.addClass(this.starContNode,"ui-toolbar-star-active")}else{this.showMessage(BX.message("UI_TOOLBAR_ITEM_WAS_DELETED_FROM_LEFT"));this.starContNode.title=BX.message("UI_TOOLBAR_ADD_PAGE_TO_LEFT_MENU");BX.removeClass(this.starContNode,"ui-toolbar-star-active")}},showMessage:function(t){var e=BX.PopupWindowManager.create("left-menu-message",this.starContNode,{content:t,darkMode:true,offsetTop:2,offsetLeft:0,angle:true,events:{onPopupClose:function(){if(e){e.destroy();e=null}}},autoHide:true});e.show();setTimeout(function(){if(e){e.destroy();e=null}},3e3)}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.min.js?16548424637131";s:6:"source";s:72:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.js";s:3:"min";s:76:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.min.js";s:3:"map";s:76:"/bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.map.js";}"*/
BX.namespace("Tasks.Component");BX.Tasks.Component.IframePopup=function(t){this.opts=BX.merge({},t);this.vars={skip:true,callbacks:{},resizeInterval:false,resizeLock:true,lastHeight:false};this.sys={scope:null};this.instances={win:false};this.ctrls={iframe:null,wrap:null,close:null};this.setCallbacks(t.callbacks);this.bindEvents()};BX.mergeEx(BX.Tasks.Component.IframePopup.prototype,{add:function(t){this.edit(0,t)},view:function(t){this.open("view",t)},edit:function(t,e){this.open("edit",t,{urlParams:e})},open:function(t,e,n){e=parseInt(e);if(isNaN(e)||e<0){return}n=n||{};var i=this.getPath(t,e,n.urlParams);if(BX.Bitrix24&&"PageSlider"in BX.Bitrix24){BX.Bitrix24.PageSlider.open(i)}else{this.toggleLoading(true);this.getWindow().show();this.getWindow().setBindElement(this.getWindowCoords());this.getWindow().adjustPosition();this.getIframe().src=i}},close:function(){this.getWindow().close()},bindEvents:function(){BX.bind(window,"resize",BX.throttle(this.onWindowResize,100,this));BX.addCustomEvent(window,"tasksIframeLoad",this.onContentLoaded.bind(this));BX.addCustomEvent(window,"tasksIframeUnload",this.onContentUnLoaded.bind(this))},bindInnerDocumentEvents:function(){var t=this.getContentDocument();if(t){BX.bind(t,"keydown",this.onInnerDocumentKeyDown.bind(this))}},getIframe:function(){if(this.ctrls.iframe===null){this.ctrls.iframe=BX.create("iframe",{attrs:{scrolling:"no",frameBorder:"0"}})}return this.ctrls.iframe},getWindow:function(){if(this.instances.win===false){this.instances.win=new BX.PopupWindow("tasks-iframe-popup",{top:0,left:0},{autoHide:false,closeByEsc:true,content:this.getIframeContainer(),overlay:true,lightShadow:false,closeIcon:true,contentNoPaddings:true,draggable:false,titleBar:true,events:{onPopupClose:BX.delegate(this.onPopupClose,this),onPopupShow:BX.delegate(this.onPopupOpen,this)}});this.ctrls.close=BX.create("div",{props:{className:"hidden"},attrs:{id:"tasks-popup-close",title:BX.message("TASKS_TIP_COMPONENT_TEMPLATE_CLOSE_WINDOW")},events:{click:BX.delegate(this.onCloseClicked,this)},children:[BX.create("span")]});BX.insertAfter(this.ctrls.close,BX("popup-window-overlay-tasks-iframe-popup"))}return this.instances.win},setTitle:function(t,e){var n="";if(t!=false){t=t=="view"?"VIEW":"EDIT";e=parseInt(e);if(isNaN(e)||e<=0){e=0}if(t=="EDIT"&&e==0){t="NEW"}n=BX.message("TASKS_TIP_COMPONENT_TEMPLATE_"+t+"_TASK_TITLE");if(e>0){n=n.replace("#TASK_ID#",e)}}this.getWindow().setTitleBar(n)},getPath:function(t,e,n){t=t=="view"?"view":"edit";e=parseInt(e);var i=this.opts.pathToTasks.replace("#task_id#",e);i=i+(i.indexOf("?")==-1?"?":"&")+"IFRAME=Y";if(BX.type.isPlainObject(n)){for(var s in n){i+="&"+s+"="+encodeURIComponent(n[s])}}i=i.replace("#action#",t);return i},getWindowCoords:function(){var t=BX.pos(this.getIframeContainer()).width;var e=BX.GetWindowSize().innerWidth;var n=BX.GetWindowScrollPos().scrollTop;return{left:Math.floor((e-t)/2),top:30+n}},getContentDocument:function(){var t=this.getIframe();var e=null;if(t.contentDocument){e=t.contentDocument}if(t.contentWindow){e=t.contentWindow.document}return e&&e.body?e:null},getIframeContainer:function(){if(this.ctrls.wrap===null){this.ctrls.wrap=this.ctrls.wrap=BX.create("div",{props:{className:"tasks-iframe-wrap loading fixedHeight"},attrs:{id:"tasks-iframe-wrap"},children:[this.getIframe()]})}return this.ctrls.wrap},getContentContainer:function(){var t=this.getContentDocument();if(t){return t.getElementById("tasks-content-outer")}return null},onCloseClicked:function(){this.getWindow().close()},onTaskGlobalEvent:function(t,e){if(BX.type.isNotEmptyString(t)){var n=t.toString().toUpperCase();e=e||{};e.task=e.task||{};e.options=e.options||{};var i=[];var s=parseInt(e.task.ID);if(n=="DELETE"&&!isNaN(s)&&s){i.push(e.task.ID)}else if(n=="ADD"||n=="UPDATE"){if(e.taskUgly){i.push(e.taskUgly)}else{return}}if(!e.options.STAY_AT_PAGE){this.close()}if(typeof this.vars.callbacks[n]!="undefined"&&this.vars.callbacks[n]!==false){var o=this.vars.callbacks[n];if(BX.type.isString(o)){o=BX.Tasks.deReference(o,window)}if(BX.type.isFunction(o)){o.apply(window,i)}}}},onContentLoaded:function(){var t=this.getContentDocument();if(t){var e=this.parseUrl(t.location.pathname);if(e){this.setTitle(e.action,e.taskId)}}this.toggleLoading(false);this.startMonitorContent();this.bindInnerDocumentEvents()},onContentUnLoaded:function(){this.setTitle(false);this.stopMonitorContent()},onPopupOpen:function(){BX.toggleClass(this.ctrls.close,"hidden");this.toggleLoading(true)},onPopupClose:function(){BX.toggleClass(this.ctrls.close,"hidden");this.lockHeight();this.stopMonitorContent();this.toggleLoading(true);this.vars.lastHeight=false;this.getIframe().src="about:blank"},onWindowResize:function(){if(this.getWindow().isShown()){this.getWindow().setBindElement(this.getWindowCoords())}},onContentResize:function(){if(this.getWindow().isShown()&&!this.vars.resizeLock){var t=this.getContentDocument();if(t){var e=this.getContentContainer();if(e){var n=e.offsetHeight;if(n!=this.vars.lastHeight){this.getIframeContainer().style.height=n+"px";this.vars.lastHeight=n;this.unLockHeight()}this.getWindow().popupContainer.style.marginBottom="40px";this.getWindow().resizeOverlay()}}}},onInnerDocumentKeyDown:function(t){if(BX.Tasks.Util.isEsc(t)){this.close()}},lockHeight:function(){this.toggleFixedHeight(true)},unLockHeight:function(){this.toggleFixedHeight(false)},toggleFixedHeight:function(t){BX[t?"addClass":"removeClass"](this.getIframeContainer(),"fixedHeight")},toggleLoading:function(t){BX[t?"addClass":"removeClass"](this.getIframeContainer(),"loading")},stopMonitorContent:function(){this.vars.resizeLock=true},startMonitorContent:function(){this.vars.resizeLock=false;if(this.vars.resizeInterval===false){this.vars.resizeInterval=setInterval(BX.proxy(this.onContentResize,this),300)}},setCallbacks:function(t){if(BX.type.isPlainObject(t)){BX.Tasks.each(t,function(t,e){if(t=="#SHOW_ADDED_TASK_DETAIL#"){return}if(t!==false&&(BX.type.isFunction(t)||BX.type.isNotEmptyString(t))){this.vars.callbacks[e]=t}}.bind(this))}},showCreateForm:function(){this.add()},parseUrl:function(t){var e=this.opts.pathToTasks;if(e){e=e.toLowerCase().replace("#action#","(view|edit){1}").replace("#task_id#","(\\d+)");var n=t.match(new RegExp(e));if(n&&BX.type.isArray(n)){var i=n[1]||false;var s=n[2]||false;if(i&&s){return{action:i,taskId:parseInt(s)}}}}return null},onTaskAdded:function(t,e,n,i,s){BX.onCustomEvent(this,"onTaskAdded",[t,e,n,i,s])},onTaskChanged:function(t,e,n,i,s){BX.onCustomEvent(this,"onTaskChanged",[t,e,n,i,s])},onTaskDeleted:function(t){BX.onCustomEvent(this,"onTaskDeleted",[t])}});BX.Tasks.Component.IframePopup.create=function(t){if(window.top!=window){return}if(typeof BX.Tasks.Singletons=="undefined"){BX.Tasks.Singletons={}}if(typeof BX.Tasks.Singletons.iframePopup=="undefined"){BX.Tasks.Singletons.iframePopup=new BX.Tasks.Component.IframePopup(t);window.taskIFramePopup=BX.Tasks.Singletons.iframePopup;window.BX.TasksIFrameInst=BX.Tasks.Singletons.iframePopup}else{BX.Tasks.Singletons.iframePopup.setCallbacks(t.callbacks)}return BX.Tasks.Singletons.iframePopup};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:67:"/bitrix/components/bitrix/search.title/script.min.js?16548423406443";s:6:"source";s:48:"/bitrix/components/bitrix/search.title/script.js";s:3:"min";s:52:"/bitrix/components/bitrix/search.title/script.min.js";s:3:"map";s:52:"/bitrix/components/bitrix/search.title/script.map.js";}"*/
function JCTitleSearch(t){var e=this;this.arParams={AJAX_PAGE:t.AJAX_PAGE,CONTAINER_ID:t.CONTAINER_ID,INPUT_ID:t.INPUT_ID,MIN_QUERY_LEN:parseInt(t.MIN_QUERY_LEN)};if(t.WAIT_IMAGE)this.arParams.WAIT_IMAGE=t.WAIT_IMAGE;if(t.MIN_QUERY_LEN<=0)t.MIN_QUERY_LEN=1;this.cache=[];this.cache_key=null;this.startText="";this.running=false;this.runningCall=false;this.currentRow=-1;this.RESULT=null;this.CONTAINER=null;this.INPUT=null;this.WAIT=null;this.ShowResult=function(t){if(BX.type.isString(t)){e.RESULT.innerHTML=t}e.RESULT.style.display=e.RESULT.innerHTML!==""?"block":"none";var s=e.adjustResultNode();var i;var n;var l=BX.findChild(e.RESULT,{tag:"table",class:"title-search-result"},true);if(l){n=BX.findChild(l,{tag:"th"},true)}if(n){var r=BX.pos(l);r.width=r.right-r.left;var a=BX.pos(n);a.width=a.right-a.left;n.style.width=a.width+"px";e.RESULT.style.width=s.width+a.width+"px";e.RESULT.style.left=s.left-a.width-1+"px";if(r.width-a.width>s.width)e.RESULT.style.width=s.width+a.width-1+"px";r=BX.pos(l);i=BX.pos(e.RESULT);if(i.right>r.right){e.RESULT.style.width=r.right-r.left+"px"}}var o;if(l)o=BX.findChild(e.RESULT,{class:"title-search-fader"},true);if(o&&n){i=BX.pos(e.RESULT);o.style.left=i.right-i.left-18+"px";o.style.width=18+"px";o.style.top=0+"px";o.style.height=i.bottom-i.top+"px";o.style.display="block"}};this.onKeyPress=function(t){var s=BX.findChild(e.RESULT,{tag:"table",class:"title-search-result"},true);if(!s)return false;var i;var n=s.rows.length;switch(t){case 27:e.RESULT.style.display="none";e.currentRow=-1;e.UnSelectAll();return true;case 40:if(e.RESULT.style.display=="none")e.RESULT.style.display="block";var l=-1;for(i=0;i<n;i++){if(!BX.findChild(s.rows[i],{class:"title-search-separator"},true)){if(l==-1)l=i;if(e.currentRow<i){e.currentRow=i;break}else if(s.rows[i].className=="title-search-selected"){s.rows[i].className=""}}}if(i==n&&e.currentRow!=i)e.currentRow=l;s.rows[e.currentRow].className="title-search-selected";return true;case 38:if(e.RESULT.style.display=="none")e.RESULT.style.display="block";var r=-1;for(i=n-1;i>=0;i--){if(!BX.findChild(s.rows[i],{class:"title-search-separator"},true)){if(r==-1)r=i;if(e.currentRow>i){e.currentRow=i;break}else if(s.rows[i].className=="title-search-selected"){s.rows[i].className=""}}}if(i<0&&e.currentRow!=i)e.currentRow=r;s.rows[e.currentRow].className="title-search-selected";return true;case 13:if(e.RESULT.style.display=="block"){for(i=0;i<n;i++){if(e.currentRow==i){if(!BX.findChild(s.rows[i],{class:"title-search-separator"},true)){var a=BX.findChild(s.rows[i],{tag:"a"},true);if(a){window.location=a.href;return true}}}}}return false}return false};this.onTimeout=function(){e.onChange(function(){setTimeout(e.onTimeout,500)})};this.onChange=function(t){if(e.running){e.runningCall=true;return}e.running=true;if(e.INPUT.value!=e.oldValue&&e.INPUT.value!=e.startText){e.oldValue=e.INPUT.value;if(e.INPUT.value.length>=e.arParams.MIN_QUERY_LEN){e.cache_key=e.arParams.INPUT_ID+"|"+e.INPUT.value;if(e.cache[e.cache_key]==null){if(e.WAIT){var s=BX.pos(e.INPUT);var i=s.bottom-s.top-2;e.WAIT.style.top=s.top+1+"px";e.WAIT.style.height=i+"px";e.WAIT.style.width=i+"px";e.WAIT.style.left=s.right-i+2+"px";e.WAIT.style.display="block"}BX.ajax.post(e.arParams.AJAX_PAGE,{ajax_call:"y",INPUT_ID:e.arParams.INPUT_ID,q:e.INPUT.value,l:e.arParams.MIN_QUERY_LEN},function(s){e.cache[e.cache_key]=s;e.ShowResult(s);e.currentRow=-1;e.EnableMouseEvents();if(e.WAIT)e.WAIT.style.display="none";if(!!t)t();e.running=false;if(e.runningCall){e.runningCall=false;e.onChange()}});return}else{e.ShowResult(e.cache[e.cache_key]);e.currentRow=-1;e.EnableMouseEvents()}}else{e.RESULT.style.display="none";e.currentRow=-1;e.UnSelectAll()}}if(!!t)t();e.running=false};this.onScroll=function(){if(BX.type.isElementNode(e.RESULT)&&e.RESULT.style.display!=="none"&&e.RESULT.innerHTML!==""){e.adjustResultNode()}};this.UnSelectAll=function(){var t=BX.findChild(e.RESULT,{tag:"table",class:"title-search-result"},true);if(t){var s=t.rows.length;for(var i=0;i<s;i++)t.rows[i].className=""}};this.EnableMouseEvents=function(){var t=BX.findChild(e.RESULT,{tag:"table",class:"title-search-result"},true);if(t){var s=t.rows.length;for(var i=0;i<s;i++)if(!BX.findChild(t.rows[i],{class:"title-search-separator"},true)){t.rows[i].id="row_"+i;t.rows[i].onmouseover=function(t){if(e.currentRow!=this.id.substr(4)){e.UnSelectAll();this.className="title-search-selected";e.currentRow=this.id.substr(4)}};t.rows[i].onmouseout=function(t){this.className="";e.currentRow=-1}}}};this.onFocusLost=function(t){setTimeout(function(){e.RESULT.style.display="none"},250)};this.onFocusGain=function(){if(e.RESULT.innerHTML.length)e.ShowResult()};this.onKeyDown=function(t){if(!t)t=window.event;if(e.RESULT.style.display=="block"){if(e.onKeyPress(t.keyCode))return BX.PreventDefault(t)}};this.adjustResultNode=function(){if(!(BX.type.isElementNode(e.RESULT)&&BX.type.isElementNode(e.CONTAINER))){return{top:0,right:0,bottom:0,left:0,width:0,height:0}}var t=BX.pos(e.CONTAINER);e.RESULT.style.position="absolute";e.RESULT.style.top=t.bottom+2+"px";e.RESULT.style.left=t.left+"px";e.RESULT.style.width=t.width+"px";return t};this._onContainerLayoutChange=function(){if(BX.type.isElementNode(e.RESULT)&&e.RESULT.style.display!=="none"&&e.RESULT.innerHTML!==""){e.adjustResultNode()}};this.Init=function(){this.CONTAINER=document.getElementById(this.arParams.CONTAINER_ID);BX.addCustomEvent(this.CONTAINER,"OnNodeLayoutChange",this._onContainerLayoutChange);this.RESULT=document.body.appendChild(document.createElement("DIV"));this.RESULT.className="title-search-result";this.INPUT=document.getElementById(this.arParams.INPUT_ID);this.startText=this.oldValue=this.INPUT.value;BX.bind(this.INPUT,"focus",function(){e.onFocusGain()});BX.bind(this.INPUT,"blur",function(){e.onFocusLost()});this.INPUT.onkeydown=this.onKeyDown;if(this.arParams.WAIT_IMAGE){this.WAIT=document.body.appendChild(document.createElement("DIV"));this.WAIT.style.backgroundImage="url('"+this.arParams.WAIT_IMAGE+"')";if(!BX.browser.IsIE())this.WAIT.style.backgroundRepeat="none";this.WAIT.style.display="none";this.WAIT.style.position="absolute";this.WAIT.style.zIndex="1100"}BX.bind(this.INPUT,"bxchange",function(){e.onChange()});var t=BX.findParent(this.CONTAINER,BX.is_fixed);if(BX.type.isElementNode(t)){BX.bind(window,"scroll",BX.throttle(this.onScroll,100,this))}};BX.ready(function(){e.Init(t)})}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/map.min.js?165484264711069";s:6:"source";s:70:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/map.js";s:3:"min";s:74:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/map.min.js";s:3:"map";s:74:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/map.map.js";}"*/
BX.namespace("BX.Bitrix24");BX.Bitrix24.SlidingPanel=function(t){this.containerClassName=this.containerClassName||"sliding-panel-window";this.container=BX.create("div",{props:{className:this.containerClassName}});this.overlayClassName=this.overlayClassName||"sliding-panel-overlay";this.overlay=BX.create("div",{props:{className:this.overlayClassName}});this.isOpen=false;this.header=BX("header");this.menuItems=BX("menu-items-block");this.imBar=BX("bx-im-bar");this.panel=BX("panel");this.creatorConfirmedPanel=BX("creatorconfirmed");this.animation=null;this.startParams=this.startParams||{};this.endParams=this.endParams||{};this.currentParams=null;BX.bind(this.container,"click",this.onContainerClick.bind(this));BX.addCustomEvent("onTopPanelCollapse",this.onTopPanelCollapse.bind(this))};BX.Bitrix24.SlidingPanel.prototype={animateStep:function(t){},setContent:function(){},open:function(){if(this.isOpen){return}this.isOpen=true;BX.bind(document,"keyup",BX.proxy(this.onDocumentKeyUp,this));BX.bind(document,"click",BX.proxy(this.onDocumentClick,this));this.header.addEventListener("click",BX.proxy(this.onHeaderClick,this),true);if(!this.overlay.parentNode){document.body.appendChild(this.overlay);BX.ZIndexManager.register(this.overlay)}BX.ZIndexManager.bringToFront(this.overlay);if(!this.container.parentNode){this.setContent();this.overlay.appendChild(this.container)}var t=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight=t+"px";if(this.imBar){this.imBar.style.right=t+"px"}if(this.panel){this.panel.style.zIndex=3001}if(this.creatorConfirmedPanel){this.creatorConfirmedPanel.style.zIndex=3e3}document.body.style.overflow="hidden";this.adjustPosition();if(this.animation){this.animation.stop()}this.animation=new BX.easing({duration:300,start:this.currentParams?this.currentParams:this.startParams,finish:this.endParams,transition:BX.easing.transitions.linear,step:BX.proxy(function(t){this.currentParams=t;this.animateStep(t)},this),complete:BX.proxy(function(){this.onTrasitionEnd()},this)});this.animation.animate()},close:function(t){if(!this.isOpen){if(this.animation){this.animation.stop(true)}return}this.isOpen=false;BX.unbind(document,"keyup",BX.proxy(this.onDocumentKeyUp,this));BX.unbind(document,"click",BX.proxy(this.onDocumentClick,this));this.header.removeEventListener("click",BX.proxy(this.onHeaderClick,this),true);this.container.classList.remove(this.containerClassName+"-open");if(this.animation){this.animation.stop()}if(t===true){this.currentParams=this.startParams;this.onTrasitionEnd()}else{this.animation=new BX.easing({duration:300,start:this.currentParams,finish:this.startParams,transition:BX.easing.transitions.linear,step:BX.proxy(function(t){this.currentParams=t;this.animateStep(t)},this),complete:BX.proxy(function(){this.onTrasitionEnd()},this)});this.animation.animate()}},adjustPosition:function(){var t=BX.pos(this.menuItems);var i=window.pageYOffset||document.documentElement.scrollTop;if(i>0){this.overlay.style.bottom=-i+"px"}var e=i>t.top?i:t.top;this.overlay.style.top=e+"px"},onTrasitionEnd:function(){this.animation=null;if(this.isOpen){this.currentParams=this.endParams;this.container.classList.add(this.containerClassName+"-open")}else{this.currentParams=this.startParams;if(this.overlay.parentNode){BX.ZIndexManager.unregister(this.overlay);this.overlay.parentNode.removeChild(this.overlay)}if(this.imBar){this.imBar.style.right=""}if(this.panel){this.panel.style.cssText=""}if(this.creatorConfirmedPanel){this.creatorConfirmedPanel.style.cssText=""}document.body.style.cssText="";this.container.style.cssText="";this.header.style.cssText="";this.overlay.style.cssText=""}},onContainerClick:function(t){t.stopPropagation()},onDocumentKeyUp:function(t){if(t.keyCode===27){this.close()}},onDocumentClick:function(t){if(BX.isParentForNode(this.container,t.target)){return}this.close()},onHeaderClick:function(t){if(this.isOpen&&t.target.className.match(/help-/)){this.close(true)}},onTopPanelCollapse:function(){if(this.isOpen){this.adjustPosition()}}};BX.Bitrix24.GroupPanel=function(t){this.containerClassName="group-panel-window";this.overlayClassName="group-panel-overlay";this.startParams={translateX:-100,opacity:0};this.endParams={translateX:0,opacity:65};BX.Bitrix24.SlidingPanel.apply(this,arguments);t=t||{};this.ajaxPath=BX.type.isNotEmptyString(t.ajaxPath)?t.ajaxPath:null;this.siteId=BX.type.isNotEmptyString(t.siteId)?t.siteId:BX.message("SITE_ID");this.menu=BX("menu-all-groups-link");this.leftMenu=BX("menu-items-block");this.content=BX("group-panel-content");this.items=BX("group-panel-items");this.counter=BX("group-panel-header-filter-counter");var i=this.items.getElementsByClassName("group-panel-item-intranet");var e=this.items.getElementsByClassName("group-panel-item-extranet");if(i.length<=20&&e.length<=20){BX.addClass(this.container,"group-panel-window-one-column")}this.closeLink=BX("group-panel-close-link");this.filters=[].slice.call(this.content.getElementsByClassName("group-panel-header-filter"));for(var n=0;n<this.filters.length;n++){var s=this.filters[n];BX.bind(s,"click",BX.proxy(this.onFilterClick,this))}BX.bind(this.items,"click",this.onItemsClick.bind(this));BX.bind(this.closeLink,"click",this.close.bind(this));BX.bind(this.menu,"click",this.onMenuClick.bind(this));var a=function(){this.close(true)}.bind(this);BX.addCustomEvent("BX.Bitrix24.Map:onBeforeOpen",a);BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onDragStart",a);BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",a)};BX.Bitrix24.GroupPanel.prototype=Object.create(BX.Bitrix24.SlidingPanel.prototype);BX.Bitrix24.GroupPanel.prototype.constructor=BX.Bitrix24.GroupPanel;BX.Bitrix24.GroupPanel.prototype.super=BX.Bitrix24.SlidingPanel.prototype;BX.Bitrix24.GroupPanel.prototype.setContent=function(){this.container.appendChild(this.content)};BX.Bitrix24.GroupPanel.prototype.animateStep=function(t){this.container.style.transform="translateX("+t.translateX+"%)";this.overlay.style.backgroundColor="rgba(0, 0, 0, "+t.opacity/100+")"};BX.Bitrix24.GroupPanel.prototype.open=function(){BX.onCustomEvent("BX.Bitrix24.GroupPanel:onBeforeOpen",[this]);if(window.pulse_loading&&window.pulse_loading.open){window.pulse_loading.close(true)}this.container.style.display="block";BX.addClass(this.menu.parentNode,"menu-item-block-hover");this.menu.innerHTML=BX.message("menu_hide");var t=BX.pos(this.leftMenu);this.overlay.style.left=t.right+"px";this.super.open.apply(this,arguments);BX.onCustomEvent("BX.Bitrix24.GroupPanel:onOpen",[this])};BX.Bitrix24.GroupPanel.prototype.close=function(){BX.onCustomEvent("BX.Bitrix24.GroupPanel:onBeforeClose",[this]);this.menu.innerHTML=BX.message("menu_show");this.super.close.apply(this,arguments);BX.onCustomEvent("BX.Bitrix24.GroupPanel:onClose",[this])};BX.Bitrix24.GroupPanel.prototype.onTrasitionEnd=function(){this.super.onTrasitionEnd.apply(this,arguments);if(!this.isOpen){this.leftMenu.style.removeProperty("z-index");BX.removeClass(this.menu.parentNode,"menu-item-block-hover")}};BX.Bitrix24.GroupPanel.prototype.onMenuClick=function(t){if(this.isOpen){this.close()}else{this.open()}t.stopPropagation()};BX.Bitrix24.GroupPanel.prototype.onFilterClick=function(t){var i=BX.type.isDomNode(BX.proxy_context)?BX.proxy_context:null;var e=this.content.dataset.filter?this.content.dataset.filter:"all";var n=i.dataset.filter?i.dataset.filter:"all";if(e!==n){this.content.dataset.filter=n;this.saveFilter(n);new BX.easing({duration:50,start:{opacity:1},finish:{opacity:0},transition:BX.easing.transitions.linear,step:BX.delegate(function(t){this.items.style.opacity=t.opacity/100},this),complete:BX.delegate(function(){BX.removeClass(this.content,"group-panel-content-"+e);BX.addClass(this.content,"group-panel-content-"+n);new BX.easing({duration:50,start:{opacity:0},finish:{opacity:1},transition:BX.easing.transitions.linear,step:BX.delegate(function(t){this.items.style.opacity=t.opacity/100},this),complete:BX.delegate(function(){this.items.style.cssText=""},this)}).animate()},this)}).animate()}t.stopPropagation()};BX.Bitrix24.GroupPanel.prototype.onItemsClick=function(t){if(!BX.hasClass(t.target,"group-panel-item-star")){return}var i=t.target;var e=i.parentNode;var n=e.dataset.id;var s=BX.hasClass(e,"group-panel-item-favorite")?"remove_from_favorites":"add_to_favorites";BX.toggleClass(e,"group-panel-item-favorite");this.animateStart(i);this.animateCounter(s==="add_to_favorites");BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:s,groupId:n}});t.preventDefault()};BX.Bitrix24.GroupPanel.prototype.animateStart=function(t){var i=t.cloneNode();i.style.marginLeft="-"+t.offsetWidth+"px";t.parentNode.appendChild(i);new BX.easing({duration:200,start:{opacity:100,scale:100},finish:{opacity:0,scale:300},transition:BX.easing.transitions.linear,step:function(t){i.style.transform="scale("+t.scale/100+")";i.style.opacity=t.opacity/100},complete:function(){i.parentNode.removeChild(i)}}).animate()};BX.Bitrix24.GroupPanel.prototype.animateCounter=function(t){this.counter.innerHTML=t===false?"-1":"+1";new BX.easing({duration:400,start:{opacity:100,top:0},finish:{opacity:0,top:-20},transition:BX.easing.transitions.linear,step:function(t){this.counter.style.top=t.top+"px";this.counter.style.opacity=t.opacity/100}.bind(this),complete:function(){this.counter.style.cssText=""}.bind(this)}).animate()};BX.Bitrix24.GroupPanel.prototype.saveFilter=function(t){if(!this.ajaxPath||!BX.type.isNotEmptyString(t)){return}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_group_filter",filter:t}})};BX.Bitrix24.Map=function(t){this.containerClassName="sitemap-window";this.overlayClassName="sitemap-window-overlay";this.startParams={translateY:-100,opacity:0};this.endParams={translateY:0,opacity:65};BX.Bitrix24.SlidingPanel.apply(this,arguments);this.menu=BX("sitemap-menu");this.content=BX("sitemap-content");this.closeLink=BX("sitemap-close-link");BX.bind(this.menu,"click",this.onMenuClick.bind(this));BX.bind(this.closeLink,"click",this.close.bind(this))};BX.Bitrix24.Map.prototype=Object.create(BX.Bitrix24.SlidingPanel.prototype);BX.Bitrix24.Map.prototype.constructor=BX.Bitrix24.Map;BX.Bitrix24.Map.prototype.super=BX.Bitrix24.SlidingPanel.prototype;BX.Bitrix24.Map.prototype.setContent=function(){this.container.appendChild(this.content)};BX.Bitrix24.Map.prototype.animateStep=function(t){this.container.style.transform="translateY("+t.translateY+"%)";this.overlay.style.backgroundColor="rgba(0, 0, 0, "+t.opacity/100+")"};BX.Bitrix24.Map.prototype.open=function(){BX.onCustomEvent("BX.Bitrix24.Map:onBeforeOpen",[this]);this.menu.classList.add("sitemap-menu-open");this.super.open.apply(this,arguments)};BX.Bitrix24.Map.prototype.close=function(){this.menu.classList.remove("sitemap-menu-open");this.super.close.apply(this,arguments)};BX.Bitrix24.Map.prototype.onMenuClick=function(t){if(this.isOpen){this.close()}else{this.open()}t.stopPropagation()};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/script.min.js?165484264767600";s:6:"source";s:73:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/script.js";s:3:"min";s:77:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/script.min.js";s:3:"map";s:77:"/bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/script.map.js";}"*/
BX.namespace("BX.Bitrix24");BX.Bitrix24.LeftMenu={init:function(e){e=typeof e==="object"?e:{};this.ajaxPath=e.ajaxPath||null;this.isAdmin=e.isAdmin==="Y";this.hiddenCounters=e.hiddenCounters||[];this.allCounters=e.allCounters||{};this.allCountersInMenu={};this.isBitrix24=e.isBitrix24==="Y";this.siteId=e.siteId||null;this.siteDir=e.siteDir||null;this.isExtranet=e.isExtranet==="Y";this.isCompositeMode=e.isCompositeMode===true;this.isCollapsedMode=e.isCollapsedMode===true;this.activeItemsId=[];this.isCurrentPageInLeftMenu=false;this.currentPagePath=null;this.menuSelectedNode=null;this.showPresetPopup=e.showPresetPopup==="Y";this.showImportConfiguration=e.showImportConfiguration==="Y";this.urlImportConfiguration=e.urlImportConfiguration||"";this.isCustomPresetAvailable=e.isCustomPresetAvailable==="Y";this.customPresetExists=e.customPresetExists==="Y";this.isCurrentPageStandard=false;this.topMenuSelectedNode=null;this.topItemSelectedObj=null;this.isPublicConverted=e.isPublicConverted==="Y";this.lastScrollOffset=0;this.logoMaskNeeded=null;this.islogoMaskMode=false;this.isScrollMode=false;this.scrollModeThreshold=20;this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return false}this.templateHeaderHeight=null;this.menuHeader=this.menuContainer.querySelector(".menu-items-header");this.menuBody=this.menuContainer.querySelector(".menu-items-body");this.menuMoreButton=this.menuContainer.querySelector(".menu-favorites-more-btn");this.menuItemsBlock=this.menuContainer.querySelector(".menu-items");this.inviteEmployeesBox=this.menuContainer.querySelector(".menu-invite-employees");this.licenseBox=this.menuContainer.querySelector(".menu-license-all-container");this.settingsBox=this.menuContainer.querySelector(".menu-settings-btn");this.settingsIconBox=this.settingsBox.querySelector(".menu-settings-icon-box");this.settingsBtnText=this.settingsBox.querySelector(".menu-settings-btn-text");this.settingsSaveBtn=this.menuContainer.querySelector(".menu-settings-save-btn");this.timeout={};this.highlight(document.location.pathname+document.location.search);this.makeTextIcons();this.handleMenuItemMouseEnter=this.handleMenuItemMouseEnter.bind(this);this.handleMenuItemMouseClick=this.handleMenuItemMouseClick.bind(this);this.templateHeaderHeight=null;this.fixedAdminPanelHeight=0;this.adminPanel=BX("bx-panel");this.adminPanelHeight=null;if(this.adminPanel){var t=BX.getClass("BX.admin.panel.state");if(t&&t.fixed){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}BX.addCustomEvent("onTopPanelCollapse",this.handleAdminPanelCollapse.bind(this));BX.addCustomEvent("onTopPanelFix",this.handleAdminPanelFix.bind(this));this.adjustAdminPanel()}document.addEventListener("scroll",this.handleDocumentScroll.bind(this));this.slidingModeTimeoutId=null;BX.bind(this.menuContainer,"dblclick",this.handleMenuDoubleClick.bind(this));BX.bind(this.menuContainer,"mouseenter",this.handleMenuMouseEnter.bind(this));BX.bind(this.menuContainer,"mouseleave",this.handleMenuMouseLeave.bind(this));BX.bind(this.menuContainer,"transitionend",this.handleSlidingTransitionEnd.bind(this));this.isMenuMouseEnterBlocked=false;this.isMenuMouseLeaveBlocked=false;this.mainTable=document.querySelector(".bx-layout-table");this.header=document.querySelector("#header");this.headerBurger=this.header.querySelector(".menu-switcher");this.headerLogo=this.header.querySelector(".logo");this.headerLogoBlock=this.header.querySelector(".header-logo-block");this.headerSettings=this.header.querySelector(".header-logo-block-settings");this.menuHeaderLogo=this.menuHeader.querySelector(".logo");this.menuHeaderBurger=this.menuHeader.querySelector(".menu-switcher");this.menuHeaderTitle=this.menuHeader.querySelector(".menu-items-header-title");this.livefeedCounter={decrementStack:0,value:0};if(this.headerSettings){BX.bind(this.headerLogoBlock,"mouseenter",this.handleHeaderLogoMouserEnter.bind(this));BX.bind(this.headerLogoBlock,"mouseleave",this.handleHeaderLogoMouserLeave.bind(this));BX.bind(this.menuHeader,"mouseenter",this.handleHeaderLogoMouserEnter.bind(this));BX.bind(this.menuHeader,"mouseleave",this.handleHeaderLogoMouserLeave.bind(this))}BX.bind(this.menuHeaderBurger,"click",this.handleBurgerClick.bind(this));BX.bind(this.menuHeaderTitle,"click",this.handleBurgerClick.bind(this,true));this.siteMapItem=this.menuContainer.querySelector(".menu-sitemap-btn");if(this.siteMapItem){BX.bind(this.siteMapItem,"click",this.handleSiteMapClick.bind(this));BX.bind(this.siteMapItem,"click",this.handleMenuItemMouseClick);BX.bind(this.siteMapItem,"mouseenter",this.handleMenuItemMouseEnter)}this.upButton=this.menuContainer.querySelector(".menu-btn-arrow-up");BX.bind(this.upButton,"click",this.handleUpButtonClick.bind(this));BX.bind(this.upButton,"mouseenter",this.handleUpButtonMouseEnter.bind(this));BX.bind(this.upButton,"mouseleave",this.handleUpButtonMouseLeave.bind(this));BX.bind(BX("left-menu-hidden-separator"),"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.menuMoreButton,"click",BX.proxy(this.showHideMoreItems,this));BX.bind(this.settingsBox,"mouseenter",this.handleMenuItemMouseEnter);BX.bind(this.settingsBox,"click",this.showSettingsPopup.bind(this));BX.bind(this.settingsBox,"click",this.handleMenuItemMouseClick);BX.bind(this.settingsSaveBtn,"click",function(){this.applyEditMode()}.bind(this));if(this.inviteEmployeesBox){BX.bind(this.inviteEmployeesBox,"mouseenter",this.handleMenuItemMouseEnter)}if(this.licenseBox){BX.bind(this.licenseBox,"mouseenter",this.handleMenuItemMouseEnter)}jsDD.Enable();if(BX.type.isDomNode(this.menuItemsBlock)){var i=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var n=0;n<i.length;n++){i[n].onbxdragstart=BX.proxy(this.menuItemDragStart,this);i[n].onbxdrag=BX.proxy(this.menuItemDragMove,this);i[n].onbxdragstop=BX.proxy(this.menuItemDragStop,this);i[n].onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(i[n],100);jsDD.registerObject(i[n]);BX.bind(i[n],"mouseenter",this.handleMenuItemMouseEnter);BX.bind(i[n],"click",this.handleMenuItemMouseClick)}}BX.addCustomEvent("BX.Bitrix24.GroupPanel:onOpen",this.handleGroupPanelOpen.bind(this));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onClose",this.handleGroupPanelClose.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",BX.proxy(function(e,t){this.onTopMenuFirstItemChange(e,t)},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",BX.proxy(function(e){this.showMessage(e,BX.message("MENU_TOP_ITEM_LAST_HIDDEN"))},this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",function(e,t,i){var n=BX.type.isDomNode(BX("bx_left_menu_"+t.DATA_ID));e.addMenuItem({text:BX.message(n?"MENU_DELETE_FROM_LEFT_MENU":"MENU_ADD_TO_LEFT_MENU"),onclick:function(i,s){var a={id:t.DATA_ID,text:BX.util.htmlspecialcharsback(t.TEXT),subLink:t.SUB_LINK,counterId:t.COUNTER_ID,counterValue:t.COUNTER};var o=document.createElement("a");o.href=t.URL;a.link=BX.util.htmlspecialcharsback(o.pathname+o.search);a.link=a.link[0]!=="/"?"/"+a.link:a.link;if(n){this.deleteStandardItem({itemId:t.DATA_ID})}else{var r="",u="";if(BX.type.isDomNode(t.NODE)){var l=t.NODE.getBoundingClientRect();r=l.left;u=l.top}this.addStandardItem({itemInfo:a,startX:r,startY:u})}BX.PopupMenu.destroy(e.id)}.bind(this)})}.bind(this));top.BX.addCustomEvent("UI.Toolbar:onRequestMenuItemData",function(e){this.onRequestMenuItemData(e)}.bind(this));BX.addCustomEvent("UI.Toolbar:onStarClick",function(e){this.onToolbarStarClick(e)}.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",function(e){e.push(function(){var e=new BX.Promise;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"},onsuccess:function(){e.fulfill()},onfailure:function(t){e.reject("Error: "+t)}});return e}.bind(this))}.bind(this));if(this.showPresetPopup){this.showPresetPopupFunction("global")}else{if(this.showImportConfiguration){this.showImportConfigurationSlider()}}this.menuSelectedNode=BX.findChild(this.menuContainer,{className:"menu-item-active"},true,false);if(BX.type.isDomNode(this.menuSelectedNode)){var s=this.menuSelectedNode.getAttribute("data-link")}var a=document.location.pathname;var o=document.location.pathname+document.location.search;if(s===a||s===o){this.isCurrentPageInLeftMenu=true}this.handleDocumentScroll();return true},isEditMode:function(){return BX.hasClass(this.menuContainer,"menu-favorites-editable")},isCollapsed:function(){return this.isCollapsedMode},switchToEditMode:function(){if(this.isEditMode()){return}this.toggle(true);BX.addClass(this.menuContainer,"menu-favorites-editable");var e=this.menuContainer.querySelectorAll(".menu-item-active");for(var t=0;t<e.length;t++){BX.removeClass(e[t],"menu-item-active");this.activeItemsId.push(e[t].id)}},applyEditMode:function(){if(!this.isEditMode()){return}BX.removeClass(this.menuContainer,"menu-favorites-editable");for(var e in this.activeItemsId){BX.addClass(BX(this.activeItemsId[e]),"menu-item-active")}this.activeItemsId=[]},areMoreItemsShowed:function(){return BX.hasClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")?true:false},animateShowingHiddenItems:function(){var e=BX("left-menu-hidden-items-block");if(!BX.hasClass(e,"menu-item-favorites-more-open")){e.style.height="0px";e.style.opacity=0;t(true,e,e.scrollHeight)}else{t(false,e,e.offsetHeight)}function t(e,t,i){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:i},finish:{opacity:e?100:0,height:e?i:0},transition:BX.easing.transitions.linear,step:function(e){t.style.opacity=e.opacity/100;t.style.height=e.height+"px"},complete:function(){BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open");t.style.overflow="";t.style.height=""}}).animate()}},showHideMoreItems:function(e){if(this.isEditMode())return;if(e!==false){this.animateShowingHiddenItems()}else{BX.toggleClass(BX("left-menu-hidden-items-block"),"menu-item-favorites-more-open")}BX.toggleClass(this.menuMoreButton,"menu-favorites-more-btn-open");var t=BX("menu-more-btn-text");if(t){if(t.innerHTML===BX.message("more_items_hide")){t.innerHTML=BX.message("more_items_show")}else{t.innerHTML=BX.message("more_items_hide")}}},openMenuPopup:function(e,t){var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i))return;var n=[];var s=i.getAttribute("data-delete-perm");var a=i.getAttribute("data-type");if(i.getAttribute("data-status")==="show"){n.push({text:BX.message("hide_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.hideItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(i.getAttribute("data-status")==="hide"){n.push({text:BX.message("show_item"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showItem(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(!this.isExtranet&&a!=="self"&&BX.previousSibling(i).id!="left-menu-empty-item"&&this.isPublicConverted){n.push({text:BX.message("MENU_SET_MAIN_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.setMainPage(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(a==="self"){n.push({text:BX.message("MENU_DELETE_SELF_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.showConfirmWindow({id:"left-menu-delete-self-item",titleBar:BX.message("MENU_DELETE_SELF_ITEM"),okButtonText:BX.message("MENU_DELETE"),content:BX.message("MENU_DELETE_SELF_ITEM_CONFIRM"),onsuccess:BX.proxy(function(){this.deleteSelfItem(t);BX.PopupMenu.destroy("popup_"+t)},this),onfailure:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t)},this)})},this)});n.push({text:BX.message("MENU_EDIT_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var n=BX.proxy_context;n.popupWindow.close();var s=BX.findChild(i,{tagName:"a"},true,false);var a={id:t,text:i.querySelector("[data-role='item-text']").innerText,link:i.getAttribute("data-link"),openInNewPage:s.getAttribute("target")=="_blank"};this.showSelfItemPopup(e,a);BX.PopupMenu.destroy("popup_"+t)},this)})}if(a==="standard"){n.push({text:BX.message("MENU_RENAME_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var n={id:t,text:i.querySelector("[data-role='item-text']").innerText};this.showStandardEditItemPopup(e,n);BX.PopupMenu.destroy("popup_"+t)},this)});n.push({text:BX.message("MENU_REMOVE_STANDARD_ITEM"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){var e=BX.proxy_context;e.popupWindow.close();this.deleteStandardItem({itemId:t});BX.PopupMenu.destroy("popup_"+t)},this)})}if(this.isAdmin){if(s==="Y"){n.push({text:BX.message("MENU_ADD_ITEM_TO_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.addItemToAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}if(s==="A"){if(a==="custom"){n.push({text:BX.message("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteCustomItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}else{n.push({text:BX.message("MENU_DELETE_ITEM_FROM_ALL"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){this.deleteItemFromAll(t);BX.PopupMenu.destroy("popup_"+t)},this)})}}}n.push({text:this.isEditMode()?BX.message("MENU_EDIT_READY_FULL"):BX.message("MENU_SETTINGS_MODE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.PopupMenu.destroy("popup_"+t);this.isEditMode()?this.applyEditMode():this.switchToEditMode()},this)});BX.PopupMenu.show({id:"popup_"+t,bindElement:e,items:n,offsetTop:0,offsetLeft:12,angle:true,events:{onPopupShow:function(){this.isMenuMouseLeaveBlocked=true;BX.addClass(i,"menu-item-block-hover")}.bind(this),onPopupClose:function(){this.isMenuMouseLeaveBlocked=false;BX.removeClass(i,"menu-item-block-hover")}.bind(this),onPopupDestroy:function(){this.isMenuMouseLeaveBlocked=false;BX.removeClass(i,"menu-item-block-hover")}.bind(this)}})},showSettingsPopup:function(e){var t="leftMenuSettingsPopup";if(BX.PopupMenu.getMenuById(t)){BX.PopupMenu.destroy(t);return}var i=this;var n="default";if(BX.type.isDomNode(this.menuSelectedNode)){n=this.menuSelectedNode.getAttribute("data-type")}if(this.isCurrentPageInLeftMenu&&n==="default"){s={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon menu-popup-disable-text"}}else{var s={text:BX.message(this.isCurrentPageInLeftMenu?"MENU_DELETE_PAGE_FROM_LEFT_MENU":"MENU_ADD_PAGE_TO_LEFT_MENU"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();if(this.isCurrentPageInLeftMenu){this.deleteStandardItem({})}else{this.addStandardItem({})}},this)}}var a=[{text:BX.message("SORT_ITEMS"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.switchToEditMode()}},{text:this.isCollapsedMode?BX.message("MENU_EXPAND"):BX.message("MENU_COLLAPSE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.toggle()},this)},s,{text:BX.message("MENU_ADD_SELF_PAGE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close();this.showSelfItemPopup(this.settingsBox)},this)}];if(!this.isExtranet){a.push({text:BX.message("MENU_SET_DEFAULT2"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu(true)}})}a.push({text:BX.message("MENU_SET_DEFAULT"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close();i.setDefaultMenu()}});if(this.isAdmin){var o=BX.message("MENU_SAVE_CUSTOM_PRESET");var r=!this.isCustomPresetAvailable;if(r){o+="<span class='menu-lock-icon'></span>"}a.push({text:o,className:"menu-popup-no-icon"+(r?" menu-popup-disable-text":""),onclick:function(){this.popupWindow.close();if(r){BX.UI.InfoHelper.show("limit_office_menu_to_all")}else{i.showCustomPresetPopup()}}})}BX.PopupMenu.show(t,this.settingsBox,a,{offsetTop:0,offsetLeft:50,angle:true,events:{onPopupShow:function(){this.isMenuMouseLeaveBlocked=true}.bind(this),onPopupClose:function(){this.isMenuMouseLeaveBlocked=false;this.switchToSlidingMode(false);BX.PopupMenu.destroy(t)}.bind(this),onPopupDestroy:function(){this.isMenuMouseLeaveBlocked=false;this.switchToSlidingMode(false)}.bind(this)}})},showMessage:function(e,t,i){var n=BX.PopupWindowManager.create("left-menu-message",e,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:i==="right"?-45:2,offsetLeft:i==="right"?215:0,angle:i==="right"?{position:"left"}:true,events:{onPopupClose:function(){if(n){n.destroy();n=null}}},autoHide:true});n.show();setTimeout(function(){if(n){n.destroy();n=null}},3e3)},showError:function(e){this.showMessage(e,BX.message("edit_error"))},onTopMenuFirstItemChange:function(e,t){if(!e)return;var i=t.getAttribute("data-top-menu-id");var n=this.menuItemsBlock.querySelector("[data-top-menu-id='"+i+"']");if(BX.type.isDomNode(n)){n.setAttribute("data-link",e);var s=BX.findChild(n,{tagName:"a",className:"menu-item-link"},true,false);if(s){s.setAttribute("href",e)}}if(BX.type.isDomNode(t)){this.showMessage(t,BX.message("MENU_ITEM_MAIN_SECTION_PAGE"))}if(BX.type.isDomNode(n)&&BX.previousSibling(n)===BX("left-menu-empty-item")){var a={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_first_page",firstPageUrl:e}}else{a={sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"clear_cache"}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:a,onsuccess:BX.proxy(function(){},this),onfailure:function(){}})},showSelfItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var n=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("label",{attrs:{for:"menuPageToFavoriteLink",className:"menu-form-label"},html:BX.message("MENU_ITEM_LINK")}),BX.create("input",{attrs:{value:i?t.link:"",name:"menuPageToFavoriteLink",type:"text",className:"menu-form-input"}}),BX.create("br"),BX.create("br"),BX.create("input",{attrs:{value:"",name:"menuOpenInNewPage",type:"checkbox",checked:!i||t.openInNewPage?"checked":"",id:"menuOpenInNewPage"}}),BX.create("label",{attrs:{for:"menuOpenInNewPage",className:"menu-form-label"},html:BX.message("MENU_OPEN_IN_NEW_PAGE")})]});if(i){n.appendChild(BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}}))}BX.PopupWindowManager.create("menu-self-item-popup",e,{closeIcon:true,offsetTop:1,offsetLeft:20,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:i?BX.message("MENU_EDIT_SELF_PAGE"):BX.message("MENU_ADD_SELF_PAGE"),content:n,buttons:[button=new BX.PopupWindowButton({text:i?BX.message("MENU_SAVE_BUTTON"):BX.message("MENU_ADD_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var n=e.elements["menuPageToFavoriteName"];var s=e.elements["menuPageToFavoriteLink"];var a=e.elements["menuOpenInNewPage"].checked;var o=BX.util.trim(n.value);var r=this.refineUrl(s.value);if(!o||!r){if(!r){BX.addClass(s,"menu-form-input-error");s.focus()}if(!o){BX.addClass(n,"menu-form-input-error");n.focus()}}else{BX.addClass(button.buttonNode,"popup-window-button-wait");BX.removeClass(n,"menu-form-input-error");BX.removeClass(s,"menu-form-input-error");var u={text:o,link:r,openInNewPage:a?"Y":"N"};if(i){u.id=t.id}this.saveSelfItem(i?"edit":"add",u,this.onSelfItemSave.bind(this))}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()},onPopupShow:function(){var e=document.forms["menuAddToFavoriteForm"];var t=e.elements["menuPageToFavoriteName"];t&&setTimeout(function(){t.focus()},100)}}}).show()},onSelfItemSave:function(e){if(e){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:e})}else{BX.PopupWindowManager.getCurrentPopup().destroy()}},saveSelfItem:function(e,t,i){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e==="edit"?"":"?analyticsLabel=selfItem"),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:e==="edit"?"update_self_item":"add_self_item"},onsuccess:BX.proxy(function(n){if(n.hasOwnProperty("error")){i(n.error)}else{var s={text:t.text,link:t.link,type:"self",openInNewPage:t.openInNewPage==="Y"?"Y":"N"};if(e==="add"&&n.hasOwnProperty("itemId")){s.id=n.itemId;this.generateItemHtml(s)}else if(e==="edit"){s.id=t.id;this.updateItemHtml(s)}i("")}},this),onfailure:function(){i()}})},deleteSelfItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(t.getAttribute("data-delete-perm")==="A"){this.deleteItemFromAll(e)}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_self_item",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this),onfailure:function(){}})},refineUrl:function(e){e=BX.util.trim(e);if(!BX.type.isNotEmptyString(e)){return""}if(!e.match(/^https?:\/\//i)&&!e.match(/^\//i)){e="http://"+e}else{var t=document.createElement("a");t.href=e;if(document.location.host===t.host){e=t.pathname+t.search+t.hash}}return e},addItemToAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-link"),n=t.querySelector("[data-role='item-text']"),s=n.innerText,a=t.getAttribute("data-counter-id"),o=BX.findChild(t,{tagName:"a"},true,false),r=BX.type.isDomNode(o)&&o.hasAttribute("target")&&o.getAttribute("target")==="_blank";BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"add_item_to_all",itemInfo:{id:e,link:i,text:s,counterId:a,openInNewPage:r?"Y":"N"}},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","A");this.showMessage(t,BX.message("MENU_ITEM_WAS_ADDED_TO_ALL"))}},this)})},deleteItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{t.setAttribute("data-delete-perm","Y");this.showMessage(t,BX.message("MENU_ITEM_WAS_DELETED_FROM_ALL"))}},this)})},deleteCustomItemFromAll:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;var i=t.getAttribute("data-type");if(i!=="custom")return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"delete_custom_item_from_all",menu_item_id:e},onsuccess:BX.proxy(function(e){if(e.error){this.showError(t)}else{BX.remove(t)}},this)})},updateDesktopCounter:function(){if(typeof BXIM==="undefined"){return}var e=0;for(var t in this.allCountersInMenu){if(t!=="im-message"){e+=parseInt(this.allCountersInMenu[t])}}if(e<0){e=0}else if(e>99){e="99"}BXIM.desktop.setBrowserIconBadge(e)},updateCounters:function(e,t){t=t!==false;var i=0;for(var n in e){if(!e.hasOwnProperty(n)){continue}this.allCounters[n]=e[n];var s=BX(n==="**"?"menu-counter-live-feed":"menu-counter-"+n.toLowerCase(),true);if(s){if(n==="**"){this.livefeedCounter.value=e[n];if(e[n]<=0){this.livefeedCounter.decrementStack=0}i=this.livefeedCounter.value-this.livefeedCounter.decrementStack}else{i=e[n]}this.allCountersInMenu[n]=i;if(i>0){s.innerHTML=i>99?"99+":i;BX.addClass(s.parentNode.parentNode.parentNode,"menu-item-with-index")}else{BX.removeClass(s.parentNode.parentNode.parentNode,"menu-item-with-index");if(i<0){var a=BX("menu-counter-warning-"+n.toLowerCase());if(a){a.style.display="inline-block"}}}if(t){BX.localStorage.set("lmc-"+n,e[n],5)}}}var o=0;for(var r=0,u=this.hiddenCounters.length;r<u;r++){if(this.allCounters[this.hiddenCounters[r]]){o+=+this.allCounters[this.hiddenCounters[r]]}}if(BX.type.isDomNode(BX("menu-hidden-counter"))){if(o>0){BX.removeClass(BX("menu-hidden-counter"),"menu-hidden-counter")}else{BX.addClass(BX("menu-hidden-counter"),"menu-hidden-counter")}BX("menu-hidden-counter").innerHTML=o>99?"99+":o}this.updateDesktopCounter()},decrementCounter:function(e,t){if(!e)return;t=parseInt(t);if(e.id=="menu-counter-live-feed"){this.livefeedCounter.decrementStack+=t;var i=this.livefeedCounter.value-this.livefeedCounter.decrementStack;if(i>0){e.innerHTML=i}else{BX.removeClass(e.parentNode.parentNode.parentNode,"menu-item-with-index")}}},recountHiddenCounters:function(){var e=0;var t=BX.findChildren(BX("left-menu-hidden-items-list"),{className:"menu-item-block"},true);this.hiddenCounters=[];if(t){for(var i=0,n=t.length;i<n;i++){var s=t[i].getAttribute("data-counter-id");this.hiddenCounters.push(s);if(this.allCounters[s]){e+=Number(this.allCounters[s])}}}if(e>0){BX.removeClass(BX("menu-hidden-counter"),"menu-hidden-counter")}else{BX.addClass(BX("menu-hidden-counter"),"menu-hidden-counter")}BX("menu-hidden-counter").innerHTML=e>99?"99+":e},checkMoreButton:function(e){var t=this.menuMoreButton;if(e===true||e===false){if(e){BX.removeClass(t,"menu-favorites-more-btn-hidden")}else{BX.addClass(t,"menu-favorites-more-btn-hidden")}return e}var i=BX("left-menu-hidden-items-list").getElementsByClassName("menu-item-block");if(i.length>0){BX.removeClass(t,"menu-favorites-more-btn-hidden");return true}else{BX.addClass(t,"menu-favorites-more-btn-hidden");return false}},hideItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;t.setAttribute("data-status","hide");BX("left-menu-hidden-items-list").appendChild(t);this.checkMoreButton(true);if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=hideItem&itemId="+e)},showItem:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){t.setAttribute("data-status","show");this.menuItemsBlock.insertBefore(t,BX("left-menu-hidden-items-block"))}this.checkMoreButton();if(t.getAttribute("data-counter-id")){this.recountHiddenCounters()}this.saveItemsSort("?analyticsLabel=showItem&itemId="+e)},saveItemsSort:function(e){var t=[],i=[],n="";var s=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var a=0;a<s.length;a++){if(a===0){n=s[a].getAttribute("data-link")}if(s[a].getAttribute("data-status")==="show"){t.push(s[a].getAttribute("data-id"))}else if(s[a].getAttribute("data-status")==="hide"){i.push(s[a].getAttribute("data-id"))}}var o={show:t,hide:i};BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+(e?e:""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"save_items_sort",items:o,firstItemLink:n},onsuccess:function(e){},onfailure:function(){}})},showItemWarning:function(e){e=BX.type.isPlainObject(e)?e:{};var t=BX.type.isNotEmptyString(e.itemId)?e.itemId:"";var i=BX("bx_left_menu_"+t);if(!BX.type.isDomNode(i)){return}this.removeItemWarning(t);var n=BX.create("a",{props:{className:"menu-post-warn-icon"},attrs:{title:BX.type.isNotEmptyString(e.title)?e.title:""},events:BX.type.isNotEmptyObject(e.events)?e.events:{}});var s=i.querySelector(".menu-item-link");if(s){BX.addClass(i,"menu-item-warning-state");s.appendChild(n)}},removeItemWarning:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t)){return}var i=t.querySelector(".menu-post-warn-icon");if(i){BX.remove(i)}BX.removeClass(t,"menu-item-warning-state")},animateTopItemToLeft:function(e,t,i,n){if(typeof e!=="object")return;var s=BX.create("div",{text:e.text,attrs:{style:"position: absolute; z-index: 1000;"}});s.style.top=i+25+"px";document.body.appendChild(s);var a=this.menuItemsBlock.getBoundingClientRect().bottom;if(this.areMoreItemsShowed()){a-=BX("left-menu-hidden-items-list").offsetHeight}if(!n){BX.remove(s);e.type="standard";this.isCurrentPageInLeftMenu=true;this.generateItemHtml(e);this.saveItemsSort();return}new BX.easing({duration:500,start:{left:t},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.left=e.left+"px"},complete:BX.proxy(function(){new BX.easing({duration:500,start:{top:i+25},finish:{top:a},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.top=e.top+"px"},complete:BX.proxy(function(){BX.remove(s);e.type="standard";this.isCurrentPageInLeftMenu=true;this.generateItemHtml(e);this.saveItemsSort()},this)}).animate()},this)}).animate()},addStandardItem:function(e){var t=e.itemInfo;var i=e.startX;var n=e.startY;var s=!e.context||e.context===top.window;var a=false;if(typeof t!=="object"){a=true;this.checkCurrentPageInTopMenu();if(this.isCurrentPageStandard&&BX.type.isDomNode(this.topMenuSelectedNode)){var o=this.topMenuSelectedNode.getBoundingClientRect();i=o.left;n=o.top;t={id:this.topItemSelectedObj.DATA_ID,text:this.topItemSelectedObj.TEXT,link:BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:this.topItemSelectedObj.URL,counterId:this.topItemSelectedObj.COUNTER_ID,counterValue:this.topItemSelectedObj.COUNTER,isStandardItem:true,subLink:this.topItemSelectedObj.SUB_LINK}}else{var r=BX.type.isNotEmptyString(e.pageTitle)?e.pageTitle:document.getElementById("pagetitle").innerText;var u="";if(BX.type.isNotEmptyString(e.pageLink)){u=e.pageLink}else{u=BX.type.isNotEmptyString(this.currentPagePath)?this.currentPagePath:document.location.pathname+document.location.search}t={text:r,link:u,isStandardItem:false}}}if(!i||!n){var l=BX("pagetitle").getBoundingClientRect();i=l.left;n=l.top}var d=this.ajaxPath;d=BX.util.add_url_param(d,{b24statAction:"addFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:d,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:t,action:"add_standard_item"},onsuccess:BX.proxy(function(o){if(o.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:o.error})}else{if(o.hasOwnProperty("itemId")){t.id=o.itemId;BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[t,this]);this.animateTopItemToLeft(t,i,n,s);this.onStandardItemChangedSuccess({isCurrentPage:a,isActive:true,context:e.context});this.isCurrentPageInLeftMenu=true}}},this),onfailure:function(){}})},deleteStandardItem:function(e){var t=e.itemId;var i=!e.context||e.context===top.window;var n={};this.checkCurrentPageInTopMenu();if(t&&BX.type.isDomNode(BX("bx_left_menu_"+t))){n={id:t}}else if(this.isCurrentPageStandard&&this.topItemSelectedObj.DATA_ID){n={id:this.topItemSelectedObj.DATA_ID}}else{n={link:BX.type.isNotEmptyString(e.pageLink)?e.pageLink:document.location.pathname+document.location.search}}var s=this.ajaxPath;s=BX.util.add_url_param(s,{b24statAction:"removeFavMenuItem"});BX.ajax({method:"POST",dataType:"json",url:s,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemData:n,action:"delete_standard_item"},onsuccess:BX.proxy(function(n){if(n.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:n.error})}else{if(n.hasOwnProperty("itemId")){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[n,this]);var s=BX("bx_left_menu_"+n.itemId);if(!BX.type.isDomNode(s))return;if(s.getAttribute("data-delete-perm")==="A"){this.deleteItemFromAll(n.itemId)}this.onStandardItemChangedSuccess({isCurrentPage:!t,isActive:false,context:e.context});this.animateTopItemFromLeft("bx_left_menu_"+n.itemId,i);this.isCurrentPageInLeftMenu=false}}},this),onfailure:function(){}})},updateStandardItem:function(e){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,itemText:e.text,itemId:e.id,action:"update_standard_item"},onsuccess:BX.proxy(function(t){if(t.hasOwnProperty("error")){this.showConfirmWindow({alertMode:true,titleBar:BX.message("MENU_ERROR_OCCURRED"),content:t.error})}else{this.updateItemHtml(e);BX.PopupWindowManager.getCurrentPopup().destroy()}},this),onfailure:function(){}})},showStandardEditItemPopup:function(e,t){var i=false;if(typeof t==="object"&&t){i=true}var n=BX.create("form",{attrs:{name:"menuAddToFavoriteForm"},children:[BX.create("label",{attrs:{for:"menuPageToFavoriteName",className:"menu-form-label"},html:BX.message("MENU_ITEM_NAME")}),BX.create("input",{attrs:{value:i?t.text:"",name:"menuPageToFavoriteName",type:"text",className:"menu-form-input"}}),BX.create("input",{attrs:{name:"menuItemId",type:"hidden",value:t.id}})]});BX.PopupWindowManager.create("menu-standard-item-popup-edit",e,{closeIcon:true,offsetTop:1,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_RENAME_ITEM"),content:n,buttons:[new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){var e=document.forms["menuAddToFavoriteForm"];var i=e.elements["menuPageToFavoriteName"];var n=BX.util.trim(i.value);if(!n){BX.addClass(i,"menu-form-input-error");i.focus()}else{BX.removeClass(i,"menu-form-input-error");var s={text:n,id:t.id};this.updateStandardItem(s)}},this)}}),new BX.PopupWindowButtonLink({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}})],events:{onPopupClose:function(){BX.PopupWindowManager.getCurrentPopup().destroy()}}}).show()},animateTopItemFromLeft:function(e,t){if(!BX.type.isDomNode(BX(e))){return}if(!t){BX.remove(BX(e));this.isCurrentPageInLeftMenu=false;this.saveItemsSort();return}new BX.easing({duration:700,start:{left:BX(e).offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){BX(e).style.paddingLeft=t.left+"px";BX(e).style.opacity=t.opacity},complete:BX.proxy(function(){BX.remove(BX(e));this.isCurrentPageInLeftMenu=false;this.saveItemsSort()},this)}).animate()},generateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=[BX.create("span",{attrs:{className:"menu-item-icon-box"},children:[BX.create("span",{attrs:{className:"menu-item-icon"},text:this.getShortName(e.text)})]}),BX.create("span",{text:e.text,attrs:{className:"menu-item-link-text","data-role":"item-text"}})];var i=BX.type.isNotEmptyString(e.counterId);if(i){t.push(BX.create("span",{attrs:{className:"menu-item-index-wrap"},children:[BX.create("span",{attrs:{className:"menu-item-index",id:"menu-counter-"+e.counterId},html:e.counterValue})]}))}var n=this;var s=BX.create("li",{attrs:{className:"menu-item-block menu-item-no-icon-state "+(i&&e.counterValue?" menu-item-with-index":""),id:"bx_left_menu_"+e.id,"data-type":e.type==="standard"?"standard":"self","data-delete-perm":"Y","data-id":e.id,"data-link":e.link,"data-status":"show","data-new-page":e.openInNewPage==="Y"?"Y":"N"},children:[BX.create("span",{attrs:{className:"menu-fav-editable-btn menu-favorites-btn"},children:[BX.create("span",{attrs:{className:"menu-favorites-btn-icon"}})],events:{click:BX.proxy(function(){this.openMenuPopup(BX.proxy_context,e.id)},this)}}),BX.create("span",{attrs:{className:"menu-favorites-btn menu-favorites-draggable"},children:[BX.create("span",{attrs:{className:"menu-fav-draggable-icon"}})],events:{onmousedown:function(){BX.addClass(this.parentNode,"menu-item-draggable")},onmouseup:function(){BX.removeClass(this.parentNode,"menu-item-draggable")}}}),BX.create("a",{attrs:{href:e.link,className:"menu-item-link",target:e.openInNewPage==="Y"?"_blank":""},children:t})]});if(BX.type.isDomNode(this.menuItemsBlock)){this.menuItemsBlock.insertBefore(s,BX("left-menu-hidden-items-block"))}s.onbxdragstart=BX.proxy(this.menuItemDragStart,this);s.onbxdrag=BX.proxy(this.menuItemDragMove,this);s.onbxdragstop=BX.proxy(this.menuItemDragStop,this);s.onbxdraghover=BX.proxy(this.menuItemDragHover,this);jsDD.registerDest(s,100);jsDD.registerObject(s)},updateItemHtml:function(e){if(!(typeof e=="object"&&e))return;var t=BX("bx_left_menu_"+e.id);if(!BX.type.isDomNode(t))return;if(e.link){t.setAttribute("data-link",e.link);var i=BX.findChild(t,{tagName:"a"},true,false);if(BX.type.isDomNode(i)){i.setAttribute("href",e.link);if(e.hasOwnProperty("openInNewPage")){i.setAttribute("target",e.openInNewPage=="Y"?"_blank":"");t.setAttribute("data-new-page",e.openInNewPage=="Y"?"Y":"N")}}}if(e.text){var n=t.querySelector("[data-role='item-text']");if(BX.type.isDomNode(n)){n.textContent=e.text;var s=t.querySelector(".menu-item-icon");if(s){s.textContent=this.getShortName(n.textContent)}}}},setMainPage:function(e){var t=BX("bx_left_menu_"+e);if(!BX.type.isDomNode(t))return;if(BX.type.isDomNode(this.menuItemsBlock)){if(t.getAttribute("data-status")=="hide"){t.setAttribute("data-status","show")}var i=t.offsetTop;var n=BX.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:i}});var s=t.nextElementSibling;if(s){t.parentNode.insertBefore(n,s)}else{t.parentNode.appendChild(n)}n.appendChild(t);BX.addClass(t,"menu-item-draggable");new BX.easing({duration:500,start:{top:i},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){n.style.top=e.top+"px"},complete:BX.proxy(function(){this.menuItemsBlock.insertBefore(t,BX("left-menu-empty-item").nextSibling);BX.removeClass(t,"menu-item-draggable");BX.remove(n);this.saveItemsSort("?analyticsLabel=mainPage&itemId="+e)},this)}).animate()}},showConfirmWindow:function(e){e=e||{};var t=BX.type.isNotEmptyString(e.id)?e.id:BX.util.getRandomString();var i=BX.PopupWindowManager.create(t,null,{content:'<div class="left-menu-confirm-popup">'+(BX.type.isNotEmptyString(e.content)?e.content:"")+"</div>",titleBar:BX.type.isNotEmptyString(e.titleBar)?e.titleBar:false,closeByEsc:true,closeIcon:true,draggable:true,buttons:[new BX.PopupWindowButton({text:BX.type.isNotEmptyString(e.okButtonText)?e.okButtonText:"OK",className:"popup-window-button-create",events:{click:function(){if(BX.type.isFunction(e.onsuccess)){e.onsuccess()}this.popupWindow.destroy()}}}),e.alertMode!==true?new BX.PopupWindowButtonLink({text:BX.type.isNotEmptyString(e.cancelButtonText)?e.cancelButtonText:BX.message("MENU_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){if(BX.type.isFunction(e.onfailure)){e.onfailure()}this.popupWindow.destroy()}}}):null]});i.show()},setDefaultMenu:function(e){if(this.isExtranet||e!==true){if(!confirm(BX.message("MENU_SET_DEFAULT_CONFIRM")))return;BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=defaultMenu",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:"set_default_menu"},onsuccess:BX.proxy(function(){document.location.reload()},this),onfailure:function(){}})}else{this.showPresetPopupFunction("personal")}},menuItemDragStart:function(){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onDragStart");var e=BX.proxy_context;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){jsDD.registerDest(t[i],100);jsDD.registerObject(t[i])}}if(e.getAttribute("data-type")==="self"){jsDD.unregisterDest(BX("left-menu-empty-item"))}else{jsDD.registerDest(BX("left-menu-empty-item"),100)}jsDD.registerDest(BX("left-menu-hidden-empty-item"),100);jsDD.registerDest(BX("left-menu-hidden-separator"),100);if(!this.isEditMode()){this.areMoreItemsShowedState=this.areMoreItemsShowed();if(!this.areMoreItemsShowedState){this.showHideMoreItems()}}this.itemHeight=e.offsetHeight;BX.addClass(e,"menu-item-draggable");BX.addClass(this.menuContainer,"menu-drag-mode");this.itemDomBlank=e.parentNode.insertBefore(BX.create("div",{style:{height:"0px"}}),e);this.itemMoveBlank=BX.create("div",{style:{height:this.itemHeight+"px"}});this.draggableBlock=BX.create("div",{attrs:{className:"menu-draggable-wrap"},children:[e]});this.menuItemsBlockCoord=BX.pos(this.menuItemsBlock);this.menuItemsBlock.style.position="relative";this.menuItemsBlock.appendChild(this.draggableBlock)},menuItemDragMove:function(e,t){t-=this.menuItemsBlockCoord.top;var i=this.menuItemsBlock.offsetHeight;if(t<0)t=0;if(t>i-this.itemHeight)t=i-this.itemHeight;this.draggableBlock.style.top=t-5+"px"},menuItemDragHover:function(e,t,i){var n=BX.proxy_context;if(e==n){this.itemDomBlank.parentNode.insertBefore(this.itemMoveBlank,this.itemDomBlank)}else if((n.getAttribute("data-type")=="self"||n.getAttribute("data-disable-first-item")=="Y")&&e.id==="left-menu-empty-item"){return}else{if(BX.findParent(e,{className:"menu-items"})){if(BX.nextSibling(e))e.parentNode.insertBefore(this.itemMoveBlank,BX.nextSibling(e));else e.parentNode.appendChild(this.itemMoveBlank)}}},menuItemDragStop:function(){var e=BX.proxy_context;BX.removeClass(this.menuContainer,"menu-drag-mode");BX.removeClass(e,"menu-item-draggable");var t=BX.findChild(this.menuContainer,{className:"menu-item-block"},true,false);if(BX.type.isDomNode(t)&&t.getAttribute("data-type")=="self"){this.showMessage(t,BX.message("MENU_SELF_ITEM_FIRST_ERROR"),"right");this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}else if(t.getAttribute("data-disable-first-item")=="Y"){this.showMessage(t,BX.message("MENU_FIRST_ITEM_ERROR"),"right");this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}else if(this.itemMoveBlank&&BX.findParent(this.itemMoveBlank,{className:"menu-items"})){this.itemMoveBlank.parentNode.replaceChild(e,this.itemMoveBlank);if(e.parentNode.id=="left-menu-hidden-items-list"){if(e.getAttribute("data-status")=="show"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","hide")}else{if(e.getAttribute("data-status")=="hide"&&e.getAttribute("data-counter-id")){this.recountHiddenCounters()}e.setAttribute("data-status","show")}var i="?analyticsLabel=sortItem";var n=BX.previousSibling(e);if(BX.type.isDomNode(n)&&n.id=="left-menu-empty-item"&&!this.isExtranet){this.showMessage(e,BX.message("MENU_ITEM_MAIN_PAGE"),"right");i="?analyticsLabel=mainPage&itemId="+e.getAttribute("data-id")}this.checkMoreButton();this.saveItemsSort(i)}else{this.menuItemsBlock.replaceChild(e,this.itemDomBlank)}BX.remove(this.draggableBlock);BX.remove(this.itemDomBlank);BX.remove(this.itemMoveBlank);jsDD.enableDest(e);this.menuItemsBlock.style.position="static";if(!this.isEditMode()&&!this.areMoreItemsShowedState){this.showHideMoreItems()}this.draggableBlock=null;this.menuItemsBlockCoord=null;this.itemDomBlank=null;this.itemMoveBlank=null;this.areMoreItemsShowedState=null;jsDD.refreshDestArea()},clearCompositeCache:function(){BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"clear"},function(e){})},adjustAdminPanel:function(){if(!this.adminPanel){return}var e=this.adminPanel.getBoundingClientRect();if(e.bottom>0){this.menuContainer.style.top=Math.max(e.bottom,this.fixedAdminPanelHeight)+"px"}else{this.menuContainer.style.top=Math.max(0,this.fixedAdminPanelHeight)+"px"}},handleBurgerClick:function(e){this.menuHeaderBurger.classList.add("menu-switcher-hover");this.toggle(e,function(){this.isMenuMouseEnterBlocked=true;setTimeout(function(){this.menuHeaderBurger.classList.remove("menu-switcher-hover");this.isMenuMouseEnterBlocked=false}.bind(this),100)}.bind(this))},handleMenuMouseEnter:function(e){if(!this.isCollapsed()){return}if(!this.isMenuMouseEnterBlocked){if(this.slidingModeTimeoutId){clearTimeout(this.slidingModeTimeoutId)}this.slidingModeTimeoutId=setTimeout(function(){this.slidingModeTimeoutId=null;this.switchToSlidingMode(true)}.bind(this),400)}},handleMenuMouseLeave:function(e){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null;if(!this.isMenuMouseLeaveBlocked){this.switchToSlidingMode(false)}},handleMenuDoubleClick:function(e){if(e.target===this.menuBody){this.toggle()}},handleHeaderLogoMouserEnter:function(e){BX.addClass(this.headerSettings,"header-logo-block-settings-show")},handleHeaderLogoMouserLeave:function(e){if(!this.headerSettings.hasAttribute("data-rename-portal")){BX.removeClass(this.headerSettings,"header-logo-block-settings-show")}},handleAdminPanelCollapse:function(e){this.adminPanelHeight=null;if(BX.admin.panel.isFixed()){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}this.adjustAdminPanel()},handleAdminPanelFix:function(e){if(e){this.fixedAdminPanelHeight=this.getAdminPanelHeight()}else{this.fixedAdminPanelHeight=0}this.adjustAdminPanel()},handleSiteMapClick:function(){this.switchToSlidingMode(false);BX.SidePanel.Instance.open("bitrix24-sitemap",{cacheable:false,contentCallback:function(){var e=new BX.Promise;e.fulfill(BX("sitemap").innerHTML);return e}})},handleUpButtonClick:function(){this.isMenuMouseEnterBlocked=true;if(this.isUpButtonReversed()){window.scrollTo(0,this.lastScrollOffset);this.lastScrollOffset=0;this.unreverseUpButton()}else{this.lastScrollOffset=window.pageYOffset;window.scrollTo(0,0);this.reverseUpButton()}setTimeout(function(){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null;this.isMenuMouseEnterBlocked=false}.bind(this),100)},handleUpButtonMouseEnter:function(){this.isMenuMouseEnterBlocked=true;clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null},handleUpButtonMouseLeave:function(){this.isMenuMouseEnterBlocked=false},handleMenuItemMouseEnter:function(e){this.handleMenuMouseEnter(e)},handleMenuItemMouseClick:function(e){if(this.isCollapsed()){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null}},handleDocumentScroll:function(){this.adjustAdminPanel();this.applyScrollMode();if(window.pageYOffset>document.documentElement.clientHeight){this.showUpButton();if(this.isUpButtonReversed()){this.unreverseUpButton();this.lastScrollOffset=0}}else{if(!this.isUpButtonReversed()){this.hideUpButton()}}if(window.pageXOffset>0){this.menuContainer.style.left=-window.pageXOffset+"px";this.upButton.style.left=-window.pageXOffset+(this.isCollapsed()?0:172)+"px"}else{this.menuContainer.style.removeProperty("left");this.upButton.style.removeProperty("left")}},handleGroupPanelOpen:function(){this.isMenuMouseLeaveBlocked=true},handleGroupPanelClose:function(){this.isMenuMouseLeaveBlocked=false},showUpButton:function(){this.menuContainer.classList.add("menu-up-button-active")},hideUpButton:function(){this.menuContainer.classList.remove("menu-up-button-active")},reverseUpButton:function(){this.menuContainer.classList.add("menu-up-button-reverse")},unreverseUpButton:function(){this.menuContainer.classList.remove("menu-up-button-reverse")},isUpButtonReversed:function(){return this.menuContainer.classList.contains("menu-up-button-reverse")},isDefaultTheme:function(){return document.body.classList.contains("bitrix24-default-theme")},getTopPadding:function(){return this.isDefaultTheme()?0:9},getAdminPanelHeight:function(){if(this.adminPanelHeight!==null){return this.adminPanelHeight}if(this.adminPanel){this.adminPanelHeight=this.adminPanel.offsetHeight}else{this.adminPanelHeight=0}return this.adminPanelHeight},getTemplateHeaderHeight:function(){if(this.templateHeaderHeight===null){var e=BX("header");if(e){this.templateHeaderHeight=e.offsetHeight}}return this.templateHeaderHeight?this.templateHeaderHeight:0},switchToSlidingMode:function(e,t){if(e===false){if(this.slidingModeTimeoutId){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=null}if(BX.hasClass(this.mainTable,"menu-sliding-mode")){if(t!==true){BX.addClass(this.mainTable,"menu-sliding-closing-mode")}BX.removeClass(this.mainTable,"menu-sliding-mode menu-sliding-opening-mode")}}else if(this.isCollapsedMode&&!BX.hasClass(this.mainTable,"menu-sliding-mode")){BX.removeClass(this.mainTable,"menu-sliding-closing-mode");if(t!==true){BX.addClass(this.mainTable,"menu-sliding-opening-mode")}BX.addClass(this.mainTable,"menu-sliding-mode")}},handleSlidingTransitionEnd:function(e){if(e.target===this.menuContainer){BX.removeClass(this.mainTable,"menu-sliding-opening-mode menu-sliding-closing-mode")}},switchToScrollMode:function(e){if(e===false){if(this.isScrollMode===true){BX.removeClass(this.mainTable,"menu-scroll-mode");this.isScrollMode=false}}else{if(this.isScrollMode===false){BX.addClass(this.mainTable,"menu-scroll-mode");this.isScrollMode=true}}},switchToLogoMaskMode:function(e){if(e===false){if(this.islogoMaskMode===true){BX.removeClass(this.mainTable,"menu-logo-mask-mode");this.islogoMaskMode=false}}else{if(this.islogoMaskMode===false){BX.addClass(this.mainTable,"menu-logo-mask-mode");this.islogoMaskMode=true}}},applyScrollMode:function(){if(this.isLogoMaskNeeded()){this.switchToLogoMaskMode(true)}var e=this.scrollModeThreshold;if(this.fixedAdminPanelHeight===0&&this.adminPanel){e+=this.getAdminPanelHeight()}if(window.pageYOffset>e){this.switchToScrollMode(true)}else{this.switchToScrollMode(false)}},isLogoMaskNeeded:function(){if(this.logoMaskNeeded===null){if(this.menuHeaderLogo.querySelector(".logo-image-container")){this.logoMaskNeeded=false}else{var e=this.menuHeaderLogo;if(e.offsetWidth===0){e=this.headerLogo}this.logoMaskNeeded=e.offsetWidth>200}}return this.logoMaskNeeded},toggle:function(e,t){var i=BX("layout-left-column");if(!i){return}var n=!BX.hasClass(this.mainTable,"menu-collapsed-mode");if(e===true&&n||e===false&&!n||BX.hasClass(this.mainTable,"menu-animation-mode")){return}if(this.isEditMode()){this.applyEditMode()}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[e,this]);var s=this.menuHeader.querySelector(".logo-image-container");if(s){var a=this.header.querySelector(".logo-image-container").offsetWidth;if(a>0){s.style.width=a+"px"}}this.isMenuMouseEnterBlocked=true;this.switchToSlidingMode(false,true);this.applyScrollMode();i.style.overflow="hidden";BX.addClass(this.mainTable,"menu-animation-mode "+(n?"menu-animation-closing-mode":"menu-animation-opening-mode"));var o=[].slice.call(i.querySelectorAll(".menu-item-link"));var r=i.querySelector(".menu-collapsed-more-btn");var u=i.querySelector(".menu-default-more-btn");var l=i.querySelector(".menu-sitemap-icon-box");var d=i.querySelector(".menu-sitemap-btn-text");var m=i.querySelector(".menu-invite-employees-text");var h=i.querySelector(".menu-invite-icon-box");var c=i.querySelector(".menu-license-all-container");var p=i.querySelector(".menu-license-all-default");if(p){var f=p.offsetHeight}var B=i.querySelector(".menu-license-all-collapsed");var g=i.querySelector(".menu-item-separator");var X=i.querySelector(".menu-item-index-more");var v=this.mainTable.querySelector(".page-header");var y=document.getElementById("bx-im-bar");var b=y?y.offsetWidth:0;new BX.easing({duration:300,start:{translateIcon:n?-100:0,translateText:n?0:-100,translateMoreBtn:n?0:-84,translateLicenseBtn:n?0:-100,heightLicenseBtn:n?f:40,burgerMenuWidth:n?33:66,sidebarWidth:n?240:66,opacity:n?100:0,opacityRevert:n?0:100},finish:{translateIcon:n?0:-100,translateText:n?-100:-18,translateMoreBtn:n?-84:0,translateLicenseBtn:n?-100:0,heightLicenseBtn:n?40:f,burgerMenuWidth:n?66:33,sidebarWidth:n?66:240,opacity:n?0:100,opacityRevert:n?100:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.width=e.sidebarWidth+"px";this.menuContainer.style.width=e.sidebarWidth+"px";this.menuHeaderBurger.style.width=e.burgerMenuWidth+"px";this.headerBurger.style.width=e.burgerMenuWidth+"px";if(v){v.style.maxWidth="calc(100vw - "+e.sidebarWidth+"px - "+b+"px)"}if(n){if(l){l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}this.settingsIconBox.style.transform="translateX("+e.translateIcon+"px)";this.settingsIconBox.style.opacity=e.opacityRevert/100;this.settingsBtnText.style.transform="translateX("+e.translateText+"px)";this.settingsBtnText.style.opacity=e.opacity/100;r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(X){X.style.transform="translateX("+e.translateIcon+"px)";X.style.opacity=e.opacityRevert/100}if(c){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;p.style.height=e.heightLicenseBtn+"px";B.style.transform="translateX("+e.translateIcon+"px)";B.style.opacity=e.opacityRevert/100}o.forEach(function(t){var i=t.querySelector(".menu-item-icon-box");var n=t.querySelector(".menu-item-link-text");var s=t.querySelector(".menu-item-index");n.style.transform="translateX("+e.translateText+"px)";n.style.opacity=e.opacity/100;i.style.transform="translateX("+e.translateIcon+"px)";i.style.opacity=e.opacityRevert/100;if(s){s.style.transform="translateX("+e.translateIcon+"px)";s.style.opacity=e.opacityRevert/100}})}else{g.style.opacity=0;if(l){l.style.transform="translateX("+e.translateIcon+"px)";l.style.opacity=e.opacityRevert/100}if(d){d.style.transform="translateX("+e.translateText+"px)";d.style.opacity=e.opacity/100}if(h){h.style.transform="translateX("+e.translateIcon+"px)";h.style.opacity=e.opacityRevert/100}if(m){m.style.transform="translateX("+e.translateText+"px)";m.style.opacity=e.opacity/100}this.settingsIconBox.style.transform="translateX("+e.translateIcon+"px)";this.settingsIconBox.style.opacity=e.opacityRevert/100;this.settingsBtnText.style.transform="translateX("+e.translateText+"px)";this.settingsBtnText.style.opacity=e.opacity/100;r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100;u.style.transform="translateX("+e.translateMoreBtn+"px)";u.style.opacity=e.opacity/100;if(X){X.style.transform="translateX("+e.translateText+"px)"}if(c){p.style.transform="translateX("+e.translateLicenseBtn+"px)";p.style.opacity=e.opacity/100;p.style.height=e.heightLicenseBtn+"px";B.style.transform="translateX("+e.translateIcon+"px)";B.style.opacity=e.opacityRevert/100}o.forEach(function(t){var i=t.querySelector(".menu-item-icon-box");var n=t.querySelector(".menu-item-link-text");var s=t.querySelector(".menu-item-index");n.style.transform="translateX("+e.translateText+"px)";n.style.opacity=e.opacity/100;n.style.display="inline-block";i.style.transform="translateX("+e.translateIcon+"px)";i.style.opacity=e.opacityRevert/100;if(s){s.style.transform="translateX("+e.translateText+"px)"}})}var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this),complete:function(){if(n){this.isCollapsedMode=true;BX.addClass(this.mainTable,"menu-collapsed-mode")}else{this.isCollapsedMode=false;BX.removeClass(this.mainTable,"menu-collapsed-mode")}BX.removeClass(this.mainTable,"menu-animation-mode menu-animation-opening-mode menu-animation-closing-mode");var e=[i,g,this.menuHeaderBurger,this.headerBurger,this.settingsIconBox,this.settingsBtnText,u,r,s,l,d,h,m,X,p,B,this.menuContainer,v];e.forEach(function(e){if(e){e.style.cssText=""}});o.forEach(function(e){var t=e.querySelector(".menu-item-icon-box");var i=e.querySelector(".menu-item-link-text");var n=e.querySelector(".menu-item-index");e.style.cssText="";i.style.cssText="";t.style.cssText="";if(n){n.style.cssText=""}});this.isMenuMouseEnterBlocked=false;this.adjustAdminPanel();if(BX.type.isFunction(t)){t()}var a=n?"collapse_menu":"expand_menu";BX.ajax({method:"POST",dataType:"json",url:BX.util.add_url_param(this.ajaxPath,{analyticsLabel:a}),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,action:a}});var c=document.createEvent("Event");c.initEvent("resize",true,true);window.dispatchEvent(c)}.bind(this)}).animate()},highlight:function(e){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var t=this.menuContainer.getElementsByTagName("li");var i=-1;var n=-1;var s=-1;var a=null;for(var o=0,r=t.length;o<r;o++){var u=[];var l=t[o].getAttribute("data-link");if(BX.type.isNotEmptyString(l)){var d=t[o].getAttribute("data-type");u.push({priority:BX.util.in_array(d,["standard","admin"])?3:2,url:l})}var m=t[o].getAttribute("data-all-links");if(BX.type.isNotEmptyString(m)){m.split(",").forEach(function(e){e=BX.util.trim(e);if(BX.type.isNotEmptyString(e)){u.push({priority:1,url:e})}})}for(var h=0,c=u.length;h<c;h++){var p=u[h].url;var f=u[h].priority;var B=this.isItemSelected(p,e);if(B){var g=p.length;if(g>n||g===n&&f>s){i=o;a=p;n=g;s=f}}}}if(i<0){return}var X=t[i];BX.addClass(X,"menu-item-active");var v=X.parentNode.parentNode;if(BX.hasClass(v,"menu-item-favorites-more")&&!BX.hasClass(v,"menu-item-favorites-more-open")){this.showHideMoreItems(false)}return true},makeTextIcons:function(){var e=this.menuContainer.getElementsByTagName("li");for(var t=0,i=e.length;t<i;t++){var n=e[t];var s=!n.classList.contains("menu-item-no-icon-state");if(s){continue}var a=n.querySelector(".menu-item-icon");var o=n.querySelector(".menu-item-link-text");if(a&&o){a.textContent=this.getShortName(o.textContent)}}},getShortName:function(e){if(!BX.type.isString(e)||!BX.type.isNotEmptyString(e.trim())){return"..."}var t="";e=e.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(!BX.type.isNotEmptyString(e)){t=e.substring(0,2)}else if(e.length===2){t=e}var i=e.split(/[\s,]+/);if(i.length<=1){t=e.substring(0,1)}else if(i.length===2){t=i[0].substring(0,1)+i[1].substring(0,1)}else{var n=i[0];var s=i[1];for(var a=1;a<i.length;a++){if(i[a].length>3){s=i[a];break}}t=n.substring(0,1)+s.substring(0,1)}return t.toUpperCase()},getSelectedItem:function(e,t){if(!BX.type.isNotEmptyString(e)||!this.menuContainer){return false}var i=this.menuContainer.getElementsByTagName("li");var n=-1;var s=-1;var a=null;for(var o=0,r=i.length;o<r;o++){var u=[];if(t){var l=i[o].getAttribute("data-all-links");if(BX.type.isNotEmptyString(l)){u=u.concat(l.split(","))}}else{var d=i[o].getAttribute("data-link");if(BX.type.isNotEmptyString(d)){u.push(d)}}for(var m=0,h=u.length;m<h;m++){var c=u[m];if(!BX.type.isNotEmptyString(c)){continue}var p=this.isItemSelected(c,e);if(p){var f=c.length;if(f>s){n=o;a=u[m];s=f}}}}return n>=0?i[n]:null},isItemSelected:function(e,t){var i=t;var n=t.indexOf("?");if(n!==-1){t=t.substring(0,n)}var s=this.getUrlWithIndex(t);e=e.replace(/(\/index\.php)($|\?)/,"$2");if(t.indexOf(e)===0||s.indexOf(e)===0){return true}n=e.indexOf("?");if(n===-1){return false}var a=e.substring(0,n);if(a!==t&&a!==s){return false}var o=true;var r=this.getUrlParams(e);var u=this.getUrlParams(i);for(var l in r){if(!r.hasOwnProperty(l)){continue}var d=r[l];var m=typeof u[l]!=="undefined"?u[l]:[];for(var h=0;h<d.length;h++){var c=d[h];if(!BX.util.in_array(c,m)){o=false;break}}}return o},getUrlParams:function(e){var t={};var i=e.indexOf("?");if(i===-1){return t}var n=e.substring(i+1).split("&");for(var s=0;s<n.length;s++){var a=n[s];var o=a.indexOf("=");if(o===0){continue}var r=o===-1?a:a.substring(0,o);r=r.replace("[]","");var u=o===-1?"":a.substring(o+1);if(t[r]){t[r].push(u)}else{t[r]=[u]}}return t},getUrlWithIndex:function(e){if(!BX.type.isNotEmptyString(e)){e=""}var t=e.indexOf("?");var i=t>=0?"?"+e.substring(t+1):"";var n=t>=0?e.substring(0,t):e;if(n.match(/\.php$/)){return e}if(n.slice(-1)!=="/"){n+="/"}return n+"index.php"+i},checkCurrentPageInTopMenu:function(){var e=document.location.pathname+document.location.search;if(BX.Main&&BX.Main.interfaceButtonsManager){var t=BX.Main.interfaceButtonsManager.getObjects();var i=Object.keys(t);if(i[0]){var n=t[i[0]];this.topItemSelectedObj=n.getActive();if(typeof this.topItemSelectedObj==="object"&&this.topItemSelectedObj){if(this.topItemSelectedObj.hasOwnProperty("NODE")){this.topMenuSelectedNode=this.topItemSelectedObj.NODE}var s=document.createElement("a");s.href=this.topItemSelectedObj.URL;var a=s.pathname[0]!=="/"?"/"+s.pathname:s.pathname;this.topItemSelectedObj.URL=BX.util.htmlspecialcharsback(a+s.search);this.topItemSelectedObj.TEXT=BX.util.htmlspecialcharsback(this.topItemSelectedObj.TEXT);this.isCurrentPageStandard=this.topItemSelectedObj.URL===e&&this.topItemSelectedObj.URL.indexOf("workgroups")===-1}}}return this.isCurrentPageStandard},checkLinkInMenu:function(e){if(!BX.type.isNotEmptyString(e))return;if(BX.type.isDomNode(this.menuItemsBlock)){var t=this.menuItemsBlock.getElementsByClassName("menu-item-block");for(var i=0;i<t.length;i++){if(t[i].getAttribute("data-link")==e)return t[i]}}return false},getStructureForHelper:function(){var e={menu:{}};if(BX.type.isDomNode(this.menuContainer)){var t=["show","hide"];for(var i in t){var n=this.menuContainer.querySelectorAll("[data-status='"+t[i]+"']");if(n){var s=[];for(var a=0,o=n.length;a<o;a++){if(n[a].getAttribute("data-type")!="default"){continue}s.push(n[a].getAttribute("data-id"))}}e[t[i]]=s}}return e},initPagetitleStar:function(){this.checkCurrentPageInTopMenu();return true},onRequestMenuItemData:function(e){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",[{currentPageInMenu:this.checkLinkInMenu(e.currentFullPath),context:e.context}])},onToolbarStarClick:function(e){if(e.isActive){this.deleteStandardItem({context:e.context,pageLink:e.pageLink})}else{this.addStandardItem({context:e.context,pageTitle:e.pageTitle,pageLink:e.pageLink})}},onStandardItemChangedSuccess:function(e){if(e.isCurrentPage){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:e.isActive,context:e.context}])}},initPreset:function(){var e=BX("left-menu-preset-popup");if(!BX.type.isDomNode(e))return;this.presetItems=e.getElementsByClassName("js-left-menu-preset-item");if(typeof this.presetItems=="object"){for(var t=0;t<this.presetItems.length;t++){BX.bind(this.presetItems[t],"click",BX.proxy(function(){this.selectPreset(BX.proxy_context)},this))}}},selectPreset:function(e){for(var t=0;t<this.presetItems.length;t++){BX.removeClass(this.presetItems[t],"left-menu-popup-selected")}if(BX.type.isDomNode(e)){BX.addClass(e,"left-menu-popup-selected")}},showImportConfigurationSlider:function(){if(this.urlImportConfiguration!==""){BX.SidePanel.Instance.open(this.urlImportConfiguration)}},showPresetPopupFunction:function(e){BX.ready(function(){var t=null;BX.PopupWindowManager.create("menu-preset-popup",null,{closeIcon:false,offsetTop:1,overlay:true,lightShadow:true,contentColor:"white",draggable:{restrict:true},closeByEsc:false,content:BX("left-menu-preset-popup"),buttons:[t=new BX.PopupWindowButton({text:BX.message("MENU_CONFIRM_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");var i=document.forms["left-menu-preset-form"];var n="";if(i){presets=i.elements["presetType"];for(var s=0;s<presets.length;s++){if(presets[s].checked){n=presets[s].value;break}}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel="+n+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"set_preset",preset:n,mode:e=="global"?"global":"personal"},onsuccess:BX.proxy(function(e){if(e.hasOwnProperty("url")){document.location.href=e.url}else{document.location.reload()}},this),onfailure:function(){document.location.reload()}})},this)}}),new BX.PopupWindowButton({text:BX.message("MENU_DELAY_BUTTON"),events:{click:BX.proxy(function(){BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=later"+(e=="global"?"&analyticsFirst=y":""),data:{sessid:BX.bitrix_sessid(),action:"delay_set_preset"}});BX.proxy_context.popupWindow.close();if(this.showImportConfiguration){this.showImportConfigurationSlider()}},this)}})]}).show();this.initPreset()}.bind(this))},showCustomPresetPopup:function(){var e=BX.create("form",{attrs:{id:"customPresetForm",style:"min-width: 350px"},children:[BX.create("div",{attrs:{style:"margin: 15px 0 15px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetCurrentUser",value:"currentUser"}}),BX.create("label",{attrs:{for:"customPresetCurrentUser"},html:BX.message("MENU_CUSTOM_PRESET_CURRENT_USER")})]}),BX.create("div",{attrs:{style:"margin: 0 0 38px 9px;"},children:[BX.create("input",{attrs:{type:"radio",name:"customPresetSettings",id:"customPresetNewUser",value:"newUser",checked:"checked"}}),BX.create("label",{attrs:{for:"customPresetNewUser"},html:BX.message("MENU_CUSTOM_PRESET_NEW_USER")})]}),BX.create("hr",{attrs:{style:"background-color: #edeef0; border: none; color:  #edeef0; height: 1px;"}})]});var t=[],i=[],n=[],s="";var a=BX.findChildren(this.menuContainer,{className:"menu-item-block"},true);for(var o=0;o<a.length;o++){if(o==0){s=a[o].getAttribute("data-link")}if(a[o].getAttribute("data-status")=="show"){t.push(a[o].getAttribute("data-id"))}else if(a[o].getAttribute("data-status")=="hide"){i.push(a[o].getAttribute("data-id"))}if(a[o].getAttribute("data-type")=="self"||a[o].getAttribute("data-type")=="standard"||a[o].getAttribute("data-type")=="custom"){var r=a[o].querySelector("[data-role='item-text']");var u={ID:a[o].getAttribute("data-id"),LINK:a[o].getAttribute("data-link"),TEXT:BX.util.htmlspecialcharsback(r.innerHTML)};if(a[o].getAttribute("data-new-page")=="Y"){u.NEW_PAGE="Y"}n.push(u)}}this.menuItemsCustomSort={show:t,hide:i};BX.PopupWindowManager.create("menu-custom-preset-popup",null,{closeIcon:true,offsetTop:1,overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:e,buttons:[button=new BX.PopupWindowButton({text:BX.message("MENU_SAVE_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(function(){if(BX.hasClass(button.buttonNode,"popup-window-button-wait")){return}BX.addClass(button.buttonNode,"popup-window-button-wait");var e=BX("customPresetForm");if(BX.type.isDomNode(e)){var t=e.elements["customPresetSettings"].value}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath+"?analyticsLabel=customPreset",data:{sessid:BX.bitrix_sessid(),site_id:this.siteId,siteDir:this.siteDir,action:"save_custom_preset",userApply:t,itemsSort:this.menuItemsCustomSort,customItems:n,firstItemLink:s},onsuccess:BX.proxy(function(){BX.removeClass(button.buttonNode,"popup-window-button-wait");BX.PopupWindowManager._currentPopup.close();this.customPresetExists=true;BX.PopupWindowManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:BX.message("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:BX.message("MENU_CUSTOM_PRESET_SUCCESS")}).show()},this),onfailure:function(){}})},this),close:function(){this.popupWindow.destroy()}}}),new BX.PopupWindowButton({text:BX.message("MENU_CANCEL"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]}).show()},showLoader:function(){var e=BX.create("div",{html:'<div style="display: block" class="intranet-loader-container"> <svg class="intranet-loader-circular" viewBox="25 25 50 50"> <circle class="intranet-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10" /> </svg> </div>'});document.body.appendChild(e)}};BX.Bitrix24.LeftMenuClass=BX.Bitrix24.LeftMenu;BX.namespace("BX.Intranet.ExpandTariff");BX.Intranet.ExpandTariff={redirect:function(e){if(typeof e!=="object")return;var t=e.COUNTER_URL||"",i=e.LICENSE_PATH||"",n=e.HOST||"";BX.ajax.post(t,{action:"upgradeButton",host:n},BX.proxy(function(){document.location.href=i},this))}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/templates/bitrix24/components/bitrix/im.messenger/.default/script.min.js?16548426464176";s:6:"source";s:76:"/bitrix/templates/bitrix24/components/bitrix/im.messenger/.default/script.js";s:3:"min";s:80:"/bitrix/templates/bitrix24/components/bitrix/im.messenger/.default/script.min.js";s:3:"map";s:80:"/bitrix/templates/bitrix24/components/bitrix/im.messenger/.default/script.map.js";}"*/
BX.namespace("BX.Intranet.Bitrix24.ImBar");(function(){var e=0;var n=null;var t=false;var i=false;var r=20;function o(){var t=l();if(t){var i=BX.getClass("BX.admin.panel.state");if(i&&i.fixed){e=d()}BX.addCustomEvent("onTopPanelCollapse",function(){n=null;if(BX.admin.panel.isFixed()){e=d()}u()}.bind(this));BX.addCustomEvent("onTopPanelFix",function(n){if(n){e=d()}else{e=0}u()}.bind(this));u()}BX.bind(window,"scroll",a);BX.bind(window,"resize",a);a();BX.bind(BX("bx-im-bar-notify"),"click",function(){if(typeof BXIM=="undefined")return false;BXIM.openNotify()});BX.bind(BX("bx-im-bar-search"),"click",function(){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(0,"im")});BX.bind(BX("bx-im-bar-ol"),"click",function(){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(0,"im-ol")});BX.bind(BX("bx-im-btn-call"),"click",function(e){if(typeof BXIM=="undefined")return false;BXIM.webrtc.openKeyPad(e)});BX.bind(window,"scroll",function(){if(typeof BXIM=="undefined"||!BXIM.messenger.popupPopupMenu)return true;if(BX.util.in_array(BXIM.messenger.popupPopupMenu.uniquePopupId.replace("bx-messenger-popup-",""),["createChat","contactList"])){BXIM.messenger.popupPopupMenu.close()}});BX.bindDelegate(BX("bx-im-external-recent-list"),"contextmenu",{className:"bx-messenger-cl-item"},function(e){if(typeof BXIM=="undefined")return false;BXIM.messenger.openPopupMenu(this,"contactList",false);return BX.PreventDefault(e)});BX.bindDelegate(BX("bx-im-external-recent-list"),"click",{className:"bx-messenger-cl-item"},function(e){if(typeof BXIM=="undefined")return false;BXIM.openMessenger(this.getAttribute("data-userId"));return BX.PreventDefault(e)});BX.addCustomEvent("onMessengerWindowBodyOverflow",function(e,n){var t=BX.findChildrenByClassName(BX("im-workarea-popup"),"bx-im-fullscreen-popup-td",true);for(var i=0;i<t.length;i++){var r=getComputedStyle(t[i],null);r=r?parseInt(r.getPropertyValue("padding-left").toString().replace("px","")):85;t[i].style.paddingRight=r+n+"px"}document.body.style.paddingRight=n+"px";BX("bx-im-bar").style.right=n+"px"});BX.addCustomEvent("onImUpdateCounterNotify",function(e){var n=BX.findChildByClassName(BX("bx-im-bar-notify"),"bx-im-informer-num");if(!n)return false;if(e>0){n.innerHTML='<div class="bx-im-informer-num-digit">'+(e>99?"99+":e)+"</div>"}else{n.innerHTML=""}});BX.addCustomEvent("onImUpdateCounterLines",function(e,n){var t=null;if(n==="LINES"){t=BX("bx-im-bar-ol")}else{return false}var i=t&&BX.findChildByClassName(t,"bx-im-informer-num");if(!i)return false;if(e>0){i.innerHTML='<div class="bx-im-informer-num-digit">'+(e>99?"99+":e)+"</div>"}else{i.innerHTML=""}});BX.bind(BX("im-workarea-backgound-selector"),"change",function(){BX("im-workarea-backgound-selector-title").innerHTML=this.options[this.selectedIndex].text});BX.addCustomEvent("onMessengerWindowInit",function(){BX("im-workarea-backgound-selector-title").innerHTML=BX("im-workarea-backgound-selector").options[BX("im-workarea-backgound-selector").selectedIndex].text});BX.addCustomEvent("onImInit",function(e){e.notify.panelButtonCall=BX("bx-im-btn-call");e.notify.panelButtonCallAnlgePosition="bottom";e.notify.panelButtonCallAnlgeOffset=131;BX.MessengerCommon.recentListRedraw()})}function a(){var n=s();if(!n||n.dataset.lockRedraw==="true"){return}u();var o=document.documentElement.scrollWidth-document.documentElement.clientWidth;if(o>0){if(!t){BX.addClass(n,"bx-im-bar-transparent");t=true}}else{if(t){BX.removeClass(n,"bx-im-bar-transparent");t=false}}var a=r;if(e===0&&l()){a+=d()}if(window.pageYOffset>a){if(!i){BX.addClass(n,"bx-im-bar-scroll-mode");i=true}}else{if(i){BX.removeClass(n,"bx-im-bar-scroll-mode");i=false}}}function s(){return BX("bx-im-bar")}function l(){return BX("bx-panel")}function u(){var n=l();var t=s();if(!n||!t){return}var i=n.getBoundingClientRect();if(i.bottom>0){t.style.top=Math.max(i.bottom,e)+"px"}else{t.style.top=Math.max(0,e)+"px"}}function d(){if(n!==null){return n}var e=l();if(e){n=e.offsetHeight}else{n=0}return n}function f(){BX.MessengerWindow.closePopup()}BX.Intranet.Bitrix24.ImBar.init=o;BX.Intranet.Bitrix24.ImBar.redraw=a;window.bxFullscreenClose=f})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:58:"/bitrix/templates/bitrix24/bitrix24.min.js?165484264622588";s:6:"source";s:38:"/bitrix/templates/bitrix24/bitrix24.js";s:3:"min";s:42:"/bitrix/templates/bitrix24/bitrix24.min.js";s:3:"map";s:42:"/bitrix/templates/bitrix24/bitrix24.map.js";}"*/
(function(){var t=window!==window.top;var e=window.location.search;var n=e.indexOf("IFRAME=")!==-1||e.indexOf("IFRAME%3D")!==-1;if(t&&n){return}else if(t){window.top.location=window.location.href;return}BX.addCustomEvent("onFrameDataRequestFail",function(t){top.location="/auth/?backurl="+encodeURIComponent(B24.getBackUrl())});BX.addCustomEvent("onAjaxFailure",function(t){var e="/auth/?backurl="+B24.getBackUrl();if(t=="auth"&&typeof window.frameRequestStart!=="undefined"){top.location=e}});BX.addCustomEvent("onPopupWindowInit",function(t,e,n){if(t=="bx_log_filter_popup"){n.lightShadow=true;n.className=""}else if(t=="task-legend-popup"){n.lightShadow=true;n.offsetTop=-15;n.offsetLeft=-670;n.angle={offset:740}}else if(t=="task-gantt-filter"||t=="task-list-filter"){n.lightShadow=true;n.className=""}else if(t.indexOf("sonet_iframe_popup_")>-1){n.lightShadow=true}});BX.addCustomEvent("onJCClockInit",function(t){JCClock.setOptions({centerXInline:83,centerX:83,centerYInline:67,centerY:79,minuteLength:31,hourLength:26,popupHeight:229,inaccuracy:15,cancelCheckClick:true})});BX.addCustomEvent("onPullEvent-main",function(t,e){if(t=="user_counter"&&e[BX.message("SITE_ID")]){var n=BX.clone(e[BX.message("SITE_ID")]);B24.updateCounters(n)}});BX.addCustomEvent("onPullEvent-bitrix24",BX.delegate(function(t,e){if(t=="userLimitNotify"){BX.UI.Notification.Center.notify({content:e.message})}},this));BX.addCustomEvent(window,"onImUpdateCounter",function(t){if(!t)return;B24.updateCounters(BX.clone(t))});BX.addCustomEvent("onCounterDecrement",function(t){B24.decrementCounter(BX("menu-counter-live-feed"),t)});BX.addCustomEvent("onImUpdateCounterNotify",function(t){B24.updateInformer(BX("im-informer-events",true),t)});BX.addCustomEvent("onImUpdateCounterMessage",function(t){B24.updateInformer(BX("im-informer-messages",true),t);B24.updateCounters({"im-message":t})});BX.addCustomEvent("onImUpdateCounterNetwork",function(t){B24.updateInformer(BX("b24network-informer-events",true),t)});BX.addCustomEvent("Kanban.Grid:onFixedModeStart",function(){BX.ready(function(){BX("footer").style.visibility="hidden"})});BX.addCustomEvent("Intranet.Search.Title:onFocusAction",function(t){if(!BX.type.isDomNode(BX("header-buttons"))||!BX("header-buttons").querySelector(".ui-btn")){return}var e=BX("timeman-container");var n=BX("header");if(!BX.type.isDomNode(e)||!BX.type.isDomNode(n)){return}if(t==="gain"){e.style.webkitTransition="min-width .2s, width .2s, opacity .1s, padding .2s";n.style.width=n.offsetWidth+"px";if(document.body.offsetWidth<1660){e.style.opacity="0";setTimeout(function(){BX.addClass(e,"timeman-container--hide")}.bind(this),100)}}else if(t==="lost"){e.style.webkitTransition="min-width .2s, width .2s, opacity .3s, padding .2s";BX.removeClass(e,"timeman-container--hide");setTimeout(function(){e.style.opacity="1";n.removeAttribute("style")}.bind(this),300)}});BX.addCustomEvent("onPullError",BX.delegate(function(t,e){if(t=="AUTHORIZE_ERROR"){B24.connectionStatus("offline")}else if(t=="RECONNECT"&&(e==1008||e==1006)){B24.connectionStatus("connecting")}},this));BX.addCustomEvent("onImError",BX.delegate(function(t,e){if(t=="AUTHORIZE_ERROR"||t=="SEND_ERROR"&&e=="AUTHORIZE_ERROR"){B24.connectionStatus("offline")}else if(t=="CONNECT_ERROR"){B24.connectionStatus("offline")}},this));BX.addCustomEvent("onPullStatus",BX.delegate(function(t){if(t=="offline")B24.connectionStatus("offline");else B24.connectionStatus("online")},this));if(BX.browser.SupportLocalStorage()){BX.addCustomEvent(window,"onLocalStorageSet",function(t){if(t.key.substring(0,4)=="lmc-"){var e={};e[t.key.substring(4)]=t.value;B24.updateCounters(e,false)}})}if(BX.getClass("BX.rest.AppLayout")){var i=BX.rest.AppLayout.initializePlacement("DEFAULT");i.prototype.showHelper=function(t,e){var n="";if(BX.type.isNumber(t)){n="redirect=detail&code="+t}else if(BX.type.isNotEmptyString(t)){n=t}else if(BX.type.isPlainObject(t)){for(var i in t){if(n.length){n+="&"}n+=i+"="+t[i]}}if(n.length){BX.Helper.show(n)}}}BX.ready(function(){BX.bind(window,"scroll",BX.throttle(B24.onScroll,150,B24))})})();var B24={b24ConnectionStatusState:"online",b24ConnectionStatus:null,b24ConnectionStatusText:null,b24ConnectionStatusTimeout:null,formateDate:function(t){return BX.util.str_pad(t.getHours(),2,"0","left")+":"+BX.util.str_pad(t.getMinutes(),2,"0","left")},openLanguagePopup:function(t){if(!BX.type.isDomNode(BX("b24LangPopupContent")))return;BX.PopupWindowManager.create("b24LangPopup",t,{content:BX("b24LangPopupContent"),closeIcon:false,autoHide:true,closeByEsc:true,angle:{offset:50}}).show()},changeLanguage:function(t){window.location.href="/auth/?user_lang="+t+"&backurl="+B24.getBackUrl()},getBackUrl:function(){var t=window.location.pathname;var e=B24.getQueryString(["logout","login","back_url_pub","user_lang"]);return t+(e.length>0?"?"+e:"")},getQueryString:function(t){var e=window.location.search.substring(1);if(!BX.type.isNotEmptyString(e)){return""}var n=e.split("&");t=BX.type.isArray(t)?t:[];var i="";for(var o=0;o<n.length;o++){var a=n[o].split("=");var s=n[o].indexOf("=");var r=a[0];var l=BX.type.isNotEmptyString(a[1])?a[1]:false;if(!BX.util.in_array(r,t)){if(i!==""){i+="&"}i+=r+(s!==-1?"=":"")+(l!==false?l:"")}}return i},updateInformer:function(t,e){if(!t)return false;if(e>0){t.innerHTML=e;BX.addClass(t,"header-informer-act")}else{t.innerHTML="";BX.removeClass(t,"header-informer-act")}},updateCounters:function(t,e){BX.ready(function(){if(BX.getClass("BX.Bitrix24.LeftMenuClass")){BX.Bitrix24.LeftMenuClass.updateCounters(t,e)}})},decrementCounter:function(t,e){BX.ready(function(){if(BX.getClass("BX.Bitrix24.LeftMenuClass")){BX.Bitrix24.LeftMenuClass.decrementCounter(t,e)}})},showNotifyPopup:function(t){if(BX.hasClass(t,"header-informer-press")){BX.removeClass(t,"header-informer-press");BXIM.closeNotify()}else{BXIM.openNotify()}},showMessagePopup:function(t){if(typeof BXIM=="undefined")return false;BXIM.toggleMessenger()},closeBanner:function(t){BX.userOptions.save("bitrix24","banners",t,"Y");var e=BX("sidebar-banner-"+t);if(e){e.style.minHeight="auto";e.style.overflow="hidden";e.style.border="none";new BX.easing({duration:500,start:{height:e.offsetHeight,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){if(t.height>=0){e.style.height=t.height+"px";e.style.opacity=t.opacity/100}if(t.height<=17){e.style.marginBottom=t.height+"px"}},complete:function(){e.style.display="none"}}).animate()}},showLoading:function(t){t=t||500;function e(){var t=BX("b24-loader");if(t){BX.addClass(t,"b24-loader-show intranet-loader-show");return true}return false}setTimeout(function(){if(!e()&&!BX.isReady){BX.ready(e)}},t)}};B24.onScroll=function(){var t=BX.GetWindowScrollPos();if(B24.b24ConnectionStatus){if(B24.b24ConnectionStatus.getAttribute("data-float")=="true"){if(t.scrollTop<60){BX.removeClass(B24.b24ConnectionStatus,"bx24-connection-status-float");B24.b24ConnectionStatus.setAttribute("data-float","false")}}else{if(t.scrollTop>60){BX.addClass(B24.b24ConnectionStatus,"bx24-connection-status-float");B24.b24ConnectionStatus.setAttribute("data-float","true")}}}};B24.goUp=function(t){var e=BX.GetWindowScrollPos();new BX.easing({duration:500,start:{scroll:e.scrollTop},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)},complete:function(){BX.onCustomEvent(window,"onGoUp");if(BX.type.isFunction(t)){t()}}}).animate()};B24.toggleMenu=function(t,e,n){var i=BX.findChild(t.parentNode,{tagName:"ul"},false,false);var o=BX.findChildren(i,{tagName:"li"},false);if(!o)return;var a=BX.findChild(t,{className:"menu-toggle-text"},true,false);if(!a)return;if(BX.hasClass(i,"menu-items-close")){i.style.height="0px";BX.removeClass(i,"menu-items-close");BX.removeClass(BX.nextSibling(BX.nextSibling(t)),"menu-items-close");i.style.opacity=0;s(true,i,i.scrollHeight);a.innerHTML=n;BX.userOptions.save("bitrix24",t.id,"hide","N")}else{s(false,i,i.offsetHeight);a.innerHTML=e;BX.userOptions.save("bitrix24",t.id,"hide","Y")}function s(e,n,i){n.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:i},finish:{opacity:e?100:0,height:e?i:0},transition:BX.easing.transitions.linear,step:function(t){n.style.opacity=t.opacity/100;n.style.height=t.height+"px"},complete:function(){if(!e){BX.addClass(n,"menu-items-close");BX.addClass(BX.nextSibling(BX.nextSibling(t)),"menu-items-close")}n.style.cssText=""}}).animate()}};B24.licenseInfoPopup={show:function(t,e,n,i){if(BX.getClass("BX.Bitrix24.LicenseInfoPopup")){BX.Bitrix24.LicenseInfoPopup.show(t,e,n,i)}}};function showPartnerForm(t){BX=window.BX;BX.Bitrix24PartnerForm={bInit:false,popup:null,arParams:{}};BX.Bitrix24PartnerForm.arParams=t;BX.message(t["MESS"]);BX.Bitrix24PartnerForm.popup=BX.PopupWindowManager.create("BXPartner",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("BX24_PARTNER_TITLE"),closeIcon:{right:"12px",top:"10px"},buttons:[new BX.PopupWindowButtonLink({text:BX.message("BX24_CLOSE_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:'<div style="width:450px;height:230px"></div>',events:{onAfterPopupShow:function(){this.setContent('<div style="width:450px;height:230px">'+BX.message("BX24_LOADING")+"</div>");BX.ajax.post("/bitrix/tools/b24_site_partner.php",{lang:BX.message("LANGUAGE_ID"),site_id:BX.message("SITE_ID")||"",arParams:BX.Bitrix24PartnerForm.arParams},BX.delegate(function(t){this.setContent(t)},this))}}});BX.Bitrix24PartnerForm.popup.show()}B24.Timemanager={inited:false,layout:{block:null,timer:null,info:null,event:null,tasks:null,status:null},data:null,timer:null,clock:null,formatTime:function(t,e){return BX.util.str_pad(parseInt(t/3600),2,"0","left")+":"+BX.util.str_pad(parseInt(t%3600/60),2,"0","left")+(!!e?":"+BX.util.str_pad(t%60,2,"0","left"):"")},formatWorkTime:function(t,e,n){return'<span class="tm-popup-notice-time-hours"><span class="tm-popup-notice-time-number">'+t+'</span></span><span class="tm-popup-notice-time-minutes"><span class="tm-popup-notice-time-number">'+BX.util.str_pad(e,2,"0","left")+'</span></span><span class="tm-popup-notice-time-seconds"><span class="tm-popup-notice-time-number">'+BX.util.str_pad(n,2,"0","left")+"</span></span>"},formatCurrentTime:function(t,e,n){var i="";if(BX.isAmPmMode()){i="AM";if(t>12){t=t-12;i="PM"}else if(t==0){t=12;i="AM"}else if(t==12){i="PM"}i='<span class="time-am-pm">'+i+"</span>"}else t=BX.util.str_pad(t,2,"0","left");return'<span class="time-hours">'+t+"</span>"+'<span class="time-semicolon">:</span>'+'<span class="time-minutes">'+BX.util.str_pad(e,2,"0","left")+"</span>"+i},init:function(t){BX.addCustomEvent("onTimeManDataRecieved",BX.proxy(this.onDataRecieved,this));BX.addCustomEvent("onTimeManNeedRebuild",BX.proxy(this.onDataRecieved,this));BX.addCustomEvent("onPlannerDataRecieved",BX.proxy(this.onPlannerDataRecieved,this));BX.addCustomEvent("onPlannerQueryResult",BX.proxy(this.onPlannerQueryResult,this));BX.addCustomEvent("onTaskTimerChange",BX.proxy(this.onTaskTimerChange,this));BX.timer.registerFormat("worktime_notice_timeman",BX.proxy(this.formatWorkTime,this));BX.timer.registerFormat("bitrix24_time",BX.proxy(this.formatCurrentTime,this));BX.addCustomEvent(window,"onTimemanInit",BX.proxy(function(){this.inited=true;this.layout.block=BX("timeman-block");this.layout.timer=BX("timeman-timer");this.layout.info=BX("timeman-info");this.layout.event=BX("timeman-event");this.layout.tasks=BX("timeman-tasks");this.layout.status=BX("timeman-status");this.layout.statusBlock=BX("timeman-status-block");this.layout.taskTime=BX("timeman-task-time");this.layout.taskTimer=BX("timeman-task-timer");window.BXTIMEMAN.ShowFormWeekly(t);BX.bind(this.layout.block,"click",BX.proxy(this.onTimemanClick,this));BXTIMEMAN.setBindOptions({node:this.layout.block,mode:"popup",popupOptions:{angle:{position:"top",offset:130},offsetTop:10,autoHide:true,offsetLeft:-60,zIndex:-1,events:{onPopupClose:BX.proxy(function(){BX.removeClass(this.layout.block,"timeman-block-active")},this)}}});this.redraw()},this))},onTimemanClick:function(){BX.addClass(this.layout.block,"timeman-block-active");BXTIMEMAN.Open()},onTaskTimerChange:function(t){if(t.action==="refresh_daemon_event"){if(!!this.taskTimerSwitch){this.layout.taskTime.style.display="";if(this.layout.info.style.display!="none"){this.layout.statusBlock.style.display="none"}this.taskTimerSwitch=false}var e="";e+=this.formatTime(parseInt(t.data.TIMER.RUN_TIME||0)+parseInt(t.data.TASK.TIME_SPENT_IN_LOGS||0),true);if(!!t.data.TASK.TIME_ESTIMATE&&t.data.TASK.TIME_ESTIMATE>0){e+=" / "+this.formatTime(parseInt(t.data.TASK.TIME_ESTIMATE))}this.layout.taskTimer.innerHTML=e}else if(t.action==="start_timer"){this.taskTimerSwitch=true}else if(t.action==="stop_timer"){this.layout.taskTime.style.display="none";this.layout.statusBlock.style.display=""}},setTimer:function(){if(this.timer){this.timer.setFrom(new Date(this.data.INFO.DATE_START*1e3));this.timer.dt=-this.data.INFO.TIME_LEAKS*1e3}else{this.timer=BX.timer(this.layout.timer,{from:new Date(this.data.INFO.DATE_START*1e3),dt:-this.data.INFO.TIME_LEAKS*1e3,display:"simple"})}},stopTimer:function(){if(this.timer!=null){BX.timer.stop(this.timer);this.timer=null}},redraw_planner:function(t){if(!!t.TASKS_ENABLED){t.TASKS_COUNT=!t.TASKS_COUNT?0:t.TASKS_COUNT;this.layout.tasks.innerHTML=t.TASKS_COUNT;this.layout.tasks.style.display=t.TASKS_COUNT==0?"none":"inline-block"}if(!!t.CALENDAR_ENABLED){this.layout.event.innerHTML=t.EVENT_TIME;this.layout.event.style.display=t.EVENT_TIME==""?"none":"inline-block"}this.layout.info.style.display=BX.style(this.layout.tasks,"display")=="none"&&BX.style(this.layout.event,"display")=="none"?"none":"block"},redraw:function(){this.redraw_planner(this.data.PLANNER);if(this.data.STATE=="CLOSED"&&(this.data.CAN_OPEN=="REOPEN"||!this.data.CAN_OPEN))this.layout.status.innerHTML=this.getStatusName("COMPLETED");else this.layout.status.innerHTML=this.getStatusName(this.data.STATE);if(!this.timer)this.timer=BX.timer({container:this.layout.timer,display:"bitrix24_time"});var t="";if(this.data.STATE=="CLOSED"){if(this.data.CAN_OPEN=="REOPEN"||!this.data.CAN_OPEN)t="timeman-completed";else t="timeman-start"}else if(this.data.STATE=="PAUSED")t="timeman-paused";else if(this.data.STATE=="EXPIRED")t="timeman-expired";BX.removeClass(this.layout.block,"timeman-completed timeman-start timeman-paused timeman-expired");BX.addClass(this.layout.block,t);if(t=="timeman-start"||t=="timeman-paused"){this.startAnimation()}else{this.endAnimation()}},getStatusName:function(t){return BX.message("TM_STATUS_"+t)},onDataRecieved:function(t){t.OPEN_NOW=false;this.data=t;if(this.inited)this.redraw()},onPlannerQueryResult:function(t,e){if(this.inited)this.redraw_planner(t)},onPlannerDataRecieved:function(t,e){if(this.inited)this.redraw_planner(e)},animation:null,animationTimeout:3e4,blinkAnimation:null,blinkLimit:10,blinkTimeout:750,startAnimation:function(){if(this.animation!==null){this.endAnimation()}this.startBlink();this.animation=setInterval(BX.proxy(this.startBlink,this),this.animationTimeout)},endAnimation:function(){this.endBlink();if(this.animation){clearInterval(this.animation)}this.animation=null},startBlink:function(){if(this.blinkAnimation!==null){this.endBlink()}var t=0;this.blinkAnimation=setInterval(BX.proxy(function(){if(++t>=this.blinkLimit){clearInterval(this.blinkAnimation);BX.show(BX("timeman-background",true))}else{BX.toggle(BX("timeman-background",true))}},this),this.blinkTimeout)},endBlink:function(){if(this.blinkAnimation){clearInterval(this.blinkAnimation)}BX("timeman-background",true).style.cssText="";this.blinkAnimation=null}};B24.Bitrix24InviteDialog={bInit:false,popup:null,arParams:{}};B24.Bitrix24InviteDialog.Init=function(t){if(t)B24.Bitrix24InviteDialog.arParams=t;if(B24.Bitrix24InviteDialog.bInit)return;BX.message(t["MESS"]);B24.Bitrix24InviteDialog.bInit=true;BX.ready(BX.delegate(function(){B24.Bitrix24InviteDialog.popup=BX.PopupWindowManager.create("B24InviteDialog",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,draggable:{restrict:true},closeByEsc:true,titleBar:BX.message("BX24_INVITE_TITLE_INVITE"),contentColor:"white",contentNoPaddings:true,closeIcon:{right:"12px",top:"10px"},buttons:[],className:"bx-b24-invite-dialog-popup",content:'<div style="width:500px;height:300px; background: url(/bitrix/templates/bitrix24/images/loader.gif) no-repeat center;"></div>',events:{onAfterPopupShow:function(){B24.Bitrix24InviteDialog.loadForm()},onPopupClose:function(){BX.InviteDialog.onInviteDialogClose()}}})},this))};B24.Bitrix24InviteDialog.ShowForm=function(t){B24.Bitrix24InviteDialog.Init(t);B24.Bitrix24InviteDialog.popup.show()};B24.Bitrix24InviteDialog.loadForm=function(){B24.Bitrix24InviteDialog.popup.setContent('<div style="width:500px;height:300px; background: url(/bitrix/templates/bitrix24/images/loader.gif) no-repeat center;"></div>');BX.ajax.post("/bitrix/tools/intranet_invite_dialog.php",{lang:BX.message("LANGUAGE_ID"),site_id:BX.message("SITE_ID")||"",arParams:B24.Bitrix24InviteDialog.arParams},BX.delegate(function(t){B24.Bitrix24InviteDialog.popup.setContent(t);B24.Bitrix24InviteDialog.popup.adjustPosition()},this))};B24.Bitrix24InviteDialog.ReInvite=function(t){BX.ajax.post("/bitrix/tools/intranet_invite_dialog.php",{lang:BX.message("LANGUAGE_ID"),site_id:BX.message("SITE_ID")||"",reinvite:t,sessid:BX.bitrix_sessid()},BX.delegate(function(t){},this))};B24.connectionStatus=function(t){if(!(t=="online"||t=="connecting"||t=="offline"))return false;if(this.b24ConnectionStatusState==t)return false;this.b24ConnectionStatusState=t;var e="";if(t=="offline"){b24ConnectionStatusStateText=BX.message("BITRIX24_CS_OFFLINE");e="bx24-connection-status-offline"}else if(t=="connecting"){b24ConnectionStatusStateText=BX.message("BITRIX24_CS_CONNECTING");e="bx24-connection-status-connecting"}else if(t=="online"){b24ConnectionStatusStateText=BX.message("BITRIX24_CS_ONLINE");e="bx24-connection-status-online"}clearTimeout(this.b24ConnectionStatusTimeout);var n=document.querySelector('[data-role="b24-connection-status"]');if(!n){var i=BX.GetWindowScrollPos();var o=i.scrollTop>60;this.b24ConnectionStatus=BX.create("div",{attrs:{className:"bx24-connection-status "+(this.b24ConnectionStatusState=="online"?"bx24-connection-status-hide":"bx24-connection-status-show bx24-connection-status-"+this.b24ConnectionStatusState)+(o?" bx24-connection-status-float":""),"data-role":"b24-connection-status","data-float":o?"true":"false"},children:[BX.create("div",{props:{className:"bx24-connection-status-wrap"},children:[this.b24ConnectionStatusText=BX.create("span",{props:{className:"bx24-connection-status-text"},html:b24ConnectionStatusStateText}),BX.create("span",{props:{className:"bx24-connection-status-text-reload"},children:[BX.create("span",{props:{className:"bx24-connection-status-text-reload-title"},html:BX.message("BITRIX24_CS_RELOAD")}),BX.create("span",{props:{className:"bx24-connection-status-text-reload-hotkey"},html:BX.browser.IsMac()?"&#8984;+R":"Ctrl+R"})],events:{click:function(){location.reload()}}})]})]})}else{this.b24ConnectionStatus=n}if(!this.b24ConnectionStatus)return false;if(t=="online"){clearTimeout(this.b24ConnectionStatusTimeout);this.b24ConnectionStatusTimeout=setTimeout(BX.delegate(function(){BX.removeClass(this.b24ConnectionStatus,"bx24-connection-status-show");this.b24ConnectionStatusTimeout=setTimeout(BX.delegate(function(){BX.removeClass(this.b24ConnectionStatus,"bx24-connection-status-hide")},this),1e3)},this),4e3)}this.b24ConnectionStatus.className="bx24-connection-status bx24-connection-status-show "+e+" "+(this.b24ConnectionStatus.getAttribute("data-float")=="true"?"bx24-connection-status-float":"");this.b24ConnectionStatusText.innerHTML=b24ConnectionStatusStateText;if(!n){var a=BX.findChild(document.body,{className:"bx-layout-inner-table"},true,false);a.parentNode.insertBefore(this.b24ConnectionStatus,a)}return true};B24.showPartnerOrderForm=function(t){if(typeof t!=="object")return;BX.PopupWindowManager.create("B24PartnerOrderForm",null,{autoHide:true,zIndex:0,offsetLeft:0,offsetTop:0,overlay:true,height:Math.min(document.documentElement.clientHeight-100,740),width:560,draggable:{restrict:true},closeByEsc:true,contentColor:"white",contentNoPaddings:true,content:'<script data-b24-form="inline/'+t.id+"/"+t.sec+'" data-skip-moving="true">'+"(function(w,d,u){"+'var s=d.createElement("script");s.async=true;s.src=u+"?"+(Date.now()/180000|0);'+'var h=d.getElementsByTagName("script")[0];h.parentNode.insertBefore(s,h);'+'})(window,document,"https://cp.bitrix.ru/upload/crm/form/loader_${params.id}_${params.sec}.js");'+"<\/script>",events:{onPopupFirstShow:function(){(function(t,e,n){var i=e.createElement("script");i.async=true;i.src=n+"?"+(Date.now()/18e4|0);var o=e.getElementsByTagName("script")[0];o.parentNode.insertBefore(i,o)})(window,document,"https://cp.bitrix.ru/upload/crm/form/loader_"+t.id+"_"+t.sec+".js")}}}).show()};B24.upgradeButtonRedirect=function(t){if(typeof t!=="object")return;var e=t.COUNTER_URL||"",n=t.LICENSE_PATH||"",i=t.HOST||"";BX.ajax.post(e,{action:"upgradeButton",host:i},BX.proxy(function(){document.location.href=n},this))};B24.PopupBlur=function(){BX.PopupWindow.apply(this,arguments);this.setBlurBg();BX.addCustomEvent("OnThemePickerApplyTheme",this.setBlurBg.bind(this))};B24.PopupBlur.prototype={__proto__:BX.PopupWindow.prototype,constructor:B24.PopupBlur,setBlurBg:function(){var t=this.getPopupContainer();var e=window.getComputedStyle(document.body).backgroundImage;var n=window.getComputedStyle(document.body).backgroundColor;t.classList.add("popup-window-blur");var i=BX.create("style",{attrs:{type:"text/css"}});var o=".popup-window-content:after { "+"background-image: "+e+";"+"background-color: "+n+"} ";o=document.createTextNode(o);i.appendChild(o);document.head.appendChild(i);if(this.angle){this.setBlurBgAngle()}},setBlurBgAngle:function(){var t=window.getComputedStyle(document.body).backgroundColor;var e=BX.create("style",{attrs:{type:"text/css"}});var n=".popup-window-angly:after { "+"background-color: "+t+"} ";n=document.createTextNode(n);e.appendChild(n);document.head.appendChild(e)},setPadding:function(t){if(BX.Type.isNumber(t)&&t>=0){this.padding=t;this.getContentContainer().style.padding=t+"px"}else if(t===null){this.padding=null;this.getContentContainer().style.removeProperty("padding")}}};
/* End */
;; /* /bitrix/components/bitrix/tasks.iframe.popup/templates/.default/logic.min.js?16548424637131*/
; /* /bitrix/components/bitrix/search.title/script.min.js?16548423406443*/
; /* /bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/map.min.js?165484264711069*/
; /* /bitrix/templates/bitrix24/components/bitrix/menu/left_vertical/script.min.js?165484264767600*/
; /* /bitrix/templates/bitrix24/components/bitrix/im.messenger/.default/script.min.js?16548426464176*/
; /* /bitrix/templates/bitrix24/bitrix24.min.js?165484264622588*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?165484154145567*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1654841541575*/
; /* /bitrix/components/bitrix/ui.toolbar/templates/.default/script.min.js?16548425236984*/
; /* /local/js/im/lib/localstorage/dist/localstorage.bundle.min.js?16547598172914*/
; /* /local/js/im/lib/logger/dist/logger.bundle.min.js?16547598174491*/
; /* /local/js/im/const/dist/registry.bundle.min.js?16547598176519*/
; /* /local/js/im/lib/utils/dist/utils.bundle.min.js?165475981718118*/
; /* /local/js/im/model/dist/registry.bundle.min.js?165475981797207*/
; /* /local/js/im/provider/pull/dist/registry.bundle.min.js?165475981718727*/
; /* /local/js/im/provider/rest/dist/registry.bundle.min.js?16547598175400*/
; /* /local/js/im/lib/timer/dist/timer.bundle.min.js?16547598172172*/
; /* /local/js/im/controller/dist/controller.bundle.min.js?165475981720247*/
; /* /local/js/im/application/launch/dist/launch.bundle.min.js?16547598171204*/
; /* /local/js/im/application/core/dist/core.bundle.min.js?1654759817436*/
; /* /local/js/im/lib/animation/dist/animation.bundle.min.js?16547598171109*/
; /* /local/js/im/view/element/attach/dist/attach.bundle.min.js?165475981717056*/
; /* /local/js/im/view/element/keyboard/dist/keyboard.bundle.min.js?16547598173415*/
; /* /local/js/im/view/popup/dist/popup.bundle.min.js?16547598189787*/
; /* /local/js/im/component/notifications/dist/notifications.bundle.min.js?165475981747876*/
; /* /local/js/im/application/notifications/dist/notifications.bundle.min.js?16547598173079*/
; /* /local/js/im/lib/clipboard/dist/clipboard.bundle.min.js?16547598171010*/
; /* /local/js/im/component/conference/conference-create/dist/conference-create.bundle.min.js?16547598179398*/

//# sourceMappingURL=template_bx24.map.js